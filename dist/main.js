/*! For license information please see main.js.LICENSE.txt */
(()=>{var e,t,a,i,n={9450:e=>{"use strict";class SubRange{constructor(e,t){this.low=e,this.high=t,this.length=1+t-e}overlaps(e){return!(this.high<e.low||this.low>e.high)}touches(e){return!(this.high+1<e.low||this.low-1>e.high)}add(e){return new SubRange(Math.min(this.low,e.low),Math.max(this.high,e.high))}subtract(e){return e.low<=this.low&&e.high>=this.high?[]:e.low>this.low&&e.high<this.high?[new SubRange(this.low,e.low-1),new SubRange(e.high+1,this.high)]:e.low<=this.low?[new SubRange(e.high+1,this.high)]:[new SubRange(this.low,e.low-1)]}toString(){return this.low==this.high?this.low.toString():this.low+"-"+this.high}}class DRange{constructor(e,t){this.ranges=[],this.length=0,null!=e&&this.add(e,t)}_update_length(){this.length=this.ranges.reduce(((e,t)=>e+t.length),0)}add(e,t){var a=e=>{for(var t=0;t<this.ranges.length&&!e.touches(this.ranges[t]);)t++;for(var a=this.ranges.slice(0,t);t<this.ranges.length&&e.touches(this.ranges[t]);)e=e.add(this.ranges[t]),t++;a.push(e),this.ranges=a.concat(this.ranges.slice(t)),this._update_length()};return e instanceof DRange?e.ranges.forEach(a):(null==t&&(t=e),a(new SubRange(e,t))),this}subtract(e,t){var a=e=>{for(var t=0;t<this.ranges.length&&!e.overlaps(this.ranges[t]);)t++;for(var a=this.ranges.slice(0,t);t<this.ranges.length&&e.overlaps(this.ranges[t]);)a=a.concat(this.ranges[t].subtract(e)),t++;this.ranges=a.concat(this.ranges.slice(t)),this._update_length()};return e instanceof DRange?e.ranges.forEach(a):(null==t&&(t=e),a(new SubRange(e,t))),this}intersect(e,t){var a=[],i=e=>{for(var t=0;t<this.ranges.length&&!e.overlaps(this.ranges[t]);)t++;for(;t<this.ranges.length&&e.overlaps(this.ranges[t]);){var i=Math.max(this.ranges[t].low,e.low),n=Math.min(this.ranges[t].high,e.high);a.push(new SubRange(i,n)),t++}};return e instanceof DRange?e.ranges.forEach(i):(null==t&&(t=e),i(new SubRange(e,t))),this.ranges=a,this._update_length(),this}index(e){for(var t=0;t<this.ranges.length&&this.ranges[t].length<=e;)e-=this.ranges[t].length,t++;return this.ranges[t].low+e}toString(){return"[ "+this.ranges.join(", ")+" ]"}clone(){return new DRange(this)}numbers(){return this.ranges.reduce(((e,t)=>{for(var a=t.low;a<=t.high;)e.push(a),a++;return e}),[])}subranges(){return this.ranges.map((e=>({low:e.low,high:e.high,length:1+e.high-e.low})))}}e.exports=DRange},4419:(e,t,a)=>{const i=a(697),n=a(9450),s=i.types;e.exports=class RandExp{constructor(e,t){if(this._setDefaults(e),e instanceof RegExp)this.ignoreCase=e.ignoreCase,this.multiline=e.multiline,e=e.source;else{if("string"!=typeof e)throw new Error("Expected a regexp or string");this.ignoreCase=t&&-1!==t.indexOf("i"),this.multiline=t&&-1!==t.indexOf("m")}this.tokens=i(e)}_setDefaults(e){this.max=null!=e.max?e.max:null!=RandExp.prototype.max?RandExp.prototype.max:100,this.defaultRange=e.defaultRange?e.defaultRange:this.defaultRange.clone(),e.randInt&&(this.randInt=e.randInt)}gen(){return this._gen(this.tokens,[])}_gen(e,t){var a,i,n,r,o;switch(e.type){case s.ROOT:case s.GROUP:if(e.followedBy||e.notFollowedBy)return"";for(e.remember&&void 0===e.groupNumber&&(e.groupNumber=t.push(null)-1),i="",r=0,o=(a=e.options?this._randSelect(e.options):e.stack).length;r<o;r++)i+=this._gen(a[r],t);return e.remember&&(t[e.groupNumber]=i),i;case s.POSITION:return"";case s.SET:var l=this._expand(e);return l.length?String.fromCharCode(this._randSelect(l)):"";case s.REPETITION:for(n=this.randInt(e.min,e.max===1/0?e.min+this.max:e.max),i="",r=0;r<n;r++)i+=this._gen(e.value,t);return i;case s.REFERENCE:return t[e.value-1]||"";case s.CHAR:var c=this.ignoreCase&&this._randBool()?this._toOtherCase(e.value):e.value;return String.fromCharCode(c)}}_toOtherCase(e){return e+(97<=e&&e<=122?-32:65<=e&&e<=90?32:0)}_randBool(){return!this.randInt(0,1)}_randSelect(e){return e instanceof n?e.index(this.randInt(0,e.length-1)):e[this.randInt(0,e.length-1)]}_expand(e){if(e.type===i.types.CHAR)return new n(e.value);if(e.type===i.types.RANGE)return new n(e.from,e.to);{let t=new n;for(let a=0;a<e.set.length;a++){let i=this._expand(e.set[a]);if(t.add(i),this.ignoreCase)for(let e=0;e<i.length;e++){let a=i.index(e),n=this._toOtherCase(a);a!==n&&t.add(n)}}return e.not?this.defaultRange.clone().subtract(t):this.defaultRange.clone().intersect(t)}}randInt(e,t){return e+Math.floor(Math.random()*(1+t-e))}get defaultRange(){return this._range=this._range||new n(32,126)}set defaultRange(e){this._range=e}static randexp(e,t){var a;return"string"==typeof e&&(e=new RegExp(e,t)),void 0===e._randexp?(a=new RandExp(e,t),e._randexp=a):(a=e._randexp)._setDefaults(e),a.gen()}static sugar(){RegExp.prototype.gen=function(){return RandExp.randexp(this)}}}},697:(e,t,a)=>{const i=a(6245),n=a(504),s=a(4992),r=a(2407);e.exports=e=>{var t,a,o=0,l={type:n.ROOT,stack:[]},c=l,d=l.stack,u=[],h=t=>{i.error(e,"Nothing to repeat at column "+(t-1))},p=i.strToChars(e);for(t=p.length;o<t;)switch(a=p[o++]){case"\\":switch(a=p[o++]){case"b":d.push(r.wordBoundary());break;case"B":d.push(r.nonWordBoundary());break;case"w":d.push(s.words());break;case"W":d.push(s.notWords());break;case"d":d.push(s.ints());break;case"D":d.push(s.notInts());break;case"s":d.push(s.whitespace());break;case"S":d.push(s.notWhitespace());break;default:/\d/.test(a)?d.push({type:n.REFERENCE,value:parseInt(a,10)}):d.push({type:n.CHAR,value:a.charCodeAt(0)})}break;case"^":d.push(r.begin());break;case"$":d.push(r.end());break;case"[":var m;"^"===p[o]?(m=!0,o++):m=!1;var f=i.tokenizeClass(p.slice(o),e);o+=f[1],d.push({type:n.SET,set:f[0],not:m});break;case".":d.push(s.anyChar());break;case"(":var g={type:n.GROUP,stack:[],remember:!0};"?"===(a=p[o])&&(a=p[o+1],o+=2,"="===a?g.followedBy=!0:"!"===a?g.notFollowedBy=!0:":"!==a&&i.error(e,`Invalid group, character '${a}' after '?' at column `+(o-1)),g.remember=!1),d.push(g),u.push(c),c=g,d=g.stack;break;case")":0===u.length&&i.error(e,"Unmatched ) at column "+(o-1)),d=(c=u.pop()).options?c.options[c.options.length-1]:c.stack;break;case"|":c.options||(c.options=[c.stack],delete c.stack);var y=[];c.options.push(y),d=y;break;case"{":var v,b,A=/^(\d+)(,(\d+)?)?\}/.exec(p.slice(o));null!==A?(0===d.length&&h(o),v=parseInt(A[1],10),b=A[2]?A[3]?parseInt(A[3],10):1/0:v,o+=A[0].length,d.push({type:n.REPETITION,min:v,max:b,value:d.pop()})):d.push({type:n.CHAR,value:123});break;case"?":0===d.length&&h(o),d.push({type:n.REPETITION,min:0,max:1,value:d.pop()});break;case"+":0===d.length&&h(o),d.push({type:n.REPETITION,min:1,max:1/0,value:d.pop()});break;case"*":0===d.length&&h(o),d.push({type:n.REPETITION,min:0,max:1/0,value:d.pop()});break;default:d.push({type:n.CHAR,value:a.charCodeAt(0)})}return 0!==u.length&&i.error(e,"Unterminated group"),l},e.exports.types=n},2407:(e,t,a)=>{const i=a(504);t.wordBoundary=()=>({type:i.POSITION,value:"b"}),t.nonWordBoundary=()=>({type:i.POSITION,value:"B"}),t.begin=()=>({type:i.POSITION,value:"^"}),t.end=()=>({type:i.POSITION,value:"$"})},4992:(e,t,a)=>{const i=a(504),n=()=>[{type:i.RANGE,from:48,to:57}],s=()=>[{type:i.CHAR,value:95},{type:i.RANGE,from:97,to:122},{type:i.RANGE,from:65,to:90}].concat(n()),r=()=>[{type:i.CHAR,value:9},{type:i.CHAR,value:10},{type:i.CHAR,value:11},{type:i.CHAR,value:12},{type:i.CHAR,value:13},{type:i.CHAR,value:32},{type:i.CHAR,value:160},{type:i.CHAR,value:5760},{type:i.RANGE,from:8192,to:8202},{type:i.CHAR,value:8232},{type:i.CHAR,value:8233},{type:i.CHAR,value:8239},{type:i.CHAR,value:8287},{type:i.CHAR,value:12288},{type:i.CHAR,value:65279}];t.words=()=>({type:i.SET,set:s(),not:!1}),t.notWords=()=>({type:i.SET,set:s(),not:!0}),t.ints=()=>({type:i.SET,set:n(),not:!1}),t.notInts=()=>({type:i.SET,set:n(),not:!0}),t.whitespace=()=>({type:i.SET,set:r(),not:!1}),t.notWhitespace=()=>({type:i.SET,set:r(),not:!0}),t.anyChar=()=>({type:i.SET,set:[{type:i.CHAR,value:10},{type:i.CHAR,value:13},{type:i.CHAR,value:8232},{type:i.CHAR,value:8233}],not:!0})},504:e=>{e.exports={ROOT:0,GROUP:1,POSITION:2,SET:3,RANGE:4,REPETITION:5,REFERENCE:6,CHAR:7}},6245:(e,t,a)=>{const i=a(504),n=a(4992),s={0:0,t:9,n:10,v:11,f:12,r:13};t.strToChars=function(e){return e=e.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|(0?[0-7]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(function(e,t,a,i,n,r,o,l){if(a)return e;var c=t?8:i?parseInt(i,16):n?parseInt(n,16):r?parseInt(r,8):o?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(o):s[l],d=String.fromCharCode(c);return/[[\]{}^$.|?*+()]/.test(d)&&(d="\\"+d),d}))},t.tokenizeClass=(e,a)=>{for(var s,r,o=[],l=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(?:\\)?([^\]]))|(\])|(?:\\)?([^])/g;null!=(s=l.exec(e));)if(s[1])o.push(n.words());else if(s[2])o.push(n.ints());else if(s[3])o.push(n.whitespace());else if(s[4])o.push(n.notWords());else if(s[5])o.push(n.notInts());else if(s[6])o.push(n.notWhitespace());else if(s[7])o.push({type:i.RANGE,from:(s[8]||s[9]).charCodeAt(0),to:s[10].charCodeAt(0)});else{if(!(r=s[12]))return[o,l.lastIndex];o.push({type:i.CHAR,value:r.charCodeAt(0)})}t.error(a,"Unterminated character class")},t.error=(e,t)=>{throw new SyntaxError("Invalid regular expression: /"+e+"/: "+t)}},7156:(e,t,a)=>{"use strict";a.d(t,{yw:()=>FultimatorImportApplication});var i=a(4892);const n=e=>({dexterity:"dex",insight:"ins",might:"mig",will:"wlp",willpower:"wlp",dex:"dex",ins:"ins",mig:"mig",wlp:"wlp"}[e?.toLowerCase()||"dex"]||"dex");function s(e){const t=String(e).normalize("NFKD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+/g,"").replace(/-+$/g,"").trim();return console.debug([e,t]),t}function r(e){if(!e)return"";return e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")}const o={Arcane:"arcane",Bow:"bow",Flail:"flail",Firearm:"firearm",Spear:"spear",spear_category:"spear",Thrown:"thrown",Heavy:"heavy",Dagger:"dagger",Brawling:"brawling",Sword:"sword"},l={vu:-1,no:0,rs:1,im:2,ab:3},c={dexterity:"dex",might:"mig",insight:"ins",will:"wlp"},d={physical:"physical",wind:"air",bolt:"bolt",dark:"dark",earth:"earth",fire:"fire",ice:"ice",light:"light",poison:"poison"},u=e=>e?l[e]:0,h=(e,t="Unnamed")=>e?.trim()||t,p=e=>{if("string"==typeof e){const t=/(\d+)\s*(x|Ã—)\s*T/i,a=e.match(t);if(a)return{amount:parseInt(a[1],10),perTarget:!0};const i=parseInt(e,10);if(!isNaN(i))return{amount:i,perTarget:!1}}return"number"==typeof e?{amount:e,perTarget:!1}:{amount:0,perTarget:!1}},m=(e,t)=>{let a,i;if(e){const t=(e=>{const t=(e||"").toLowerCase();let a="single",i=1,n=!1;return t.includes("self")?(a="self",n=!0):t.includes("one creature")?(a="single",n=!0):t.includes("up to two creatures")?(a="multiple",i=2,n=!0):t.includes("up to three creatures")?(a="multiple",i=3,n=!0):t.includes("up to four creatures")?(a="multiple",i=4,n=!0):t.includes("up to five creatures")?(a="multiple",i=5,n=!0):t.includes("one equipped weapon")?(a="weapon",n=!0):t.includes("special")&&(a="special",n=!0),{rule:a,max:i,success:n}})(e);if(t.success)return a=t.rule,i=t.max,{targetingRule:a,maxTargets:i}}return i=t??1,a=i>1?"multiple":"single",{targetingRule:a,maxTargets:i}};var f;!function(e){e.Npc="npc",e.Pc="pc",e.Class="class",e.PCWeapon="weapon",e.PCCustomWeapon="customWeapon",e.PCArmor="armor",e.PCShield="shield",e.PCAccessory="accessory",e.Arcana="arcana"}(f||(f={}));class FultimatorImportApplication extends FormApplication{async _updateObject(e,t){if(this.object.preferCompendium=Boolean(t.preferCompendium&&t.preferCompendium),t.text!=this.object.text){delete this.object.error,this.object.text=t.text,this.object.dataType=this.detectDataType(t.text);try{switch(this.object.dataType){case f.Npc:this.object.parse=(a=this.object.text,(e=>(!1===(e=>{const t=e=>"string"==typeof e.name&&("melee"===e.range||"distance"===e.range)&&("might"===e.attr1||"dexterity"===e.attr1||"insight"===e.attr1||"will"===e.attr1)&&("might"===e.attr2||"dexterity"===e.attr2||"insight"===e.attr2||"will"===e.attr2)&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type)&&Array.isArray(e.special)&&e.special.every((e=>"string"==typeof e))&&(void 0===e.extraDamage||"boolean"==typeof e.extraDamage)&&(void 0===e.flatdmg||"string"==typeof e.flatdmg||"number"==typeof e.flatdmg)&&(void 0===e.flathit||"string"==typeof e.flathit||"number"==typeof e.flathit),a=e=>!(void 0!==e.physical&&"rs"!==e.physical&&"vu"!==e.physical&&"ab"!==e.physical&&"im"!==e.physical&&"no"!==e.physical||void 0!==e.wind&&"rs"!==e.wind&&"vu"!==e.wind&&"ab"!==e.wind&&"im"!==e.wind&&"no"!==e.wind||void 0!==e.bolt&&"rs"!==e.bolt&&"vu"!==e.bolt&&"ab"!==e.bolt&&"im"!==e.bolt&&"no"!==e.bolt||void 0!==e.dark&&"rs"!==e.dark&&"vu"!==e.dark&&"ab"!==e.dark&&"im"!==e.dark&&"no"!==e.dark||void 0!==e.earth&&"rs"!==e.earth&&"vu"!==e.earth&&"ab"!==e.earth&&"im"!==e.earth&&"no"!==e.earth||void 0!==e.ice&&"rs"!==e.ice&&"vu"!==e.ice&&"ab"!==e.ice&&"im"!==e.ice&&"no"!==e.ice||void 0!==e.light&&"rs"!==e.light&&"vu"!==e.light&&"ab"!==e.light&&"im"!==e.light&&"no"!==e.light||void 0!==e.poison&&"rs"!==e.poison&&"vu"!==e.poison&&"ab"!==e.poison&&"im"!==e.poison&&"no"!==e.poison||void 0!==e.fire&&"rs"!==e.fire&&"vu"!==e.fire&&"ab"!==e.fire&&"im"!==e.fire&&"no"!==e.fire),i=e=>"string"==typeof e.name&&"string"==typeof e.effect,n=e=>!(void 0!==e.init&&"boolean"!=typeof e.init||void 0!==e.precision&&"boolean"!=typeof e.precision||void 0!==e.hp&&"string"!=typeof e.hp||void 0!==e.mp&&"string"!=typeof e.mp||void 0!==e.def&&"number"!=typeof e.def||void 0!==e.mDef&&"number"!=typeof e.mDef||void 0!==e.extrainit&&"string"!=typeof e.extrainit||void 0!==e.magic&&"boolean"!=typeof e.magic),s=e=>(void 0===e.effect||"string"==typeof e.effect)&&(void 0===e.target||"string"==typeof e.target)&&(void 0===e.duration||"string"==typeof e.duration)&&"string"==typeof e.name&&(null===e.type||"string"==typeof e.type)&&("might"===e.attr1||"dexterity"===e.attr1||"insight"===e.attr1||"will"===e.attr1)&&("might"===e.attr2||"dexterity"===e.attr2||"insight"===e.attr2||"will"===e.attr2)&&(void 0===e.mp||"string"==typeof e.mp)&&(void 0===e.maxTargets||"number"==typeof e.maxTargets)&&Array.isArray(e.special)&&e.special.every((e=>"string"==typeof e)),r=e=>"string"==typeof e.name&&"string"==typeof e.effect,o=e=>(void 0===e.extraDamage||"boolean"==typeof e.extraDamage)&&"object"==typeof e.weapon&&null!==e.weapon&&l(e.weapon)&&"string"==typeof e.name&&(void 0===e.type||"physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type)&&Array.isArray(e.special)&&e.special.every((e=>"string"==typeof e))&&(void 0===e.flathit||"string"==typeof e.flathit||"number"==typeof e.flathit)&&(void 0===e.flatdmg||"string"==typeof e.flatdmg||"number"==typeof e.flatdmg),l=e=>!("string"!=typeof e.name||"number"!=typeof e.cost||"Arcane"!==e.category&&"Bow"!==e.category&&"Flail"!==e.category&&"Firearm"!==e.category&&"Spear"!==e.category&&"spear_category"!==e.category&&"Thrown"!==e.category&&"Heavy"!==e.category&&"Dagger"!==e.category&&"Brawling"!==e.category&&"Sword"!==e.category||"number"!=typeof e.prec||"might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2||void 0!==e.martial&&"boolean"!=typeof e.martial||void 0!==e.range&&"melee"!==e.range&&"distance"!==e.range||void 0!==e.melee&&"boolean"!=typeof e.melee||void 0!==e.ranged&&"boolean"!=typeof e.ranged||"number"!=typeof e.hands||"number"!=typeof e.damage||"physical"!==e.type&&"wind"!==e.type&&"bolt"!==e.type&&"dark"!==e.type&&"earth"!==e.type&&"fire"!==e.type&&"ice"!==e.type&&"light"!==e.type&&"poison"!==e.type||void 0!==e.quality&&"string"!=typeof e.quality),c=e=>"number"==typeof e.def&&"string"==typeof e.name&&"number"==typeof e.init&&"number"==typeof e.mdefbonus&&"number"==typeof e.cost&&"number"==typeof e.mdef&&"number"==typeof e.defbonus,d=e=>"string"==typeof e.name&&"string"==typeof e.effect,u=e=>"string"==typeof e.name&&"string"==typeof e.effect;return"object"==typeof e&&null!==e&&(e=>("string"==typeof e.id||"number"==typeof e.id)&&"string"==typeof e.uid&&(void 0===e.imgurl||"string"==typeof e.imgurl)&&"string"==typeof e.name&&"number"==typeof e.lvl&&Array.isArray(e.attacks)&&e.attacks.every((e=>"object"==typeof e&&null!==e&&t(e)))&&"object"==typeof e.affinities&&null!==e.affinities&&!1===Array.isArray(e.affinities)&&a(e.affinities)&&"object"==typeof e.attributes&&null!==e.attributes&&"number"==typeof e.attributes.might&&"number"==typeof e.attributes.insight&&"number"==typeof e.attributes.will&&"number"==typeof e.attributes.dexterity&&"string"==typeof e.species&&(void 0===e.villain||""===e.villain||"major"===e.villain||"supreme"===e.villain||"minor"===e.villain)&&(void 0===e.phases||"string"==typeof e.phases||"number"==typeof e.phases)&&(void 0===e.multipart||"string"==typeof e.multipart)&&(void 0===e.rank||"soldier"===e.rank||"elite"===e.rank||"champion1"===e.rank||"champion2"===e.rank||"champion3"===e.rank||"champion4"===e.rank||"champion5"===e.rank||"champion6"===e.rank||"companion"===e.rank)&&(void 0===e.traits||"string"==typeof e.traits)&&(void 0===e.actions||Array.isArray(e.actions)&&e.actions.every((e=>"object"==typeof e&&null!==e&&i(e))))&&(void 0===e.extra||"object"==typeof e.extra&&null!==e.extra&&!1===Array.isArray(e.extra)&&n(e.extra))&&(void 0===e.spells||Array.isArray(e.spells)&&e.spells.every((e=>"object"==typeof e&&null!==e&&s(e))))&&(void 0===e.special||Array.isArray(e.special)&&e.special.every((e=>"object"==typeof e&&null!==e&&r(e))))&&(void 0===e.weaponattacks||Array.isArray(e.weaponattacks)&&e.weaponattacks.every((e=>"object"==typeof e&&null!==e&&o(e))))&&(void 0===e.description||"string"==typeof e.description)&&(void 0===e.armor||"object"==typeof e.armor&&null!==e.armor&&c(e.armor))&&(void 0===e.shield||"object"==typeof e.shield&&null!==e.shield&&c(e.shield))&&(void 0===e.raregear||Array.isArray(e.raregear)&&e.raregear.every((e=>"object"==typeof e&&null!==e&&d(e))))&&(void 0===e.label||"string"==typeof e.label)&&(void 0===e.notes||Array.isArray(e.notes)&&e.notes.every((e=>"object"==typeof e&&null!==e&&u(e)))))(e)})(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard,s=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("melee"===e.range||"distance"===e.range||n(a,{path:t+".range",expected:'("distance" | "melee")',value:e.range}))&&("might"===e.attr1||"dexterity"===e.attr1||"insight"===e.attr1||"will"===e.attr1||n(a,{path:t+".attr1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.attr1}))&&("might"===e.attr2||"dexterity"===e.attr2||"insight"===e.attr2||"will"===e.attr2||n(a,{path:t+".attr2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.attr2}))&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.type}))&&((Array.isArray(e.special)||n(a,{path:t+".special",expected:"Array<string>",value:e.special}))&&e.special.every(((e,i)=>"string"==typeof e||n(a,{path:t+".special["+i+"]",expected:"string",value:e})))||n(a,{path:t+".special",expected:"Array<string>",value:e.special}))&&(void 0===e.extraDamage||"boolean"==typeof e.extraDamage||n(a,{path:t+".extraDamage",expected:"(boolean | undefined)",value:e.extraDamage}))&&(void 0===e.flatdmg||"string"==typeof e.flatdmg||"number"==typeof e.flatdmg||n(a,{path:t+".flatdmg",expected:"(number | string | undefined)",value:e.flatdmg}))&&(void 0===e.flathit||"string"==typeof e.flathit||"number"==typeof e.flathit||n(a,{path:t+".flathit",expected:"(number | string | undefined)",value:e.flathit})),r=(e,t,a=!0)=>(void 0===e.physical||"rs"===e.physical||"vu"===e.physical||"ab"===e.physical||"im"===e.physical||"no"===e.physical||n(a,{path:t+".physical",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.physical}))&&(void 0===e.wind||"rs"===e.wind||"vu"===e.wind||"ab"===e.wind||"im"===e.wind||"no"===e.wind||n(a,{path:t+".wind",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.wind}))&&(void 0===e.bolt||"rs"===e.bolt||"vu"===e.bolt||"ab"===e.bolt||"im"===e.bolt||"no"===e.bolt||n(a,{path:t+".bolt",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.bolt}))&&(void 0===e.dark||"rs"===e.dark||"vu"===e.dark||"ab"===e.dark||"im"===e.dark||"no"===e.dark||n(a,{path:t+".dark",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.dark}))&&(void 0===e.earth||"rs"===e.earth||"vu"===e.earth||"ab"===e.earth||"im"===e.earth||"no"===e.earth||n(a,{path:t+".earth",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.earth}))&&(void 0===e.ice||"rs"===e.ice||"vu"===e.ice||"ab"===e.ice||"im"===e.ice||"no"===e.ice||n(a,{path:t+".ice",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.ice}))&&(void 0===e.light||"rs"===e.light||"vu"===e.light||"ab"===e.light||"im"===e.light||"no"===e.light||n(a,{path:t+".light",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.light}))&&(void 0===e.poison||"rs"===e.poison||"vu"===e.poison||"ab"===e.poison||"im"===e.poison||"no"===e.poison||n(a,{path:t+".poison",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.poison}))&&(void 0===e.fire||"rs"===e.fire||"vu"===e.fire||"ab"===e.fire||"im"===e.fire||"no"===e.fire||n(a,{path:t+".fire",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.fire})),o=(e,t,a=!0)=>("number"==typeof e.might||n(a,{path:t+".might",expected:"number",value:e.might}))&&("number"==typeof e.insight||n(a,{path:t+".insight",expected:"number",value:e.insight}))&&("number"==typeof e.will||n(a,{path:t+".will",expected:"number",value:e.will}))&&("number"==typeof e.dexterity||n(a,{path:t+".dexterity",expected:"number",value:e.dexterity})),l=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect})),c=(e,t,a=!0)=>(void 0===e.init||"boolean"==typeof e.init||n(a,{path:t+".init",expected:"(boolean | undefined)",value:e.init}))&&(void 0===e.precision||"boolean"==typeof e.precision||n(a,{path:t+".precision",expected:"(boolean | undefined)",value:e.precision}))&&(void 0===e.hp||"string"==typeof e.hp||n(a,{path:t+".hp",expected:"(string | undefined)",value:e.hp}))&&(void 0===e.mp||"string"==typeof e.mp||n(a,{path:t+".mp",expected:"(string | undefined)",value:e.mp}))&&(void 0===e.def||"number"==typeof e.def||n(a,{path:t+".def",expected:"(number | undefined)",value:e.def}))&&(void 0===e.mDef||"number"==typeof e.mDef||n(a,{path:t+".mDef",expected:"(number | undefined)",value:e.mDef}))&&(void 0===e.extrainit||"string"==typeof e.extrainit||n(a,{path:t+".extrainit",expected:"(string | undefined)",value:e.extrainit}))&&(void 0===e.magic||"boolean"==typeof e.magic||n(a,{path:t+".magic",expected:"(boolean | undefined)",value:e.magic})),d=(e,t,a=!0)=>(void 0===e.effect||"string"==typeof e.effect||n(a,{path:t+".effect",expected:"(string | undefined)",value:e.effect}))&&(void 0===e.target||"string"==typeof e.target||n(a,{path:t+".target",expected:"(string | undefined)",value:e.target}))&&(void 0===e.duration||"string"==typeof e.duration||n(a,{path:t+".duration",expected:"(string | undefined)",value:e.duration}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(null===e.type||"string"==typeof e.type||n(a,{path:t+".type",expected:"(null | string)",value:e.type}))&&("might"===e.attr1||"dexterity"===e.attr1||"insight"===e.attr1||"will"===e.attr1||n(a,{path:t+".attr1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.attr1}))&&("might"===e.attr2||"dexterity"===e.attr2||"insight"===e.attr2||"will"===e.attr2||n(a,{path:t+".attr2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.attr2}))&&(void 0===e.mp||"string"==typeof e.mp||n(a,{path:t+".mp",expected:"(string | undefined)",value:e.mp}))&&(void 0===e.maxTargets||"number"==typeof e.maxTargets||n(a,{path:t+".maxTargets",expected:"(number | undefined)",value:e.maxTargets}))&&((Array.isArray(e.special)||n(a,{path:t+".special",expected:"Array<string>",value:e.special}))&&e.special.every(((e,i)=>"string"==typeof e||n(a,{path:t+".special["+i+"]",expected:"string",value:e})))||n(a,{path:t+".special",expected:"Array<string>",value:e.special})),u=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect})),h=(e,t,a=!0)=>(void 0===e.extraDamage||"boolean"==typeof e.extraDamage||n(a,{path:t+".extraDamage",expected:"(boolean | undefined)",value:e.extraDamage}))&&(("object"==typeof e.weapon&&null!==e.weapon||n(a,{path:t+".weapon",expected:"Weapon",value:e.weapon}))&&p(e.weapon,t+".weapon",a)||n(a,{path:t+".weapon",expected:"Weapon",value:e.weapon}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.type||"physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind" | undefined)',value:e.type}))&&((Array.isArray(e.special)||n(a,{path:t+".special",expected:"Array<string>",value:e.special}))&&e.special.every(((e,i)=>"string"==typeof e||n(a,{path:t+".special["+i+"]",expected:"string",value:e})))||n(a,{path:t+".special",expected:"Array<string>",value:e.special}))&&(void 0===e.flathit||"string"==typeof e.flathit||"number"==typeof e.flathit||n(a,{path:t+".flathit",expected:"(number | string | undefined)",value:e.flathit}))&&(void 0===e.flatdmg||"string"==typeof e.flatdmg||"number"==typeof e.flatdmg||n(a,{path:t+".flatdmg",expected:"(number | string | undefined)",value:e.flatdmg})),p=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("Arcane"===e.category||"Bow"===e.category||"Flail"===e.category||"Firearm"===e.category||"Spear"===e.category||"spear_category"===e.category||"Thrown"===e.category||"Heavy"===e.category||"Dagger"===e.category||"Brawling"===e.category||"Sword"===e.category||n(a,{path:t+".category",expected:'("Arcane" | "Bow" | "Brawling" | "Dagger" | "Firearm" | "Flail" | "Heavy" | "Spear" | "Sword" | "Thrown" | "spear_category")',value:e.category}))&&("number"==typeof e.prec||n(a,{path:t+".prec",expected:"number",value:e.prec}))&&("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2}))&&(void 0===e.martial||"boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"(boolean | undefined)",value:e.martial}))&&(void 0===e.range||"melee"===e.range||"distance"===e.range||n(a,{path:t+".range",expected:'("distance" | "melee" | undefined)',value:e.range}))&&(void 0===e.melee||"boolean"==typeof e.melee||n(a,{path:t+".melee",expected:"(boolean | undefined)",value:e.melee}))&&(void 0===e.ranged||"boolean"==typeof e.ranged||n(a,{path:t+".ranged",expected:"(boolean | undefined)",value:e.ranged}))&&("number"==typeof e.hands||n(a,{path:t+".hands",expected:"number",value:e.hands}))&&("number"==typeof e.damage||n(a,{path:t+".damage",expected:"number",value:e.damage}))&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.type}))&&(void 0===e.quality||"string"==typeof e.quality||n(a,{path:t+".quality",expected:"(string | undefined)",value:e.quality})),m=(e,t,a=!0)=>("number"==typeof e.def||n(a,{path:t+".def",expected:"number",value:e.def}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.init||n(a,{path:t+".init",expected:"number",value:e.init}))&&("number"==typeof e.mdefbonus||n(a,{path:t+".mdefbonus",expected:"number",value:e.mdefbonus}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("number"==typeof e.mdef||n(a,{path:t+".mdef",expected:"number",value:e.mdef}))&&("number"==typeof e.defbonus||n(a,{path:t+".defbonus",expected:"number",value:e.defbonus})),f=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect})),g=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}));("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"Npc",value:e}))&&((e,t,a=!0)=>("string"==typeof e.id||"number"==typeof e.id||n(a,{path:t+".id",expected:"(number | string)",value:e.id}))&&("string"==typeof e.uid||n(a,{path:t+".uid",expected:"string",value:e.uid}))&&(void 0===e.imgurl||"string"==typeof e.imgurl||n(a,{path:t+".imgurl",expected:"(string | undefined)",value:e.imgurl}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.lvl||n(a,{path:t+".lvl",expected:"number",value:e.lvl}))&&((Array.isArray(e.attacks)||n(a,{path:t+".attacks",expected:"Array<NpcAttack>",value:e.attacks}))&&e.attacks.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".attacks["+i+"]",expected:"NpcAttack",value:e}))&&s(e,t+".attacks["+i+"]",a)||n(a,{path:t+".attacks["+i+"]",expected:"NpcAttack",value:e})))||n(a,{path:t+".attacks",expected:"Array<NpcAttack>",value:e.attacks}))&&(("object"==typeof e.affinities&&null!==e.affinities&&!1===Array.isArray(e.affinities)||n(a,{path:t+".affinities",expected:"NpcAffinities",value:e.affinities}))&&r(e.affinities,t+".affinities",a)||n(a,{path:t+".affinities",expected:"NpcAffinities",value:e.affinities}))&&(("object"==typeof e.attributes&&null!==e.attributes||n(a,{path:t+".attributes",expected:"NpcAttributes",value:e.attributes}))&&o(e.attributes,t+".attributes",a)||n(a,{path:t+".attributes",expected:"NpcAttributes",value:e.attributes}))&&("string"==typeof e.species||n(a,{path:t+".species",expected:"string",value:e.species}))&&(void 0===e.villain||""===e.villain||"major"===e.villain||"supreme"===e.villain||"minor"===e.villain||n(a,{path:t+".villain",expected:'("" | "major" | "minor" | "supreme" | undefined)',value:e.villain}))&&(void 0===e.phases||"string"==typeof e.phases||"number"==typeof e.phases||n(a,{path:t+".phases",expected:"(number | string | undefined)",value:e.phases}))&&(void 0===e.multipart||"string"==typeof e.multipart||n(a,{path:t+".multipart",expected:"(string | undefined)",value:e.multipart}))&&(void 0===e.rank||"soldier"===e.rank||"elite"===e.rank||"champion1"===e.rank||"champion2"===e.rank||"champion3"===e.rank||"champion4"===e.rank||"champion5"===e.rank||"champion6"===e.rank||"companion"===e.rank||n(a,{path:t+".rank",expected:'("champion1" | "champion2" | "champion3" | "champion4" | "champion5" | "champion6" | "companion" | "elite" | "soldier" | undefined)',value:e.rank}))&&(void 0===e.traits||"string"==typeof e.traits||n(a,{path:t+".traits",expected:"(string | undefined)",value:e.traits}))&&(void 0===e.actions||(Array.isArray(e.actions)||n(a,{path:t+".actions",expected:"(Array<NpcAction> | undefined)",value:e.actions}))&&e.actions.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".actions["+i+"]",expected:"NpcAction",value:e}))&&l(e,t+".actions["+i+"]",a)||n(a,{path:t+".actions["+i+"]",expected:"NpcAction",value:e})))||n(a,{path:t+".actions",expected:"(Array<NpcAction> | undefined)",value:e.actions}))&&(void 0===e.extra||("object"==typeof e.extra&&null!==e.extra&&!1===Array.isArray(e.extra)||n(a,{path:t+".extra",expected:"(NpcExtra | undefined)",value:e.extra}))&&c(e.extra,t+".extra",a)||n(a,{path:t+".extra",expected:"(NpcExtra | undefined)",value:e.extra}))&&(void 0===e.spells||(Array.isArray(e.spells)||n(a,{path:t+".spells",expected:"(Array<NpcSpell> | undefined)",value:e.spells}))&&e.spells.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".spells["+i+"]",expected:"NpcSpell",value:e}))&&d(e,t+".spells["+i+"]",a)||n(a,{path:t+".spells["+i+"]",expected:"NpcSpell",value:e})))||n(a,{path:t+".spells",expected:"(Array<NpcSpell> | undefined)",value:e.spells}))&&(void 0===e.special||(Array.isArray(e.special)||n(a,{path:t+".special",expected:"(Array<NpcSpecial> | undefined)",value:e.special}))&&e.special.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".special["+i+"]",expected:"NpcSpecial",value:e}))&&u(e,t+".special["+i+"]",a)||n(a,{path:t+".special["+i+"]",expected:"NpcSpecial",value:e})))||n(a,{path:t+".special",expected:"(Array<NpcSpecial> | undefined)",value:e.special}))&&(void 0===e.weaponattacks||(Array.isArray(e.weaponattacks)||n(a,{path:t+".weaponattacks",expected:"(Array<NpcWeaponAttack> | undefined)",value:e.weaponattacks}))&&e.weaponattacks.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".weaponattacks["+i+"]",expected:"NpcWeaponAttack",value:e}))&&h(e,t+".weaponattacks["+i+"]",a)||n(a,{path:t+".weaponattacks["+i+"]",expected:"NpcWeaponAttack",value:e})))||n(a,{path:t+".weaponattacks",expected:"(Array<NpcWeaponAttack> | undefined)",value:e.weaponattacks}))&&(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&(void 0===e.armor||("object"==typeof e.armor&&null!==e.armor||n(a,{path:t+".armor",expected:"(NpcArmor | undefined)",value:e.armor}))&&m(e.armor,t+".armor",a)||n(a,{path:t+".armor",expected:"(NpcArmor | undefined)",value:e.armor}))&&(void 0===e.shield||("object"==typeof e.shield&&null!==e.shield||n(a,{path:t+".shield",expected:"(NpcArmor | undefined)",value:e.shield}))&&m(e.shield,t+".shield",a)||n(a,{path:t+".shield",expected:"(NpcArmor | undefined)",value:e.shield}))&&(void 0===e.raregear||(Array.isArray(e.raregear)||n(a,{path:t+".raregear",expected:"(Array<NpcRareGear> | undefined)",value:e.raregear}))&&e.raregear.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".raregear["+i+"]",expected:"NpcRareGear",value:e}))&&f(e,t+".raregear["+i+"]",a)||n(a,{path:t+".raregear["+i+"]",expected:"NpcRareGear",value:e})))||n(a,{path:t+".raregear",expected:"(Array<NpcRareGear> | undefined)",value:e.raregear}))&&(void 0===e.label||"string"==typeof e.label||n(a,{path:t+".label",expected:"(string | undefined)",value:e.label}))&&(void 0===e.notes||(Array.isArray(e.notes)||n(a,{path:t+".notes",expected:"(Array<NpcNotes> | undefined)",value:e.notes}))&&e.notes.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".notes["+i+"]",expected:"NpcNotes",value:e}))&&g(e,t+".notes["+i+"]",a)||n(a,{path:t+".notes["+i+"]",expected:"NpcNotes",value:e})))||n(a,{path:t+".notes",expected:"(Array<NpcNotes> | undefined)",value:e.notes})))(e,t+"",!0)||n(!0,{path:t+"",expected:"Npc",value:e})})(e,"$input",!0),e))(a=JSON.parse(a)));break;case f.Pc:this.object.parse=(e=>(e=>(!1===(e=>{const t=e=>"object"==typeof e.mp&&null!==e.mp&&"number"==typeof e.mp.current&&"number"==typeof e.mp.max&&"object"==typeof e.ip&&null!==e.ip&&"number"==typeof e.ip.current&&"number"==typeof e.ip.max&&"object"==typeof e.hp&&null!==e.hp&&"number"==typeof e.hp.current&&"number"==typeof e.hp.max,a=e=>(void 0===e.imgurl||"string"==typeof e.imgurl)&&(void 0===e.pronouns||"string"==typeof e.pronouns)&&(void 0===e.identity||"string"==typeof e.identity)&&(void 0===e.theme||"string"==typeof e.theme)&&(void 0===e.origin||"string"==typeof e.origin)&&"number"==typeof e.fabulapoints&&"number"==typeof e.exp&&"number"==typeof e.zenit&&(void 0===e.description||"string"==typeof e.description)&&Array.isArray(e.bonds)&&e.bonds.every((e=>"object"==typeof e&&null!==e&&i(e))),i=e=>!(void 0!==e.name&&"string"!=typeof e.name||"boolean"!=typeof e.admiration||"boolean"!=typeof e.inferiority||"boolean"!=typeof e.hatred||"boolean"!=typeof e.mistrust||"boolean"!=typeof e.affection||"boolean"!=typeof e.loyality||void 0!==e.strength&&"number"!=typeof e.strength),n=e=>!(void 0!==e.physical&&"rs"!==e.physical&&"vu"!==e.physical&&"ab"!==e.physical&&"im"!==e.physical&&"no"!==e.physical||void 0!==e.wind&&"rs"!==e.wind&&"vu"!==e.wind&&"ab"!==e.wind&&"im"!==e.wind&&"no"!==e.wind||void 0!==e.bolt&&"rs"!==e.bolt&&"vu"!==e.bolt&&"ab"!==e.bolt&&"im"!==e.bolt&&"no"!==e.bolt||void 0!==e.dark&&"rs"!==e.dark&&"vu"!==e.dark&&"ab"!==e.dark&&"im"!==e.dark&&"no"!==e.dark||void 0!==e.earth&&"rs"!==e.earth&&"vu"!==e.earth&&"ab"!==e.earth&&"im"!==e.earth&&"no"!==e.earth||void 0!==e.ice&&"rs"!==e.ice&&"vu"!==e.ice&&"ab"!==e.ice&&"im"!==e.ice&&"no"!==e.ice||void 0!==e.light&&"rs"!==e.light&&"vu"!==e.light&&"ab"!==e.light&&"im"!==e.light&&"no"!==e.light||void 0!==e.poison&&"rs"!==e.poison&&"vu"!==e.poison&&"ab"!==e.poison&&"im"!==e.poison&&"no"!==e.poison||void 0!==e.fire&&"rs"!==e.fire&&"vu"!==e.fire&&"ab"!==e.fire&&"im"!==e.fire&&"no"!==e.fire),s=e=>"string"==typeof e.name&&"number"==typeof e.lvl&&"object"==typeof e.benefits&&null!==e.benefits&&r(e.benefits)&&Array.isArray(e.skills)&&e.skills.every((e=>"object"==typeof e&&null!==e&&l(e)))&&(void 0===e.heroic||"object"==typeof e.heroic&&null!==e.heroic&&c(e.heroic))&&(void 0===e.spells||Array.isArray(e.spells)&&e.spells.every((e=>"object"==typeof e&&null!==e&&!1===Array.isArray(e)&&d(e)))),r=e=>"number"==typeof e.hpplus&&"number"==typeof e.mpplus&&"number"==typeof e.ipplus&&"object"==typeof e.martials&&null!==e.martials&&"boolean"==typeof e.martials.shields&&"boolean"==typeof e.martials.ranged&&"boolean"==typeof e.martials.armor&&"boolean"==typeof e.martials.melee&&"object"==typeof e.rituals&&null!==e.rituals&&o(e.rituals)&&(void 0===e.spellClasses||Array.isArray(e.spellClasses)&&e.spellClasses.every((e=>"symbol"===e||"default"===e||"arcanist"===e||"arcanist-rework"===e||"tinkerer-alchemy"===e||"tinkerer-infusion"===e||"tinkerer-magitech"===e||"gamble"===e||"magichant"===e||"dance"===e||"gift"===e||"therioform"===e||"magiseed"===e||"invocation"===e||"cooking"===e||"pilot-vehicle"===e))),o=e=>!("boolean"!=typeof e.ritualism||void 0!==e.arcanism&&"boolean"!=typeof e.arcanism||void 0!==e.chimerism&&"boolean"!=typeof e.chimerism||void 0!==e.elementalism&&"boolean"!=typeof e.elementalism||void 0!==e.entropism&&"boolean"!=typeof e.entropism||void 0!==e.spiritism&&"boolean"!=typeof e.spiritism),l=e=>"string"==typeof e.skillName&&"number"==typeof e.currentLvl&&"number"==typeof e.maxLvl&&(void 0===e.specialSkill||"string"==typeof e.specialSkill)&&"string"==typeof e.description,c=e=>"string"==typeof e.name&&"string"==typeof e.description,d=e=>(void 0===e.name||"string"==typeof e.name)&&(void 0===e.spellName||"string"==typeof e.spellName)&&(void 0===e.mp||"string"==typeof e.mp||"number"==typeof e.mp)&&(void 0===e.maxTargets||"number"==typeof e.maxTargets)&&(void 0===e.targetDesc||"string"==typeof e.targetDesc)&&(void 0===e.description||"string"==typeof e.description)&&(void 0===e.class||"string"==typeof e.class)&&(void 0===e.duration||"string"==typeof e.duration)&&(void 0===e.isOffensive||"boolean"==typeof e.isOffensive)&&(void 0===e.isMagisphere||"boolean"==typeof e.isMagisphere)&&(void 0===e.attr1||"might"===e.attr1||"dexterity"===e.attr1||"insight"===e.attr1||"will"===e.attr1)&&(void 0===e.attr2||"might"===e.attr2||"dexterity"===e.attr2||"insight"===e.attr2||"will"===e.attr2)&&(void 0===e.effect1||"string"==typeof e.effect1)&&(void 0===e.effect2||"string"==typeof e.effect2)&&(void 0===e.effect3||"string"==typeof e.effect3)&&(void 0===e.effect4||"string"==typeof e.effect4)&&(void 0===e.effect5||"string"==typeof e.effect5)&&(void 0===e.effect6||"string"==typeof e.effect6)&&(void 0===e.spellType||"string"==typeof e.spellType)&&(void 0===e.mergeDesc||"string"==typeof e.mergeDesc)&&(void 0===e.merge||"string"==typeof e.merge)&&(void 0===e.dismissDesc||"string"==typeof e.dismissDesc)&&(void 0===e.domainDesc||"string"==typeof e.domainDesc)&&(void 0===e.domain||"string"==typeof e.domain)&&(void 0===e.dismiss||"string"==typeof e.dismiss)&&(void 0===e.pulse||"string"==typeof e.pulse)&&(void 0===e.pulseDesc||"string"==typeof e.pulseDesc)&&(void 0===e.skillLevel||"number"==typeof e.skillLevel)&&(void 0===e.innerWellspring||"boolean"==typeof e.innerWellspring)&&(void 0===e.chosenWellspring||"string"==typeof e.chosenWellspring)&&(void 0===e.allYouCanEat||"boolean"==typeof e.allYouCanEat)&&(void 0===e.tones||Array.isArray(e.tones)&&e.tones.every((e=>"object"==typeof e&&null!==e&&u(e))))&&(void 0===e.keys||Array.isArray(e.keys)&&e.keys.every((e=>"object"==typeof e&&null!==e&&h(e))))&&(void 0===e.dances||Array.isArray(e.dances)&&e.dances.every((e=>"object"==typeof e&&null!==e&&p(e))))&&(void 0===e.symbols||Array.isArray(e.symbols)&&e.symbols.every((e=>"object"==typeof e&&null!==e&&m(e))))&&(void 0===e.gifts||Array.isArray(e.gifts)&&e.gifts.every((e=>"object"==typeof e&&null!==e&&f(e))))&&(void 0===e.therioforms||Array.isArray(e.therioforms)&&e.therioforms.every((e=>"object"==typeof e&&null!==e&&g(e))))&&(void 0===e.invocations||Array.isArray(e.invocations)&&e.invocations.every((e=>"object"==typeof e&&null!==e&&y(e))))&&(void 0===e.magiseeds||Array.isArray(e.magiseeds)&&e.magiseeds.every((e=>"object"==typeof e&&null!==e&&v(e))))&&(void 0===e.gardenDescription||"string"==typeof e.gardenDescription)&&(void 0===e.cookbookEffects||"object"==typeof e.cookbookEffects&&null!==e.cookbookEffects&&!1===Array.isArray(e.cookbookEffects)&&A(e.cookbookEffects))&&(void 0===e.ingredientInventory||Array.isArray(e.ingredientInventory)&&e.ingredientInventory.every((e=>"object"==typeof e&&null!==e&&x(e))))&&(void 0===e.vehicles||Array.isArray(e.vehicles)&&e.vehicles.every((e=>"object"==typeof e&&null!==e&&w(e)))),u=e=>!("string"!=typeof e.name||void 0!==e.effect&&"string"!=typeof e.effect||void 0!==e.customName&&"string"!=typeof e.customName),h=e=>!("string"!=typeof e.name||void 0!==e.recovery&&"string"!=typeof e.recovery||void 0!==e.customName&&"string"!=typeof e.customName||void 0!==e.type&&"string"!=typeof e.type||void 0!==e.status&&"string"!=typeof e.status||void 0!==e.attribute&&"string"!=typeof e.attribute),p=e=>!("string"!=typeof e.name||void 0!==e.effect&&"string"!=typeof e.effect||void 0!==e.duration&&"string"!=typeof e.duration||void 0!==e.customName&&"string"!=typeof e.customName),m=e=>!("string"!=typeof e.name||void 0!==e.effect&&"string"!=typeof e.effect||void 0!==e.customName&&"string"!=typeof e.customName),f=e=>!("string"!=typeof e.name||void 0!==e.event&&"string"!=typeof e.event||void 0!==e.effect&&"string"!=typeof e.effect||void 0!==e.customName&&"string"!=typeof e.customName),g=e=>!("string"!=typeof e.name||void 0!==e.genoclepsis&&"string"!=typeof e.genoclepsis||void 0!==e.description&&"string"!=typeof e.description||void 0!==e.customName&&"string"!=typeof e.customName),y=e=>"string"==typeof e.name&&(void 0===e.skillLevel||"number"==typeof e.skillLevel),v=e=>"string"==typeof e.name&&(void 0===e.description||"string"==typeof e.description)&&(void 0===e.rangeStart||"number"==typeof e.rangeStart)&&(void 0===e.rangeEnd||"number"==typeof e.rangeEnd)&&(void 0===e.effects||"object"==typeof e.effects&&null!==e.effects&&!1===Array.isArray(e.effects)&&b(e.effects))&&(void 0===e.customName||"string"==typeof e.customName),b=e=>Object.keys(e).every((t=>{const a=e[t];return void 0===a||"string"==typeof a})),A=e=>Object.keys(e).every((t=>{const a=e[t];return void 0===a||"object"==typeof a&&null!==a&&_(a)})),_=e=>"string"==typeof e.taste1&&"string"==typeof e.taste2&&"string"==typeof e.effect&&(void 0===e.customChoices||"object"==typeof e.customChoices&&null!==e.customChoices&&!1===Array.isArray(e.customChoices)&&b(e.customChoices)),x=e=>"number"==typeof e.id&&"string"==typeof e.name&&"number"==typeof e.quantity&&("bitter"===e.taste||"salty"===e.taste||"sour"===e.taste||"sweet"===e.taste||"umami"===e.taste),w=e=>(void 0===e.description||"string"==typeof e.description)&&(void 0===e.customName||"string"==typeof e.customName)&&"string"==typeof e.frame&&(void 0===e.maxEnabledModules||"number"==typeof e.maxEnabledModules)&&(void 0===e.enabled||"boolean"==typeof e.enabled)&&(void 0===e.enabledModules||Array.isArray(e.enabledModules)&&e.enabledModules.every((e=>"string"==typeof e)))&&Array.isArray(e.modules)&&e.modules.every((e=>"object"==typeof e&&null!==e&&C(e))),C=e=>!("string"!=typeof e.name||"pilot_module_weapon"!==e.type&&"pilot_module_armor"!==e.type&&"pilot_module_support"!==e.type||void 0!==e.description&&"string"!=typeof e.description||void 0!==e.customName&&"string"!=typeof e.customName||"boolean"!=typeof e.enabled||"boolean"!=typeof e.equipped||null!==e.equippedSlot&&"main"!==e.equippedSlot&&"armor"!==e.equippedSlot&&"off"!==e.equippedSlot&&"both"!==e.equippedSlot&&"support"!==e.equippedSlot||void 0!==e.att1&&"might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||void 0!==e.att2&&"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2||void 0!==e.prec&&"number"!=typeof e.prec||void 0!==e.damage&&"number"!=typeof e.damage||void 0!==e.cost&&"number"!=typeof e.cost||void 0!==e.cumbersome&&"boolean"!=typeof e.cumbersome||void 0!==e.takesTwoHands&&"boolean"!=typeof e.takesTwoHands||void 0!==e.quality&&"string"!=typeof e.quality||void 0!==e.category&&"string"!=typeof e.category||void 0!==e.range&&"Melee"!==e.range&&"Ranged"!==e.range||void 0!==e.damageType&&"string"!=typeof e.damageType||void 0!==e.qualityCost&&"number"!=typeof e.qualityCost||void 0!==e.isShield&&"boolean"!=typeof e.isShield||void 0!==e.def&&"number"!=typeof e.def||void 0!==e.mdef&&"number"!=typeof e.mdef||void 0!==e.martial&&"boolean"!=typeof e.martial||void 0!==e.isComplex&&"boolean"!=typeof e.isComplex),E=e=>!("string"!=typeof e.name||"Arcane"!==e.category&&"Bow"!==e.category&&"Flail"!==e.category&&"Firearm"!==e.category&&"Spear"!==e.category&&"spear_category"!==e.category&&"Thrown"!==e.category&&"Heavy"!==e.category&&"Dagger"!==e.category&&"Brawling"!==e.category&&"Sword"!==e.category||"boolean"!=typeof e.melee||"boolean"!=typeof e.ranged||"physical"!==e.type&&"wind"!==e.type&&"bolt"!==e.type&&"dark"!==e.type&&"earth"!==e.type&&"fire"!==e.type&&"ice"!==e.type&&"light"!==e.type&&"poison"!==e.type||"number"!=typeof e.hands||"might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2||"boolean"!=typeof e.martial||"boolean"!=typeof e.damageBonus||"boolean"!=typeof e.damageReworkBonus||"boolean"!=typeof e.precBonus||"string"!=typeof e.quality||"number"!=typeof e.cost||"number"!=typeof e.damage||"number"!=typeof e.prec),S=e=>"string"==typeof e.name&&"string"==typeof e.category&&"string"==typeof e.range&&"object"==typeof e.accuracyCheck&&null!==e.accuracyCheck&&M(e.accuracyCheck)&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type)&&Array.isArray(e.customizations)&&e.customizations.every((e=>"object"==typeof e&&null!==e&&T(e)))&&"string"==typeof e.selectedQuality&&"string"==typeof e.quality&&"number"==typeof e.qualityCost&&"number"==typeof e.cost&&"number"==typeof e.hands&&"boolean"==typeof e.martial&&"boolean"==typeof e.isEquipped&&"number"==typeof e.damageModifier&&"number"==typeof e.precModifier&&"number"==typeof e.defModifier&&"number"==typeof e.mDefModifier&&"boolean"==typeof e.overrideDamageType&&("physical"===e.customDamageType||"wind"===e.customDamageType||"bolt"===e.customDamageType||"dark"===e.customDamageType||"earth"===e.customDamageType||"fire"===e.customDamageType||"ice"===e.customDamageType||"light"===e.customDamageType||"poison"===e.customDamageType)&&"string"==typeof e.secondWeaponName&&"string"==typeof e.secondSelectedCategory&&"string"==typeof e.secondSelectedRange&&"object"==typeof e.secondSelectedAccuracyCheck&&null!==e.secondSelectedAccuracyCheck&&k(e.secondSelectedAccuracyCheck)&&("physical"===e.secondSelectedType||"wind"===e.secondSelectedType||"bolt"===e.secondSelectedType||"dark"===e.secondSelectedType||"earth"===e.secondSelectedType||"fire"===e.secondSelectedType||"ice"===e.secondSelectedType||"light"===e.secondSelectedType||"poison"===e.secondSelectedType)&&Array.isArray(e.secondCurrentCustomizations)&&e.secondCurrentCustomizations.every((e=>"object"==typeof e&&null!==e&&P(e)))&&"number"==typeof e.secondDamageModifier&&"number"==typeof e.secondPrecModifier&&"number"==typeof e.secondDefModifier&&"number"==typeof e.secondMDefModifier&&"boolean"==typeof e.secondOverrideDamageType&&("physical"===e.secondCustomDamageType||"wind"===e.secondCustomDamageType||"bolt"===e.secondCustomDamageType||"dark"===e.secondCustomDamageType||"earth"===e.secondCustomDamageType||"fire"===e.secondCustomDamageType||"ice"===e.secondCustomDamageType||"light"===e.secondCustomDamageType||"poison"===e.secondCustomDamageType)&&"weapon"===e.dataType,M=e=>!("might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2),T=e=>"string"==typeof e.name&&"string"==typeof e.effect&&"boolean"==typeof e.martial&&"number"==typeof e.customCost,k=e=>!("might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2),P=e=>"string"==typeof e.name&&"string"==typeof e.effect&&"boolean"==typeof e.martial&&"number"==typeof e.customCost,D=e=>!("string"!=typeof e.name||"string"!=typeof e.category||"number"!=typeof e.def||"number"!=typeof e.mdef||"number"!=typeof e.init||void 0!==e.defModifier&&"number"!=typeof e.defModifier||void 0!==e.mDefModifier&&"number"!=typeof e.mDefModifier||void 0!==e.initModifier&&"number"!=typeof e.initModifier||"string"!=typeof e.quality||"number"!=typeof e.cost||"boolean"!=typeof e.martial||void 0!==e.precModifier&&"number"!=typeof e.precModifier||void 0!==e.magicModifier&&"number"!=typeof e.magicModifier||void 0!==e.damageMeleeModifier&&"number"!=typeof e.damageMeleeModifier||void 0!==e.damageRangedModifier&&"number"!=typeof e.damageRangedModifier),R=e=>!("string"!=typeof e.name||void 0!==e.defModifier&&"number"!=typeof e.defModifier||void 0!==e.mDefModifier&&"number"!=typeof e.mDefModifier||void 0!==e.initModifier&&"number"!=typeof e.initModifier||"string"!=typeof e.quality||"number"!=typeof e.cost||void 0!==e.precModifier&&"number"!=typeof e.precModifier||void 0!==e.magicModifier&&"number"!=typeof e.magicModifier||void 0!==e.damageMeleeModifier&&"number"!=typeof e.damageMeleeModifier||void 0!==e.damageRangedModifier&&"number"!=typeof e.damageRangedModifier),F=e=>"string"==typeof e.name&&"string"==typeof e.description&&(void 0===e.clocks||Array.isArray(e.clocks)&&e.clocks.every((e=>"object"==typeof e&&null!==e&&I(e)))),I=e=>"string"==typeof e.name&&"number"==typeof e.sections,O=e=>"string"==typeof e.effect&&"string"==typeof e.name&&"string"==typeof e.description;return"object"==typeof e&&null!==e&&(e=>("string"==typeof e.id||"number"==typeof e.id)&&"string"==typeof e.uid&&(void 0===e.imgurl||"string"==typeof e.imgurl)&&"string"==typeof e.name&&"number"==typeof e.lvl&&"object"==typeof e.stats&&null!==e.stats&&t(e.stats)&&"object"==typeof e.info&&null!==e.info&&a(e.info)&&(void 0===e.affinities||"object"==typeof e.affinities&&null!==e.affinities&&!1===Array.isArray(e.affinities)&&n(e.affinities))&&"object"==typeof e.attributes&&null!==e.attributes&&"number"==typeof e.attributes.might&&"number"==typeof e.attributes.insight&&"number"==typeof e.attributes.willpower&&"number"==typeof e.attributes.dexterity&&(void 0===e.classes||Array.isArray(e.classes)&&e.classes.every((e=>"object"==typeof e&&null!==e&&s(e))))&&(void 0===e.weapons||Array.isArray(e.weapons)&&e.weapons.every((e=>"object"==typeof e&&null!==e&&E(e))))&&(void 0===e.customWeapons||Array.isArray(e.customWeapons)&&e.customWeapons.every((e=>"object"==typeof e&&null!==e&&S(e))))&&(void 0===e.armor||Array.isArray(e.armor)&&e.armor.every((e=>"object"==typeof e&&null!==e&&D(e))))&&(void 0===e.shields||Array.isArray(e.shields)&&e.shields.every((e=>"object"==typeof e&&null!==e&&D(e))))&&(void 0===e.accessories||Array.isArray(e.accessories)&&e.accessories.every((e=>"object"==typeof e&&null!==e&&R(e))))&&(void 0===e.notes||Array.isArray(e.notes)&&e.notes.every((e=>"object"==typeof e&&null!==e&&F(e))))&&"object"==typeof e.modifiers&&null!==e.modifiers&&"number"==typeof e.modifiers.mdef&&"number"==typeof e.modifiers.magicPrec&&"number"==typeof e.modifiers.init&&"number"==typeof e.modifiers.ip&&"number"==typeof e.modifiers.hp&&"number"==typeof e.modifiers.def&&"number"==typeof e.modifiers.meleePrec&&"number"==typeof e.modifiers.rangedPrec&&"number"==typeof e.modifiers.mp&&(void 0===e.quirk||"object"==typeof e.quirk&&null!==e.quirk&&O(e.quirk)))(e)})(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard,s=i.json.assertParse.join,r=(e,t,a=!0)=>(("object"==typeof e.mp&&null!==e.mp||n(a,{path:t+".mp",expected:"StatValue",value:e.mp}))&&o(e.mp,t+".mp",a)||n(a,{path:t+".mp",expected:"StatValue",value:e.mp}))&&(("object"==typeof e.ip&&null!==e.ip||n(a,{path:t+".ip",expected:"StatValue",value:e.ip}))&&o(e.ip,t+".ip",a)||n(a,{path:t+".ip",expected:"StatValue",value:e.ip}))&&(("object"==typeof e.hp&&null!==e.hp||n(a,{path:t+".hp",expected:"StatValue",value:e.hp}))&&o(e.hp,t+".hp",a)||n(a,{path:t+".hp",expected:"StatValue",value:e.hp})),o=(e,t,a=!0)=>("number"==typeof e.current||n(a,{path:t+".current",expected:"number",value:e.current}))&&("number"==typeof e.max||n(a,{path:t+".max",expected:"number",value:e.max})),l=(e,t,a=!0)=>(void 0===e.imgurl||"string"==typeof e.imgurl||n(a,{path:t+".imgurl",expected:"(string | undefined)",value:e.imgurl}))&&(void 0===e.pronouns||"string"==typeof e.pronouns||n(a,{path:t+".pronouns",expected:"(string | undefined)",value:e.pronouns}))&&(void 0===e.identity||"string"==typeof e.identity||n(a,{path:t+".identity",expected:"(string | undefined)",value:e.identity}))&&(void 0===e.theme||"string"==typeof e.theme||n(a,{path:t+".theme",expected:"(string | undefined)",value:e.theme}))&&(void 0===e.origin||"string"==typeof e.origin||n(a,{path:t+".origin",expected:"(string | undefined)",value:e.origin}))&&("number"==typeof e.fabulapoints||n(a,{path:t+".fabulapoints",expected:"number",value:e.fabulapoints}))&&("number"==typeof e.exp||n(a,{path:t+".exp",expected:"number",value:e.exp}))&&("number"==typeof e.zenit||n(a,{path:t+".zenit",expected:"number",value:e.zenit}))&&(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&((Array.isArray(e.bonds)||n(a,{path:t+".bonds",expected:"Array<PCBond>",value:e.bonds}))&&e.bonds.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".bonds["+i+"]",expected:"PCBond",value:e}))&&c(e,t+".bonds["+i+"]",a)||n(a,{path:t+".bonds["+i+"]",expected:"PCBond",value:e})))||n(a,{path:t+".bonds",expected:"Array<PCBond>",value:e.bonds})),c=(e,t,a=!0)=>(void 0===e.name||"string"==typeof e.name||n(a,{path:t+".name",expected:"(string | undefined)",value:e.name}))&&("boolean"==typeof e.admiration||n(a,{path:t+".admiration",expected:"boolean",value:e.admiration}))&&("boolean"==typeof e.inferiority||n(a,{path:t+".inferiority",expected:"boolean",value:e.inferiority}))&&("boolean"==typeof e.hatred||n(a,{path:t+".hatred",expected:"boolean",value:e.hatred}))&&("boolean"==typeof e.mistrust||n(a,{path:t+".mistrust",expected:"boolean",value:e.mistrust}))&&("boolean"==typeof e.affection||n(a,{path:t+".affection",expected:"boolean",value:e.affection}))&&("boolean"==typeof e.loyality||n(a,{path:t+".loyality",expected:"boolean",value:e.loyality}))&&(void 0===e.strength||"number"==typeof e.strength||n(a,{path:t+".strength",expected:"(number | undefined)",value:e.strength})),d=(e,t,a=!0)=>(void 0===e.physical||"rs"===e.physical||"vu"===e.physical||"ab"===e.physical||"im"===e.physical||"no"===e.physical||n(a,{path:t+".physical",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.physical}))&&(void 0===e.wind||"rs"===e.wind||"vu"===e.wind||"ab"===e.wind||"im"===e.wind||"no"===e.wind||n(a,{path:t+".wind",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.wind}))&&(void 0===e.bolt||"rs"===e.bolt||"vu"===e.bolt||"ab"===e.bolt||"im"===e.bolt||"no"===e.bolt||n(a,{path:t+".bolt",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.bolt}))&&(void 0===e.dark||"rs"===e.dark||"vu"===e.dark||"ab"===e.dark||"im"===e.dark||"no"===e.dark||n(a,{path:t+".dark",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.dark}))&&(void 0===e.earth||"rs"===e.earth||"vu"===e.earth||"ab"===e.earth||"im"===e.earth||"no"===e.earth||n(a,{path:t+".earth",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.earth}))&&(void 0===e.ice||"rs"===e.ice||"vu"===e.ice||"ab"===e.ice||"im"===e.ice||"no"===e.ice||n(a,{path:t+".ice",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.ice}))&&(void 0===e.light||"rs"===e.light||"vu"===e.light||"ab"===e.light||"im"===e.light||"no"===e.light||n(a,{path:t+".light",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.light}))&&(void 0===e.poison||"rs"===e.poison||"vu"===e.poison||"ab"===e.poison||"im"===e.poison||"no"===e.poison||n(a,{path:t+".poison",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.poison}))&&(void 0===e.fire||"rs"===e.fire||"vu"===e.fire||"ab"===e.fire||"im"===e.fire||"no"===e.fire||n(a,{path:t+".fire",expected:'("ab" | "im" | "no" | "rs" | "vu" | undefined)',value:e.fire})),u=(e,t,a=!0)=>("number"==typeof e.might||n(a,{path:t+".might",expected:"number",value:e.might}))&&("number"==typeof e.insight||n(a,{path:t+".insight",expected:"number",value:e.insight}))&&("number"==typeof e.willpower||n(a,{path:t+".willpower",expected:"number",value:e.willpower}))&&("number"==typeof e.dexterity||n(a,{path:t+".dexterity",expected:"number",value:e.dexterity})),h=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.lvl||n(a,{path:t+".lvl",expected:"number",value:e.lvl}))&&(("object"==typeof e.benefits&&null!==e.benefits||n(a,{path:t+".benefits",expected:"PCBenefits",value:e.benefits}))&&p(e.benefits,t+".benefits",a)||n(a,{path:t+".benefits",expected:"PCBenefits",value:e.benefits}))&&((Array.isArray(e.skills)||n(a,{path:t+".skills",expected:"Array<PCSkills>",value:e.skills}))&&e.skills.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".skills["+i+"]",expected:"PCSkills",value:e}))&&g(e,t+".skills["+i+"]",a)||n(a,{path:t+".skills["+i+"]",expected:"PCSkills",value:e})))||n(a,{path:t+".skills",expected:"Array<PCSkills>",value:e.skills}))&&(void 0===e.heroic||("object"==typeof e.heroic&&null!==e.heroic||n(a,{path:t+".heroic",expected:"(PCHeroicSkills | undefined)",value:e.heroic}))&&y(e.heroic,t+".heroic",a)||n(a,{path:t+".heroic",expected:"(PCHeroicSkills | undefined)",value:e.heroic}))&&(void 0===e.spells||(Array.isArray(e.spells)||n(a,{path:t+".spells",expected:"(Array<PCSpells> | undefined)",value:e.spells}))&&e.spells.every(((e,i)=>("object"==typeof e&&null!==e&&!1===Array.isArray(e)||n(a,{path:t+".spells["+i+"]",expected:"PCSpells",value:e}))&&v(e,t+".spells["+i+"]",a)||n(a,{path:t+".spells["+i+"]",expected:"PCSpells",value:e})))||n(a,{path:t+".spells",expected:"(Array<PCSpells> | undefined)",value:e.spells})),p=(e,t,a=!0)=>("number"==typeof e.hpplus||n(a,{path:t+".hpplus",expected:"number",value:e.hpplus}))&&("number"==typeof e.mpplus||n(a,{path:t+".mpplus",expected:"number",value:e.mpplus}))&&("number"==typeof e.ipplus||n(a,{path:t+".ipplus",expected:"number",value:e.ipplus}))&&(("object"==typeof e.martials&&null!==e.martials||n(a,{path:t+".martials",expected:"PCMartials",value:e.martials}))&&m(e.martials,t+".martials",a)||n(a,{path:t+".martials",expected:"PCMartials",value:e.martials}))&&(("object"==typeof e.rituals&&null!==e.rituals||n(a,{path:t+".rituals",expected:"PCRituals",value:e.rituals}))&&f(e.rituals,t+".rituals",a)||n(a,{path:t+".rituals",expected:"PCRituals",value:e.rituals}))&&(void 0===e.spellClasses||(Array.isArray(e.spellClasses)||n(a,{path:t+".spellClasses",expected:"(Array<SpellClass> | undefined)",value:e.spellClasses}))&&e.spellClasses.every(((e,i)=>"symbol"===e||"default"===e||"arcanist"===e||"arcanist-rework"===e||"tinkerer-alchemy"===e||"tinkerer-infusion"===e||"tinkerer-magitech"===e||"gamble"===e||"magichant"===e||"dance"===e||"gift"===e||"therioform"===e||"magiseed"===e||"invocation"===e||"cooking"===e||"pilot-vehicle"===e||n(a,{path:t+".spellClasses["+i+"]",expected:'("arcanist" | "arcanist-rework" | "cooking" | "dance" | "default" | "gamble" | "gift" | "invocation" | "magichant" | "magiseed" | "pilot-vehicle" | "symbol" | "therioform" | "tinkerer-alchemy" | "tinkerer-infusion" | "tinkerer-magitech")',value:e})))||n(a,{path:t+".spellClasses",expected:"(Array<SpellClass> | undefined)",value:e.spellClasses})),m=(e,t,a=!0)=>("boolean"==typeof e.shields||n(a,{path:t+".shields",expected:"boolean",value:e.shields}))&&("boolean"==typeof e.ranged||n(a,{path:t+".ranged",expected:"boolean",value:e.ranged}))&&("boolean"==typeof e.armor||n(a,{path:t+".armor",expected:"boolean",value:e.armor}))&&("boolean"==typeof e.melee||n(a,{path:t+".melee",expected:"boolean",value:e.melee})),f=(e,t,a=!0)=>("boolean"==typeof e.ritualism||n(a,{path:t+".ritualism",expected:"boolean",value:e.ritualism}))&&(void 0===e.arcanism||"boolean"==typeof e.arcanism||n(a,{path:t+".arcanism",expected:"(boolean | undefined)",value:e.arcanism}))&&(void 0===e.chimerism||"boolean"==typeof e.chimerism||n(a,{path:t+".chimerism",expected:"(boolean | undefined)",value:e.chimerism}))&&(void 0===e.elementalism||"boolean"==typeof e.elementalism||n(a,{path:t+".elementalism",expected:"(boolean | undefined)",value:e.elementalism}))&&(void 0===e.entropism||"boolean"==typeof e.entropism||n(a,{path:t+".entropism",expected:"(boolean | undefined)",value:e.entropism}))&&(void 0===e.spiritism||"boolean"==typeof e.spiritism||n(a,{path:t+".spiritism",expected:"(boolean | undefined)",value:e.spiritism})),g=(e,t,a=!0)=>("string"==typeof e.skillName||n(a,{path:t+".skillName",expected:"string",value:e.skillName}))&&("number"==typeof e.currentLvl||n(a,{path:t+".currentLvl",expected:"number",value:e.currentLvl}))&&("number"==typeof e.maxLvl||n(a,{path:t+".maxLvl",expected:"number",value:e.maxLvl}))&&(void 0===e.specialSkill||"string"==typeof e.specialSkill||n(a,{path:t+".specialSkill",expected:"(string | undefined)",value:e.specialSkill}))&&("string"==typeof e.description||n(a,{path:t+".description",expected:"string",value:e.description})),y=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.description||n(a,{path:t+".description",expected:"string",value:e.description})),v=(e,t,a=!0)=>(void 0===e.name||"string"==typeof e.name||n(a,{path:t+".name",expected:"(string | undefined)",value:e.name}))&&(void 0===e.spellName||"string"==typeof e.spellName||n(a,{path:t+".spellName",expected:"(string | undefined)",value:e.spellName}))&&(void 0===e.mp||"string"==typeof e.mp||"number"==typeof e.mp||n(a,{path:t+".mp",expected:"(number | string | undefined)",value:e.mp}))&&(void 0===e.maxTargets||"number"==typeof e.maxTargets||n(a,{path:t+".maxTargets",expected:"(number | undefined)",value:e.maxTargets}))&&(void 0===e.targetDesc||"string"==typeof e.targetDesc||n(a,{path:t+".targetDesc",expected:"(string | undefined)",value:e.targetDesc}))&&(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&(void 0===e.class||"string"==typeof e.class||n(a,{path:t+'["class"]',expected:"(string | undefined)",value:e.class}))&&(void 0===e.duration||"string"==typeof e.duration||n(a,{path:t+".duration",expected:"(string | undefined)",value:e.duration}))&&(void 0===e.isOffensive||"boolean"==typeof e.isOffensive||n(a,{path:t+".isOffensive",expected:"(boolean | undefined)",value:e.isOffensive}))&&(void 0===e.isMagisphere||"boolean"==typeof e.isMagisphere||n(a,{path:t+".isMagisphere",expected:"(boolean | undefined)",value:e.isMagisphere}))&&(void 0===e.attr1||"might"===e.attr1||"dexterity"===e.attr1||"insight"===e.attr1||"will"===e.attr1||n(a,{path:t+".attr1",expected:'("dexterity" | "insight" | "might" | "will" | undefined)',value:e.attr1}))&&(void 0===e.attr2||"might"===e.attr2||"dexterity"===e.attr2||"insight"===e.attr2||"will"===e.attr2||n(a,{path:t+".attr2",expected:'("dexterity" | "insight" | "might" | "will" | undefined)',value:e.attr2}))&&(void 0===e.effect1||"string"==typeof e.effect1||n(a,{path:t+".effect1",expected:"(string | undefined)",value:e.effect1}))&&(void 0===e.effect2||"string"==typeof e.effect2||n(a,{path:t+".effect2",expected:"(string | undefined)",value:e.effect2}))&&(void 0===e.effect3||"string"==typeof e.effect3||n(a,{path:t+".effect3",expected:"(string | undefined)",value:e.effect3}))&&(void 0===e.effect4||"string"==typeof e.effect4||n(a,{path:t+".effect4",expected:"(string | undefined)",value:e.effect4}))&&(void 0===e.effect5||"string"==typeof e.effect5||n(a,{path:t+".effect5",expected:"(string | undefined)",value:e.effect5}))&&(void 0===e.effect6||"string"==typeof e.effect6||n(a,{path:t+".effect6",expected:"(string | undefined)",value:e.effect6}))&&(void 0===e.spellType||"string"==typeof e.spellType||n(a,{path:t+".spellType",expected:"(string | undefined)",value:e.spellType}))&&(void 0===e.mergeDesc||"string"==typeof e.mergeDesc||n(a,{path:t+".mergeDesc",expected:"(string | undefined)",value:e.mergeDesc}))&&(void 0===e.merge||"string"==typeof e.merge||n(a,{path:t+".merge",expected:"(string | undefined)",value:e.merge}))&&(void 0===e.dismissDesc||"string"==typeof e.dismissDesc||n(a,{path:t+".dismissDesc",expected:"(string | undefined)",value:e.dismissDesc}))&&(void 0===e.domainDesc||"string"==typeof e.domainDesc||n(a,{path:t+".domainDesc",expected:"(string | undefined)",value:e.domainDesc}))&&(void 0===e.domain||"string"==typeof e.domain||n(a,{path:t+".domain",expected:"(string | undefined)",value:e.domain}))&&(void 0===e.dismiss||"string"==typeof e.dismiss||n(a,{path:t+".dismiss",expected:"(string | undefined)",value:e.dismiss}))&&(void 0===e.pulse||"string"==typeof e.pulse||n(a,{path:t+".pulse",expected:"(string | undefined)",value:e.pulse}))&&(void 0===e.pulseDesc||"string"==typeof e.pulseDesc||n(a,{path:t+".pulseDesc",expected:"(string | undefined)",value:e.pulseDesc}))&&(void 0===e.skillLevel||"number"==typeof e.skillLevel||n(a,{path:t+".skillLevel",expected:"(number | undefined)",value:e.skillLevel}))&&(void 0===e.innerWellspring||"boolean"==typeof e.innerWellspring||n(a,{path:t+".innerWellspring",expected:"(boolean | undefined)",value:e.innerWellspring}))&&(void 0===e.chosenWellspring||"string"==typeof e.chosenWellspring||n(a,{path:t+".chosenWellspring",expected:"(string | undefined)",value:e.chosenWellspring}))&&(void 0===e.allYouCanEat||"boolean"==typeof e.allYouCanEat||n(a,{path:t+".allYouCanEat",expected:"(boolean | undefined)",value:e.allYouCanEat}))&&(void 0===e.tones||(Array.isArray(e.tones)||n(a,{path:t+".tones",expected:"(Array<__type> | undefined)",value:e.tones}))&&e.tones.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".tones["+i+"]",expected:"__type",value:e}))&&b(e,t+".tones["+i+"]",a)||n(a,{path:t+".tones["+i+"]",expected:"__type",value:e})))||n(a,{path:t+".tones",expected:"(Array<__type> | undefined)",value:e.tones}))&&(void 0===e.keys||(Array.isArray(e.keys)||n(a,{path:t+".keys",expected:"(Array<__type>.o1 | undefined)",value:e.keys}))&&e.keys.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".keys["+i+"]",expected:"__type.o1",value:e}))&&A(e,t+".keys["+i+"]",a)||n(a,{path:t+".keys["+i+"]",expected:"__type.o1",value:e})))||n(a,{path:t+".keys",expected:"(Array<__type>.o1 | undefined)",value:e.keys}))&&(void 0===e.dances||(Array.isArray(e.dances)||n(a,{path:t+".dances",expected:"(Array<__type>.o2 | undefined)",value:e.dances}))&&e.dances.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".dances["+i+"]",expected:"__type.o2",value:e}))&&_(e,t+".dances["+i+"]",a)||n(a,{path:t+".dances["+i+"]",expected:"__type.o2",value:e})))||n(a,{path:t+".dances",expected:"(Array<__type>.o2 | undefined)",value:e.dances}))&&(void 0===e.symbols||(Array.isArray(e.symbols)||n(a,{path:t+".symbols",expected:"(Array<__type>.o3 | undefined)",value:e.symbols}))&&e.symbols.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".symbols["+i+"]",expected:"__type.o3",value:e}))&&x(e,t+".symbols["+i+"]",a)||n(a,{path:t+".symbols["+i+"]",expected:"__type.o3",value:e})))||n(a,{path:t+".symbols",expected:"(Array<__type>.o3 | undefined)",value:e.symbols}))&&(void 0===e.gifts||(Array.isArray(e.gifts)||n(a,{path:t+".gifts",expected:"(Array<__type>.o4 | undefined)",value:e.gifts}))&&e.gifts.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".gifts["+i+"]",expected:"__type.o4",value:e}))&&w(e,t+".gifts["+i+"]",a)||n(a,{path:t+".gifts["+i+"]",expected:"__type.o4",value:e})))||n(a,{path:t+".gifts",expected:"(Array<__type>.o4 | undefined)",value:e.gifts}))&&(void 0===e.therioforms||(Array.isArray(e.therioforms)||n(a,{path:t+".therioforms",expected:"(Array<__type>.o5 | undefined)",value:e.therioforms}))&&e.therioforms.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".therioforms["+i+"]",expected:"__type.o5",value:e}))&&C(e,t+".therioforms["+i+"]",a)||n(a,{path:t+".therioforms["+i+"]",expected:"__type.o5",value:e})))||n(a,{path:t+".therioforms",expected:"(Array<__type>.o5 | undefined)",value:e.therioforms}))&&(void 0===e.invocations||(Array.isArray(e.invocations)||n(a,{path:t+".invocations",expected:"(Array<__type>.o6 | undefined)",value:e.invocations}))&&e.invocations.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".invocations["+i+"]",expected:"__type.o6",value:e}))&&E(e,t+".invocations["+i+"]",a)||n(a,{path:t+".invocations["+i+"]",expected:"__type.o6",value:e})))||n(a,{path:t+".invocations",expected:"(Array<__type>.o6 | undefined)",value:e.invocations}))&&(void 0===e.magiseeds||(Array.isArray(e.magiseeds)||n(a,{path:t+".magiseeds",expected:"(Array<__type>.o7 | undefined)",value:e.magiseeds}))&&e.magiseeds.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".magiseeds["+i+"]",expected:"__type.o7",value:e}))&&S(e,t+".magiseeds["+i+"]",a)||n(a,{path:t+".magiseeds["+i+"]",expected:"__type.o7",value:e})))||n(a,{path:t+".magiseeds",expected:"(Array<__type>.o7 | undefined)",value:e.magiseeds}))&&(void 0===e.gardenDescription||"string"==typeof e.gardenDescription||n(a,{path:t+".gardenDescription",expected:"(string | undefined)",value:e.gardenDescription}))&&(void 0===e.cookbookEffects||("object"==typeof e.cookbookEffects&&null!==e.cookbookEffects&&!1===Array.isArray(e.cookbookEffects)||n(a,{path:t+".cookbookEffects",expected:"(Record<string, __type> | undefined)",value:e.cookbookEffects}))&&T(e.cookbookEffects,t+".cookbookEffects",a)||n(a,{path:t+".cookbookEffects",expected:"(Record<string, __type> | undefined)",value:e.cookbookEffects}))&&(void 0===e.ingredientInventory||(Array.isArray(e.ingredientInventory)||n(a,{path:t+".ingredientInventory",expected:"(Array<__type>.o8 | undefined)",value:e.ingredientInventory}))&&e.ingredientInventory.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".ingredientInventory["+i+"]",expected:"__type.o9",value:e}))&&P(e,t+".ingredientInventory["+i+"]",a)||n(a,{path:t+".ingredientInventory["+i+"]",expected:"__type.o9",value:e})))||n(a,{path:t+".ingredientInventory",expected:"(Array<__type>.o8 | undefined)",value:e.ingredientInventory}))&&(void 0===e.vehicles||(Array.isArray(e.vehicles)||n(a,{path:t+".vehicles",expected:"(Array<__type>.o9 | undefined)",value:e.vehicles}))&&e.vehicles.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".vehicles["+i+"]",expected:"__type.o10",value:e}))&&D(e,t+".vehicles["+i+"]",a)||n(a,{path:t+".vehicles["+i+"]",expected:"__type.o10",value:e})))||n(a,{path:t+".vehicles",expected:"(Array<__type>.o9 | undefined)",value:e.vehicles})),b=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.effect||"string"==typeof e.effect||n(a,{path:t+".effect",expected:"(string | undefined)",value:e.effect}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName})),A=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.recovery||"string"==typeof e.recovery||n(a,{path:t+".recovery",expected:"(string | undefined)",value:e.recovery}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName}))&&(void 0===e.type||"string"==typeof e.type||n(a,{path:t+".type",expected:"(string | undefined)",value:e.type}))&&(void 0===e.status||"string"==typeof e.status||n(a,{path:t+".status",expected:"(string | undefined)",value:e.status}))&&(void 0===e.attribute||"string"==typeof e.attribute||n(a,{path:t+".attribute",expected:"(string | undefined)",value:e.attribute})),_=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.effect||"string"==typeof e.effect||n(a,{path:t+".effect",expected:"(string | undefined)",value:e.effect}))&&(void 0===e.duration||"string"==typeof e.duration||n(a,{path:t+".duration",expected:"(string | undefined)",value:e.duration}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName})),x=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.effect||"string"==typeof e.effect||n(a,{path:t+".effect",expected:"(string | undefined)",value:e.effect}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName})),w=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.event||"string"==typeof e.event||n(a,{path:t+".event",expected:"(string | undefined)",value:e.event}))&&(void 0===e.effect||"string"==typeof e.effect||n(a,{path:t+".effect",expected:"(string | undefined)",value:e.effect}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName})),C=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.genoclepsis||"string"==typeof e.genoclepsis||n(a,{path:t+".genoclepsis",expected:"(string | undefined)",value:e.genoclepsis}))&&(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName})),E=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.skillLevel||"number"==typeof e.skillLevel||n(a,{path:t+".skillLevel",expected:"(number | undefined)",value:e.skillLevel})),S=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&(void 0===e.rangeStart||"number"==typeof e.rangeStart||n(a,{path:t+".rangeStart",expected:"(number | undefined)",value:e.rangeStart}))&&(void 0===e.rangeEnd||"number"==typeof e.rangeEnd||n(a,{path:t+".rangeEnd",expected:"(number | undefined)",value:e.rangeEnd}))&&(void 0===e.effects||("object"==typeof e.effects&&null!==e.effects&&!1===Array.isArray(e.effects)||n(a,{path:t+".effects",expected:"(Record<string, string> | undefined)",value:e.effects}))&&M(e.effects,t+".effects",a)||n(a,{path:t+".effects",expected:"(Record<string, string> | undefined)",value:e.effects}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName})),M=(e,t,a=!0)=>!1===a||Object.keys(e).every((i=>{const r=e[i];return void 0===r||("string"==typeof r||n(a,{path:t+s(i),expected:"string",value:r}))})),T=(e,t,a=!0)=>!1===a||Object.keys(e).every((i=>{const r=e[i];return void 0===r||(("object"==typeof r&&null!==r||n(a,{path:t+s(i),expected:"__type.o8",value:r}))&&k(r,t+s(i),a)||n(a,{path:t+s(i),expected:"__type.o8",value:r}))})),k=(e,t,a=!0)=>("string"==typeof e.taste1||n(a,{path:t+".taste1",expected:"string",value:e.taste1}))&&("string"==typeof e.taste2||n(a,{path:t+".taste2",expected:"string",value:e.taste2}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}))&&(void 0===e.customChoices||("object"==typeof e.customChoices&&null!==e.customChoices&&!1===Array.isArray(e.customChoices)||n(a,{path:t+".customChoices",expected:"(Record<string, string> | undefined)",value:e.customChoices}))&&M(e.customChoices,t+".customChoices",a)||n(a,{path:t+".customChoices",expected:"(Record<string, string> | undefined)",value:e.customChoices})),P=(e,t,a=!0)=>("number"==typeof e.id||n(a,{path:t+".id",expected:"number",value:e.id}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.quantity||n(a,{path:t+".quantity",expected:"number",value:e.quantity}))&&("bitter"===e.taste||"salty"===e.taste||"sour"===e.taste||"sweet"===e.taste||"umami"===e.taste||n(a,{path:t+".taste",expected:'("bitter" | "salty" | "sour" | "sweet" | "umami")',value:e.taste})),D=(e,t,a=!0)=>(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName}))&&("string"==typeof e.frame||n(a,{path:t+".frame",expected:"string",value:e.frame}))&&(void 0===e.maxEnabledModules||"number"==typeof e.maxEnabledModules||n(a,{path:t+".maxEnabledModules",expected:"(number | undefined)",value:e.maxEnabledModules}))&&(void 0===e.enabled||"boolean"==typeof e.enabled||n(a,{path:t+".enabled",expected:"(boolean | undefined)",value:e.enabled}))&&(void 0===e.enabledModules||(Array.isArray(e.enabledModules)||n(a,{path:t+".enabledModules",expected:"(Array<string> | undefined)",value:e.enabledModules}))&&e.enabledModules.every(((e,i)=>"string"==typeof e||n(a,{path:t+".enabledModules["+i+"]",expected:"string",value:e})))||n(a,{path:t+".enabledModules",expected:"(Array<string> | undefined)",value:e.enabledModules}))&&((Array.isArray(e.modules)||n(a,{path:t+".modules",expected:"Array<__type>.o10",value:e.modules}))&&e.modules.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".modules["+i+"]",expected:"__type.o11",value:e}))&&R(e,t+".modules["+i+"]",a)||n(a,{path:t+".modules["+i+"]",expected:"__type.o11",value:e})))||n(a,{path:t+".modules",expected:"Array<__type>.o10",value:e.modules})),R=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("pilot_module_weapon"===e.type||"pilot_module_armor"===e.type||"pilot_module_support"===e.type||n(a,{path:t+".type",expected:'("pilot_module_armor" | "pilot_module_support" | "pilot_module_weapon")',value:e.type}))&&(void 0===e.description||"string"==typeof e.description||n(a,{path:t+".description",expected:"(string | undefined)",value:e.description}))&&(void 0===e.customName||"string"==typeof e.customName||n(a,{path:t+".customName",expected:"(string | undefined)",value:e.customName}))&&("boolean"==typeof e.enabled||n(a,{path:t+".enabled",expected:"boolean",value:e.enabled}))&&("boolean"==typeof e.equipped||n(a,{path:t+".equipped",expected:"boolean",value:e.equipped}))&&(null===e.equippedSlot||"main"===e.equippedSlot||"armor"===e.equippedSlot||"off"===e.equippedSlot||"both"===e.equippedSlot||"support"===e.equippedSlot||n(a,{path:t+".equippedSlot",expected:'("armor" | "both" | "main" | "off" | "support" | null)',value:e.equippedSlot}))&&(void 0===e.att1||"might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will" | undefined)',value:e.att1}))&&(void 0===e.att2||"might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will" | undefined)',value:e.att2}))&&(void 0===e.prec||"number"==typeof e.prec||n(a,{path:t+".prec",expected:"(number | undefined)",value:e.prec}))&&(void 0===e.damage||"number"==typeof e.damage||n(a,{path:t+".damage",expected:"(number | undefined)",value:e.damage}))&&(void 0===e.cost||"number"==typeof e.cost||n(a,{path:t+".cost",expected:"(number | undefined)",value:e.cost}))&&(void 0===e.cumbersome||"boolean"==typeof e.cumbersome||n(a,{path:t+".cumbersome",expected:"(boolean | undefined)",value:e.cumbersome}))&&(void 0===e.takesTwoHands||"boolean"==typeof e.takesTwoHands||n(a,{path:t+".takesTwoHands",expected:"(boolean | undefined)",value:e.takesTwoHands}))&&(void 0===e.quality||"string"==typeof e.quality||n(a,{path:t+".quality",expected:"(string | undefined)",value:e.quality}))&&(void 0===e.category||"string"==typeof e.category||n(a,{path:t+".category",expected:"(string | undefined)",value:e.category}))&&(void 0===e.range||"Melee"===e.range||"Ranged"===e.range||n(a,{path:t+".range",expected:'("Melee" | "Ranged" | undefined)',value:e.range}))&&(void 0===e.damageType||"string"==typeof e.damageType||n(a,{path:t+".damageType",expected:"(string | undefined)",value:e.damageType}))&&(void 0===e.qualityCost||"number"==typeof e.qualityCost||n(a,{path:t+".qualityCost",expected:"(number | undefined)",value:e.qualityCost}))&&(void 0===e.isShield||"boolean"==typeof e.isShield||n(a,{path:t+".isShield",expected:"(boolean | undefined)",value:e.isShield}))&&(void 0===e.def||"number"==typeof e.def||n(a,{path:t+".def",expected:"(number | undefined)",value:e.def}))&&(void 0===e.mdef||"number"==typeof e.mdef||n(a,{path:t+".mdef",expected:"(number | undefined)",value:e.mdef}))&&(void 0===e.martial||"boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"(boolean | undefined)",value:e.martial}))&&(void 0===e.isComplex||"boolean"==typeof e.isComplex||n(a,{path:t+".isComplex",expected:"(boolean | undefined)",value:e.isComplex})),F=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("Arcane"===e.category||"Bow"===e.category||"Flail"===e.category||"Firearm"===e.category||"Spear"===e.category||"spear_category"===e.category||"Thrown"===e.category||"Heavy"===e.category||"Dagger"===e.category||"Brawling"===e.category||"Sword"===e.category||n(a,{path:t+".category",expected:'("Arcane" | "Bow" | "Brawling" | "Dagger" | "Firearm" | "Flail" | "Heavy" | "Spear" | "Sword" | "Thrown" | "spear_category")',value:e.category}))&&("boolean"==typeof e.melee||n(a,{path:t+".melee",expected:"boolean",value:e.melee}))&&("boolean"==typeof e.ranged||n(a,{path:t+".ranged",expected:"boolean",value:e.ranged}))&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.type}))&&("number"==typeof e.hands||n(a,{path:t+".hands",expected:"number",value:e.hands}))&&("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("boolean"==typeof e.damageBonus||n(a,{path:t+".damageBonus",expected:"boolean",value:e.damageBonus}))&&("boolean"==typeof e.damageReworkBonus||n(a,{path:t+".damageReworkBonus",expected:"boolean",value:e.damageReworkBonus}))&&("boolean"==typeof e.precBonus||n(a,{path:t+".precBonus",expected:"boolean",value:e.precBonus}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("number"==typeof e.damage||n(a,{path:t+".damage",expected:"number",value:e.damage}))&&("number"==typeof e.prec||n(a,{path:t+".prec",expected:"number",value:e.prec})),I=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.category||n(a,{path:t+".category",expected:"string",value:e.category}))&&("string"==typeof e.range||n(a,{path:t+".range",expected:"string",value:e.range}))&&(("object"==typeof e.accuracyCheck&&null!==e.accuracyCheck||n(a,{path:t+".accuracyCheck",expected:"__type.o12",value:e.accuracyCheck}))&&O(e.accuracyCheck,t+".accuracyCheck",a)||n(a,{path:t+".accuracyCheck",expected:"__type.o12",value:e.accuracyCheck}))&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.type}))&&((Array.isArray(e.customizations)||n(a,{path:t+".customizations",expected:"Array<__type>.o11",value:e.customizations}))&&e.customizations.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".customizations["+i+"]",expected:"__type.o13",value:e}))&&L(e,t+".customizations["+i+"]",a)||n(a,{path:t+".customizations["+i+"]",expected:"__type.o13",value:e})))||n(a,{path:t+".customizations",expected:"Array<__type>.o11",value:e.customizations}))&&("string"==typeof e.selectedQuality||n(a,{path:t+".selectedQuality",expected:"string",value:e.selectedQuality}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.qualityCost||n(a,{path:t+".qualityCost",expected:"number",value:e.qualityCost}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("number"==typeof e.hands||n(a,{path:t+".hands",expected:"number",value:e.hands}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("boolean"==typeof e.isEquipped||n(a,{path:t+".isEquipped",expected:"boolean",value:e.isEquipped}))&&("number"==typeof e.damageModifier||n(a,{path:t+".damageModifier",expected:"number",value:e.damageModifier}))&&("number"==typeof e.precModifier||n(a,{path:t+".precModifier",expected:"number",value:e.precModifier}))&&("number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"number",value:e.defModifier}))&&("number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"number",value:e.mDefModifier}))&&("boolean"==typeof e.overrideDamageType||n(a,{path:t+".overrideDamageType",expected:"boolean",value:e.overrideDamageType}))&&("physical"===e.customDamageType||"wind"===e.customDamageType||"bolt"===e.customDamageType||"dark"===e.customDamageType||"earth"===e.customDamageType||"fire"===e.customDamageType||"ice"===e.customDamageType||"light"===e.customDamageType||"poison"===e.customDamageType||n(a,{path:t+".customDamageType",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.customDamageType}))&&("string"==typeof e.secondWeaponName||n(a,{path:t+".secondWeaponName",expected:"string",value:e.secondWeaponName}))&&("string"==typeof e.secondSelectedCategory||n(a,{path:t+".secondSelectedCategory",expected:"string",value:e.secondSelectedCategory}))&&("string"==typeof e.secondSelectedRange||n(a,{path:t+".secondSelectedRange",expected:"string",value:e.secondSelectedRange}))&&(("object"==typeof e.secondSelectedAccuracyCheck&&null!==e.secondSelectedAccuracyCheck||n(a,{path:t+".secondSelectedAccuracyCheck",expected:"__type.o14",value:e.secondSelectedAccuracyCheck}))&&j(e.secondSelectedAccuracyCheck,t+".secondSelectedAccuracyCheck",a)||n(a,{path:t+".secondSelectedAccuracyCheck",expected:"__type.o14",value:e.secondSelectedAccuracyCheck}))&&("physical"===e.secondSelectedType||"wind"===e.secondSelectedType||"bolt"===e.secondSelectedType||"dark"===e.secondSelectedType||"earth"===e.secondSelectedType||"fire"===e.secondSelectedType||"ice"===e.secondSelectedType||"light"===e.secondSelectedType||"poison"===e.secondSelectedType||n(a,{path:t+".secondSelectedType",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.secondSelectedType}))&&((Array.isArray(e.secondCurrentCustomizations)||n(a,{path:t+".secondCurrentCustomizations",expected:"Array<__type>.o12",value:e.secondCurrentCustomizations}))&&e.secondCurrentCustomizations.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".secondCurrentCustomizations["+i+"]",expected:"__type.o15",value:e}))&&N(e,t+".secondCurrentCustomizations["+i+"]",a)||n(a,{path:t+".secondCurrentCustomizations["+i+"]",expected:"__type.o15",value:e})))||n(a,{path:t+".secondCurrentCustomizations",expected:"Array<__type>.o12",value:e.secondCurrentCustomizations}))&&("number"==typeof e.secondDamageModifier||n(a,{path:t+".secondDamageModifier",expected:"number",value:e.secondDamageModifier}))&&("number"==typeof e.secondPrecModifier||n(a,{path:t+".secondPrecModifier",expected:"number",value:e.secondPrecModifier}))&&("number"==typeof e.secondDefModifier||n(a,{path:t+".secondDefModifier",expected:"number",value:e.secondDefModifier}))&&("number"==typeof e.secondMDefModifier||n(a,{path:t+".secondMDefModifier",expected:"number",value:e.secondMDefModifier}))&&("boolean"==typeof e.secondOverrideDamageType||n(a,{path:t+".secondOverrideDamageType",expected:"boolean",value:e.secondOverrideDamageType}))&&("physical"===e.secondCustomDamageType||"wind"===e.secondCustomDamageType||"bolt"===e.secondCustomDamageType||"dark"===e.secondCustomDamageType||"earth"===e.secondCustomDamageType||"fire"===e.secondCustomDamageType||"ice"===e.secondCustomDamageType||"light"===e.secondCustomDamageType||"poison"===e.secondCustomDamageType||n(a,{path:t+".secondCustomDamageType",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.secondCustomDamageType}))&&("weapon"===e.dataType||n(a,{path:t+".dataType",expected:'"weapon"',value:e.dataType})),O=(e,t,a=!0)=>("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2})),L=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("number"==typeof e.customCost||n(a,{path:t+".customCost",expected:"number",value:e.customCost})),j=(e,t,a=!0)=>("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2})),N=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("number"==typeof e.customCost||n(a,{path:t+".customCost",expected:"number",value:e.customCost})),B=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.category||n(a,{path:t+".category",expected:"string",value:e.category}))&&("number"==typeof e.def||n(a,{path:t+".def",expected:"number",value:e.def}))&&("number"==typeof e.mdef||n(a,{path:t+".mdef",expected:"number",value:e.mdef}))&&("number"==typeof e.init||n(a,{path:t+".init",expected:"number",value:e.init}))&&(void 0===e.defModifier||"number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"(number | undefined)",value:e.defModifier}))&&(void 0===e.mDefModifier||"number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"(number | undefined)",value:e.mDefModifier}))&&(void 0===e.initModifier||"number"==typeof e.initModifier||n(a,{path:t+".initModifier",expected:"(number | undefined)",value:e.initModifier}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&(void 0===e.precModifier||"number"==typeof e.precModifier||n(a,{path:t+".precModifier",expected:"(number | undefined)",value:e.precModifier}))&&(void 0===e.magicModifier||"number"==typeof e.magicModifier||n(a,{path:t+".magicModifier",expected:"(number | undefined)",value:e.magicModifier}))&&(void 0===e.damageMeleeModifier||"number"==typeof e.damageMeleeModifier||n(a,{path:t+".damageMeleeModifier",expected:"(number | undefined)",value:e.damageMeleeModifier}))&&(void 0===e.damageRangedModifier||"number"==typeof e.damageRangedModifier||n(a,{path:t+".damageRangedModifier",expected:"(number | undefined)",value:e.damageRangedModifier})),q=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.defModifier||"number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"(number | undefined)",value:e.defModifier}))&&(void 0===e.mDefModifier||"number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"(number | undefined)",value:e.mDefModifier}))&&(void 0===e.initModifier||"number"==typeof e.initModifier||n(a,{path:t+".initModifier",expected:"(number | undefined)",value:e.initModifier}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&(void 0===e.precModifier||"number"==typeof e.precModifier||n(a,{path:t+".precModifier",expected:"(number | undefined)",value:e.precModifier}))&&(void 0===e.magicModifier||"number"==typeof e.magicModifier||n(a,{path:t+".magicModifier",expected:"(number | undefined)",value:e.magicModifier}))&&(void 0===e.damageMeleeModifier||"number"==typeof e.damageMeleeModifier||n(a,{path:t+".damageMeleeModifier",expected:"(number | undefined)",value:e.damageMeleeModifier}))&&(void 0===e.damageRangedModifier||"number"==typeof e.damageRangedModifier||n(a,{path:t+".damageRangedModifier",expected:"(number | undefined)",value:e.damageRangedModifier})),z=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.description||n(a,{path:t+".description",expected:"string",value:e.description}))&&(void 0===e.clocks||(Array.isArray(e.clocks)||n(a,{path:t+".clocks",expected:"(Array<Clocks> | undefined)",value:e.clocks}))&&e.clocks.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".clocks["+i+"]",expected:"Clocks",value:e}))&&U(e,t+".clocks["+i+"]",a)||n(a,{path:t+".clocks["+i+"]",expected:"Clocks",value:e})))||n(a,{path:t+".clocks",expected:"(Array<Clocks> | undefined)",value:e.clocks})),U=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.sections||n(a,{path:t+".sections",expected:"number",value:e.sections})),H=(e,t,a=!0)=>("number"==typeof e.mdef||n(a,{path:t+".mdef",expected:"number",value:e.mdef}))&&("number"==typeof e.magicPrec||n(a,{path:t+".magicPrec",expected:"number",value:e.magicPrec}))&&("number"==typeof e.init||n(a,{path:t+".init",expected:"number",value:e.init}))&&("number"==typeof e.ip||n(a,{path:t+".ip",expected:"number",value:e.ip}))&&("number"==typeof e.hp||n(a,{path:t+".hp",expected:"number",value:e.hp}))&&("number"==typeof e.def||n(a,{path:t+".def",expected:"number",value:e.def}))&&("number"==typeof e.meleePrec||n(a,{path:t+".meleePrec",expected:"number",value:e.meleePrec}))&&("number"==typeof e.rangedPrec||n(a,{path:t+".rangedPrec",expected:"number",value:e.rangedPrec}))&&("number"==typeof e.mp||n(a,{path:t+".mp",expected:"number",value:e.mp})),W=(e,t,a=!0)=>("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.description||n(a,{path:t+".description",expected:"string",value:e.description}));("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"Player",value:e}))&&((e,t,a=!0)=>("string"==typeof e.id||"number"==typeof e.id||n(a,{path:t+".id",expected:"(number | string)",value:e.id}))&&("string"==typeof e.uid||n(a,{path:t+".uid",expected:"string",value:e.uid}))&&(void 0===e.imgurl||"string"==typeof e.imgurl||n(a,{path:t+".imgurl",expected:"(string | undefined)",value:e.imgurl}))&&("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.lvl||n(a,{path:t+".lvl",expected:"number",value:e.lvl}))&&(("object"==typeof e.stats&&null!==e.stats||n(a,{path:t+".stats",expected:"Stats",value:e.stats}))&&r(e.stats,t+".stats",a)||n(a,{path:t+".stats",expected:"Stats",value:e.stats}))&&(("object"==typeof e.info&&null!==e.info||n(a,{path:t+".info",expected:"PCInfo",value:e.info}))&&l(e.info,t+".info",a)||n(a,{path:t+".info",expected:"PCInfo",value:e.info}))&&(void 0===e.affinities||("object"==typeof e.affinities&&null!==e.affinities&&!1===Array.isArray(e.affinities)||n(a,{path:t+".affinities",expected:"(PCAffinities | undefined)",value:e.affinities}))&&d(e.affinities,t+".affinities",a)||n(a,{path:t+".affinities",expected:"(PCAffinities | undefined)",value:e.affinities}))&&(("object"==typeof e.attributes&&null!==e.attributes||n(a,{path:t+".attributes",expected:"PCAttributes",value:e.attributes}))&&u(e.attributes,t+".attributes",a)||n(a,{path:t+".attributes",expected:"PCAttributes",value:e.attributes}))&&(void 0===e.classes||(Array.isArray(e.classes)||n(a,{path:t+".classes",expected:"(Array<PCClasses> | undefined)",value:e.classes}))&&e.classes.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".classes["+i+"]",expected:"PCClasses",value:e}))&&h(e,t+".classes["+i+"]",a)||n(a,{path:t+".classes["+i+"]",expected:"PCClasses",value:e})))||n(a,{path:t+".classes",expected:"(Array<PCClasses> | undefined)",value:e.classes}))&&(void 0===e.weapons||(Array.isArray(e.weapons)||n(a,{path:t+".weapons",expected:"(Array<PCWeaponAttack> | undefined)",value:e.weapons}))&&e.weapons.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".weapons["+i+"]",expected:"PCWeaponAttack",value:e}))&&F(e,t+".weapons["+i+"]",a)||n(a,{path:t+".weapons["+i+"]",expected:"PCWeaponAttack",value:e})))||n(a,{path:t+".weapons",expected:"(Array<PCWeaponAttack> | undefined)",value:e.weapons}))&&(void 0===e.customWeapons||(Array.isArray(e.customWeapons)||n(a,{path:t+".customWeapons",expected:"(Array<PCCustomWeapon> | undefined)",value:e.customWeapons}))&&e.customWeapons.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".customWeapons["+i+"]",expected:"PCCustomWeapon",value:e}))&&I(e,t+".customWeapons["+i+"]",a)||n(a,{path:t+".customWeapons["+i+"]",expected:"PCCustomWeapon",value:e})))||n(a,{path:t+".customWeapons",expected:"(Array<PCCustomWeapon> | undefined)",value:e.customWeapons}))&&(void 0===e.armor||(Array.isArray(e.armor)||n(a,{path:t+".armor",expected:"(Array<PCArmor> | undefined)",value:e.armor}))&&e.armor.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".armor["+i+"]",expected:"PCArmor",value:e}))&&B(e,t+".armor["+i+"]",a)||n(a,{path:t+".armor["+i+"]",expected:"PCArmor",value:e})))||n(a,{path:t+".armor",expected:"(Array<PCArmor> | undefined)",value:e.armor}))&&(void 0===e.shields||(Array.isArray(e.shields)||n(a,{path:t+".shields",expected:"(Array<PCArmor> | undefined)",value:e.shields}))&&e.shields.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".shields["+i+"]",expected:"PCArmor",value:e}))&&B(e,t+".shields["+i+"]",a)||n(a,{path:t+".shields["+i+"]",expected:"PCArmor",value:e})))||n(a,{path:t+".shields",expected:"(Array<PCArmor> | undefined)",value:e.shields}))&&(void 0===e.accessories||(Array.isArray(e.accessories)||n(a,{path:t+".accessories",expected:"(Array<PCAccessory> | undefined)",value:e.accessories}))&&e.accessories.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".accessories["+i+"]",expected:"PCAccessory",value:e}))&&q(e,t+".accessories["+i+"]",a)||n(a,{path:t+".accessories["+i+"]",expected:"PCAccessory",value:e})))||n(a,{path:t+".accessories",expected:"(Array<PCAccessory> | undefined)",value:e.accessories}))&&(void 0===e.notes||(Array.isArray(e.notes)||n(a,{path:t+".notes",expected:"(Array<PCNotes> | undefined)",value:e.notes}))&&e.notes.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".notes["+i+"]",expected:"PCNotes",value:e}))&&z(e,t+".notes["+i+"]",a)||n(a,{path:t+".notes["+i+"]",expected:"PCNotes",value:e})))||n(a,{path:t+".notes",expected:"(Array<PCNotes> | undefined)",value:e.notes}))&&(("object"==typeof e.modifiers&&null!==e.modifiers||n(a,{path:t+".modifiers",expected:"PCModifiers",value:e.modifiers}))&&H(e.modifiers,t+".modifiers",a)||n(a,{path:t+".modifiers",expected:"PCModifiers",value:e.modifiers}))&&(void 0===e.quirk||("object"==typeof e.quirk&&null!==e.quirk||n(a,{path:t+".quirk",expected:"(PCQuirk | undefined)",value:e.quirk}))&&W(e.quirk,t+".quirk",a)||n(a,{path:t+".quirk",expected:"(PCQuirk | undefined)",value:e.quirk})))(e,t+"",!0)||n(!0,{path:t+"",expected:"Player",value:e})})(e,"$input",!0),e))(e=JSON.parse(e)))(this.object.text);break;case f.PCWeapon:this.object.parse=(e=>(e=>(!1===(e=>"object"==typeof e&&null!==e&&(e=>!("string"!=typeof e.name||"Arcane"!==e.category&&"Bow"!==e.category&&"Flail"!==e.category&&"Firearm"!==e.category&&"Spear"!==e.category&&"spear_category"!==e.category&&"Thrown"!==e.category&&"Heavy"!==e.category&&"Dagger"!==e.category&&"Brawling"!==e.category&&"Sword"!==e.category||"number"!=typeof e.cost||"number"!=typeof e.prec||"might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2||"boolean"!=typeof e.martial||void 0!==e.range&&"melee"!==e.range&&"distance"!==e.range||void 0!==e.melee&&"boolean"!=typeof e.melee||void 0!==e.ranged&&"boolean"!=typeof e.ranged||"number"!=typeof e.hands||"number"!=typeof e.damage||"physical"!==e.type&&"wind"!==e.type&&"bolt"!==e.type&&"dark"!==e.type&&"earth"!==e.type&&"fire"!==e.type&&"ice"!==e.type&&"light"!==e.type&&"poison"!==e.type||"string"!=typeof e.quality))(e))(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard;("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"PCWeapon",value:e}))&&((e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("Arcane"===e.category||"Bow"===e.category||"Flail"===e.category||"Firearm"===e.category||"Spear"===e.category||"spear_category"===e.category||"Thrown"===e.category||"Heavy"===e.category||"Dagger"===e.category||"Brawling"===e.category||"Sword"===e.category||n(a,{path:t+".category",expected:'("Arcane" | "Bow" | "Brawling" | "Dagger" | "Firearm" | "Flail" | "Heavy" | "Spear" | "Sword" | "Thrown" | "spear_category")',value:e.category}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("number"==typeof e.prec||n(a,{path:t+".prec",expected:"number",value:e.prec}))&&("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&(void 0===e.range||"melee"===e.range||"distance"===e.range||n(a,{path:t+".range",expected:'("distance" | "melee" | undefined)',value:e.range}))&&(void 0===e.melee||"boolean"==typeof e.melee||n(a,{path:t+".melee",expected:"(boolean | undefined)",value:e.melee}))&&(void 0===e.ranged||"boolean"==typeof e.ranged||n(a,{path:t+".ranged",expected:"(boolean | undefined)",value:e.ranged}))&&("number"==typeof e.hands||n(a,{path:t+".hands",expected:"number",value:e.hands}))&&("number"==typeof e.damage||n(a,{path:t+".damage",expected:"number",value:e.damage}))&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.type}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality})))(e,t+"",!0)||n(!0,{path:t+"",expected:"PCWeapon",value:e})})(e,"$input",!0),e))(e=JSON.parse(e)))(this.object.text);break;case f.PCCustomWeapon:this.object.parse=(e=>(e=>(!1===(e=>{const t=e=>!("might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2),a=e=>"string"==typeof e.name&&"string"==typeof e.effect&&"boolean"==typeof e.martial&&"number"==typeof e.customCost,i=e=>!("might"!==e.att1&&"dexterity"!==e.att1&&"insight"!==e.att1&&"will"!==e.att1||"might"!==e.att2&&"dexterity"!==e.att2&&"insight"!==e.att2&&"will"!==e.att2),n=e=>"string"==typeof e.name&&"string"==typeof e.effect&&"boolean"==typeof e.martial&&"number"==typeof e.customCost;return"object"==typeof e&&null!==e&&(e=>"string"==typeof e.name&&"string"==typeof e.category&&"string"==typeof e.range&&"object"==typeof e.accuracyCheck&&null!==e.accuracyCheck&&t(e.accuracyCheck)&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type)&&Array.isArray(e.customizations)&&e.customizations.every((e=>"object"==typeof e&&null!==e&&a(e)))&&"string"==typeof e.selectedQuality&&"string"==typeof e.quality&&"number"==typeof e.qualityCost&&"number"==typeof e.cost&&"number"==typeof e.hands&&"boolean"==typeof e.martial&&"boolean"==typeof e.isEquipped&&"number"==typeof e.damageModifier&&"number"==typeof e.precModifier&&"number"==typeof e.defModifier&&"number"==typeof e.mDefModifier&&"boolean"==typeof e.overrideDamageType&&("physical"===e.customDamageType||"wind"===e.customDamageType||"bolt"===e.customDamageType||"dark"===e.customDamageType||"earth"===e.customDamageType||"fire"===e.customDamageType||"ice"===e.customDamageType||"light"===e.customDamageType||"poison"===e.customDamageType)&&"string"==typeof e.secondWeaponName&&"string"==typeof e.secondSelectedCategory&&"string"==typeof e.secondSelectedRange&&"object"==typeof e.secondSelectedAccuracyCheck&&null!==e.secondSelectedAccuracyCheck&&i(e.secondSelectedAccuracyCheck)&&("physical"===e.secondSelectedType||"wind"===e.secondSelectedType||"bolt"===e.secondSelectedType||"dark"===e.secondSelectedType||"earth"===e.secondSelectedType||"fire"===e.secondSelectedType||"ice"===e.secondSelectedType||"light"===e.secondSelectedType||"poison"===e.secondSelectedType)&&Array.isArray(e.secondCurrentCustomizations)&&e.secondCurrentCustomizations.every((e=>"object"==typeof e&&null!==e&&n(e)))&&"number"==typeof e.secondDamageModifier&&"number"==typeof e.secondPrecModifier&&"number"==typeof e.secondDefModifier&&"number"==typeof e.secondMDefModifier&&"boolean"==typeof e.secondOverrideDamageType&&("physical"===e.secondCustomDamageType||"wind"===e.secondCustomDamageType||"bolt"===e.secondCustomDamageType||"dark"===e.secondCustomDamageType||"earth"===e.secondCustomDamageType||"fire"===e.secondCustomDamageType||"ice"===e.secondCustomDamageType||"light"===e.secondCustomDamageType||"poison"===e.secondCustomDamageType)&&"weapon"===e.dataType)(e)})(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard,s=(e,t,a=!0)=>("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2})),r=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("number"==typeof e.customCost||n(a,{path:t+".customCost",expected:"number",value:e.customCost})),o=(e,t,a=!0)=>("might"===e.att1||"dexterity"===e.att1||"insight"===e.att1||"will"===e.att1||n(a,{path:t+".att1",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att1}))&&("might"===e.att2||"dexterity"===e.att2||"insight"===e.att2||"will"===e.att2||n(a,{path:t+".att2",expected:'("dexterity" | "insight" | "might" | "will")',value:e.att2})),l=(e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.effect||n(a,{path:t+".effect",expected:"string",value:e.effect}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("number"==typeof e.customCost||n(a,{path:t+".customCost",expected:"number",value:e.customCost}));("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"PCCustomWeapon",value:e}))&&((e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.category||n(a,{path:t+".category",expected:"string",value:e.category}))&&("string"==typeof e.range||n(a,{path:t+".range",expected:"string",value:e.range}))&&(("object"==typeof e.accuracyCheck&&null!==e.accuracyCheck||n(a,{path:t+".accuracyCheck",expected:"__type",value:e.accuracyCheck}))&&s(e.accuracyCheck,t+".accuracyCheck",a)||n(a,{path:t+".accuracyCheck",expected:"__type",value:e.accuracyCheck}))&&("physical"===e.type||"wind"===e.type||"bolt"===e.type||"dark"===e.type||"earth"===e.type||"fire"===e.type||"ice"===e.type||"light"===e.type||"poison"===e.type||n(a,{path:t+".type",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.type}))&&((Array.isArray(e.customizations)||n(a,{path:t+".customizations",expected:"Array<__type>",value:e.customizations}))&&e.customizations.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".customizations["+i+"]",expected:"__type.o1",value:e}))&&r(e,t+".customizations["+i+"]",a)||n(a,{path:t+".customizations["+i+"]",expected:"__type.o1",value:e})))||n(a,{path:t+".customizations",expected:"Array<__type>",value:e.customizations}))&&("string"==typeof e.selectedQuality||n(a,{path:t+".selectedQuality",expected:"string",value:e.selectedQuality}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.qualityCost||n(a,{path:t+".qualityCost",expected:"number",value:e.qualityCost}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("number"==typeof e.hands||n(a,{path:t+".hands",expected:"number",value:e.hands}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("boolean"==typeof e.isEquipped||n(a,{path:t+".isEquipped",expected:"boolean",value:e.isEquipped}))&&("number"==typeof e.damageModifier||n(a,{path:t+".damageModifier",expected:"number",value:e.damageModifier}))&&("number"==typeof e.precModifier||n(a,{path:t+".precModifier",expected:"number",value:e.precModifier}))&&("number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"number",value:e.defModifier}))&&("number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"number",value:e.mDefModifier}))&&("boolean"==typeof e.overrideDamageType||n(a,{path:t+".overrideDamageType",expected:"boolean",value:e.overrideDamageType}))&&("physical"===e.customDamageType||"wind"===e.customDamageType||"bolt"===e.customDamageType||"dark"===e.customDamageType||"earth"===e.customDamageType||"fire"===e.customDamageType||"ice"===e.customDamageType||"light"===e.customDamageType||"poison"===e.customDamageType||n(a,{path:t+".customDamageType",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.customDamageType}))&&("string"==typeof e.secondWeaponName||n(a,{path:t+".secondWeaponName",expected:"string",value:e.secondWeaponName}))&&("string"==typeof e.secondSelectedCategory||n(a,{path:t+".secondSelectedCategory",expected:"string",value:e.secondSelectedCategory}))&&("string"==typeof e.secondSelectedRange||n(a,{path:t+".secondSelectedRange",expected:"string",value:e.secondSelectedRange}))&&(("object"==typeof e.secondSelectedAccuracyCheck&&null!==e.secondSelectedAccuracyCheck||n(a,{path:t+".secondSelectedAccuracyCheck",expected:"__type.o2",value:e.secondSelectedAccuracyCheck}))&&o(e.secondSelectedAccuracyCheck,t+".secondSelectedAccuracyCheck",a)||n(a,{path:t+".secondSelectedAccuracyCheck",expected:"__type.o2",value:e.secondSelectedAccuracyCheck}))&&("physical"===e.secondSelectedType||"wind"===e.secondSelectedType||"bolt"===e.secondSelectedType||"dark"===e.secondSelectedType||"earth"===e.secondSelectedType||"fire"===e.secondSelectedType||"ice"===e.secondSelectedType||"light"===e.secondSelectedType||"poison"===e.secondSelectedType||n(a,{path:t+".secondSelectedType",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.secondSelectedType}))&&((Array.isArray(e.secondCurrentCustomizations)||n(a,{path:t+".secondCurrentCustomizations",expected:"Array<__type>.o1",value:e.secondCurrentCustomizations}))&&e.secondCurrentCustomizations.every(((e,i)=>("object"==typeof e&&null!==e||n(a,{path:t+".secondCurrentCustomizations["+i+"]",expected:"__type.o3",value:e}))&&l(e,t+".secondCurrentCustomizations["+i+"]",a)||n(a,{path:t+".secondCurrentCustomizations["+i+"]",expected:"__type.o3",value:e})))||n(a,{path:t+".secondCurrentCustomizations",expected:"Array<__type>.o1",value:e.secondCurrentCustomizations}))&&("number"==typeof e.secondDamageModifier||n(a,{path:t+".secondDamageModifier",expected:"number",value:e.secondDamageModifier}))&&("number"==typeof e.secondPrecModifier||n(a,{path:t+".secondPrecModifier",expected:"number",value:e.secondPrecModifier}))&&("number"==typeof e.secondDefModifier||n(a,{path:t+".secondDefModifier",expected:"number",value:e.secondDefModifier}))&&("number"==typeof e.secondMDefModifier||n(a,{path:t+".secondMDefModifier",expected:"number",value:e.secondMDefModifier}))&&("boolean"==typeof e.secondOverrideDamageType||n(a,{path:t+".secondOverrideDamageType",expected:"boolean",value:e.secondOverrideDamageType}))&&("physical"===e.secondCustomDamageType||"wind"===e.secondCustomDamageType||"bolt"===e.secondCustomDamageType||"dark"===e.secondCustomDamageType||"earth"===e.secondCustomDamageType||"fire"===e.secondCustomDamageType||"ice"===e.secondCustomDamageType||"light"===e.secondCustomDamageType||"poison"===e.secondCustomDamageType||n(a,{path:t+".secondCustomDamageType",expected:'("bolt" | "dark" | "earth" | "fire" | "ice" | "light" | "physical" | "poison" | "wind")',value:e.secondCustomDamageType}))&&("weapon"===e.dataType||n(a,{path:t+".dataType",expected:'"weapon"',value:e.dataType})))(e,t+"",!0)||n(!0,{path:t+"",expected:"PCCustomWeapon",value:e})})(e,"$input",!0),e))(e=JSON.parse(e)))(this.object.text);break;case f.PCShield:this.object.parse=(e=>(e=>(!1===(e=>"object"==typeof e&&null!==e&&(e=>!("string"!=typeof e.name||"number"!=typeof e.cost||"number"!=typeof e.def||"number"!=typeof e.mdef||"number"!=typeof e.init||void 0!==e.defModifier&&"number"!=typeof e.defModifier||void 0!==e.mDefModifier&&"number"!=typeof e.mDefModifier||void 0!==e.initModifier&&"number"!=typeof e.initModifier||"boolean"!=typeof e.martial||"string"!=typeof e.quality))(e))(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard;("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"PCShield",value:e}))&&((e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("number"==typeof e.def||n(a,{path:t+".def",expected:"number",value:e.def}))&&("number"==typeof e.mdef||n(a,{path:t+".mdef",expected:"number",value:e.mdef}))&&("number"==typeof e.init||n(a,{path:t+".init",expected:"number",value:e.init}))&&(void 0===e.defModifier||"number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"(number | undefined)",value:e.defModifier}))&&(void 0===e.mDefModifier||"number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"(number | undefined)",value:e.mDefModifier}))&&(void 0===e.initModifier||"number"==typeof e.initModifier||n(a,{path:t+".initModifier",expected:"(number | undefined)",value:e.initModifier}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality})))(e,t+"",!0)||n(!0,{path:t+"",expected:"PCShield",value:e})})(e,"$input",!0),e))(e=JSON.parse(e)))(this.object.text);break;case f.PCArmor:this.object.parse=(e=>(e=>(!1===(e=>"object"==typeof e&&null!==e&&(e=>!("string"!=typeof e.name||"string"!=typeof e.category||"number"!=typeof e.def||"number"!=typeof e.mdef||"number"!=typeof e.init||void 0!==e.defModifier&&"number"!=typeof e.defModifier||void 0!==e.mDefModifier&&"number"!=typeof e.mDefModifier||void 0!==e.initModifier&&"number"!=typeof e.initModifier||"string"!=typeof e.quality||"number"!=typeof e.cost||"boolean"!=typeof e.martial||void 0!==e.precModifier&&"number"!=typeof e.precModifier||void 0!==e.magicModifier&&"number"!=typeof e.magicModifier||void 0!==e.damageMeleeModifier&&"number"!=typeof e.damageMeleeModifier||void 0!==e.damageRangedModifier&&"number"!=typeof e.damageRangedModifier))(e))(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard;("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"PCArmor",value:e}))&&((e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&("string"==typeof e.category||n(a,{path:t+".category",expected:"string",value:e.category}))&&("number"==typeof e.def||n(a,{path:t+".def",expected:"number",value:e.def}))&&("number"==typeof e.mdef||n(a,{path:t+".mdef",expected:"number",value:e.mdef}))&&("number"==typeof e.init||n(a,{path:t+".init",expected:"number",value:e.init}))&&(void 0===e.defModifier||"number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"(number | undefined)",value:e.defModifier}))&&(void 0===e.mDefModifier||"number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"(number | undefined)",value:e.mDefModifier}))&&(void 0===e.initModifier||"number"==typeof e.initModifier||n(a,{path:t+".initModifier",expected:"(number | undefined)",value:e.initModifier}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&("boolean"==typeof e.martial||n(a,{path:t+".martial",expected:"boolean",value:e.martial}))&&(void 0===e.precModifier||"number"==typeof e.precModifier||n(a,{path:t+".precModifier",expected:"(number | undefined)",value:e.precModifier}))&&(void 0===e.magicModifier||"number"==typeof e.magicModifier||n(a,{path:t+".magicModifier",expected:"(number | undefined)",value:e.magicModifier}))&&(void 0===e.damageMeleeModifier||"number"==typeof e.damageMeleeModifier||n(a,{path:t+".damageMeleeModifier",expected:"(number | undefined)",value:e.damageMeleeModifier}))&&(void 0===e.damageRangedModifier||"number"==typeof e.damageRangedModifier||n(a,{path:t+".damageRangedModifier",expected:"(number | undefined)",value:e.damageRangedModifier})))(e,t+"",!0)||n(!0,{path:t+"",expected:"PCArmor",value:e})})(e,"$input",!0),e))(e=JSON.parse(e)))(this.object.text);break;case f.PCAccessory:this.object.parse=(e=>(e=>(!1===(e=>"object"==typeof e&&null!==e&&(e=>!("string"!=typeof e.name||void 0!==e.defModifier&&"number"!=typeof e.defModifier||void 0!==e.mDefModifier&&"number"!=typeof e.mDefModifier||void 0!==e.initModifier&&"number"!=typeof e.initModifier||"string"!=typeof e.quality||"number"!=typeof e.cost||void 0!==e.precModifier&&"number"!=typeof e.precModifier||void 0!==e.magicModifier&&"number"!=typeof e.magicModifier||void 0!==e.damageMeleeModifier&&"number"!=typeof e.damageMeleeModifier||void 0!==e.damageRangedModifier&&"number"!=typeof e.damageRangedModifier))(e))(e)&&((e,t,a=!0)=>{const n=i.json.assertParse.guard;("object"==typeof e&&null!==e||n(!0,{path:t+"",expected:"PCAccessory",value:e}))&&((e,t,a=!0)=>("string"==typeof e.name||n(a,{path:t+".name",expected:"string",value:e.name}))&&(void 0===e.defModifier||"number"==typeof e.defModifier||n(a,{path:t+".defModifier",expected:"(number | undefined)",value:e.defModifier}))&&(void 0===e.mDefModifier||"number"==typeof e.mDefModifier||n(a,{path:t+".mDefModifier",expected:"(number | undefined)",value:e.mDefModifier}))&&(void 0===e.initModifier||"number"==typeof e.initModifier||n(a,{path:t+".initModifier",expected:"(number | undefined)",value:e.initModifier}))&&("string"==typeof e.quality||n(a,{path:t+".quality",expected:"string",value:e.quality}))&&("number"==typeof e.cost||n(a,{path:t+".cost",expected:"number",value:e.cost}))&&(void 0===e.precModifier||"number"==typeof e.precModifier||n(a,{path:t+".precModifier",expected:"(number | undefined)",value:e.precModifier}))&&(void 0===e.magicModifier||"number"==typeof e.magicModifier||n(a,{path:t+".magicModifier",expected:"(number | undefined)",value:e.magicModifier}))&&(void 0===e.damageMeleeModifier||"number"==typeof e.damageMeleeModifier||n(a,{path:t+".damageMeleeModifier",expected:"(number | undefined)",value:e.damageMeleeModifier}))&&(void 0===e.damageRangedModifier||"number"==typeof e.damageRangedModifier||n(a,{path:t+".damageRangedModifier",expected:"(number | undefined)",value:e.damageRangedModifier})))(e,t+"",!0)||n(!0,{path:t+"",expected:"PCAccessory",value:e})})(e,"$input",!0),e))(e=JSON.parse(e)))(this.object.text)}}catch(e){this.object.error=e instanceof Error?e.message:String(e)}}var a;this.render()}detectDataType(e){return/"dataType"\s*:\s*"npc"/i.test(e)?f.Npc:/"dataType"\s*:\s*"pc"/i.test(e)?f.Pc:/"dataType"\s*:\s*"weapon"/i.test(e)?/"customizations"\s*:\s*\[/i.test(e)?f.PCCustomWeapon:f.PCWeapon:/"dataType"\s*:\s*"shield"/i.test(e)?f.PCShield:/"dataType"\s*:\s*"armor"/i.test(e)?f.PCArmor:/"dataType"\s*:\s*"accessory"/i.test(e)?f.PCAccessory:void 0}async getData(){const{text:e,error:t,inProgress:a,dataType:i,preferCompendium:n}=this.object;return{...this.object,disabled:!e||!!t||a,dataType:i,preferCompendium:n}}get template(){return"modules/fu-parser/templates/import-fultimator.hbs"}activateListeners(e){super.activateListeners(e),e.find("#sub").on("click",(async e=>{e.preventDefault(),this.object.inProgress=!0,this.render();try{if(this.object.parse)switch(this.object.dataType){case f.Npc:await(async e=>{"number"==typeof e.id?e.id.toString():e.id;const t="string"==typeof e.phases?Number(e.phases):e.phases;let a=!0,i=!0;const n=[e.armor,e.shield,...e.weaponattacks?.map((e=>e.weapon))||[]].filter((e=>null!=e)).map((e=>{const t=game.items.find((t=>t.name.toLowerCase()===e.name.toLowerCase()));if(t){const e=duplicate(t),n=e.type;return"weapon"===n?a?(e.system.isEquipped={slot:"mainHand",value:!0},a=!1,"two-handed"==e.system.hands.value&&(i=!1)):i&&"one-handed"==e.system.hands.value&&(e.system.isEquipped={slot:"offHand",value:!0},i=!1):"shield"===n?i&&(e.system.isEquipped={slot:"offHand",value:!0},i=!1):"accessory"!=n&&"armor"!=n||(e.system.isEquipped={slot:n,value:!0}),e}console.log("Not Found",e)})).filter((e=>void 0!==e)),s={system:{level:{value:e.lvl},resources:{hp:{value:0,max:0,min:0,bonus:e.extra&&e.extra.hp?Number(e.extra.hp):0},mp:{value:0,max:0,min:0,bonus:e.extra&&e.extra.mp?Number(e.extra.mp):0},ip:{value:6,max:6,min:0},fp:{value:3}},affinities:{physical:{base:u(e.affinities.physical),current:u(e.affinities.physical),bonus:0},air:{base:u(e.affinities.wind),current:u(e.affinities.wind),bonus:0},bolt:{base:u(e.affinities.bolt),current:u(e.affinities.bolt),bonus:0},dark:{base:u(e.affinities.dark),current:u(e.affinities.dark),bonus:0},earth:{base:u(e.affinities.earth),current:u(e.affinities.earth),bonus:0},fire:{base:u(e.affinities.fire),current:u(e.affinities.fire),bonus:0},ice:{base:u(e.affinities.ice),current:u(e.affinities.ice),bonus:0},light:{base:u(e.affinities.light),current:u(e.affinities.light),bonus:0},poison:{base:u(e.affinities.poison),current:u(e.affinities.poison),bonus:0}},attributes:{dex:{base:e.attributes.dexterity,current:e.attributes.dexterity,bonus:0},ins:{base:e.attributes.insight,current:e.attributes.insight,bonus:0},mig:{base:e.attributes.might,current:e.attributes.might,bonus:0},wlp:{base:e.attributes.will,current:e.attributes.will,bonus:0}},derived:{init:{value:0,bonus:(e.extra&&e.extra.init?4:0)+(e.extra&&e.extra?.extrainit?Number(e.extra.extrainit):0)},def:{value:0,bonus:e.extra&&e.extra.def||0},mdef:{value:0,bonus:e.extra&&e.extra.mDef||0},accuracy:{value:0,bonus:e.extra&&e.extra.precision?3:0},magic:{value:0,bonus:e.extra&&e.extra.magic?3:0}},traits:{value:e.traits||""},species:{value:e.species.toLowerCase()},useEquipment:{value:0!=n.length},villain:{value:e.villain||""},phases:{value:t||0},multipart:{value:e.multipart||""},isElite:{value:"elite"==e.rank},isChampion:{value:e.rank&&/champion/.test(e.rank)?Number(e.rank.slice(-1)):1},isCompanion:{value:"companion"==e.rank},study:{value:0},description:r(e.description||"")},type:"npc",name:""!=e.name?e.name:"Unnamed NPC"},o=await Actor.create(s),l=e.attacks.map((t=>({type:"basic",name:""!=t.name?t.name:"Unnamed Attack",system:{attributes:{primary:{value:c[t.attr1]},secondary:{value:c[t.attr2]}},accuracy:{value:Math.floor(e.lvl/10)+("companion"==e.rank?e.lvl||1:0)+(t.flathit?Number(t.flathit):0)},damage:{value:5*Math.floor(e.lvl/20)+5+(t.extraDamage?5:0)+("companion"==e.rank?e.lvl||1:0)+(t.flatdmg?Number(t.flatdmg):0)},type:{value:"distance"==t.range?"ranged":"melee"},damageType:{value:d[t.type]},quality:{value:""},isBehavior:!1,weight:{value:1},description:r(t.special.join(" "))}}))),h=(e.weaponattacks||[]).map((t=>{const a=t.type??t.weapon.type??"physical";return{type:"basic",name:""!=t.name?t.name:"Unnamed Weapon Attack",system:{attributes:{primary:{value:c[t.weapon.att1]},secondary:{value:c[t.weapon.att2]}},accuracy:{value:Math.floor(e.lvl/10)+t.weapon.prec+("companion"==e.rank?e.lvl||1:0)+(t.flathit?Number(t.flathit):0)},damage:{value:5*Math.floor(e.lvl/20)+t.weapon.damage+(t.extraDamage?5:0)+(t.flatdmg?Number(t.flatdmg):0)},type:{value:"distance"==t.weapon.range?"ranged":"melee"},damageType:{value:d[a]},description:r(t.special.join(" ")),isBehavior:!1,weight:{value:1},quality:{value:""}}}})),f=(e.spells||[]).map((t=>{const{targetingRule:a,maxTargets:i}=m(t.target,t.maxTargets),n=p(t.mp),s=i>1||n.perTarget;return{type:"spell",name:""!=t.name?t.name:"Unnamed Spell",system:{cost:{resource:"mp",amount:n.amount,perTarget:s},targeting:{rule:a,max:i},mpCost:{value:t.mp},target:{value:t.target},duration:{value:(t.duration||"").toLowerCase()},isOffensive:{value:"offensive"==t.type},hasRoll:{value:"offensive"==t.type},rollInfo:"offensive"==t.type?{attributes:{primary:{value:c[t.attr1]},secondary:{value:c[t.attr2]}},accuracy:{value:Math.floor(e.lvl/10)+("companion"==e.rank?e.lvl||1:0)}}:void 0,description:r(t.effect),isBehavior:!1,weight:{value:1},quality:{value:""}}}})),g=(e.actions||[]).map((e=>({name:""!=e.name?e.name:"Unnamed Other Action",system:{description:r(e.effect||""),isBehavior:!1,weight:{value:1},hasClock:{value:!1},hasRoll:{value:!1}},type:"miscAbility"}))),y=(e.special||[]).map((e=>({name:""!=e.name?e.name:"Unnamed Special Rule",system:{description:r(e.effect||""),isBehavior:!1,weight:{value:1},hasClock:{value:!1}},type:"rule"}))),v=(e.raregear||[]).map((e=>({name:""!=e.name?e.name:"Unnamed Rare Gear",system:{description:r(e.effect||""),isBehavior:!1,weight:{value:1},hasClock:{value:!1}},type:"rule"}))),b=(e.notes||[]).map((e=>({name:""!=e.name?e.name:"Unnamed Note",system:{description:r(e.effect||""),isBehavior:!1,weight:{value:1},hasClock:{value:!1}},type:"rule"})));await o.createEmbeddedDocuments("Item",[...l,...h,...f,...g,...y,...v,...b]),await o.createEmbeddedDocuments("Item",n),await o.update({"system.resources.hp.value":o.system.resources.hp.max,"system.resources.mp.value":o.system.resources.mp.max})})(this.object.parse);break;case f.Pc:await(async(e,t=!0)=>{"number"==typeof e.id?e.id.toString():e.id;const a={system:{level:{value:e.lvl},resources:{hp:{value:e.stats.hp.current,max:0,min:0,bonus:e.modifiers.hp},mp:{value:e.stats.mp.current,max:0,min:0,bonus:e.modifiers.mp},ip:{value:e.stats.ip.current,max:0,min:0,bonus:e.modifiers.ip},fp:{value:e.info.fabulapoints},zenit:{value:e.info.zenit},exp:{value:e.info.exp},identity:{name:e.info.identity||""},pronouns:{name:e.info.pronouns||""},theme:{name:e.info.theme||""},origin:{name:e.info.origin||""},bonds:(i=e.info.bonds||[],i.map((e=>{const t=[e.admiration,e.inferiority,e.loyality,e.mistrust,e.affection,e.hatred].filter(Boolean).length,a=Math.min(t,4);return{name:e.name||"",admInf:e.admiration?"Admiration":e.inferiority?"Inferiority":"",loyMis:e.loyality?"Loyalty":e.mistrust?"Mistrust":"",affHat:e.affection?"Affection":e.hatred?"Hatred":"",strength:a}})))},affinities:{physical:{base:u(e.affinities?.physical),current:u(e.affinities?.physical),bonus:0},air:{base:u(e.affinities?.wind),current:u(e.affinities?.wind),bonus:0},bolt:{base:u(e.affinities?.bolt),current:u(e.affinities?.bolt),bonus:0},dark:{base:u(e.affinities?.dark),current:u(e.affinities?.dark),bonus:0},earth:{base:u(e.affinities?.earth),current:u(e.affinities?.earth),bonus:0},fire:{base:u(e.affinities?.fire),current:u(e.affinities?.fire),bonus:0},ice:{base:u(e.affinities?.ice),current:u(e.affinities?.ice),bonus:0},light:{base:u(e.affinities?.light),current:u(e.affinities?.light),bonus:0},poison:{base:u(e.affinities?.poison),current:u(e.affinities?.poison),bonus:0}},attributes:{dex:{base:e.attributes.dexterity,current:e.attributes.dexterity,bonus:0},ins:{base:e.attributes.insight,current:e.attributes.insight,bonus:0},mig:{base:e.attributes.might,current:e.attributes.might,bonus:0},wlp:{base:e.attributes.willpower,current:e.attributes.willpower,bonus:0}},derived:{init:{value:0,bonus:e.modifiers.init},def:{value:0,bonus:e.modifiers.def},mdef:{value:0,bonus:e.modifiers.mdef}},bonuses:{accuracy:{accuracyCheck:0,accuracyMelee:e.modifiers.meleePrec,accuracyRanged:e.modifiers.rangedPrec,magicCheck:e.modifiers.magicPrec},damage:{melee:0,ranged:0,spell:0}},description:r(e.info.description)||""},type:"character",name:""!=e.name?e.name:"Unnamed NPC"};var i;const l=await Promise.all((e.classes||[]).map((async e=>{const a=h(e.name,"Unnamed Class");if(t){const t=game.packs.get("projectfu.classes");if(t){const i=(await t.getIndex({fields:["name"]})).find((e=>e.name===a));if(i){const a=(await t.getDocument(i._id)).toObject();return a.system.level.value=e.lvl,a}}}return{name:a,system:{level:{value:e.lvl},benefits:{resources:{hp:{value:e.benefits.hpplus},mp:{value:e.benefits.mpplus},ip:{value:e.benefits.ipplus}},martials:{melee:{value:e.benefits.martials.melee},ranged:{value:e.benefits.martials.ranged},armor:{value:e.benefits.martials.armor},shields:{value:e.benefits.martials.shields}},rituals:{arcanism:{value:e.benefits.rituals.arcanism},chimerism:{value:e.benefits.rituals.chimerism},elementalism:{value:e.benefits.rituals.elementalism},entropism:{value:e.benefits.rituals.entropism},ritualism:{value:e.benefits.rituals.ritualism},spiritism:{value:e.benefits.rituals.spiritism}}},description:""},type:"class"}}))),f=await Promise.all((e.classes||[]).flatMap((e=>(e.skills||[]).filter((e=>e.currentLvl>0)).map((async e=>{const a=h(e.skillName,"Unnamed Skill");if(t){const t=game.packs.get("projectfu.skills");if(t){const i=(await t.getIndex({fields:["name"]})).find((e=>e.name===a));if(i){const a=(await t.getDocument(i._id)).toObject();return a.system.level={value:e.currentLvl,max:e.maxLvl},a}}}return{type:"skill",name:a,system:{description:r(e.description),level:{value:e.currentLvl,max:e.maxLvl}}}}))))),g=await Promise.all((e.classes||[]).map((async e=>{if(!e.heroic||e.lvl<10)return null;const a=h(e.heroic.name,"Unnamed Heroic Skill");if(t){const t=game.packs.get("projectfu.heroic-skills");if(t){const i=(await t.getIndex({fields:["name"]})).find((e=>e.name===a));if(i){const a=(await t.getDocument(i._id)).toObject();return a.system.subtype={value:"skill"},a.system.class={value:e.name},a}}}return{type:"heroic",name:a,system:{subtype:{value:"skill"},class:{value:e.name},description:r(e.heroic.description)}}}))).then((e=>e.filter(Boolean))),y=async(e,t)=>{const a=game.packs.get(e);if(!a)return null;if(a.getSingleItemByFuid)return a.getSingleItemByFuid(t);const i=(await a.getIndex({fields:["flags","name"]})).find((e=>{if("object"==typeof e&&null!==e){const a=e;return a.flags?.core?.sourceId?.includes(t)||a.name&&s(a.name)===t}return!1}));return i?(await a.getDocument(i._id)).toObject():null},v=await Promise.all((e.classes||[]).map((async e=>e.spells&&0!==e.spells.length?(await Promise.all((e.spells||[]).map((async e=>{const a=h(e.name||e.spellName,"Unnamed Spell");if("arcanist"===e.spellType){if(t){const e=s(a),t=await y("projectfu.skills",e);if(t)return t}return{type:"classFeature",name:a,img:"icons/svg/item-bag.svg",system:{fuid:a,summary:{value:""},featureType:"projectfu.arcanum",data:{merge:`<p>${r(e.mergeDesc||e.merge||"")}</p>`,dismiss:`<p>${r(e.dismissDesc||e.domainDesc||"")}</p>`,domains:e.domain||""},source:""}}}if("arcanist-rework"===e.spellType){if(t){const e=s(a),t=await y("projectfu.skills",e);if(t)return t}return{type:"classFeature",name:a,img:"icons/svg/item-bag.svg",system:{fuid:a,summary:{value:""},featureType:"projectfu-playtest.arcanum2",data:{merge:`<p>${r(e.mergeDesc||e.merge||"")}</p>`,dismiss:`<p>${r(e.dismissDesc||e.dismiss||"")}</p>`,pulse:`<p>${r(e.pulseDesc||e.pulse||"")}</p>`,domains:e.domain||""},source:""}}}if(("tinkerer-alchemy"===e.spellType||"tinkerer-infusion"===e.spellType||"tinkerer-magitech"===e.spellType)&&t){const t={"tinkerer-alchemy":"gadget-alchemy","tinkerer-infusion":"gadget-infusion","tinkerer-magitech":"gadget-magitech"}[e.spellType],a=await y("projectfu.skills",t);if(a)return a}if("magichant"===e.spellType){const a=[],i={magichant_flame:"key-of-flame",magichant_frost:"key-of-frost",magichant_iron:"key-of-iron",magichant_radiance:"key-of-radiance",magichant_shadow:"key-of-shadow",magichant_stone:"key-of-stone",magichant_thunder:"key-of-thunder",magichant_wind:"key-of-wind"},n={magichant_flame:"Key of Flame",magichant_frost:"Key of Frost",magichant_iron:"Key of Iron",magichant_radiance:"Key of Radiance",magichant_shadow:"Key of Shadow",magichant_stone:"Key of Stone",magichant_thunder:"Key of Thunder",magichant_wind:"Key of Wind"},s={magichant_tone_calm:"calm-tone",magichant_tone_energetic:"energetic-tone",magichant_tone_frantic:"frantic-tone",magichant_tone_haunting:"haunting-tone",magichant_tone_lively:"lively-tone",magichant_tone_menacing:"menacing-tone",magichant_tone_solemn:"solemn-tone"},o={magichant_tone_calm:"Calm Tone",magichant_tone_energetic:"Energetic Tone",magichant_tone_frantic:"Frantic Tone",magichant_tone_haunting:"Haunting Tone",magichant_tone_lively:"Lively Tone",magichant_tone_menacing:"Menacing Tone",magichant_tone_solemn:"Solemn Tone"};if(e.keys)for(const s of e.keys){if(t&&i[s.name]){const e=i[s.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}const e=s.customName||n[s.name]||s.name;a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:e,summary:{value:""},featureType:"projectfu.key",data:{},source:""}})}if(e.tones)for(const i of e.tones){if(t&&s[i.name]){const e=s[i.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}const e=i.customName||o[i.name]||i.name;a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:e,summary:{value:""},featureType:"projectfu.tone",data:{description:r(i.effect)||""},source:""}})}return a.length>0?a:null}if("dance"===e.spellType){const a=[],i={dance_duration_next_turn:"nextTurn",dance_duration_instant:"instant","Until the start of your next turn":"nextTurn",Instantaneous:"instant"},n={dance_angel:"angel-dance",dance_banshee:"banshee-dance",dance_bat:"bat-dance",dance_cat:"cat-dance",dance_devil:"devil-dance",dance_dragon:"dragon-dance",dance_falcon:"falcon-dance",dance_fox:"fox-dance",dance_golem:"golem-dance",dance_griffin:"griffin-dance",dance_hydra:"hydra-dance",dance_kraken:"kraken-dance",dance_lion:"lion-dance",dance_maenad:"maenad-dance",dance_myrmidon:"myrmidon-dance",dance_nightmare:"nightmare-dance",dance_ouroboros:"ouroboros-dance",dance_peacock:"peacock-dance",dance_phoenix:"phoenix-dance",dance_satyr:"satyr-dance",dance_spider:"spider-dance",dance_turtle:"turtle-dance",dance_unicorn:"unicorn-dance",dance_wolf:"wolf-dance",dance_yeti:"yeti-dance"},s={dance_angel:"Angel Dance",dance_banshee:"Banshee Dance",dance_bat:"Bat Dance",dance_cat:"Cat Dance",dance_devil:"Devil Dance",dance_dragon:"Dragon Dance",dance_falcon:"Falcon Dance",dance_fox:"Fox Dance",dance_golem:"Golem Dance",dance_griffin:"Griffin Dance",dance_hydra:"Hydra Dance",dance_kraken:"Kraken Dance",dance_lion:"Lion Dance",dance_maenad:"Maenad Dance",dance_myrmidon:"Myrmidon Dance",dance_nightmare:"Nightmare Dance",dance_ouroboros:"Ouroboros Dance",dance_peacock:"Peacock Dance",dance_phoenix:"Phoenix Dance",dance_satyr:"Satyr Dance",dance_spider:"Spider Dance",dance_turtle:"Turtle Dance",dance_unicorn:"Unicorn Dance",dance_wolf:"Wolf Dance",dance_yeti:"Yeti Dance"};if(e.dances)for(const o of e.dances){const e="dance_custom_name"===o.name?o.customName||"Custom Dance":s[o.name]||o.name;if(t&&n[o.name]){const e=n[o.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:"dance_custom_name"===o.name?e.toLowerCase().replace(/\s+/g,"-"):o.name,summary:{value:""},featureType:"projectfu.dance",data:{duration:i[o.duration||""]||o.duration||"",description:r(o.effect||"")},source:""}})}return a.length>0?a:null}if("gift"===e.spellType){const a=[],i={esper_gift_atmokinesis:"atmokinesis",esper_gift_clairvoyance:"clairvoyance",esper_gift_gravitokinesis:"gravitokinesis",esper_gift_life_transference:"life-transference",esper_gift_photokinesis:"photokinesis",esper_gift_psychic_backlash:"psychic-backlash",esper_gift_psychic_shield:"psychic-shield",esper_gift_reassuring_presence:"reassuring-presence",esper_gift_thermokinesis:"thermokinesis"},n={esper_gift_atmokinesis:"Atmokinesis",esper_gift_clairvoyance:"Clairvoyance",esper_gift_gravitokinesis:"Gravitokinesis",esper_gift_life_transference:"Life Transference",esper_gift_photokinesis:"Photokinesis",esper_gift_psychic_backlash:"Psychic Backlash",esper_gift_psychic_shield:"Psychic Shield",esper_gift_reassuring_presence:"Reassuring Presence",esper_gift_thermokinesis:"Thermokinesis"};if(e.gifts)for(const s of e.gifts){const e="esper_gift_custom_name"===s.name?s.customName||"Custom Gift":n[s.name]||s.name;if(t&&i[s.name]){const e=i[s.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:"esper_gift_custom_name"===s.name?e.toLowerCase().replace(/\s+/g,"-"):s.name,summary:{value:""},featureType:"projectfu.psychicGift",data:{trigger:r(s.event||""),description:r(s.effect||"")},source:""}})}return a.length>0?a:null}if("therioform"===e.spellType){const a=[],i={mutant_therioform_amphibia:"amphibia",mutant_therioform_arpaktida:"arpaktida",mutant_therioform_dynamotheria:"dynamotheria",mutant_therioform_electrophora:"electrophora",mutant_therioform_neurophagoida:"neurophagoida",mutant_therioform_placophora:"placophora",mutant_therioform_pneumophora:"pneumophora",mutant_therioform_polypoda:"polypoda",mutant_therioform_pterotheria:"pterotheria",mutant_therioform_pyrophora:"pyrophora",mutant_therioform_tachytheria:"tachytheria",mutant_therioform_toxicophora:"toxicophora"},n={mutant_therioform_amphibia:"Amphibia",mutant_therioform_arpaktida:"Arpaktida",mutant_therioform_dynamotheria:"Dynamotheria",mutant_therioform_electrophora:"Electrophora",mutant_therioform_neurophagoida:"Neurophagoida",mutant_therioform_placophora:"Placophora",mutant_therioform_pneumophora:"Pneumophora",mutant_therioform_polypoda:"Polypoda",mutant_therioform_pterotheria:"Pterotheria",mutant_therioform_pyrophora:"Pyrophora",mutant_therioform_tachytheria:"Tachytheria",mutant_therioform_toxicophora:"Toxicophora"};if(e.therioforms)for(const s of e.therioforms){const e="mutant_therioform_custom_name"===s.name?s.customName||"Custom Therioform":n[s.name]||s.name;if(t&&i[s.name]){const e=i[s.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:"mutant_therioform_custom_name"===s.name?e.toLowerCase().replace(/\s+/g,"-"):s.name,summary:{value:s.genoclepsis||""},featureType:"projectfu.therioform",data:{description:r(s.description||"")},source:""}})}return a.length>0?a:null}if("invocation"===e.spellType){const a=[],i=e=>1===e?"basic":2===e?"advanced":3===e?"superior":void 0;if(t){const t="invocations",n="inner-wellspring",s=await y("projectfu.skills",t);if(s){const t=duplicate(s),n=i(e.skillLevel);n&&"classFeature"===t.type&&"projectfu.weaponModule"!==t.system.featureType&&t.system.data&&"level"in t.system.data&&(t.system.data.level=n,a.push(t))}if(!0===e.innerWellspring&&e.chosenWellspring){const t=await y("projectfu.heroic-skills",n);if(t){const i=duplicate(t);if("heroic"===i.type){const t=e.chosenWellspring.toLowerCase(),a=i;if(a.effects&&Array.isArray(a.effects))for(const e of a.effects)e.name&&e.name.toLowerCase().includes(t)?e.disabled=!1:e.disabled=!0}a.push(i)}}}return a.length>0?a:null}if("magiseed"===e.spellType){const a=[],i={magiseed_arctic_narcissus:"arctic-narcissus",magiseed_blazing_chrysanthemum:"blazing-chrysanthemum",magiseed_desert_dahlia:"desert-dahlia",magiseed_golden_ginkgo:"golden-ginkgo",magiseed_grave_asphodel:"grave-asphodel",magiseed_hermit_iris:"hermit-iris",magiseed_hookleaf_nightshade:"hookleaf-nightshade",magiseed_horned_hawthorn:"horned-hawthorn",magiseed_lunar_magnolia:"lunar-magnolia",magiseed_ocean_lotus:"ocean-lotus",magiseed_pilgrim_gazalia:"pilgrim-gazalia",magiseed_prancing_dandelion:"prancing-dandelion",magiseed_regal_protea:"regal-protea",magiseed_remedy_lily:"remedy-lily",magiseed_serrated_rose:"serrated-rose",magiseed_silver_strelitzia:"silver-strelitzia",magiseed_star_peony:"star-peony",magiseed_striped_orchid:"striped-orchid",magiseed_wardwattle:"wardwattle",magiseed_wrathful_carnation:"wrathful-carnation"},n={magiseed_arctic_narcissus:"Arctic Narcissus",magiseed_blazing_chrysanthemum:"Blazing Chrysanthemum",magiseed_desert_dahlia:"Desert Dahlia",magiseed_golden_ginkgo:"Golden Ginkgo",magiseed_grave_asphodel:"Grave Asphodel",magiseed_hermit_iris:"Hermit Iris",magiseed_hookleaf_nightshade:"Hookleaf Nightshade",magiseed_horned_hawthorn:"Horned Hawthorn",magiseed_lunar_magnolia:"Lunar Magnolia",magiseed_ocean_lotus:"Ocean Lotus",magiseed_pilgrim_gazalia:"Pilgrim Gazalia",magiseed_prancing_dandelion:"Prancing Dandelion",magiseed_regal_protea:"Regal Protea",magiseed_remedy_lily:"Remedy Lily",magiseed_serrated_rose:"Serrated Rose",magiseed_silver_strelitzia:"Silver Strelitzia",magiseed_star_peony:"Star Peony",magiseed_striped_orchid:"Striped Orchid",magiseed_wardwattle:"Wardwattle",magiseed_wrathful_carnation:"Wrathful Carnation"};if(t){const e="garden",t=await y("projectfu.skills",e);if(t){const e=duplicate(t);"classFeature"===e.type&&"projectfu.weaponModule"!==e.system.featureType&&a.push(e)}}if(e.magiseeds&&Array.isArray(e.magiseeds))for(const s of e.magiseeds){const e="magiseed_custom"===s.name?s.customName||"Custom Magiseed":n[s.name]||s.name;if("magiseed_custom"===s.name){const t=[];if(s.effects){const e=Object.keys(s.effects).map(Number).sort(((e,t)=>e-t));for(const a of e){const e=s.effects[a.toString()];e&&t.push({start:a,end:a+1,effect:e})}}a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:e.toLowerCase().replace(/\s+/g,"-"),summary:{value:s.description||""},featureType:"projectfu.magiseed",data:{effectCount:t.length,effects:t},source:""}});continue}if(t&&i[s.name]){const e=i[s.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}let o="";s.effects&&(o=Object.entries(s.effects).filter((([e,t])=>t)).map((([e,t])=>`**Level ${e}**: ${t}`)).join("\n\n")),a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:s.name,summary:{value:s.description||""},featureType:"projectfu.magiseed",data:{description:r(o)},source:""}})}return a.length>0?a:null}if("cooking"===e.spellType){const a=[],i="cookbook",n="all-you-can-eat";if(t){const t=await y("projectfu.skills",i);if(t){const i=duplicate(t);if("classFeature"===i.type&&"projectfu.cookbook"===i.system.featureType&&i.system.data.combinations&&e.cookbookEffects&&"object"==typeof e.cookbookEffects&&!Array.isArray(e.cookbookEffects)){for(const[t,a]of Object.entries(e.cookbookEffects))if(i.system.data.combinations[t]){let e=a.effect||"";a.customChoices&&Object.keys(a.customChoices).length>0&&(e+="\n\n**Choice:** "+Object.values(a.customChoices).join(", ")),i.system.data.combinations[t].effect=r(e)}a.push(i)}else"classFeature"===i.type&&"projectfu.weaponModule"!==i.system.featureType&&a.push(i)}}if(!0===e.allYouCanEat&&t){const e=await y("projectfu.heroic-skills",n);if(e){const t=duplicate(e);"heroic"===t.type&&a.push(t)}}if(e.ingredientInventory&&Array.isArray(e.ingredientInventory)&&t)for(const t of e.ingredientInventory){const e=await y("projectfu.skills",t.taste);if(e){const i=duplicate(e);if("classFeature"===i.type&&"projectfu.ingredient"===i.system.featureType){const e=i.system.data;void 0!==t.quantity&&(e.quantity=t.quantity)}a.push(i)}}return a.length>0?a:null}if("pilot-vehicle"===e.spellType){const a=[],i={pilot_module_aerial:"aerial-module","pilot_module_anti-element":"anti-element-module",pilot_module_advanced_targeting:"advanced-targeting-module",pilot_module_counterstrike:"counterstrike-module",pilot_module_excavation:"excavation-module",pilot_module_expanded_plating:"expanded-plating-module",pilot_module_magistatic:"magistatic-module",pilot_module_power:"power-module",pilot_module_rapid_interface:"rapid-interface-module",pilot_module_seafarer:"seafarer-module",pilot_module_seat:"seat-module",pilot_module_secondary_offensive:"secondary-offensive-module",pilot_module_sensor:"sensor-module",pilot_module_turbo:"turbo-module"},o={pilot_module_arcane:"arcane-module",pilot_module_axe:"axe-module",pilot_module_blade:"blade-module",pilot_module_bow:"bow-module",pilot_module_cannon:"cannon-module",pilot_module_claw:"claw-module",pilot_module_claymore:"claymore-module",pilot_module_esoteric:"esoteric-module",pilot_module_flail:"flail-module",pilot_module_flamer:"flamer-module",pilot_module_machine_gun:"machine-gun-module",pilot_module_rifle:"rifle-module",pilot_module_scythe:"scythe-module",pilot_module_shield:"shield-module",pilot_module_spear:"spear-module",pilot_module_sword:"sword-module",pilot_module_trident:"trident-module"},l={pilot_frame_exoskeleton:"exoskeleton",pilot_frame_mecha:"mecha",pilot_frame_steed:"steed"},c={pilot_module_flexible_plating:"flexible-plating-module",pilot_module_heavy_plating:"heavy-plating-module",pilot_module_runic_plating:"runic-plating-module",pilot_module_standard_plating:"standard-plating-module"},d={pilot_module_aerial:"Aerial Module","pilot_module_anti-element":"Anti-Element Module",pilot_module_advanced_targeting:"Advanced Targeting Module",pilot_module_counterstrike:"Counterstrike Module",pilot_module_excavation:"Excavation Module",pilot_module_expanded_plating:"Expanded Plating Module",pilot_module_magistatic:"Magistatic Module",pilot_module_power:"Power Module",pilot_module_rapid_interface:"Rapid Interface Module",pilot_module_seafarer:"Seafarer Module",pilot_module_seat:"Seat Module",pilot_module_secondary_offensive:"Secondary Offensive Module",pilot_module_sensor:"Sensor Module",pilot_module_turbo:"Turbo Module"},u={pilot_module_arcane:"Arcane Module",pilot_module_axe:"Axe Module",pilot_module_blade:"Blade Module",pilot_module_bow:"Bow Module",pilot_module_cannon:"Cannon Module",pilot_module_claw:"Claw Module",pilot_module_claymore:"Claymore Module",pilot_module_esoteric:"Esoteric Module",pilot_module_flail:"Flail Module",pilot_module_flamer:"Flamer Module",pilot_module_machine_gun:"Machine Gun Module",pilot_module_rifle:"Rifle Module",pilot_module_scythe:"Scythe Module",pilot_module_shield:"Shield Module",pilot_module_spear:"Spear Module",pilot_module_sword:"Sword Module",pilot_module_trident:"Trident Module"},h={pilot_frame_exoskeleton:"Exoskeleton",pilot_frame_mecha:"Mecha",pilot_frame_steed:"Steed"},p={pilot_module_flexible_plating:"Flexible Plating Module",pilot_module_heavy_plating:"Heavy Plating Module",pilot_module_runic_plating:"Runic Plating Module",pilot_module_standard_plating:"Standard Plating Module"};if(e.vehicles)for(const m of e.vehicles){if(t&&l[m.frame]){const e=l[m.frame]||s(h[m.frame]),t=await y("projectfu.vehicle-modules",e);t&&"classFeature"===t.type&&"projectfu.vehicle"===t.system.featureType&&(t.system.data.moduleSlots=m.maxEnabledModules||3,a.push(t))}if(m.modules)for(const e of m.modules){if("pilot_module_weapon"===e.type){const i=e.customName||u[e.name]||e.name;if(t&&o[e.name]){const t=o[e.name],i=await y("projectfu.vehicle-modules",t);if(i){a.push(i);continue}}const s=e.damageType?.toLowerCase()||"physical",l=(e.cost||0)+(e.qualityCost||0);a.push({type:"classFeature",name:i,img:"systems/projectfu/styles/static/compendium/weapon-modules/blade-module.png",system:{fuid:"pilot_custom_weapon"===e.name?i.toLowerCase().replace(/\s+/g,"-"):e.name,summary:{value:""},featureType:"projectfu.weaponModule",cost:{value:l},data:{quality:e.quality||"",description:r(e.description||""),accuracy:{attr1:n(e.att1),attr2:n(e.att2),modifier:e.prec||0,defense:"def"},damage:{bonus:e.damage||0,type:s},type:"Ranged"===e.range?"ranged":e.isShield?"shield":"melee",category:"spear_category"===e.category?.toLowerCase()?"spear":e.category?.toLowerCase()||"brawling",complex:e.cumbersome||!1,shield:e.isShield?{defense:2,magicDefense:2}:void 0},source:""}})}if("pilot_module_armor"===e.type){const i=e.customName||p[e.name]||e.name;if(t&&c[e.name]){const t=c[e.name],i=await y("projectfu.vehicle-modules",t);if(i){a.push(i);continue}}const n=(e.cost||0)+(e.qualityCost||0);a.push({type:"classFeature",name:i,img:"icons/equipment/chest/breastplate-banded-steel.webp",system:{fuid:"pilot_custom_armor"===e.name?i.toLowerCase().replace(/\s+/g,"-"):e.name,summary:{value:""},featureType:"projectfu.armorModule",cost:{value:n},data:{martial:e.martial||!1,quality:e.quality||"",defense:{modifier:e.def||0,attribute:"dex"},magicDefense:{modifier:e.mdef||0,attribute:"ins"},description:r(e.description||"")},source:""}})}if("pilot_module_support"===e.type){const n=e.customName||d[e.name]||e.name;if(t&&i[e.name]){const t=i[e.name],n=await y("projectfu.vehicle-modules",t);if(n){a.push(n);continue}}const s=(e.cost||0)+(e.qualityCost||0);a.push({type:"classFeature",name:n,img:"icons/commodities/tech/cog-brass.webp",system:{fuid:"pilot_custom_support"===e.name?n.toLowerCase().replace(/\s+/g,"-"):e.name,summary:{value:""},featureType:"projectfu.supportModule",cost:{value:s},data:{description:r(e.description||""),complex:e.isComplex||!1},source:""}})}}}return a.length>0?a:null}if("symbol"===e.spellType){const a=[],i={symbol_binding:"symbol-of-binding",symbol_creation:"symbol-of-creation",symbol_despair:"symbol-of-despair",symbol_destiny:"symbol-of-destiny",symbol_elements:"symbol-of-elements",symbol_enmity:"symbol-of-enmity",symbol_flux:"symbol-of-flux",symbol_forbiddance:"symbol-of-forbiddance",symbol_growth:"symbol-of-growth",symbol_metamorphosis:"symbol-of-metamorphosis",symbol_prosperity:"symbol-of-prosperity",symbol_protection:"symbol-of-protection",symbol_rebellion:"symbol-of-rebellion",symbol_rebirth:"symbol-of-rebirth",symbol_revenge:"symbol-of-revenge",symbol_sacrifice:"symbol-of-sacrifice",symbol_sorcery:"symbol-of-sorcery",symbol_truth:"symbol-of-truth",symbol_weakness:"symbol-of-weakness",symbol_custom_name:"custom-symbol"},n={symbol_binding:"Symbol of Binding",symbol_creation:"Symbol of Creation",symbol_despair:"Symbol of Despair",symbol_destiny:"Symbol of Destiny",symbol_elements:"Symbol of Elements",symbol_enmity:"Symbol of Enmity",symbol_flux:"Symbol of Flux",symbol_forbiddance:"Symbol of Forbiddance",symbol_growth:"Symbol of Growth",symbol_metamorphosis:"Symbol of Metamorphosis",symbol_prosperity:"Symbol of Prosperity",symbol_protection:"Symbol of Protection",symbol_rebellion:"Symbol of Rebellion",symbol_rebirth:"Symbol of Rebirth",symbol_revenge:"Symbol of Revenge",symbol_sacrifice:"Symbol of Sacrifice",symbol_sorcery:"Symbol of Sorcery",symbol_truth:"Symbol of Truth",symbol_weakness:"Symbol of Weakness",symbol_custom_name:"Custom Symbol"};if(e.symbols)for(const s of e.symbols){const e="symbol_custom_name"===s.name?s.customName||"Custom Symbol":n[s.name]||s.name;if(t&&i[s.name]){const e=i[s.name],t=await y("projectfu.skills",e);if(t){a.push(t);continue}}a.push({type:"classFeature",name:e,img:"icons/svg/item-bag.svg",system:{fuid:"symbol_custom_name"===s.name?e.toLowerCase().replace(/\s+/g,"_"):s.name,summary:{value:""},featureType:"projectfu.symbol",data:{description:r(s.effect||"")},source:""}})}return a.length>0?a:null}if("gamble"===e.spellType&&t){const e="gamble",t=await y("projectfu.spells",e);if(t)return t}if(t){const e=s(a),t=await y("projectfu.spells",e);if(t)return t}const{targetingRule:i,maxTargets:o}=m(e.targetDesc,e.maxTargets),l=p(e.mp),d=o>1||l.perTarget;return{type:"spell",name:a,system:{cost:{resource:"mp",amount:l.amount,perTarget:d},targeting:{rule:i,max:o},mpCost:{value:(e.mp??"").toString()},maxTargets:{value:(e.maxTargets??1).toString()},target:{value:(e.targetDesc??"").toString()},duration:{value:(e.duration??"").toLowerCase()},isOffensive:{value:!0===e.isOffensive},hasRoll:{value:!0===e.isOffensive},rollInfo:!0===e.isOffensive&&e.attr1&&e.attr2?{attributes:{primary:{value:c[e.attr1]},secondary:{value:c[e.attr2]}},accuracy:{value:0}}:void 0,description:r(e.description||""),isBehavior:!1,weight:{value:1},quality:{value:""},summary:{value:e.isMagisphere?"Magisphere":""}}}})))).filter((e=>null!==e)).flatMap((e=>Array.isArray(e)?e:[e])):[]))).then((e=>e.flat())),b=(e.notes||[]).flatMap((e=>[{name:h(e.name,"Unnamed Note"),system:{description:r(e.description),isBehavior:!1,weight:{value:1},hasClock:{value:!1},hasRoll:{value:!1}},type:"miscAbility"},...(e.clocks||[]).map((e=>{const t=h(e.name,"Unnamed Clock");return{name:t,system:{description:t,isBehavior:!1,isFavored:{value:!0},weight:{value:1},hasClock:{value:!0},progress:{name:t,current:0,step:0,max:e.sections||0},hasRoll:{value:!1}},type:"miscAbility"}}))])),A=(e.weapons||[]).map((e=>{const t=e.type,a=e.category;return{type:"weapon",name:""!==e.name?e.name:"Unnamed Weapon",system:{attributes:{primary:{value:c[e.att1]},secondary:{value:c[e.att2]}},accuracy:{value:e.prec},damage:{value:e.damage},type:{value:e.ranged?"ranged":"melee"},damageType:{value:d[t]},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:e.martial},category:{value:o[a]},hands:{value:1===e.hands?"one-handed":"two-handed"},isCustomWeapon:{value:!1}}}})),_=(e.armor||[]).map((e=>{const t=e.defModifier??0,a=e.mDefModifier??0,i=e.initModifier??0;return{type:"armor",name:""!==e.name?e.name:"Unnamed Armor",system:{def:{value:e.def+t},mdef:{value:e.mdef+a},init:{value:e.init+i},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:e.martial}}}})),x=(e.shields||[]).map((e=>{const t=e.defModifier??0,a=e.mDefModifier??0,i=e.initModifier??0;return{type:"shield",name:""!==e.name?e.name:"Unnamed Shield",system:{def:{value:e.def+t},mdef:{value:e.mdef+a},init:{value:e.init+i},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:e.martial}}}})),w=(e.accessories||[]).map((e=>{const t=e.defModifier??0,a=e.mDefModifier??0,i=e.initModifier??0;return{type:"accessory",name:""!==e.name?e.name:"Unnamed accessory",system:{def:{value:t},mdef:{value:a},init:{value:i},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:!1}}}})),C=(e.customWeapons||[]).map((e=>{const t=e=>({weapon_customization_accurate:"Accurate",weapon_customization_defenseboost:"Defense Boost",weapon_customization_elemental:"Elemental",weapon_customization_magicdefenseboost:"Magic Defense Boost",weapon_customization_powerful:"Powerful",weapon_customization_powerful_effect:"Powerful",weapon_customization_quick:"Quick",weapon_customization_transforming:"Transforming"}[e]||e),a=e=>({weapon_category_arcane:"arcane",weapon_category_bow:"bow",weapon_category_flail:"flail",weapon_category_firearm:"firearm",weapon_category_spear:"spear",weapon_category_thrown:"thrown",weapon_category_heavy:"heavy",weapon_category_dagger:"dagger",weapon_category_brawling:"brawling",weapon_category_sword:"sword"}[e]||"brawling"),i=(e,t)=>{let a=0,i=0,n=0,s=0;for(const r of e)r.name.includes("accurate")&&(i+=2),r.name.includes("magicdefenseboost")?s+=2:r.name.includes("defenseboost")&&(n+=2),r.name.includes("elemental")&&(a+=2),r.name.includes("powerful")&&(a+="weapon_category_heavy"===t?7:5);return{damageBonus:a,accuracyBonus:i,defBonus:n,mdefBonus:s}},o=e.customizations.some((e=>e.name.includes("transforming")))||(e.secondCurrentCustomizations||[]).some((e=>e.name.includes("transforming"))),l=e.martial||e.customizations.some((e=>e.martial))||(e.secondCurrentCustomizations||[]).some((e=>e.martial)),c=i(e.customizations,e.category),u=i(e.secondCurrentCustomizations||[],e.secondSelectedCategory),h="weapon_range_ranged"===e.range?"ranged":"melee",p="weapon_range_ranged"===e.secondSelectedRange?"ranged":"melee",m=e=>d[e]||"physical";let f=e.quality||"";return e.customizations.length>0&&(f+="\n\n**Primary Form Customizations:**\n",f+=e.customizations.map((e=>`- ${t(e.name)}`)).join("\n")),o&&e.secondCurrentCustomizations.length>0&&(f+="\n\n**Secondary Form Customizations:**\n",f+=e.secondCurrentCustomizations.map((e=>`- ${t(e.name)}`)).join("\n")),{type:"customWeapon",name:e.name||"Unnamed Custom Weapon",system:{fuid:s(e.name||"custom-weapon"),isFavored:{value:!1},showTitleCard:{value:!1},cost:e.cost+e.qualityCost,isMartial:l,defense:"def",isTransforming:o,activeForm:"primaryForm",primaryForm:{def:(e.defModifier||0)+c.defBonus,mdef:(e.mDefModifier||0)+c.mdefBonus,attributes:{primary:n(e.accuracyCheck.att1),secondary:n(e.accuracyCheck.att2)},accuracy:e.precModifier+c.accuracyBonus,damage:{value:5+e.damageModifier+c.damageBonus,type:m(e.overrideDamageType?e.customDamageType:e.type)},type:h,category:a(e.category),name:e.name||""},secondaryForm:{def:(e.secondDefModifier||0)+u.defBonus,mdef:(e.secondMDefModifier||0)+u.mdefBonus,attributes:{primary:n(e.secondSelectedAccuracyCheck.att1),secondary:n(e.secondSelectedAccuracyCheck.att2)},accuracy:e.secondPrecModifier+u.accuracyBonus,damage:{value:5+e.secondDamageModifier+u.damageBonus,type:m(e.secondOverrideDamageType?e.secondCustomDamageType:e.secondSelectedType)},type:p,category:a(e.secondSelectedCategory),name:e.secondWeaponName||""},traits:[],slots:"alpha",items:[],summary:"",quality:e.quality,description:r(f)}}})),E=[];if(e.quirk){const t=Array.isArray(e.quirk)?e.quirk:[e.quirk];E.push(...t.map((e=>({type:"optionalFeature",name:""!==e.name?e.name:"Unnamed quirk",system:{optionalType:"projectfu.quirk",data:{description:r(e.description||"")+"<br>"+(e.effect||"")}}}))))}const S=await Actor.create(a);await S.createEmbeddedDocuments("Item",[...A,...C,..._,...x,...w,...l,...f,...g,...v,...b,...E]),await S.update({"system.resources.hp.value":S.system.resources.hp.max,"system.resources.mp.value":S.system.resources.mp.max})})(this.object.parse,this.object.preferCompendium??!0);break;case f.PCWeapon:await(async e=>{const t=e.type,a=e.category,i=e.ranged,n={type:"weapon",name:""!==e.name?e.name:"Unnamed data",system:{attributes:{primary:{value:c[e.att1]},secondary:{value:c[e.att2]}},accuracy:{value:e.prec},damage:{value:e.damage},type:{value:i?"ranged":"melee"},damageType:{value:d[t]},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:e.martial},category:{value:o[a]},hands:{value:1===e.hands?"one-handed":"two-handed"},isCustomWeapon:{value:!1}}},s=await Item.create(n);console.log("Item created:",s)})(this.object.parse);break;case f.PCCustomWeapon:await(async e=>{const t=e=>({weapon_customization_accurate:"Accurate",weapon_customization_defenseboost:"Defense Boost",weapon_customization_elemental:"Elemental",weapon_customization_magicdefenseboost:"Magic Defense Boost",weapon_customization_powerful:"Powerful",weapon_customization_powerful_effect:"Powerful",weapon_customization_quick:"Quick",weapon_customization_transforming:"Transforming"}[e]||e),a=e=>({weapon_category_arcane:"arcane",weapon_category_bow:"bow",weapon_category_flail:"flail",weapon_category_firearm:"firearm",weapon_category_spear:"spear",weapon_category_thrown:"thrown",weapon_category_heavy:"heavy",weapon_category_dagger:"dagger",weapon_category_brawling:"brawling",weapon_category_sword:"sword"}[e]||"brawling"),i=(e,t)=>{let a=0,i=0,n=0,s=0;for(const r of e)r.name.includes("accurate")&&(i+=2),r.name.includes("magicdefenseboost")?s+=2:r.name.includes("defenseboost")&&(n+=2),r.name.includes("elemental")&&(a+=2),r.name.includes("powerful")&&(a+="weapon_category_heavy"===t?7:5);return{damageBonus:a,accuracyBonus:i,defBonus:n,mdefBonus:s}},o=e.customizations.some((e=>e.name.includes("transforming")))||(e.secondCurrentCustomizations||[]).some((e=>e.name.includes("transforming"))),l=e.martial||e.customizations.some((e=>e.martial))||(e.secondCurrentCustomizations||[]).some((e=>e.martial)),c=i(e.customizations||[],e.category),u=i(e.secondCurrentCustomizations||[],e.secondSelectedCategory),h="weapon_range_ranged"===e.range?"ranged":"melee",p="weapon_range_ranged"===e.secondSelectedRange?"ranged":"melee",m=e=>d[e]||"physical";let f=e.quality||"";e.customizations.length>0&&(f+="\n\n**Primary Form Customizations:**\n",f+=e.customizations.map((e=>`- ${t(e.name)}`)).join("\n")),o&&(e.secondCurrentCustomizations||[]).length>0&&(f+="\n\n**Secondary Form Customizations:**\n",f+=(e.secondCurrentCustomizations||[]).map((e=>`- ${t(e.name)}`)).join("\n"));const g={type:"customWeapon",name:e.name||"Unnamed Custom Weapon",system:{description:r(f),fuid:s(e.name||"custom-weapon"),isFavored:{value:!1},showTitleCard:{value:!1},cost:e.cost+e.qualityCost,isMartial:l,defense:"def",isTransforming:o,activeForm:"primaryForm",primaryForm:{def:(e.defModifier||0)+c.defBonus,mdef:(e.mDefModifier||0)+c.mdefBonus,attributes:{primary:n(e.accuracyCheck.att1),secondary:n(e.accuracyCheck.att2)},accuracy:e.precModifier+c.accuracyBonus,damage:{value:5+e.damageModifier+c.damageBonus,type:m(e.overrideDamageType?e.customDamageType:e.type)},type:h,category:a(e.category),name:e.name||""},secondaryForm:{def:(e.secondDefModifier||0)+u.defBonus,mdef:(e.secondMDefModifier||0)+u.mdefBonus,attributes:{primary:n(e.secondSelectedAccuracyCheck.att1),secondary:n(e.secondSelectedAccuracyCheck.att2)},accuracy:e.secondPrecModifier+u.accuracyBonus,damage:{value:5+e.secondDamageModifier+u.damageBonus,type:m(e.secondOverrideDamageType?e.secondCustomDamageType:e.secondSelectedType)},type:p,category:a(e.secondSelectedCategory),name:e.secondWeaponName||""},traits:[],slots:"alpha",items:[],summary:"",quality:e.quality}},y=await Item.create(g);console.log("Custom weapon created:",y)})(this.object.parse);break;case f.PCShield:await(async e=>{const t=e.defModifier??0,a=e.mDefModifier??0,i=e.initModifier??0,n={type:"shield",name:""!==e.name?e.name:"Unnamed data",system:{description:r(e.quality||""),cost:{value:e.cost},isMartial:{value:e.martial},quality:{value:""},isEquipped:{value:!1,slot:""},def:{value:e.def+t},mdef:{value:e.mdef+a},init:{value:e.init+i},isBehavior:!1,weight:{value:1}}},s=await Item.create(n);console.log("Item created:",s)})(this.object.parse);break;case f.PCArmor:await(async e=>{const t=e.defModifier??0,a=e.mDefModifier??0,i=e.initModifier??0,n={type:"armor",name:""!==e.name?e.name:"Unnamed Armor",system:{def:{value:e.def+t,attribute:"dex"},mdef:{value:e.mdef+a,attribute:"ins"},init:{value:e.init+i},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:e.martial}}},s=await Item.create(n);console.log("Armor item created:",s)})(this.object.parse);break;case f.PCAccessory:await(async e=>{const t=e.defModifier??0,a=e.mDefModifier??0,i=e.initModifier??0,n={type:"shield",name:""!==e.name?e.name:"Unnamed data",system:{def:{value:0|t},mdef:{value:0|a},init:{value:0|i},description:r(e.quality||""),isBehavior:!1,cost:{value:e.cost},weight:{value:1},quality:{value:""},isMartial:{value:!1}}},s=await Item.create(n);console.log("Item created:",s)})(this.object.parse)}}finally{this.object.inProgress=!1,this.close()}}))}}},2986:(e,t,a)=>{"use strict";a.a(e,(async(e,i)=>{try{a.d(t,{E5:()=>d,PN:()=>ImportPDFApplication});var n=a(8541),s=a(1378),r=a(4566),o=a(7221),l=e([n,s]);[n,s]=l.then?(await l)():l,n.Tu.workerSrc="modules/fu-parser/pdf.worker.js";for(const e of["deepFlatten","equals","partition","filterJoin","findSplice"])Object.defineProperty(Array.prototype,e,{enumerable:!1});const c=async(e,t)=>{const[a,i]=await(0,s.D)(e);switch(t){case"FUCR_LEGACY":return[await(0,r.K)(a),i];case"FUCR":case"FUHF":case"FUTF":case"FUNF":case"FUCR_PT":return[await(0,o.o)(a,t),i]}},d={FUCR:"Core Rulebook (rare items)",FUCR_LEGACY:"Core Rulebook legacy",FUCR_PT:"Livro BÃ¡sico (PT-BR)",FUHF:"High Fantasy Atlas",FUTF:"Techno Fantasy Atlas",FUNF:"Natural Fantasy Atlas"};class ImportPDFApplication extends FormApplication{async _updateObject(e,t){if(t.imagePath!=this.object.imagePath&&(this.object.imagePath=t.imagePath),t.pdfPath!=this.object.pdfPath||t.bookType!=this.object.bookType){this.cleanupPDFResources(),this.object.pdfPath=t.pdfPath,this.object.bookType=t.bookType,this.render();const[e,a]=await c(this.object.pdfPath,this.object.bookType);this.object.parseResults=e,this.object.destroy=a}this.render()}async getData(){return{...this.object,disabled:""===this.object.imagePath||""===this.object.pdfPath||0==this.object.parseResults.length||this.object.inProgress}}get template(){return"modules/fu-parser/templates/import-pdf.hbs"}async close(e){return this.cleanupPDFResources(),super.close(e)}cleanupPDFResources(){for(const e of this.object.parseResults)"success"===e.type&&e.cleanup();this.object.destroy&&this.object.destroy(),this.object.parseResults=[],delete this.object.destroy}activateListeners(e){super.activateListeners(e),e.find(".fu-parser-collapsible").on("click",(e=>{e.preventDefault();const t=e.currentTarget;t.classList.toggle("fu-parser-active");const a=t.nextElementSibling;a?.style.maxHeight?a.style.maxHeight="":a.style.maxHeight=a.scrollHeight+"px"})),e.find("#sub").on("click",(async e=>{e.preventDefault(),this.object.inProgress=!0,this.render();for(const e of this.object.parseResults)"success"===e.type&&await e.save(this.object.imagePath);this.close()}))}}i()}catch(e){i(e)}}))},4566:(e,t,a)=>{"use strict";a.d(t,{K:()=>je});var i=a(6780),n=a(5065),s=a(2659);const r=([e,t])=>e[t],o=([e,t])=>[e,t+1],l=(e,t)=>({result:[e,t]}),c=e=>"result"in e,d=e=>"error"in e,u=(e,t,a)=>({error:e,distance:t,found:a}),h=e=>t=>[l(e,t)],p=e=>t=>{const a=r(t);return null!=a?(0,i.iJ)(a)?[u(e,t[1],"<Image>")]:[u(e,t[1],a)]:[u(e,t[1],"<eof>")]},m=(e,t)=>a=>{const i=r(a);return i&&e(i)?h(i)(o(a)):p(t)(a)},f=(e,t)=>e.reduce(((e,a)=>e.concat(t(a))),[]),g=(e,t)=>a=>f(e(a),(e=>{if(d(e))return[e];{const[a,i]=e.result;return f(t(i),(e=>{if(d(e))return[e];const[t,i]=e.result;return[l([a,t],i)]}))}})),y=(e,t)=>a=>e(a).concat(t(a)),v=(e,t)=>a=>e(a).map((e=>{if(d(e))return e;const[a,i]=e.result;return l(t(a),i)})),b=e=>(([e,t])=>e.length<=t)(e)?h("eof")(e):p("eof")(e),A=e=>y(v(g(e,(t=>A(e)(t).filter(c))),(([e,t])=>[e].concat(t))),h([])),_=e=>v(g(e,A(e)),(([e,t])=>[e].concat(t))),x=v(m(i.iJ,"typed Image"),(e=>e.image)),w=v(m(i.QJ,"typed string"),(e=>e.string)),C=e=>v(m((t=>(0,i.QJ)(t)&&e.some((e=>e.test(t.font)))),`string with fonts ${e}`),(e=>e.string)),E=e=>m((t=>(0,i.QJ)(t)&&t.string===e),`text: "${e}"`),S=(e,t)=>m((a=>(0,i.QJ)(a)&&a.string===e&&t.some((e=>e.test(a.font)))),`text: "${e}" with fonts ${t}`),M=(e,...t)=>0===t.length?v(e,(e=>[e])):v(g(e,M(t[0],...t.slice(1))),(([e,t])=>[e].concat(t))),T=(e,t)=>v(g(e,t),(([e,t])=>e)),k=(e,t)=>v(g(e,t),(([e,t])=>t)),P=v(m((e=>(0,i.QJ)(e)&&/.*[.?!]$/.test(e.string)),"description end"),(e=>e.string)),D=v(m((e=>(0,i.QJ)(e)&&[/PTSans-Narrow$/,/PTSans-NarrowBold$/,/Heydings-Icons$/,/KozMinPro-Regular$/].some((t=>t.test(e.font)))&&!/^Opportunity:/.test(e.string)),"description line"),(e=>e.string)),R=y(v(M(C([/PTSans-Narrow$/]),A(D),P),(([e,t,a])=>(0,s.Fb)([e,...t,a]))),P),F=M(x,x,_(w)),I=S("w",[/Wingdings-Regular$/]),O=(e,t)=>v(m((t=>(0,i.QJ)(t)&&e.test(t.string)),t),(e=>e.string)),L=y(v(m((e=>(0,i.QJ)(e)&&/\+\d*/.test(e.string)),"Accuracy bonus"),(e=>Number(e.string.slice(1)))),h(0)),j=v(g(T(k(E("ã€"),(e=>{const t=r(e);if(t&&(0,i.QJ)(t)&&9==t.string.length){const a=t.string.slice(0,3),i=t.string.slice(-3);if((0,n.h5)(a)&&(0,n.h5)(i))return h([a,i])(o(e))}return p("Accuracy attributes")(e)})),E("ã€‘")),L),(([[e,t],a])=>({primary:e,secondary:t,bonus:a}))),N=T(k(E("ã€"),(e=>{const t=r(e);return t&&(0,i.QJ)(t)&&/HR \+ \d+/.test(t.string)?h(Number(t.string.slice(5)))(o(e)):p("Damage")(e)})),E("ã€‘")),B=v(_(w),(e=>e.join(""))),q=y(v(E("One-handed"),(()=>"one-handed")),v(E("Two-handed"),(()=>"two-handed"))),z=y(v(E("Melee"),(()=>"melee")),v(E("Ranged"),(()=>"ranged"))),U=y(v(S("E",[/FnT_BasicShapes1$/]),(e=>!0)),h(!1)),H=v(C([/PTSans-Narrow$/]),s.HX),W=e=>v(O(/^((\+|-)?[0-9]+)|-$/,e),(e=>"-"===e?0:Number(e))),$=C([/Helvetica$/]),V=v(M(x,v(_(w),(e=>e.join(" "))),v(O(/^[0-9]+$/,"ipCost"),(e=>Number(e))),R),(([e,t,a,i])=>({image:e,name:t,ipCost:a,description:i}))),G=O(/^[^.?!]*$/,"header"),X=T(k(F,_(g(G,_(V)))),M(w,$,b)),K=v(M(x,w,U,H,j,N,B,T(q,I),T(z,I),R),(([e,t,a,i,n,s,r,o,l,c])=>({image:e,name:t,martial:a,cost:i,damage:s,accuracy:n,damageType:r,hands:o,melee:l,description:c}))),Y=T(k(M(x,x,_(w)),(e=>{const t=r(e);return t&&(0,i.QJ)(t)&&/^SAMPLE RARE .* WEAPONS$/.test(t.string)?J(t.string.slice(12,-8).toLowerCase(),e):p("Category")(e)})),_(w));function J(e,t){return n.DA.includes(e)?h(e)(o(t)):p(`Unexpected category ${e}`)(t)}const Q=v(g((e=>{const t=r(e);return t&&(0,i.QJ)(t)&&t.string.endsWith(" Category")?J(t.string.slice(0,-9).toLowerCase(),e):p("Category")(e)}),_(K)),(([e,t])=>t.map((t=>({...t,category:e}))))),Z=g(y(g(E("BASIC WEAPONS"),$),$),b),ee=v(T(k(F,_(Q)),Z),(e=>e.flat(1))),te=T(v(g(Y,_(K)),(([e,t])=>t.map((t=>({...t,category:e}))))),g($,b));var ae=a(8824);const ie=v(w,(0,ae.i)("DEX")),ne=v(w,(0,ae.i)("INS")),se=W("initiative"),re=v(g(A(C([/PTSans-Narrow$/,/PTSans-NarrowBold$/,/Heydings-Icons$/,/KozMinPro-Regular$/])),P),(([e,t])=>(0,s.Fb)([...e,t]))),oe=v(M(x,w,U,H,ie,ne,se,re),(([e,t,a,i,n,s,r,o])=>({image:e,name:t,martial:a,cost:i,def:n,mdef:s,init:r,description:o}))),le=T(k(F,_(oe)),M(y(x,h(null)),$,b)),ce=W("def"),de=W("mdef"),ue=W("initiative"),he=v(M(x,w,U,H,ce,de,ue,R),(([e,t,a,i,n,s,r,o])=>({image:e,name:t,martial:a,cost:i,def:n,mdef:s,init:r,description:o}))),pe=T(k(F,_(he)),M(y(M(w,w,_(x)),h(null)),$,b)),me=v(M(x,w,H,R),(([e,t,a,i])=>({image:e,name:t,description:i,cost:a}))),fe=T(k(F,_(me)),g($,b)),ge=e=>v(O(new RegExp(`^${e} d(${n.eX.join("|")})`),e),(t=>Number(t.slice(e.length+2)))),ye=ge("DEX"),ve=ge("INS"),be=ge("MIG"),Ae=ge("WLP"),_e=v(O(/^Init\. [0-9]+$/,"beast init"),(e=>Number(e.slice(6)))),xe=e=>v(O(new RegExp(`^${e} \\+?[0-9]+$`),"beast def"),(t=>Number(t.slice(e.length+1)))),we=v(M(ye,ve,be,Ae,k(E("HP"),v(O(/^[0-9]+$/,"HP"),(e=>Number(e)))),k(I,v(O(/^[0-9]+$/,"Crisis"),(e=>Number(e)))),k(E("MP"),v(O(/^[0-9]+$/,"MP"),(e=>Number(e)))),_e,xe("DEF"),xe("M.DEF")),(([e,t,a,i,n,s,r,o,l,c])=>({dex:e,ins:t,mig:a,wlp:i,maxHp:n,crisis:s,maxMp:r,init:o,def:l,mdef:c}))),Ce=n.VH.reduce(((e,t)=>{return v(g(e,(a=n.Rg[t],y(v(E(a),(()=>"N")),k(g(E(a),E(a)),O(new RegExp(n.Eu.join("|")),"affinity"))))),(([e,a])=>({...e,[t]:a})));var a}),h({})),Ee=v(M(y(v(S("$",[/Evilz$/]),(()=>"melee")),v(_(S("a",[/fabulaultima$/])),(()=>"ranged"))),w,k(I,j),k(I,y(g(N,y(C([/PTSans-NarrowBold$/]),h(null))),h([0,null]))),R),(([e,t,a,[i,n],s])=>({range:e,name:t,accuracy:a,damage:i,damageType:n,description:s}))),Se=v(M(T(w,I),R),(([e,t])=>({name:e,description:t}))),Me=k(E("Opportunity:"),R),Te=k(E("SPELLS"),_(v(M(k(S("h",[/Evilz$/]),w),y(k(_(S("r",[/Heydings-Icons$/])),k(I,j)),h(null)),k(I,v(w,(e=>e.slice(0,-3)))),k(I,w),k(I,v(T(w,E(".")),(e=>e.toLowerCase()))),R,y(Me,h(null))),(([e,t,a,i,n,s,r])=>r?{name:e,accuracy:t,mp:a,target:i,duration:n,description:s,opportunity:r}:{name:e,accuracy:t,mp:a,target:i,duration:n,description:s})))),ke=k(E("BASIC ATTACKS"),_(Ee)),Pe=k(E("SPECIAL RULES"),_(Se)),De=k(E("OTHER ACTIONS"),_(k(S("S",[/WebSymbols-Regular$/]),Se))),Re=v(M(x,w,v(O(/^Lv \d+/,"Level"),(e=>Number(e.slice(3)))),k(I,w),R,k(E("Typical Traits:"),w),we,Ce,y(k(E("Equipment:"),v(w,(e=>e.slice(0,-1).split(", ")))),h(null)),y(ke,h([])),y(Te,h([])),y(De,h([])),y(Pe,h([]))),(([e,t,a,i,n,s,r,o,l,c,d,u,h])=>({image:e,name:t,level:a,type:i,description:n,traits:s,attributes:r,resists:o,equipment:l,attacks:c,spells:d,otherActions:u,specialRules:h}))),Fe=T(k(F,_(Re)),M(y(y(y(M(C([/MonotypeCorsiva$/]),C([/MonotypeCorsiva$/]),y(M(_(w),C([/Antonio-Bold$/]),x,A(w),x),h(null))),M(_(O(/^.*[^.]$/,"aside")),O(/^.*\.$/,"aside"),C([/Antonio-Bold$/]),x,A(w),x)),C([/CreditValley$/])),h(null)),$,b));var Ie=a(1497);const Oe={106:[["Equipment","Consumables"],e=>e(X,Ie.xh)],132:[["Equipment","Weapons","Basic"],e=>e(ee,Ie.$F)],133:[["Equipment","Weapons","Basic"],e=>e(ee,Ie.$F)],134:[["Equipment","Armors","Basic"],e=>e(le,Ie.pA)],135:[["Equipment","Shields","Basic"],e=>e(pe,Ie.LT)],272:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],273:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],274:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],275:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],276:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],277:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],278:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],279:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],280:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],281:[["Equipment","Weapons","Rare"],e=>e(te,Ie.$F)],283:[["Equipment","Armors","Rare"],e=>e(le,Ie.pA)],284:[["Equipment","Armors","Rare"],e=>e(le,Ie.pA)],285:[["Equipment","Shields","Rare"],e=>e(pe,Ie.LT)],287:[["Equipment","Accessories"],e=>e(fe,Ie.q1)],288:[["Equipment","Accessories"],e=>e(fe,Ie.q1)],289:[["Equipment","Accessories"],e=>e(fe,Ie.q1)],326:[["Beastiary"],e=>e(Fe,Ie.fL)],327:[["Beastiary"],e=>e(Fe,Ie.fL)],328:[["Beastiary"],e=>e(Fe,Ie.fL)],329:[["Beastiary"],e=>e(Fe,Ie.fL)],330:[["Beastiary"],e=>e(Fe,Ie.fL)],331:[["Beastiary"],e=>e(Fe,Ie.fL)],332:[["Beastiary"],e=>e(Fe,Ie.fL)],333:[["Beastiary"],e=>e(Fe,Ie.fL)],334:[["Beastiary"],e=>e(Fe,Ie.fL)],335:[["Beastiary"],e=>e(Fe,Ie.fL)],336:[["Beastiary"],e=>e(Fe,Ie.fL)],337:[["Beastiary"],e=>e(Fe,Ie.fL)],338:[["Beastiary"],e=>e(Fe,Ie.fL)],339:[["Beastiary"],e=>e(Fe,Ie.fL)],340:[["Beastiary"],e=>e(Fe,Ie.fL)],341:[["Beastiary"],e=>e(Fe,Ie.fL)],342:[["Beastiary"],e=>e(Fe,Ie.fL)],343:[["Beastiary"],e=>e(Fe,Ie.fL)],344:[["Beastiary"],e=>e(Fe,Ie.fL)],345:[["Beastiary"],e=>e(Fe,Ie.fL)],346:[["Beastiary"],e=>e(Fe,Ie.fL)],347:[["Beastiary"],e=>e(Fe,Ie.fL)],348:[["Beastiary"],e=>e(Fe,Ie.fL)],349:[["Beastiary"],e=>e(Fe,Ie.fL)],350:[["Beastiary"],e=>e(Fe,Ie.fL)],351:[["Beastiary"],e=>e(Fe,Ie.fL)],352:[["Beastiary"],e=>e(Fe,Ie.fL)],353:[["Beastiary"],e=>e(Fe,Ie.fL)],354:[["Beastiary"],e=>e(Fe,Ie.fL)],355:[["Beastiary"],e=>e(Fe,Ie.fL)]},Le=e=>"string"==typeof e?e:`<Text str="${e.string}" font="${e.font}">`;function je(e){return Promise.all(Object.entries(Oe).map((([t,[a,i]])=>i((async(i,n)=>{const s=Number(t),[r,o]=await e(s,(async e=>{const t="FUCR"+(s-2),r=i([e,0]),o=r.filter(c);if(1==o.length)return{type:"success",page:s,results:f(o[0].result[0],(e=>"name"in e?[e]:e[1])),save:async e=>await n(o[0].result[0],t,a,e)};{const e=r.filter(d);return 0==o.length?{type:"failure",page:s,errors:e.map((e=>({...e,found:Le(e.found)})))}:{type:"too many",page:s,count:o.length,errors:e.map((e=>({...e,found:Le(e.found)})))}}}));return"success"===r.type?{...r,cleanup:o}:(o(),r)})))))}},7221:(e,t,a)=>{"use strict";a.d(t,{o:()=>b});var i=a(1497),n=a(6780);Map.prototype.map=function(e){return new Map(Array.from(this.entries(),(([t,a])=>e(t,a))))},Map.prototype.mapValues=function(e){const t=Array.from(this.entries()).map((([t,a],i)=>[t,e(a,t,i)]));return new Map(t)};var s=a(5065);function r(e){const t=e.filter(n.QJ).map(n.Pw),a=e.filter(n.iJ).map(n.ge).sort(((e,t)=>t.y-e.y)),i=t.find((e=>e.string.startsWith("SAMPLE RARE")))?.string.split(" ").at(2)||"",r=function(e){return e.reduce(((e,t)=>{const a=function(e){const t=e.toUpperCase().trim();return["WEAPON","ARMAS"].includes(t)||t.includes("CATEGORIA DE")||t.includes("CATEGORIAS DE")?"WEAPON":["ARMOR","ARMADURAS","ARMADURAS BÃSICAS"].includes(t)?"ARMOR":["SHIELD","ESCUDOS"].includes(t)?"SHIELD":["ACCESSORY","ACESSÃ“RIOS"].includes(t)?"ACCESSORY":["WEAPON MODULE","MÃ“DULOS DE ARMA"].includes(t)?"WEAPON MODULE":["CAMP ACTIVITY","ATIVIDADES DE ACAMPAMENTO"].includes(t)?"CAMP ACTIVITY":void 0}(t.string);if(s.dd.includes(t.string)||c(t.string)||a){const i=a||c(t.string)&&d(t.string.split(" ").at(2))||t.string;e.currentCategory=i,e.tokensByCategory.has(e.currentCategory)?e.skipTokens=!a:(e.tokensByCategory.set(e.currentCategory,[]),e.skipTokens=!1)}else if(t.string.includes("new Camp Activities"))e.skipTokens=!0;else if(""!==e.currentCategory&&o(t)&&!e.skipTokens){const a=e.tokensByCategory.get(e.currentCategory);a?.push(t)}return e}),{currentCategory:"",skipTokens:!1,tokensByCategory:new Map}).tokensByCategory}(t).mapValues((e=>function(e){return e.reduce(((t,a,i)=>(t.groupedTokens[t.index]||t.groupedTokens.push([]),t.groupedTokens[t.index].push(a),l(a,i,e)&&t.index++,t)),{index:0,groupedTokens:Array()}).groupedTokens}(e))),u=function(e,t){return Array.from(e).reduce(((e,t)=>{const a=t[1].length,i=e.imageTokens.slice(0,a);return{imageTokens:e.imageTokens.slice(a),imageTokensByCategory:e.imageTokensByCategory.set(t[0],i)}}),{imageTokens:t,imageTokensByCategory:new Map}).imageTokensByCategory}(r,a),h=r.map(((e,t)=>{const a=t.map(((t,a)=>s.XT.includes(e)?{strings:t}:{image:u.get(e)[a],strings:t}));return[e,a]}));return[h,i]}const o=e=>!(e.font.includes("Helvetica")||e.font.includes("Antonio-Regular")||e.font.includes("Antonio-Bold")||e.font.includes("BodoniOrnaments"));const l=(e,t,a)=>e.string.endsWith(".")&&!(a[t+1]?.font?.endsWith("PTSans-Narrow")||a[t+1]?.font?.includes("Wingdings-Regular")||a[t+1]?.font?.endsWith("FabulaUltimaicons-Regular")),c=e=>e.startsWith("SAMPLE RARE")&&!e.endsWith("WEAPONS"),d=e=>e?.endsWith("S")?e.slice(0,-1):e;var u=a(2659);var h=a(8824);function p(e){const t=void 0!==e.strings.find((e=>e.font.includes("PTSans-NarrowBold")&&e.string.includes("Shield module")));return t?function(e){const t=e.strings.map((e=>e.string)),a=t[0],i=(0,u.HX)(t[1]),n=m(e.strings.slice(4)),s=n.includes("this module enabled cannot have");return{image:e.image.image,name:a,cost:i,accuracy:{primary:"DEX",secondary:"INS",bonus:0},damage:0,damageType:"physical",moduleType:"shield",category:"arcane",description:n,isComplex:s}}(e):function(e){const t=e.strings.map((e=>e.string)),a=t[0],i=(0,u.HX)(t[1]),[n,s]=t[3].split("+"),r=Number(t[5]),o=isNaN(r)?0:1,l=isNaN(r)?0:r,c={primary:n,secondary:s,bonus:l},d=Number(t[6+o].slice(5)),h=t[8+o],p=t[9+o].toLowerCase(),f=t[11+o].toLowerCase(),g=m(e.strings.slice(13+o)),y=g.includes("this module enabled cannot have");return{image:e.image.image,name:a,cost:i,accuracy:c,damage:d,damageType:h,moduleType:f,category:p,description:g,isComplex:y}}(e)}function m(e){return(0,u.dk)(e.filter((e=>!e.font.includes("Wingdings-Regular")&&!e.font.includes("FabulaUltimaicons-Regular")&&"No qualities."!==e.string)))}function f(e){const[t,a]=r(e);return t.map(((e,t)=>{const i=t.map((t=>{const i=function(e,t,a){switch(e){case"WEAPON":return function(e,t){let a=0;const i=e.strings.map((e=>e.string)),n=i[0],s=(0,u.$l)(e.strings[1]);s&&a++;const r=(0,u.HX)(i[1+a]),[o,l]=i[3+a].split("+"),c=Number(i[5+a]);isNaN(c)||a++;const d=isNaN(c)?0:c,h={primary:(0,u.sM)(o),secondary:(0,u.sM)(l),bonus:d},p=i[6+a],m=Number(p.replace(/^(HR|RA)\s*\+\s*/,""));let f=i[8+a];"l"===f&&(f+=i[8+ ++a]);const g=(0,u.sE)(f);""===t&&a++;const y=""===t?(0,u.hQ)(i[8+a]):(0,u.hQ)(t);""===t&&a++;const v=(0,u.IN)(i[9+a]),b=(0,u.nK)(i[11+a]),A=(0,u.dk)(e.strings.slice(13+a).filter((e=>!(0,u.Vs)(e.string))));return{image:e.image.image,name:n,martial:s,cost:r,accuracy:h,damage:m,damageType:g,hands:v,melee:b,category:y,description:A}}(t,a);case"ARMOR":return function(e){const t=e.strings.map((e=>e.string)),a=t[0],i=(0,u.$l)(e.strings[1]),n=i?1:0,s=(0,u.HX)(t[1+n]),r=(0,h.i)("DEX")(t[2+n]),o=(0,h.i)("INS")(t[3+n]),l=(0,u.$$)(t[4+n]),c=(0,u.dk)(e.strings.slice(5+n).filter((e=>!(0,u.Vs)(e.string))));return{image:e.image.image,name:a,martial:i,cost:s,def:r,mdef:o,init:l,description:c}}(t);case"SHIELD":return function(e){const t=e.strings.map((e=>e.string)),a=t[0],i=(0,u.$l)(e.strings[1]),n=i?1:0,s=(0,u.HX)(t[1+n]),r=(0,u.$$)(t[2+n]),o=(0,u.$$)(t[3+n]),l=(0,u.$$)(t[4+n]),c=(0,u.dk)(e.strings.slice(5+n).filter((e=>!(0,u.Vs)(e.string))));return{image:e.image.image,name:a,martial:i,cost:s,def:r,mdef:o,init:l,description:c}}(t);case"ACCESSORY":return function(e){const t=e.strings.map((e=>e.string)),a=t[0],i=(0,u.HX)(t[1]),n=(0,u.dk)(e.strings.slice(2));return{image:e.image.image,name:a,description:n,cost:i}}(t);case"WEAPON MODULE":return p(t);case"CAMP ACTIVITY":return function(e){const t=e.strings.map((e=>e.string));return{name:t[0],description:`<p>Target: <strong>${t[1]}</strong></p>`+(0,u.dk)(e.strings.slice(2))}}(t);default:throw new Error(`Unknown item category: ${e}`)}}(e,t,a);if(function(e){return Object.entries(e).some((([e,t])=>void 0===t))}(i))throw new Error("Failed to parse one or more items on the page.");return i}));return[e,i]}))}const g="Camp Activities",y=new Map([["FUCR",[272,273,274,275,276,277,278,279,280,281,283,284,285,287,288,289]],["FUCR_PT",[130,131,132,133,134,135,136,137,138,139,140,141,142]],["FUHF",[80,81,82,83]],["FUNF",[86,87,88,89,133,134,135]],["FUTF",[84,85,86,87,88,89]]]),v=new Map([["FUCR","Core Rulebook Equipment"],["FUCR_PT","Equipamento - Livro BÃ¡sico"],["FUHF","High Fantasy Equipment"],["FUNF","Natural Fantasy Equipment"],["FUTF","Techno Fantasy Equipment"]]);function b(e,t){return Promise.all(y.get(t).map((async a=>{const[n,s]=await e(a,(async e=>{try{return Array.from(f(e).mapValues(((e,n)=>{const s=t+(a-2),r=(e=>"CAMP ACTIVITY"===e?g:v.get(t))(n),o=function(e,t,a,n){switch(e){case"WEAPON":return e=>(0,i.$F)(t,n,[a,"Weapons"],e);case"ARMOR":return e=>(0,i.pA)(t,n,[a,"Armors"],e);case"SHIELD":return e=>(0,i.LT)(t,n,[a,"Shields"],e);case"ACCESSORY":return e=>(0,i.q1)(t,n,[a,"Accessories"],e);case"WEAPON MODULE":return e=>(0,i.wW)(t,n,[a,"Weapon Modules"],e);case"CAMP ACTIVITY":return e=>(0,i.Ae)(t,n,[a]);default:throw new Error(`Unknown item category: ${e}`)}}(n,e,r,s);return{type:"success",page:a,save:o}})).values())}catch(e){const t=e instanceof Error?e:Error(`Unexpected error: ${e}`);return[A(t,a)]}}));return n.map((e=>"success"===e.type?{...e,cleanup:s}:(s(),e)))}))).then((e=>e.flat()))}const A=(e,t)=>({type:"failure",page:t,errors:[{found:"",error:e.message,distance:0}]})},1497:(e,t,a)=>{"use strict";a.d(t,{q1:()=>v,pA:()=>y,fL:()=>x,Ae:()=>_,xh:()=>f,LT:()=>b,wW:()=>A,$F:()=>g});const i=async(e,t)=>{let a=null;for(const i of e)a=a?a.getSubfolders().find((e=>e.name===i))||await Folder.create({name:i,type:t,folder:a._id}):game.folders.find((e=>e.name===i&&e.type==t))||await Folder.create({name:i,type:t});return a},n=async(e,t,a)=>{try{const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");if(null!==n&&"bitmap"in e){n.drawImage(e.bitmap,0,0);const s=await new Promise((function(e,t){i.toBlob((function(t){e(t)}))}));if(s)return FilePicker.upload("data",a,new File([s],t),{},{notify:!1})}}catch(e){console.log(e)}return!1};var s=a(5065);function r(e,t,a,i){const n=function(e){let t=!0,a=!0;return(e.equipment||[]).map((e=>{const i=game.items.find((t=>t.name.toLowerCase()===e.toLowerCase()));if(i){const e=duplicate(i),n=e.type;return"weapon"===n?t?(e.system.isEquipped={slot:"mainHand",value:!0},t=!1,"two-handed"==e.system.hands.value&&(a=!1)):a&&"one-handed"==e.system.hands.value&&(e.system.isEquipped={slot:"offHand",value:!0},a=!1):"shield"===n?a&&(e.system.isEquipped={slot:"offHand",value:!0},a=!1):"accessory"!=n&&"armor"!=n||(e.system.isEquipped={slot:n,value:!0}),e}console.log("Not Found",e)})).filter((e=>void 0!==e))}(e),r=function(e,t){return e.attributes.init-t.reduce(((e,t)=>"armor"!=t.type&&"accessory"!=t.type&&"shield"!=t.type||!t.system.isEquipped?0:t.system.init.value),0)-(e.attributes.dex+e.attributes.ins)/2}(e,n),l=2*e.level+5*e.attributes.mig,c=e.level+5*e.attributes.wlp;return[{system:{description:e.description,level:{value:e.level},resources:{hp:{value:e.attributes.maxHp,max:l,min:0,bonus:e.attributes.maxHp-l},mp:{value:e.attributes.maxMp,max:c,min:0,bonus:e.attributes.maxMp-c},ip:{value:6,max:6,min:0},fp:{value:3}},affinities:{physical:{base:s._i[e.resists.physical],current:s._i[e.resists.physical],bonus:0},air:{base:s._i[e.resists.air],current:s._i[e.resists.air],bonus:0},bolt:{base:s._i[e.resists.bolt],current:s._i[e.resists.bolt],bonus:0},dark:{base:s._i[e.resists.dark],current:s._i[e.resists.dark],bonus:0},earth:{base:s._i[e.resists.earth],current:s._i[e.resists.earth],bonus:0},fire:{base:s._i[e.resists.fire],current:s._i[e.resists.fire],bonus:0},ice:{base:s._i[e.resists.ice],current:s._i[e.resists.ice],bonus:0},light:{base:s._i[e.resists.light],current:s._i[e.resists.light],bonus:0},poison:{base:s._i[e.resists.poison],current:s._i[e.resists.poison],bonus:0}},attributes:{dex:{base:e.attributes.dex,current:e.attributes.dex,bonus:0},ins:{base:e.attributes.ins,current:e.attributes.ins,bonus:0},mig:{base:e.attributes.mig,current:e.attributes.mig,bonus:0},wlp:{base:e.attributes.wlp,current:e.attributes.wlp,bonus:0}},derived:{init:{value:e.attributes.init,bonus:r},def:{value:0,bonus:null==e.equipment?e.attributes.def:0},mdef:{value:0,bonus:null==e.equipment?e.attributes.mdef:0},accuracy:{value:0,bonus:0},magic:{value:0,bonus:0}},traits:{value:e.traits},species:{value:e.type.toLowerCase()},useEquipment:{value:null!=e.equipment},source:i,villain:{value:""},isElite:{value:!1},isChampion:{value:1},isCompanion:{value:!1},study:{value:0}},type:"npc",name:e.name,img:t+"/"+e.name+".png",prototypeToken:{texture:{src:t+"/"+e.name+".png"}},folder:a},[...e.attacks.map((e=>({type:"basic",name:e.name,system:{attributes:{primary:{value:s.hP[e.accuracy.primary]},secondary:{value:s.hP[e.accuracy.secondary]}},accuracy:{value:e.accuracy.bonus},damage:{value:e.damage},type:{value:e.range},damageType:{value:e.damageType},description:e.description,isBehavior:!1,weight:{value:1},quality:{value:""}}}))),...e.spells.map((e=>{const{targetingRule:t,maxTargets:a}=function(e){switch(e){case"One creature":default:return{targetingRule:"single",maxTargets:1};case"Up to three creatures":return{targetingRule:"multiple",maxTargets:3};case"Special":return{targetingRule:"special",maxTargets:1};case"Self":return{targetingRule:"self",maxTargets:1}}}(e.target),{amount:i,perTarget:n}=function(e){const t=e.match(o);if(t)return{amount:parseInt(t[1],10),perTarget:!0};const a=parseInt(e,10);if(!isNaN(a))return{amount:a,perTarget:!1};return{amount:0,perTarget:!1}}(e.mp),r=a>1||n;return{type:"spell",name:e.name,system:{cost:{resource:"mp",amount:i,perTarget:r},targeting:{rule:t,max:a},mpCost:{value:e.mp},target:{value:e.target},duration:{value:e.duration},isOffensive:{value:null!==e.accuracy},hasRoll:{value:null!==e.accuracy},rollInfo:null==e.accuracy?void 0:{attributes:{primary:{value:s.hP[e.accuracy.primary]},secondary:{value:s.hP[e.accuracy.secondary]}},accuracy:{value:e.accuracy.bonus}},description:e.description,isBehavior:!1,weight:{value:1},quality:{value:e.opportunity||""}}}})),...e.otherActions.map((e=>({name:e.name,system:{description:e.description,isBehavior:!1,weight:{value:1},hasClock:{value:!1},hasRoll:{value:!1}},type:"miscAbility"}))),...e.specialRules.map((e=>({name:e.name,system:{description:e.description,isBehavior:!1,weight:{value:1},hasClock:{value:!1}},type:"rule"})))],n]}const o=/(\d+)\s*(x|Ã—)\s*T/i;function l(e,t,a,i){return{type:"consumable",name:e.name,img:t+"/"+e.name+".png",folder:a,system:{ipCost:{value:e.ipCost},description:e.description,source:i}}}function c(e,t,a,i){return{type:"weapon",name:e.name,img:t+"/"+e.name+".png",folder:a,system:{isMartial:{value:e.martial},description:"No Quality."===e.description?"":e.description,cost:{value:e.cost},attributes:{primary:{value:s.hP[e.accuracy.primary]},secondary:{value:s.hP[e.accuracy.secondary]}},accuracy:{value:e.accuracy.bonus},damage:{value:e.damage},type:{value:e.melee},category:{value:e.category},hands:{value:e.hands},damageType:{value:e.damageType},source:i,isBehavior:!1,weight:{value:1},isCustomWeapon:{value:!1}}}}var d=a(8824);function u(e,t,a,i){return{type:"accessory",name:e.name,img:t+"/"+e.name+".png",folder:a,system:{isMartial:{value:!1},description:e.description,cost:{value:e.cost},source:i,def:{value:0},mdef:{value:0},init:{value:0},isBehavior:!1,weight:{value:1}}}}function h(e,t,a,i){return{type:"shield",name:e.name,img:t+"/"+e.name+".png",folder:a,system:{isMartial:{value:e.martial},description:"No Quality."===e.description?"":e.description,cost:{value:e.cost},source:i,def:{value:e.def},mdef:{value:e.mdef},init:{value:e.init},isBehavior:!1,weight:{value:1}}}}function p(e,t,a,i){return{type:"classFeature",name:e.name,img:t+"/"+e.name+".png",folder:a,system:{fuid:e.name.toLowerCase().replace(/\s+/g,"-"),summary:{value:""},featureType:"projectfu.weaponModule",source:i,cost:{value:e.cost},data:{type:e.moduleType,quality:"",description:e.description,accuracy:{attr1:s.hP[e.accuracy.primary],attr2:s.hP[e.accuracy.secondary],modifier:e.accuracy.bonus,defense:"def"},damage:{type:e.damageType,bonus:e.damage},category:e.category,shield:"shield"===e.moduleType?{defense:2,magicDefense:2}:void 0,complex:e.isComplex}}}}function m(e,t,a){return{type:"optionalFeature",name:e.name,folder:t,system:{optionalType:"projectfu.campActivity",data:{description:e.description},source:a}}}const f=async(e,t,a,s)=>{for(const[r,o]of e){const e=await i([...a,r],"Item");if(e)for(const a of o){await n(a.image,a.name+".png",s);const i=l(a,s,e._id,t);await Item.create(i)}}},g=async(e,t,a,s)=>{const r=await i(a,"Item");if(r)for(const a of e){const e=await n(a.image,a.name+".png",s);if(e&&0!=Object.keys(e).length){const e=c(a,s,r._id,t);await Item.create(e)}}},y=async(e,t,a,s)=>{const r=await i(a,"Item");if(r)for(const a of e){await n(a.image,a.name+".png",s);const e=(0,d.B)(a,s,r._id,t);await Item.create(e)}},v=async(e,t,a,s)=>{for(const r of e){const e=await i(a,"Item");if(e){await n(r.image,r.name+".png",s);const a=u(r,s,e._id,t);await Item.create(a)}}},b=async(e,t,a,s)=>{const r=await i(a,"Item");if(r)for(const a of e){await n(a.image,a.name+".png",s);const e=h(a,s,r._id,t);await Item.create(e)}},A=async(e,t,a,s)=>{const r=await i(a,"Item");if(r)for(const a of e){const e=await n(a.image,a.name+".png",s);if(e&&0!=Object.keys(e).length){const e=p(a,s,r._id,t);await Item.create(e)}}},_=async(e,t,a)=>{const n=await i(a,"Item");if(n)for(const a of e){const e=m(a,n._id,t);await Item.create(e)}},x=async(e,t,a,s)=>{for(const o of e){const e=await i([...a,o.type],"Actor");if(e){const[a,i,l]=r(o,s,e._id,t);await n(o.image,o.name+".png",s);const c=await Actor.create(a);c.createEmbeddedDocuments("Item",i),c.createEmbeddedDocuments("Item",l)}}}},8519:(e,t,a)=>{"use strict";a.a(e,(async(e,t)=>{try{var i=a(7156),n=a(2986),s=e([n]);n=(s.then?(await s)():s)[0],Hooks.on("renderSettings",(async(e,t)=>{if(!game.user.isGM)return;const[a]=game.version.split(".").map(Number);if(a>=13){const e=document.createElement("template");e.innerHTML='\n\t\t\t<section class="fu-importer flexcol">\n\t\t\t\t<h4 class="divider">FU Importer</h4>\n\t\t\t\t<button type="button" data-action="openPdfImporter">\n\t\t\t\t\t<i class="fa-solid fa-download"></i>\n\t\t\t\t\tImport PDF\n\t\t\t\t</button>\n\t\t\t\t<button type="button" data-action="openFultimatorImporter">\n\t\t\t\t\t<i class="fa-solid fa-cloud-download"></i>\n\t\t\t\t\tImport Fultimator\n\t\t\t\t</button>\n            </section>\n        ',e.content.querySelector("[data-action=openPdfImporter]").addEventListener("click",(()=>{new n.PN({pdfPath:"",imagePath:"",bookType:"FUCR",parseResults:[],inProgress:!1,bookTypes:n.E5},{width:450,height:600,submitOnChange:!0,closeOnSubmit:!1,title:"Fabula Ultima PDF importer",resizable:!0}).render(!0)})),e.content.querySelector("[data-action=openFultimatorImporter]").addEventListener("click",(()=>{new i.yw({text:"",dataType:void 0,inProgress:!1,preferCompendium:!0},{width:450,height:600,submitOnChange:!0,closeOnSubmit:!1,title:"Fultimator import",resizable:!0}).render(!0)})),t.querySelector("#settings > section.documentation.flexcol")?.after(e.content)}else{const e=t[0],a=document.createElement("h2");a.appendChild(new Text("FU Importer"));const s=document.createElement("button");s.type="button",s.append("Import PDF"),s.addEventListener("click",(()=>{new n.PN({pdfPath:"",imagePath:"",bookType:"FUCR",parseResults:[],inProgress:!1,bookTypes:n.E5},{width:450,height:600,submitOnChange:!0,closeOnSubmit:!1,title:"Fabula Ultima PDF importer",resizable:!0}).render(!0)}));const r=document.createElement("button");r.type="button",r.append("Import Fultimator"),r.addEventListener("click",(()=>{new i.yw({text:"",dataType:void 0,inProgress:!1,preferCompendium:!0},{width:450,height:600,submitOnChange:!0,closeOnSubmit:!1,title:"Fultimator import",resizable:!0}).render(!0)}));const o=document.createElement("div");o.appendChild(s),o.appendChild(r),e.querySelector("#settings-documentation")?.after(a,o)}})),t()}catch(e){t(e)}}))},1378:(e,t,a)=>{"use strict";a.a(e,(async(e,i)=>{try{a.d(t,{D:()=>r});var n=a(8541),s=e([n]);n=(s.then?(await s)():s)[0];const r=async e=>{const t=await n.Me(e).promise;return[async(e,a)=>{const i=await t.getPage(e),s=await i.getOperatorList(),r={font:"",tokens:[]};s.fnArray.map(((e,t)=>{const a=s.argsArray[t];switch(e){case n.OW.paintImageXObject:{let e=null;try{e=i.objs.get(a[0])}catch(t){a[0].startsWith("g_")&&(e=i.commonObjs.get(a[0]))}if(e&&e.height>0&&e.width>0){const a=o(t,s.fnArray,s.argsArray);r.tokens.push({kind:"Image",image:e,y:a})}break}case n.OW.setFont:if(a[0].startsWith("g_")){const e=i.commonObjs.get(a[0]);r.font=e.name}break;case n.OW.showText:{if(1!==a.length)throw new Error("Expected text to be an array with a single array element.");const e=a[0].filter((e=>e.unicode)).map((e=>e.unicode)).join("").trim();""!==e&&r.tokens.push({kind:"String",font:r.font,string:e});break}}return null}),[]);return[await a(r.tokens),()=>i.cleanup()]},()=>t.destroy()]};function o(e,t,a){for(let i=e-1;i>=0;i--)if(t[i]===n.OW.transform)return a[i][5];return 0}i()}catch(l){i(l)}}))},6780:(e,t,a)=>{"use strict";a.d(t,{Pw:()=>s,QJ:()=>n,ge:()=>r,iJ:()=>i});const i=e=>"Image"===e.kind,n=e=>"String"===e.kind,s=e=>e,r=e=>e},8824:(e,t,a)=>{"use strict";a.d(t,{B:()=>n,i:()=>i});const i=e=>t=>{const a={DES:"DEX",AST:"INS",VIG:"MIG",VON:"WLP"};let i=t;for(const e in a)i=i.replace(e,a[e]);if(i.startsWith(e+" size")){const t=i.slice((e+" size").length);return""===t?0:Number(t)}if(i.startsWith(e+" die")){const t=i.slice((e+" die").length);return""===t?0:Number(t)}if(i.startsWith(e)){const t=i.slice(e.length).replace("+","").trim();return""===t?0:Number(t)}return"-"===t?0:Number(t)};function n(e,t,a,i){return{type:"armor",name:e.name,img:t+"/"+e.name+".png",folder:a,system:{isMartial:{value:e.martial},description:"No Quality."===e.description?"":e.description,cost:{value:e.cost},source:i,def:{value:e.def},mdef:{value:e.mdef},init:{value:e.init},isBehavior:!1,weight:{value:1}}}}},5065:(e,t,a)=>{"use strict";a.d(t,{DA:()=>r,Eu:()=>l,Rg:()=>o,VH:()=>s,XT:()=>u,_i:()=>p,dd:()=>d,eX:()=>c,h5:()=>n,hP:()=>h});const i=["DEX","MIG","INS","WLP"],n=e=>i.includes(e),s=["physical","air","bolt","dark","earth","fire","ice","light","poison"],r=["arcane","bow","brawling","dagger","firearm","flail","heavy","spear","sword","thrown"],o={physical:"'",air:"a",bolt:"b",dark:"a",earth:"E",fire:"f",ice:"i",light:"l",poison:"b"},l=["VU","N","RS","IM","AB"],c=[6,8,10,12],d=["WEAPON","ARMOR","SHIELD","ACCESSORY","WEAPON MODULE","CAMP ACTIVITY"],u=["CAMP ACTIVITY"],h={DEX:"dex",MIG:"mig",INS:"ins",WLP:"wlp"},p={VU:-1,N:0,RS:1,IM:2,AB:3}},2659:(e,t,a)=>{"use strict";a.d(t,{$$:()=>d,$l:()=>i,Fb:()=>h,HX:()=>u,IN:()=>o,Vs:()=>n,dk:()=>p,hQ:()=>c,nK:()=>l,sE:()=>r,sM:()=>s});const i=e=>e.font.includes("BasicShapes1")&&"E"===e.string||e.font.includes("Type3")&&"W"===e.string,n=e=>{const t=e.trim().toLowerCase();return"no quality."===t||"sem caracterÃ­sticas especiais."===t||"sem caracteristicas especiais."===t},s=e=>({DEX:"DEX",DES:"DEX",MIG:"MIG",VIG:"MIG",INS:"INS",AST:"INS",WLP:"WLP",VON:"WLP"}[e.trim().toUpperCase()]||e.trim()),r=e=>({physical:"physical",fÃ­sico:"physical",air:"air",ar:"air",bolt:"bolt",raio:"bolt",dark:"dark",trevas:"dark",earth:"earth",terra:"earth",fire:"fire",fogo:"fire",ice:"ice",gelo:"ice",light:"light",luz:"light",poison:"poison",veneno:"poison"}[e.trim().toLowerCase()]||e.trim().toLowerCase()),o=e=>{const t=e.trim().toLowerCase();return"one-handed"===t||"uma mÃ£o"===t?"one-handed":"two-handed"===t||"duas mÃ£os"===t?"two-handed":t},l=e=>{const t=e.trim().toLowerCase();return"melee"===t||"corpo a corpo"===t||"c a c"===t?"melee":"ranged"===t||"Ã  distÃ¢ncia"===t||"a distÃ¢ncia"===t?"ranged":t},c=e=>({arcane:"arcane",arcana:"arcane",bow:"bow",arco:"bow",brawling:"brawling",luta:"brawling",dagger:"dagger",adaga:"dagger",firearm:"firearm","arma de fogo":"firearm",flail:"flail",malho:"flail",heavy:"heavy",pesada:"heavy",spear:"spear",lanÃ§a:"spear",sword:"sword",espada:"sword",thrown:"thrown",arremessÃ¡vel:"thrown","ar-remessÃ¡vel":"thrown"}[e.trim().toLowerCase()]||e.trim().toLowerCase()),d=e=>"-"===e?0:Number(e),u=e=>e.endsWith(" z")?Number(e.slice(0,-2)):"-"===e?0:Number(e),h=e=>e.reduce(((e,t)=>{const a=t.trim();return/^[.?!),]/.test(a)?e+a:e+" "+a}),"").trim();function p(e){const t=["ÂŠ","â€¢"],a=Array(e.length).fill(-1);let i=-1;for(let n=e.length-1;n>=0;n--)a[n]=i,t.includes(e[n].string)&&(i=n);let n="",s=!1,r=!1;const o=()=>{s=!1,n+="</p>"},l=()=>{r=!1,n+="</li></ul>"},c=e=>!!e&&(e.font.includes("Heydings-Icons")&&"r"===e.string||e.font.includes("Type3")&&"O"===e.string);for(let i=0;i<e.length;i++){const d=e[i];if(t.includes(d.string)){r?n+="</li><li>":(s&&o(),r=!0,n+="<ul><li>");continue}if(c(d)){c(e.at(i+1))||(n+=" @ICON[offensive] ");continue}s||r||(s=!0,n+="<p>");let u=d.string.trim();const h=e.at(i-1)?.string;/^[.?!),]/.test(u)||0===i||h?.endsWith("(")||(u=" "+u),d.font.includes("PTSans-NarrowBold")&&(u=`<strong>${u}</strong>`),n+=u;u.endsWith(".")&&r&&-1===a[i]&&l()}return r&&l(),s&&o(),n}},4499:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3987:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5260:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},306:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9387:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3784:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1151:function(e,t){"use strict";var a,i=this&&this.__extends||(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.TypeGuardError=void 0;var n=function(e){function t(t){var a=this.constructor,i=e.call(this,t.message||"Error on ".concat(t.method,"(): invalid type").concat(t.path?" on ".concat(t.path):"",", expect to be ").concat(t.expected))||this,n=a.prototype;return Object.setPrototypeOf?Object.setPrototypeOf(i,n):i.__proto__=n,i.method=t.method,i.path=t.path,i.expected=t.expected,i.value=t.value,i}return i(t,e),t}(Error);t.TypeGuardError=n},6509:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.$HeadersReader=void 0,function(e){e.boolean=function(e){return void 0!==e?"true"===e||"false"!==e&&e:void 0},e.bigint=function(e){return void 0!==e?n(e):void 0},e.number=function(e){return void 0!==e?i(e):void 0},e.string=function(e){return e}}(a||(t.$HeadersReader=a={}));var i=function(e){var t=Number(e);return isNaN(t)?e:t},n=function(e){try{return BigInt(e)}catch(t){return e}}},3436:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.$ParameterReader=void 0,function(e){e.boolean=function(e){return"null"!==e?"true"===e||"1"===e||"false"!==e&&"0"!==e&&e:null},e.bigint=function(e){return"null"!==e?n(e):null},e.number=function(e){return"null"!==e?i(e):null},e.string=function(e){return"null"!==e?e:null}}(a||(t.$ParameterReader=a={}));var i=function(e){var t=Number(e);return isNaN(t)?e:t},n=function(e){try{return BigInt(e)}catch(t){return e}}},45:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$ProtobufReader=void 0;var a=function(){function e(e){this.buf=e,this.ptr=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}return e.prototype.index=function(){return this.ptr},e.prototype.size=function(){return this.buf.length},e.prototype.uint32=function(){return this.varint32()},e.prototype.int32=function(){return this.varint32()},e.prototype.sint32=function(){var e=this.varint32();return e>>>1^-(1&e)},e.prototype.uint64=function(){return this.varint64()},e.prototype.int64=function(){return this.varint64()},e.prototype.sint64=function(){var e=this.varint64();return e>>n^-(e&n)},e.prototype.bool=function(){return 0!==this.varint32()},e.prototype.float=function(){var e=this.view.getFloat32(this.ptr,!0);return this.ptr+=4,e},e.prototype.double=function(){var e=this.view.getFloat64(this.ptr,!0);return this.ptr+=8,e},e.prototype.bytes=function(){var e=this.uint32(),t=this.ptr;return this.ptr+=e,this.buf.subarray(t,t+e)},e.prototype.string=function(){return i.decode(this.bytes())},e.prototype.skip=function(e){if(0===e)for(;128&this.u8(););else{if(this.index()+e>this.size())throw new Error("Error on typia.protobuf.decode(): buffer overflow.");this.ptr+=e}},e.prototype.skipType=function(e){switch(e){case 0:this.skip(0);break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw new Error("Invalid wire type ".concat(e," at offset ").concat(this.ptr,"."))}},e.prototype.varint32=function(){var e,t;return t=127&(e=this.u8()),e<128?t:(t|=(127&(e=this.u8()))<<7,e<128?t:(t|=(127&(e=this.u8()))<<14,e<128?t:(t|=(127&(e=this.u8()))<<21,e<128||(t|=(15&(e=this.u8()))<<28,e<128||this.u8()<128||this.u8()<128||this.u8()<128||this.u8()<128||this.u8()),t)))},e.prototype.varint64=function(){var e,t;return t=(e=this.u8n())&s,e<r?t:(t|=((e=this.u8n())&s)<<BigInt(7),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(14),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(21),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(28),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(35),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(42),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(49),e<r?t:(t|=((e=this.u8n())&s)<<BigInt(56),e<r?t:(t|=(this.u8n()&n)<<BigInt(63),BigInt.asIntN(64,t))))))))))},e.prototype.u8=function(){return this.view.getUint8(this.ptr++)},e.prototype.u8n=function(){return BigInt(this.u8())},e}();t.$ProtobufReader=a;var i=new TextDecoder,n=BigInt(1),s=BigInt(127),r=BigInt(128)},5842:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$ProtobufSizer=void 0;var i=a(9894),n=function(){function e(e){void 0===e&&(e=0),this.len=e,this.pos=[],this.varlen=[],this.varlenidx=[]}return e.prototype.bool=function(){this.len+=1},e.prototype.int32=function(e){e<0?this.len+=10:this.varint32(e)},e.prototype.sint32=function(e){this.varint32(e<<1^e>>31)},e.prototype.uint32=function(e){this.varint32(e)},e.prototype.int64=function(e){this.varint64("number"==typeof e?BigInt(e):e)},e.prototype.sint64=function(e){"number"==typeof e&&(e=BigInt(e)),this.varint64(e<<BigInt(1)^e>>BigInt(63))},e.prototype.uint64=function(e){this.varint64("number"==typeof e?BigInt(e):e)},e.prototype.float=function(e){this.len+=4},e.prototype.double=function(e){this.len+=8},e.prototype.bytes=function(e){this.uint32(e.byteLength),this.len+=e.byteLength},e.prototype.string=function(e){var t=(0,i.$strlen)(e);this.varlen.push(t),this.uint32(t),this.len+=t},e.prototype.fork=function(){this.pos.push(this.len),this.varlenidx.push(this.varlen.length),this.varlen.push(0)},e.prototype.ldelim=function(){if(!this.pos.length||!this.varlenidx.length)throw new Error("Error on typia.protobuf.encode(): missing fork() before ldelim() call.");var e=this.len,t=this.pos.pop(),a=this.varlenidx.pop(),i=e-t;this.varlen[a]=i,this.uint32(i)},e.prototype.reset=function(){this.len=0,this.pos.length=0,this.varlen.length=0,this.varlenidx.length=0},e.prototype.varint32=function(e){this.len+=e<0?10:e<128?1:e<16384?2:e<2097152?3:e<268435456?4:5},e.prototype.varint64=function(e){for(e=BigInt.asUintN(64,e);e>r;)++this.len,e>>=s;++this.len},e}();t.$ProtobufSizer=n;var s=BigInt(7),r=BigInt(127)},7552:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$ProtobufWriter=void 0;var a=function(){function e(e){this.sizer=e,this.buf=new Uint8Array(e.len),this.view=new DataView(this.buf.buffer),this.ptr=0,this.varlenidx=0}return e.prototype.buffer=function(){return this.buf},e.prototype.bool=function(e){this.byte(e?1:0)},e.prototype.byte=function(e){this.buf[this.ptr++]=255&e},e.prototype.int32=function(e){e<0?this.int64(e):this.variant32(e>>>0)},e.prototype.sint32=function(e){this.variant32(e<<1^e>>31)},e.prototype.uint32=function(e){this.variant32(e)},e.prototype.sint64=function(e){e=BigInt(e),this.variant64(e<<n^e>>r)},e.prototype.int64=function(e){this.variant64(BigInt(e))},e.prototype.uint64=function(e){this.variant64(BigInt(e))},e.prototype.float=function(e){this.view.setFloat32(this.ptr,e,!0),this.ptr+=4},e.prototype.double=function(e){this.view.setFloat64(this.ptr,e,!0),this.ptr+=8},e.prototype.bytes=function(e){this.uint32(e.byteLength);for(var t=0;t<e.byteLength;t++)this.buf[this.ptr++]=e[t]},e.prototype.string=function(e){var t=this.varlen();this.uint32(t);for(var a=i.encode(e),n=0;n<a.byteLength;n++)this.buf[this.ptr++]=a[n]},e.prototype.fork=function(){this.uint32(this.varlen())},e.prototype.ldelim=function(){},e.prototype.finish=function(){return this.buf},e.prototype.reset=function(){this.buf=new Uint8Array(this.sizer.len),this.view=new DataView(this.buf.buffer),this.ptr=0,this.varlenidx=0},e.prototype.variant32=function(e){for(;e>127;)this.buf[this.ptr++]=127&e|128,e>>>=7;this.buf[this.ptr++]=e},e.prototype.variant64=function(e){for(e=BigInt.asUintN(64,e);e>o;)this.buf[this.ptr++]=Number(e&o|l),e>>=s;this.buf[this.ptr++]=Number(e)},e.prototype.varlen=function(){return this.varlenidx>=this.sizer.varlen.length?0:this.sizer.varlen[this.varlenidx++]},e}();t.$ProtobufWriter=a;var i=new TextEncoder,n=BigInt(1),s=BigInt(7),r=BigInt(63),o=BigInt(127),l=BigInt(128)},2260:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.$QueryReader=void 0,function(e){e.boolean=function(e){return null===e?void 0:"null"===e?null:0===e.length||("true"===e||"1"===e||"false"!==e&&"0"!==e&&e)},e.number=function(e){return(null==e?void 0:e.length)?"null"===e?null:i(e):void 0},e.bigint=function(e){return(null==e?void 0:e.length)?"null"===e?null:n(e):void 0},e.string=function(e){return null===e?void 0:"null"===e?null:e},e.params=function(e){if("string"==typeof e){var t=e.indexOf("?");return e=-1===t?"":e.substring(t+1),new URLSearchParams(e)}return e},e.array=function(e,t){return e.length?e:t}}(a||(t.$QueryReader=a={}));var i=function(e){var t=Number(e);return isNaN(t)?e:t},n=function(e){try{return BigInt(e)}catch(t){return e}}},4011:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$any=void 0;var i=a(1560);t.$any=function(e){return void 0!==e?(0,i.$clone)(e):void 0}},1560:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$clone=void 0;t.$clone=function(e){return JSON.parse(JSON.stringify(e))}},6147:function(e,t){"use strict";var a=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.$convention=void 0;t.$convention=function(e){var t=function(e){return"object"==typeof e?null===e?null:Array.isArray(e)?e.map(t):e instanceof Boolean||e instanceof BigInt||e instanceof Number||e instanceof String?e.valueOf():e instanceof Date?new Date(e):e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof BigUint64Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof BigInt64Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof DataView?e:i(e):e},i=function(i){return Object.fromEntries(Object.entries(i).map((function(i){var n=a(i,2),s=n[0],r=n[1];return[e(s),t(r)]})))};return t}},9201:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$every=void 0;t.$every=function(e,t){for(var a=null,i=0;i<e.length;++i)if(null!==(a=t(e[i],i)))return a;return null}},3949:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$from=void 0;var i=a(5821);t.$from=function(e){return i.MetadataApplication.from(e)}},421:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$guard=void 0;var i=a(1151);t.$guard=function(e){return function(t,a){if(!0===t)throw new i.TypeGuardError({method:e,path:a.path,expected:a.expected,value:a.value});return!1}}},9379:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$is_between=void 0;t.$is_between=function(e,t,a){return t<=e&&e<=a}},5833:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$join=void 0;t.$join=function(e){return a(e)?".".concat(e):"[".concat(JSON.stringify(e),"]")};var a=function(e){return!1===i(e)&&/^[a-zA-Z_$][a-zA-Z_$0-9]*$/g.test(e)},i=function(e){return n.has(e)},n=new Set(["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"])},302:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$number=void 0;var i=a(1151);t.$number=function(e){if(!1===isFinite(e))throw new i.TypeGuardError({method:"typia.json.stringify",expected:"number",value:e,message:"Error on typia.json.stringify(): infinite or not a number."});return e}},3960:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$report=void 0;t.$report=function(e){return function(t,a){return t&&function(t){if(0===e.length)return!0;var a=e[e.length-1].path;return t.length>a.length||a.substring(0,t.length)!==t}(a.path)&&e.push(a),!1}}},4660:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$rest=void 0;t.$rest=function(e){return 2===e.length?"":","+e.substring(1,e.length-1)}},5844:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$is_bigint_string=void 0;t.$is_bigint_string=function(e){try{return BigInt(e),!0}catch(e){return!1}}},2100:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$string=void 0;t.$string=function(e){if(!1===a.test(e))return'"'.concat(e,'"');var t=e.length;if(t>41)return JSON.stringify(e);for(var i="",n=-1,s=255,r=0;r<t;++r){if((s=e.charCodeAt(r))<32)return JSON.stringify(e);if(s>=55296&&s<=57343)return JSON.stringify(e);34!==s&&92!==s||(-1===n&&(n=0),i+=e.slice(n,r)+"\\",n=r)}return-1===n&&'"'+e+'"'||'"'+i+e.slice(n)+'"'};var a=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/},9894:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$strlen=void 0;t.$strlen=function(e){var t,a,i;for(t=a=0;i=e.charCodeAt(a++);t+=i>>11?3:i>>7?2:1);return t}},4881:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$tail=void 0;t.$tail=function(e){return","===e[e.length-1]?e.substring(0,e.length-1):e}},8003:function(e,t,a){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Namespace=void 0;var n,s=a(473),r=a(6036),o=a(1151),l=a(6509),c=a(3436),d=a(45),u=a(5842),h=a(7552),p=a(2260),m=a(4011),f=a(6147),g=a(9201),y=a(3949),v=a(421),b=a(9379),A=a(5833),_=a(302),x=a(3960),w=a(4660),C=a(5844),E=a(2100),S=a(9894),M=a(4881);!function(e){e.is=function(){return{is_between:b.$is_between,is_bigint_string:C.$is_bigint_string}},e.assert=function(t){return i(i({},e.is()),{join:A.$join,every:g.$every,guard:(0,v.$guard)("typia.".concat(t)),predicate:function(e,a,n){if(!1===e&&!0===a)throw new o.TypeGuardError(i(i({},n()),{method:"typia.".concat(t)}));return e}})},e.validate=function(){return i(i({},e.is()),{join:A.$join,report:x.$report,predicate:function(e){return function(t,a,i){return!1===t&&!0===a&&function(){e.success&&(e.success=!1);var t=e.errors,a=i();if(t.length){var n=t[t.length-1].path;if(n.length>=a.path.length&&n.substring(0,a.path.length)===a.path)return}t.push(a)}(),t}}})},function(a){a.stringify=function(a){return i(i({},e.is()),{number:_.$number,string:E.$string,tail:M.$tail,rest:w.$rest,throws:t("json.".concat(a))})}}(e.json||(e.json={})),function(a){a.decode=function(a){return i(i({},e.is()),{Reader:d.$ProtobufReader,throws:t("protobuf.".concat(a))})},a.encode=function(a){return i(i({},e.is()),{Sizer:u.$ProtobufSizer,Writer:h.$ProtobufWriter,strlen:S.$strlen,throws:t(a)})}}(e.protobuf||(e.protobuf={})),function(e){e.metadata=function(){return{from:y.$from}}}(e.reflect||(e.reflect={})),function(e){e.query=function(){return p.$QueryReader},e.headers=function(){return l.$HeadersReader},e.parameter=function(){return c.$ParameterReader}}(e.http||(e.http={})),function(a){a.clone=function(a){return i(i({},e.is()),{throws:t("misc.".concat(a)),any:m.$any})},a.prune=function(a){return i(i({},e.is()),{throws:t("misc.".concat(a))})}}(e.misc||(e.misc={})),function(a){a.camel=function(e){return i(i({},n(e)),{any:(0,f.$convention)(s.NamingConvention.camel)})},a.pascal=function(e){return i(i({},n(e)),{any:(0,f.$convention)(s.NamingConvention.pascal)})},a.snake=function(e){return i(i({},n(e)),{any:(0,f.$convention)(s.NamingConvention.snake)})};var n=function(a){return i(i({},e.is()),{throws:t("notations.".concat(a))})}}(e.notations||(e.notations={})),e.random=function(){return{generator:r.RandomGenerator,pick:r.RandomGenerator.pick}};var t=function(e){return function(t){throw new o.TypeGuardError(i(i({},t),{method:"typia.".concat(e)}))}}}(n||(t.Namespace=n={}))},900:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createParameter=t.createValidateHeaders=t.createIsHeaders=t.createAssertHeaders=t.createHeaders=t.createValidateQuery=t.createIsQuery=t.createAssertQuery=t.createQuery=t.parameter=t.validateHeaders=t.isHeaders=t.assertHeaders=t.headers=t.validateQuery=t.isQuery=t.assertQuery=t.query=void 0;var i=a(8003);function n(){x("query")}function s(){x("assertQuery")}function r(){x("isQuery")}function o(){x("validateQuery")}function l(){x("headers")}function c(){x("assertHeaders")}function d(){x("isHeaders")}function u(){x("validateHeaders")}function h(){x("parameter")}function p(){x("createQuery")}function m(){x("createAssertQuery")}function f(){x("createIsQuery")}function g(){x("createValidateQuery")}function y(){x("createHeaders")}function v(){x("createAssertHeaders")}function b(){x("createIsHeaders")}function A(){x("createValidateHeaders")}function _(){x("createParameter")}function x(e){throw new Error("Error on typia.http.".concat(e,"(): no transform has been configured. Read and follow https://typia.io/docs/setup please."))}t.query=n,Object.assign(n,i.Namespace.http.query()),t.assertQuery=s,Object.assign(s,i.Namespace.http.query()),Object.assign(s,i.Namespace.assert("http.assertQuery")),t.isQuery=r,Object.assign(r,i.Namespace.http.query()),Object.assign(r,i.Namespace.is()),t.validateQuery=o,Object.assign(o,i.Namespace.http.query()),Object.assign(o,i.Namespace.validate()),t.headers=l,Object.assign(l,i.Namespace.http.headers()),t.assertHeaders=c,Object.assign(c,i.Namespace.http.headers()),Object.assign(c,i.Namespace.assert("http.assertHeaders")),t.isHeaders=d,Object.assign(d,i.Namespace.http.headers()),Object.assign(d,i.Namespace.is()),t.validateHeaders=u,Object.assign(u,i.Namespace.http.headers()),Object.assign(u,i.Namespace.validate()),t.parameter=h,Object.assign(h,i.Namespace.http.parameter()),Object.assign(h,i.Namespace.assert("http.parameter")),t.createQuery=p,Object.assign(p,i.Namespace.http.query()),t.createAssertQuery=m,Object.assign(m,i.Namespace.http.query()),Object.assign(m,i.Namespace.assert("http.createAssertQuery")),t.createIsQuery=f,Object.assign(f,i.Namespace.http.query()),Object.assign(f,i.Namespace.is()),t.createValidateQuery=g,Object.assign(g,i.Namespace.http.query()),Object.assign(g,i.Namespace.validate()),t.createHeaders=y,Object.assign(y,i.Namespace.http.headers()),t.createAssertHeaders=v,Object.assign(v,i.Namespace.http.headers()),Object.assign(v,i.Namespace.assert("http.createAssertHeaders")),t.createIsHeaders=b,Object.assign(b,i.Namespace.http.headers()),Object.assign(b,i.Namespace.is()),t.createValidateHeaders=A,Object.assign(A,i.Namespace.http.headers()),Object.assign(A,i.Namespace.validate()),t.createParameter=_,Object.assign(_,i.Namespace.http.parameter()),Object.assign(_,i.Namespace.assert("http.createParameter"))},4892:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0});var o=s(a(1816));t.default=o,r(a(1816),t)},3980:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createValidateStringify=t.createIsStringify=t.createAssertStringify=t.createStringify=t.createValidateParse=t.createAssertParse=t.createIsParse=t.validateStringify=t.isStringify=t.assertStringify=t.stringify=t.validateParse=t.isParse=t.assertParse=t.application=void 0;var i=a(8003);function n(){v("assertParse")}function s(){v("isParse")}function r(){v("validateParse")}function o(){v("stringify")}function l(){v("assertStringify")}function c(){v("isStringify")}function d(){v("validateStringify")}function u(){v("createIsParse")}function h(){v("createAssertParse")}function p(){v("createValidateParse")}function m(){v("createStringify")}function f(){v("createAssertStringify")}function g(){v("createIsStringify")}function y(){v("createValidateStringify")}function v(e){throw new Error("Error on typia.json.".concat(e,"(): no transform has been configured. Read and follow https://typia.json.io/docs/setup please."))}t.application=function(){v("application")},t.assertParse=n,Object.assign(n,i.Namespace.assert("json.assertParse")),t.isParse=s,Object.assign(s,i.Namespace.is()),t.validateParse=r,Object.assign(r,i.Namespace.validate()),t.stringify=o,Object.assign(o,i.Namespace.json.stringify("stringify")),t.assertStringify=l,Object.assign(l,i.Namespace.assert("json.assertStringify")),Object.assign(l,i.Namespace.json.stringify("assertStringify")),t.isStringify=c,Object.assign(c,i.Namespace.is()),Object.assign(c,i.Namespace.json.stringify("isStringify")),t.validateStringify=d,Object.assign(d,i.Namespace.validate()),Object.assign(d,i.Namespace.json.stringify("validateStringify")),t.createIsParse=u,Object.assign(u,s),t.createAssertParse=h,Object.assign(h,n),t.createValidateParse=p,Object.assign(p,r),t.createStringify=m,Object.assign(m,o),t.createAssertStringify=f,Object.assign(f,l),t.createIsStringify=g,Object.assign(g,c),t.createValidateStringify=y,Object.assign(y,d)},1686:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createValidatePrune=t.createIsPrune=t.createAssertPrune=t.createPrune=t.createValidateClone=t.createIsClone=t.createAssertClone=t.createClone=t.validatePrune=t.isPrune=t.assertPrune=t.prune=t.validateClone=t.isClone=t.assertClone=t.clone=t.literals=void 0;var i=a(8003);function n(){A("clone")}function s(){A("assertClone")}function r(){A("isClone")}function o(){A("validateClone")}function l(){A("prune")}function c(){A("assertPrune")}function d(){A("isPrune")}function u(){A("validatePrune")}function h(){A("createClone")}function p(){A("createAssertClone")}function m(){A("createIsClone")}function f(){A("createValidateClone")}function g(){A("createPrune")}function y(){A("createAssertPrune")}function v(){A("createIsPrune")}function b(){A("createValidatePrune")}function A(e){throw new Error("Error on typia.misc.".concat(e,"(): no transform has been configured. Read and follow https://typia.io/docs/setup please."))}t.literals=function(){A("literals")},t.clone=n,Object.assign(n,i.Namespace.misc.clone("clone")),t.assertClone=s,Object.assign(s,i.Namespace.assert("misc.assertClone")),Object.assign(s,i.Namespace.misc.clone("assertClone")),t.isClone=r,Object.assign(r,i.Namespace.is()),Object.assign(r,i.Namespace.misc.clone("isClone")),t.validateClone=o,Object.assign(o,i.Namespace.validate()),Object.assign(o,i.Namespace.misc.clone("validateClone")),t.prune=l,Object.assign(l,i.Namespace.misc.prune("prune")),t.assertPrune=c,Object.assign(c,i.Namespace.assert("misc.assertPrune")),Object.assign(c,i.Namespace.misc.prune("assertPrune")),t.isPrune=d,Object.assign(d,i.Namespace.is()),Object.assign(d,i.Namespace.misc.prune("isPrune")),t.validatePrune=u,Object.assign(u,i.Namespace.misc.prune("validatePrune")),Object.assign(u,i.Namespace.validate()),t.createClone=h,Object.assign(h,n),t.createAssertClone=p,Object.assign(p,s),t.createIsClone=m,Object.assign(m,r),t.createValidateClone=f,Object.assign(f,o),t.createPrune=g,Object.assign(g,l),t.createAssertPrune=y,Object.assign(y,c),t.createIsPrune=v,Object.assign(v,d),t.createValidatePrune=b,Object.assign(b,u)},1816:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.createRandom=t.createValidateEquals=t.createEquals=t.createAssertGuardEquals=t.createAssertEquals=t.createValidate=t.createIs=t.createAssertGuard=t.createAssert=t.random=t.validateEquals=t.equals=t.assertGuardEquals=t.assertEquals=t.validate=t.is=t.assertGuard=t.assert=t.tags=t.reflect=t.protobuf=t.notations=t.misc=t.json=t.http=void 0;var o=a(8003);function l(){S("assert")}function c(){S("assertGuard")}function d(){S("is")}function u(){S("validate")}function h(){S("assertEquals")}function p(){S("assertGuardEquals")}function m(){S("equals")}function f(){S("validateEquals")}function g(){S("random")}function y(){S("createAssert")}function v(){S("createAssertGuard")}function b(){S("createIs")}function A(){S("createValidate")}function _(){S("createAssertEquals")}function x(){S("createAssertGuardEquals")}function w(){S("createEquals")}function C(){S("createValidateEquals")}function E(){S("createRandom")}function S(e){throw new Error("Error on typia.".concat(e,"(): no transform has been configured. Read and follow https://typia.io/docs/setup please."))}t.http=s(a(900)),t.json=s(a(3980)),t.misc=s(a(1686)),t.notations=s(a(1507)),t.protobuf=s(a(808)),t.reflect=s(a(6243)),t.tags=s(a(8719)),r(a(114),t),r(a(6982),t),r(a(7611),t),r(a(8321),t),r(a(4499),t),r(a(5260),t),r(a(306),t),r(a(1151),t),r(a(7205),t),r(a(3784),t),r(a(3987),t),r(a(9387),t),r(a(8653),t),t.assert=l,Object.assign(l,o.Namespace.assert("assert")),t.assertGuard=c,Object.assign(c,o.Namespace.assert("assertGuard")),t.is=d,Object.assign(d,o.Namespace.assert("is")),t.validate=u,Object.assign(u,o.Namespace.validate()),t.assertEquals=h,Object.assign(h,o.Namespace.assert("assertEquals")),t.assertGuardEquals=p,Object.assign(p,o.Namespace.assert("assertGuardEquals")),t.equals=m,Object.assign(m,o.Namespace.is()),t.validateEquals=f,Object.assign(f,o.Namespace.validate()),t.random=g,Object.assign(g,o.Namespace.random()),t.createAssert=y,Object.assign(y,l),t.createAssertGuard=v,Object.assign(v,c),t.createIs=b,Object.assign(b,d),t.createValidate=A,Object.assign(A,u),t.createAssertEquals=_,Object.assign(_,h),t.createAssertGuardEquals=x,Object.assign(x,p),t.createEquals=w,Object.assign(w,m),t.createValidateEquals=C,Object.assign(C,f),t.createRandom=E,Object.assign(E,g)},1507:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createValidateSnake=t.createIsSnake=t.createAssertSnake=t.createSnake=t.createValidatePascal=t.createIsPascal=t.createAssertPascal=t.createPascal=t.createValidateCamel=t.createIsCamel=t.createAssertCamel=t.createCamel=t.validateSnake=t.isSnake=t.assertSnake=t.snake=t.validatePascal=t.isPascal=t.assertPascal=t.pascal=t.validateCamel=t.isCamel=t.assertCamel=t.camel=void 0;var i=a(8003);function n(){return T("camel")}function s(){return T("assertCamel")}function r(){return T("isCamel")}function o(){return T("validateCamel")}function l(){return T("pascal")}function c(){return T("assertPascal")}function d(){return T("isPascal")}function u(){return T("validatePascal")}function h(){return T("snake")}function p(){return T("assertSnake")}function m(){return T("isSnake")}function f(){return T("validateSnake")}function g(){T("createCamel")}function y(){T("createAssertCamel")}function v(){T("createIsCamel")}function b(){T("createValidateCamel")}function A(){T("createPascal")}function _(){T("createAssertPascal")}function x(){T("createIsPascal")}function w(){T("createValidatePascal")}function C(){T("createSnake")}function E(){T("createAssertSnake")}function S(){T("createIsSnake")}function M(){T("createValidateSnake")}function T(e){throw new Error("Error on typia.notations.".concat(e,"(): no transform has been configured. Read and follow https://typia.io/docs/setup please."))}t.camel=n,Object.assign(n,i.Namespace.notations.camel("camel")),t.assertCamel=s,Object.assign(s,i.Namespace.notations.camel("assertCamel")),Object.assign(s,i.Namespace.assert("notations.assertCamel")),t.isCamel=r,Object.assign(r,i.Namespace.notations.camel("isCamel")),Object.assign(r,i.Namespace.is()),t.validateCamel=o,Object.assign(o,i.Namespace.notations.camel("validateCamel")),Object.assign(o,i.Namespace.validate()),t.pascal=l,Object.assign(l,i.Namespace.notations.pascal("pascal")),t.assertPascal=c,Object.assign(c,i.Namespace.notations.pascal("assertPascal")),Object.assign(c,i.Namespace.assert("notations.assertPascal")),t.isPascal=d,Object.assign(d,i.Namespace.notations.pascal("isPascal")),Object.assign(d,i.Namespace.is()),t.validatePascal=u,Object.assign(u,i.Namespace.notations.pascal("validatePascal")),Object.assign(u,i.Namespace.validate()),t.snake=h,Object.assign(h,i.Namespace.notations.snake("snake")),t.assertSnake=p,Object.assign(p,i.Namespace.notations.snake("assertSnake")),Object.assign(p,i.Namespace.assert("notations.assertSnake")),t.isSnake=m,Object.assign(m,i.Namespace.notations.snake("isSnake")),Object.assign(m,i.Namespace.is()),t.validateSnake=f,Object.assign(f,i.Namespace.notations.snake("validateSnake")),Object.assign(f,i.Namespace.validate()),t.createCamel=g,Object.assign(g,i.Namespace.notations.camel("createCamel")),t.createAssertCamel=y,Object.assign(y,i.Namespace.notations.camel("createAssertCamel")),Object.assign(y,i.Namespace.assert("notations.createAssertCamel")),t.createIsCamel=v,Object.assign(v,i.Namespace.notations.camel("createIsCamel")),Object.assign(v,i.Namespace.is()),t.createValidateCamel=b,Object.assign(b,i.Namespace.notations.camel("createValidateCamel")),Object.assign(b,i.Namespace.validate()),t.createPascal=A,Object.assign(A,i.Namespace.notations.pascal("createPascal")),t.createAssertPascal=_,Object.assign(_,i.Namespace.notations.pascal("createAssertPascal")),Object.assign(_,i.Namespace.assert("notations.createAssertPascal")),t.createIsPascal=x,Object.assign(x,i.Namespace.notations.pascal("createIsPascal")),Object.assign(x,i.Namespace.is()),t.createValidatePascal=w,Object.assign(w,i.Namespace.notations.pascal("createValidatePascal")),Object.assign(w,i.Namespace.validate()),t.createSnake=C,Object.assign(C,i.Namespace.notations.snake("createSnake")),t.createAssertSnake=E,Object.assign(E,i.Namespace.notations.snake("createAssertSnake")),Object.assign(E,i.Namespace.assert("notations.createAssertSnake")),t.createIsSnake=S,Object.assign(S,i.Namespace.notations.snake("createIsSnake")),Object.assign(S,i.Namespace.is()),t.createValidateSnake=M,Object.assign(M,i.Namespace.notations.snake("createValidateSnake")),Object.assign(M,i.Namespace.validate())},808:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createValidateEncode=t.createAssertEncode=t.createIsEncode=t.createEncode=t.createValidateDecode=t.createAssertDecode=t.createIsDecode=t.createDecode=t.validateEncode=t.isEncode=t.assertEncode=t.encode=t.validateDecode=t.isDecode=t.assertDecode=t.decode=t.message=void 0;var i=a(8003);function n(){A("decode")}function s(){A("assertDecode")}function r(){A("isDecode")}function o(){A("validateDecode")}function l(){A("encode")}function c(){A("assertEncode")}function d(){A("isEncode")}function u(){A("validateEncode")}function h(){A("createDecode")}function p(){A("createIsDecode")}function m(){A("createAssertDecode")}function f(){A("createValidateDecode")}function g(){A("createEncode")}function y(){A("createIsEncode")}function v(){A("createAssertEncode")}function b(){A("createValidateEncode")}function A(e){throw new Error("Error on typia.protobuf.".concat(e,"(): no transform has been configured. Read and follow https://typia.io/docs/setup please."))}t.message=function(){A("message")},t.decode=n,Object.assign(n,i.Namespace.protobuf.decode("decode")),t.assertDecode=s,Object.assign(s,i.Namespace.assert("protobuf.assertDecode")),Object.assign(s,i.Namespace.protobuf.decode("assertDecode")),t.isDecode=r,Object.assign(r,i.Namespace.is()),Object.assign(r,i.Namespace.protobuf.decode("isDecode")),t.validateDecode=o,Object.assign(o,i.Namespace.validate()),Object.assign(o,i.Namespace.protobuf.decode("validateDecode")),t.encode=l,Object.assign(l,i.Namespace.protobuf.encode("encode")),t.assertEncode=c,Object.assign(c,i.Namespace.assert("protobuf.assertEncode")),Object.assign(c,i.Namespace.protobuf.encode("assertEncode")),t.isEncode=d,Object.assign(d,i.Namespace.is()),Object.assign(d,i.Namespace.protobuf.encode("isEncode")),t.validateEncode=u,Object.assign(u,i.Namespace.validate()),Object.assign(u,i.Namespace.protobuf.encode("validateEncode")),t.createDecode=h,Object.assign(h,i.Namespace.protobuf.decode("createDecode")),t.createIsDecode=p,Object.assign(p,i.Namespace.is()),Object.assign(p,i.Namespace.protobuf.decode("createIsDecode")),t.createAssertDecode=m,Object.assign(m,i.Namespace.assert("protobuf.createAssertDecode")),Object.assign(m,i.Namespace.protobuf.decode("createAssertDecode")),t.createValidateDecode=f,Object.assign(f,i.Namespace.validate()),Object.assign(f,i.Namespace.protobuf.decode("createValidateDecode")),t.createEncode=g,Object.assign(g,i.Namespace.protobuf.encode("createEncode")),t.createIsEncode=y,Object.assign(y,i.Namespace.is()),Object.assign(y,i.Namespace.protobuf.encode("createIsEncode")),t.createAssertEncode=v,Object.assign(v,i.Namespace.assert("protobuf.createAssertEncode")),Object.assign(v,i.Namespace.protobuf.encode("createAssertEncode")),t.createValidateEncode=b,Object.assign(b,i.Namespace.validate()),Object.assign(b,i.Namespace.protobuf.encode("createValidateEncode"))},6243:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.metadata=void 0;var i=a(8003);function n(){!function(e){throw new Error("Error on typia.reflect.".concat(e,"(): no transform has been configured. Read and follow https://typia.io/docs/setup please."))}("metadata")}t.metadata=n,Object.assign(n,i.Namespace.reflect.metadata())},6982:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7611:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8321:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3078:function(e,t,a){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,a=t&&e[t],i=0;if(a)return a.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},n=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r},s=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=a(3346),o=a(3879),l=a(5041),c=a(1665),d=a(6104),u=a(8962),h=a(5191),p=function(){function e(e){this.parent_resolved_=!1,this.any=e.any,this.required=e.required,this.optional=e.optional,this.nullable=e.nullable,this.functional=e.functional,this.escaped=e.escaped,this.atomics=e.atomics,this.constants=e.constants,this.templates=e.templates,this.rest=e.rest,this.arrays=e.arrays,this.tuples=e.tuples,this.objects=e.objects,this.aliases=e.aliases,this.natives=e.natives,this.sets=e.sets,this.maps=e.maps}return e.create=function(t){return new e(t)},e.initialize=function(t){void 0===t&&(t=!1);var a=e.create({any:!1,nullable:!1,required:!0,optional:!1,functional:!1,escaped:null,constants:[],atomics:[],templates:[],arrays:[],tuples:[],objects:[],aliases:[],rest:null,natives:[],sets:[],maps:[]});return a.parent_resolved_=t,a},e.prototype.toJSON=function(){return{any:this.any,required:this.required,optional:this.optional,nullable:this.nullable,functional:this.functional,atomics:this.atomics.map((function(e){return e.toJSON()})),constants:this.constants.map((function(e){return e.toJSON()})),templates:this.templates.map((function(e){return e.map((function(e){return e.toJSON()}))})),escaped:this.escaped?this.escaped.toJSON():null,rest:this.rest?this.rest.toJSON():null,arrays:this.arrays.map((function(e){return{name:e.type.name,tags:e.tags.map((function(e){return e.slice()}))}})),tuples:this.tuples.map((function(e){return{name:e.type.name,tags:e.tags.map((function(e){return e.slice()}))}})),objects:this.objects.map((function(e){return e.name})),aliases:this.aliases.map((function(e){return e.name})),natives:this.natives.slice(),sets:this.sets.map((function(e){return e.toJSON()})),maps:this.maps.map((function(e){return{key:e.key.toJSON(),value:e.value.toJSON()}}))}},e.from=function(t,a){var i=this;return e.create({any:t.any,required:t.required,optional:t.optional,nullable:t.nullable,functional:t.functional,constants:t.constants.map(c.MetadataConstant.from),atomics:t.atomics.map(l.MetadataAtomic.from),templates:t.templates.map((function(e){return e.map((function(e){return i.from(e,a)}))})),escaped:t.escaped?d.MetadataEscaped.from(t.escaped,a):null,rest:t.rest?this.from(t.rest,a):null,arrays:t.arrays.map((function(e){var t=a.arrays.get(e.name);if(void 0===t)throw new RangeError('Error on Metadata.from(): failed to find array "'.concat(e.name,'".'));return o.MetadataArray.create({type:t,tags:e.tags.map((function(e){return e.slice()}))})})),tuples:t.tuples.map((function(e){var t=a.tuples.get(e.name);if(void 0===t)throw new RangeError('Error on Metadata.from(): failed to find tuple "'.concat(e.name,'".'));return h.MetadataTuple.create({type:t,tags:e.tags.map((function(e){return e.slice()}))})})),objects:t.objects.map((function(e){var t=a.objects.get(e);if(void 0===t)throw new RangeError('Error on Metadata.from(): failed to find object "'.concat(e,'".'));return t})),aliases:t.aliases.map((function(e){var t=a.aliases.get(e);if(void 0===t)throw new RangeError('Error on Metadata.from(): failed to find alias "'.concat(e,'".'));return t})),natives:t.natives.slice(),sets:t.sets.map((function(e){return i.from(e,a)})),maps:t.maps.map((function(e){return{key:i.from(e.key,a),value:i.from(e.value,a)}}))})},e.prototype.getName=function(){var e;return null!==(e=this.name_)&&void 0!==e?e:this.name_=m(this)},e.prototype.empty=function(){return 0===this.bucket()||0===this.size()},e.prototype.size=function(){return(this.any?1:0)+(this.escaped?1:0)+(this.functional?1:0)+(this.rest?this.rest.size():0)+this.templates.length+this.atomics.length+this.constants.map((function(e){return e.values.length})).reduce((function(e,t){return e+t}),0)+this.arrays.length+this.tuples.length+this.natives.length+this.maps.length+this.sets.length+this.objects.length+this.aliases.length},e.prototype.bucket=function(){return(this.any?1:0)+(this.escaped?1:0)+(this.functional?1:0)+(this.templates.length?1:0)+(this.atomics.length?1:0)+(this.constants.length?1:0)+(this.rest?this.rest.size():0)+(this.arrays.length?1:0)+(this.tuples.length?1:0)+(this.natives.length?1:0)+(this.sets.length?1:0)+(this.maps.length?1:0)+(this.objects.length?1:0)+(this.aliases.length?1:0)},e.prototype.isConstant=function(){return this.bucket()===(this.constants.length?1:0)},e.prototype.isRequired=function(){return!0===this.required&&!1===this.optional},e.prototype.isUnionBucket=function(){var e=this.bucket();return(this.atomics.length&&this.constants.length?e-1:e)>1},e.prototype.getSoleLiteral=function(){return 1===this.size()&&1===this.constants.length&&"string"===this.constants[0].type&&1===this.constants[0].values.length?this.constants[0].values[0]:null},e.prototype.isSoleLiteral=function(){return null!==this.getSoleLiteral()},e.prototype.isParentResolved=function(){return this.parent_resolved_},e}();t.Metadata=p,function(e){e.intersects=function(e,t){var a,r,o,l;if(e.any||t.any)return!0;if(!1===e.isRequired()&&!1===t.isRequired())return!0;if(!0===e.nullable&&!0===t.nullable)return!0;if(!0===e.functional&&!0===t.functional)return!0;if(e.arrays.length&&t.arrays.length)return!0;if(e.tuples.length&&t.tuples.length)return!0;if(e.objects.length&&t.objects.length)return!0;if(e.aliases.length&&t.aliases.length)return!0;if(e.natives.length&&t.natives.length&&e.natives.some((function(e){return t.natives.some((function(t){return e===t}))})))return!0;var c=function(e){return t.atomics.some((function(t){return e.type===t.type}))||t.constants.some((function(t){return e.type===t.type}))?{value:!0}:void 0};try{for(var d=i(e.atomics),u=d.next();!u.done;u=d.next()){var h=c(u.value);if("object"==typeof h)return h.value}}catch(e){a={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(a)throw a.error}}var p=function(e){if(void 0!==t.atomics.find((function(t){return t.type===e.type})))return{value:!0};var a=t.constants.find((function(t){return t.type===e.type}));return void 0===a?"continue":new Set(s(s([],n(e.values),!1),n(a.values),!1)).size!==e.values.length+a.values.length?{value:!0}:void 0};try{for(var m=i(e.constants),f=m.next();!f.done;f=m.next()){var g=p(f.value);if("object"==typeof g)return g.value}}catch(e){o={error:e}}finally{try{f&&!f.done&&(l=m.return)&&l.call(m)}finally{if(o)throw o.error}}return!(!e.templates.length||!t.atomics.some((function(e){return"string"===e.type})))||!(!t.templates.length||!e.atomics.some((function(e){return"string"===e.type})))},e.covers=function(t,a,n){var s,r,o,l,c,d,h,p,m,f,g,y,v,b;if(void 0===n&&(n=0),t===a)return!1;if(t.any)return!0;if(a.any)return!1;if(0===n){var A=function(a){if(!t.arrays.some((function(t){return e.covers(t.type.value,a.type.value,n+1)})))return{value:!1}};try{for(var _=i(a.arrays),x=_.next();!x.done;x=_.next()){var w=A(x.value);if("object"==typeof w)return w.value}}catch(e){s={error:e}}finally{try{x&&!x.done&&(r=_.return)&&r.call(_)}finally{if(s)throw s.error}}var C=function(a){if(0!==a.type.elements.length&&!1===t.tuples.some((function(t){return t.type.elements.length>=a.type.elements.length&&t.type.elements.slice(a.type.elements.length).every((function(t,i){return e.covers(t,a.type.elements[i],n+1)}))})))return{value:!1}};try{for(var E=i(a.tuples),S=E.next();!S.done;S=E.next()){var M=C(S.value);if("object"==typeof M)return M.value}}catch(e){o={error:e}}finally{try{S&&!S.done&&(l=E.return)&&l.call(E)}finally{if(o)throw o.error}}}var T=function(e){if(!1===t.objects.some((function(t){return u.MetadataObject.covers(t,e)})))return{value:!1}};try{for(var k=i(a.objects),P=k.next();!P.done;P=k.next()){var D=T(P.value);if("object"==typeof D)return D.value}}catch(e){c={error:e}}finally{try{P&&!P.done&&(d=k.return)&&d.call(k)}finally{if(c)throw c.error}}var R=function(e){if(!1===t.aliases.some((function(t){return t.name===e.name})))return{value:!1}};try{for(var F=i(a.aliases),I=F.next();!I.done;I=F.next()){var O=R(I.value);if("object"==typeof O)return O.value}}catch(e){h={error:e}}finally{try{I&&!I.done&&(p=F.return)&&p.call(F)}finally{if(h)throw h.error}}var L=function(e){if(!1===t.natives.some((function(t){return t===e})))return{value:!1}};try{for(var j=i(a.natives),N=j.next();!N.done;N=j.next()){var B=L(N.value);if("object"==typeof B)return B.value}}catch(e){m={error:e}}finally{try{N&&!N.done&&(f=j.return)&&f.call(j)}finally{if(m)throw m.error}}var q=function(a){if(!1===t.sets.some((function(t){return e.covers(t,a)})))return{value:!1}};try{for(var z=i(a.sets),U=z.next();!U.done;U=z.next()){var H=q(U.value);if("object"==typeof H)return H.value}}catch(e){g={error:e}}finally{try{U&&!U.done&&(y=z.return)&&y.call(z)}finally{if(g)throw g.error}}if(a.atomics.some((function(e){return!1===t.atomics.some((function(t){return t.type===e.type}))})))return!1;var W=function(e){if(t.atomics.some((function(t){return e.type===t.type})))return"continue";var a=t.constants.find((function(t){return t.type===e.type}));return void 0===a||e.values.some((function(e){return!1===a.values.includes(e)}))?{value:!1}:void 0};try{for(var $=i(a.constants),V=$.next();!V.done;V=$.next()){var G=W(V.value);if("object"==typeof G)return G.value}}catch(e){v={error:e}}finally{try{V&&!V.done&&(b=$.return)&&b.call($)}finally{if(v)throw v.error}}return!1!==t.functional||!a.functional},e.merge=function(t,a){var o,l,u,h,p,m,g,y,v=e.create({any:t.any||a.any,nullable:t.nullable||a.nullable,required:t.required&&a.required,optional:t.optional||a.optional,functional:t.functional||a.functional,escaped:null!==t.escaped&&null!==a.escaped?d.MetadataEscaped.create({original:e.merge(t.escaped.original,a.escaped.original),returns:e.merge(t.escaped.returns,a.escaped.returns)}):null!==(g=t.escaped)&&void 0!==g?g:a.escaped,atomics:f({container:t.atomics,equals:function(e,t){return e.type===t.type},getter:function(e){return e.tags}})(a.atomics),constants:s([],n(t.constants),!1),templates:t.templates.slice(),rest:null!==t.rest&&null!==a.rest?e.merge(t.rest,a.rest):null!==(y=t.rest)&&void 0!==y?y:a.rest,arrays:f({container:t.arrays,equals:function(e,t){return e.type.name===t.type.name},getter:function(e){return e.tags}})(a.arrays),tuples:f({container:t.tuples,equals:function(e,t){return e.type.name===t.type.name},getter:function(e){return e.tags}})(a.tuples),objects:t.objects.slice(),aliases:t.aliases.slice(),natives:s([],n(new Set(s(s([],n(t.natives),!1),n(a.natives),!1))),!1),sets:t.sets.slice(),maps:t.maps.slice()}),b=function(e){var t,a,n=r.ArrayUtil.take(v.constants,(function(t){return t.type===e.type}),(function(){return c.MetadataConstant.create({type:e.type,values:[]})}));try{for(var s=(t=void 0,i(e.values)),o=s.next();!o.done;o=s.next()){var l=o.value;r.ArrayUtil.add(n.values,l)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(a=s.return)&&a.call(s)}finally{if(t)throw t.error}}};try{for(var A=i(a.constants),_=A.next();!_.done;_=A.next()){b(_.value)}}catch(e){o={error:e}}finally{try{_&&!_.done&&(l=A.return)&&l.call(A)}finally{if(o)throw o.error}}try{for(var x=i(a.objects),w=x.next();!w.done;w=x.next()){var C=w.value;r.ArrayUtil.set(v.objects,C,(function(e){return e.name}))}}catch(e){u={error:e}}finally{try{w&&!w.done&&(h=x.return)&&h.call(x)}finally{if(u)throw u.error}}try{for(var E=i(a.aliases),S=E.next();!S.done;S=E.next()){var M=S.value;r.ArrayUtil.set(v.aliases,M,(function(e){return e.name}))}}catch(e){p={error:e}}finally{try{S&&!S.done&&(m=E.return)&&m.call(E)}finally{if(p)throw p.error}}return v}}(p||(t.Metadata=p={}));var m=function(e){var t,a,n,s,r,o,l,c,d,u,h,p,m,f,g,y,v,b,A,_,x,w;if(!0===e.any)return"any";var C=[];!0===e.nullable&&C.push("null"),!1===e.isRequired()&&C.push("undefined");try{for(var E=i(e.atomics),S=E.next();!S.done;S=E.next()){var M=S.value;C.push(M.getName())}}catch(e){t={error:e}}finally{try{S&&!S.done&&(a=E.return)&&a.call(E)}finally{if(t)throw t.error}}try{for(var T=i(e.constants),k=T.next();!k.done;k=T.next()){var P=k.value;try{for(var D=(r=void 0,i(P.values)),R=D.next();!R.done;R=D.next()){var F=R.value;C.push("string"===P.type?JSON.stringify(F):F.toString())}}catch(e){r={error:e}}finally{try{R&&!R.done&&(o=D.return)&&o.call(D)}finally{if(r)throw r.error}}}}catch(e){n={error:e}}finally{try{k&&!k.done&&(s=T.return)&&s.call(T)}finally{if(n)throw n.error}}try{for(var I=i(e.templates),O=I.next();!O.done;O=I.next()){var L=O.value;C.push("`"+L.map((function(e){return e.isConstant()&&1===e.size()?e.constants[0].values[0]:"${".concat(e.getName(),"}")})).join("").split("`").join("\\`")+"`")}}catch(e){l={error:e}}finally{try{O&&!O.done&&(c=I.return)&&c.call(I)}finally{if(l)throw l.error}}try{for(var j=i(e.natives),N=j.next();!N.done;N=j.next()){var B=N.value;C.push(B)}}catch(e){d={error:e}}finally{try{N&&!N.done&&(u=j.return)&&u.call(j)}finally{if(d)throw d.error}}try{for(var q=i(e.sets),z=q.next();!z.done;z=q.next()){var U=z.value;C.push("Set<".concat(U.getName(),">"))}}catch(e){h={error:e}}finally{try{z&&!z.done&&(p=q.return)&&p.call(q)}finally{if(h)throw h.error}}try{for(var H=i(e.maps),W=H.next();!W.done;W=H.next()){var $=W.value;C.push("Map<".concat($.key.getName(),", ").concat($.value.getName(),">"))}}catch(e){m={error:e}}finally{try{W&&!W.done&&(f=H.return)&&f.call(H)}finally{if(m)throw m.error}}null!==e.rest&&C.push("...".concat(e.rest.getName()));try{for(var V=i(e.tuples),G=V.next();!G.done;G=V.next()){var X=G.value;C.push(X.type.name)}}catch(e){g={error:e}}finally{try{G&&!G.done&&(y=V.return)&&y.call(V)}finally{if(g)throw g.error}}try{for(var K=i(e.arrays),Y=K.next();!Y.done;Y=K.next()){var J=Y.value;C.push(J.getName())}}catch(e){v={error:e}}finally{try{Y&&!Y.done&&(b=K.return)&&b.call(K)}finally{if(v)throw v.error}}try{for(var Q=i(e.objects),Z=Q.next();!Z.done;Z=Q.next()){var ee=Z.value;C.push(ee.name)}}catch(e){A={error:e}}finally{try{Z&&!Z.done&&(_=Q.return)&&_.call(Q)}finally{if(A)throw A.error}}try{for(var te=i(e.aliases),ae=te.next();!ae.done;ae=te.next()){var ie=ae.value;C.push(ie.name)}}catch(e){x={error:e}}finally{try{ae&&!ae.done&&(w=te.return)&&w.call(te)}finally{if(x)throw x.error}}return null!==e.escaped&&C.push(e.escaped.getName()),0===C.length?"unknown":1===C.length?C[0]:(C.sort(),"(".concat(C.join(" | "),")"))},f=function(e){return function(t){var a,r,o=s([],n(e.container),!1),l=function(t){var a,n,s=e.container.find((function(a){return e.equals(a,t)}));if(void 0===s)return o.push(t),"continue";var r=e.getter(s).map((function(e){return e.map((function(e){return e.name}))})).sort(),l=function(t){var a=t.map((function(e){return e.name})).sort();if(r.some((function(e){return e.length===a.length&&e.every((function(e,t){return e===a[t]}))})))return"continue";e.getter(s).push(t)};try{for(var c=(a=void 0,i(e.getter(t))),d=c.next();!d.done;d=c.next()){l(d.value)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(a)throw a.error}}};try{for(var c=i(t),d=c.next();!d.done;d=c.next()){l(d.value)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(a)throw a.error}}return o}}},9596:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataAlias=void 0;var a=function(){function e(e){this.name=e.name,this.value=e.value,this.description=e.description,this.jsDocTags=e.jsDocTags,this.recursive=e.recursive,this.nullables=e.nullables}return e.create=function(t){return new e(t)},e._From_without_value=function(t){return e.create({name:t.name,value:null,description:t.description,recursive:t.recursive,jsDocTags:t.jsDocTags.slice(),nullables:t.nullables.slice()})},e.prototype.toJSON=function(){return{name:this.name,value:this.value.toJSON(),description:this.description,recursive:this.recursive,jsDocTags:this.jsDocTags.slice(),nullables:this.nullables.slice()}},e}();t.MetadataAlias=a},5821:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataApplication=void 0;var i=a(3078),n=a(4291),s=function(){function e(e){this.metadatas=e.metadatas,this.components=e.components}return e.create=function(t){return new e(t)},e.from=function(t){var a=n.MetadataComponents.from(t.components),s=t.metadatas.map((function(e){return i.Metadata.from(e,a.dictionary)}));return e.create({metadatas:s,components:a})},e.prototype.toJSON=function(){return{metadatas:this.metadatas.map((function(e){return e.toJSON()})),components:this.components.toJSON()}},e}();t.MetadataApplication=s},3879:function(e,t){"use strict";var a=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r},i=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataArray=void 0;var n=function(){function e(e){this.type=e.type,this.tags=e.tags}return e.create=function(t){return new e(t)},e.prototype.getName=function(){var e,t=this;return null!==(e=this.name_)&&void 0!==e?e:this.name_=function(){if(0===t.tags.length)return t.type.name;if(1===t.tags.length){var e=i([t.type.name],a(t.tags[0].map((function(e){return e.name}))),!1).join(" & ");return"(".concat(e,")")}var n=t.tags.map((function(e){var t=e.map((function(e){return e.name})).join(" & ");return 1===e.length?t:"(".concat(t,")")}));return"(".concat(t.type.name," & (").concat(n.join(" | "),"))")}()},e.prototype.toJSON=function(){return{type:this.type.toJSON(),tags:this.tags.map((function(e){return e.slice()}))}},e}();t.MetadataArray=n},3860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataArrayType=void 0;var a=function(){function e(e){this.name=e.name,this.value=e.value,this.index=e.index,this.recursive=e.recursive,this.nullables=e.nullables}return e._From_without_value=function(t){return e.create({name:t.name,value:null,index:t.index,recursive:t.recursive,nullables:t.nullables})},e.create=function(t){return new e(t)},e.prototype.toJSON=function(){return{name:this.name,value:this.value.toJSON(),nullables:this.nullables,recursive:this.recursive,index:this.index}},e}();t.MetadataArrayType=a},5041:function(e,t){"use strict";var a=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r},i=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataAtomic=void 0;var n=function(){function e(e){this.type=e.type,this.tags=e.tags}return e.create=function(t){return new e(t)},e.from=function(t){return e.create({type:t.type,tags:t.tags.map((function(e){return e.map((function(e){var t;return{target:e.target,name:e.name,kind:e.kind,value:"object"==typeof e.value&&"bigint"===(null===(t=e.value)||void 0===t?void 0:t.type)&&"string"==typeof e.value.value?BigInt(e.value.value):e.value,validate:e.validate,exclusive:e.exclusive}}))}))})},e.prototype.getName=function(){var e,t=this;return null!==(e=this.name_)&&void 0!==e?e:this.name_=function(){if(0===t.tags.length)return t.type;if(1===t.tags.length){var e=i([t.type],a(t.tags[0].map((function(e){return e.name}))),!1).join(" & ");return"(".concat(e,")")}var n=t.tags.map((function(e){var t=e.map((function(e){return e.name})).join(" & ");return 1===e.length?t:"(".concat(t,")")}));return"(".concat(t.type," & (").concat(n.join(" | "),"))")}()},e.prototype.toJSON=function(){return{type:this.type,tags:this.tags.map((function(e){return e.map((function(e){return{target:e.target,name:e.name,kind:e.kind,value:"bigint"==typeof e.value?{type:"bigint",value:e.value.toString()}:e.value,validate:e.validate,exclusive:e.exclusive}}))}))}},e}();t.MetadataAtomic=n},4291:function(e,t,a){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,a=t&&e[t],i=0;if(a)return a.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},n=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r},s=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataComponents=void 0;var r=a(1261),o=a(3078),l=a(9596),c=a(3860),d=a(8962),u=a(6724),h=a(4530),p=function(){function e(e){this.aliases=e.aliases,this.objects=e.objects,this.arrays=e.arrays,this.tuples=e.tuples,this.dictionary=e.dictionary}return e.from=function(t){var a,p,m,f,g,y,v,b,A,_={objects:new Map(t.objects.map((function(e){return[e.name,d.MetadataObject._From_without_properties(e)]}))),aliases:new Map(t.aliases.map((function(e){return[e.name,l.MetadataAlias._From_without_value(e)]}))),arrays:new Map(t.arrays.map((function(e){return[e.name,c.MetadataArrayType._From_without_value(e)]}))),tuples:new Map(t.tuples.map((function(e){return[e.name,h.MetadataTupleType._From_without_elements(e)]})))};try{for(var x=i(t.objects),w=x.next();!w.done;w=x.next()){var C=w.value;(m=_.objects.get(C.name).properties).push.apply(m,s([],n(C.properties.map((function(e){return u.MetadataProperty.from(e,_)}))),!1))}}catch(e){a={error:e}}finally{try{w&&!w.done&&(p=x.return)&&p.call(x)}finally{if(a)throw a.error}}try{for(var E=i(t.aliases),S=E.next();!S.done;S=E.next()){var M=S.value;(0,r.Writable)(_.aliases.get(M.name)).value=o.Metadata.from(M.value,_)}}catch(e){f={error:e}}finally{try{S&&!S.done&&(g=E.return)&&g.call(E)}finally{if(f)throw f.error}}try{for(var T=i(t.arrays),k=T.next();!k.done;k=T.next()){var P=k.value;(0,r.Writable)(_.arrays.get(P.name)).value=o.Metadata.from(P.value,_)}}catch(e){y={error:e}}finally{try{k&&!k.done&&(v=T.return)&&v.call(T)}finally{if(y)throw y.error}}try{for(var D=i(t.tuples),R=D.next();!R.done;R=D.next()){var F=R.value;(0,r.Writable)(_.tuples.get(F.name)).elements=F.elements.map((function(e){return o.Metadata.from(e,_)}))}}catch(e){b={error:e}}finally{try{R&&!R.done&&(A=D.return)&&A.call(D)}finally{if(b)throw b.error}}return new e({aliases:s([],n(_.aliases.values()),!1),objects:s([],n(_.objects.values()),!1),arrays:s([],n(_.arrays.values()),!1),tuples:s([],n(_.tuples.values()),!1),dictionary:_})},e.prototype.toJSON=function(){return{aliases:this.aliases.map((function(e){return e.toJSON()})),objects:this.objects.map((function(e){return e.toJSON()})),arrays:this.arrays.map((function(e){return e.toJSON()})),tuples:this.tuples.map((function(e){return e.toJSON()}))}},e}();t.MetadataComponents=p},1665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataConstant=void 0;var a=function(){function e(e){this.type=e.type,this.values=e.values,this.tags=e.tags}return e.create=function(t){return new e(t)},e.from=function(t){return e.create({type:t.type,values:"bigint"===t.type?t.values.map((function(e){return BigInt(e)})):t.values})},e.prototype.toJSON=function(){return{type:this.type,values:"bigint"===this.type?this.values.map((function(e){return e.toString()})):this.values}},e}();t.MetadataConstant=a},6104:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataEscaped=void 0;var i=a(3078),n=function(){function e(e){this.original=e.original,this.returns=e.returns}return e.from=function(t,a){return e.create({original:i.Metadata.from(t.original,a),returns:i.Metadata.from(t.returns,a)})},e.create=function(t){return new e(t)},e.prototype.getName=function(){return this.returns.getName()},e.prototype.toJSON=function(){return{original:this.original.toJSON(),returns:this.returns.toJSON()}},e}();t.MetadataEscaped=n},8962:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataObject=void 0;var a=function(){function e(e){this.nullables=[],this.tagged_=!1,this.name=e.name,this.properties=e.properties,this.description=e.description,this.jsDocTags=e.jsDocTags,this.index=e.index,this.validated=e.validated,this.recursive=e.recursive,this.nullables=e.nullables.slice(),this.tagged_=!1}return e.create=function(t){return new e(t)},e._From_without_properties=function(t){return e.create({name:t.name,properties:[],description:t.description,jsDocTags:t.jsDocTags,index:t.index,validated:t.validated,recursive:t.recursive,nullables:t.nullables.slice()})},e.prototype._Messagable=function(){return this.properties.length>=1&&this.properties.every((function(e){return e.key.isSoleLiteral()}))},e.prototype._Is_simple=function(e){return void 0===e&&(e=0),!1===this.recursive&&this.properties.length<10&&this.properties.every((function(t){return t.key.isSoleLiteral()&&1===t.value.size()&&!0===t.value.isRequired()&&!1===t.value.nullable&&(1===t.value.atomics.length||e<1&&1===t.value.objects.length&&t.value.objects[0]._Is_simple(e+1))}))},e.prototype._Is_literal=function(){var e,t=this;return null!==(e=this.literal_)&&void 0!==e?e:this.literal_=function(){if(!0===t.recursive)return!1;if("__type"===t.name)return!0;if(!1===t.name.startsWith("__type.o"))return!1;var e=t.name.substr(8),a=Number(e);return!1===isNaN(a)&&Number.isInteger(a)}()},e.prototype.toJSON=function(){return{name:this.name,properties:this.properties.map((function(e){return e.toJSON()})),description:this.description,jsDocTags:this.jsDocTags,index:this.index,validated:this.validated,recursive:this.recursive,nullables:this.nullables.slice()}},e}();t.MetadataObject=a,function(e){e.intersects=function(e,t){return e.properties.some((function(e){return void 0!==t.properties.find((function(t){return e.key.getName()===t.key.getName()}))}))},e.covers=function(e,t){return e.properties.length>=t.properties.length&&e.properties.every((function(e){return void 0!==t.properties.find((function(t){return e.key.getName()===t.key.getName()}))}))}}(a||(t.MetadataObject=a={}))},6724:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataProperty=void 0;var i=a(3078),n=function(){function e(e){this.key=e.key,this.value=e.value,this.description=e.description,this.jsDocTags=e.jsDocTags}return e.create=function(t){return new e(t)},e.from=function(t,a){return e.create({key:i.Metadata.from(t.key,a),value:i.Metadata.from(t.value,a),description:t.description,jsDocTags:t.jsDocTags.slice()})},e.prototype.toJSON=function(){return{key:this.key.toJSON(),value:this.value.toJSON(),description:this.description,jsDocTags:this.jsDocTags}},e}();t.MetadataProperty=n},5191:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataTuple=void 0;var a=function(){function e(e){this.type=e.type,this.tags=e.tags}return e.create=function(t){return new e(t)},e.prototype.toJSON=function(){return{type:this.type.toJSON(),tags:this.tags.map((function(e){return e.slice()}))}},e}();t.MetadataTuple=a},4530:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataTupleType=void 0;var a=function(){function e(e){this.name=e.name,this.elements=e.elements,this.index=e.index,this.recursive=e.recursive,this.nullables=e.nullables}return e._From_without_elements=function(t){return e.create({name:t.name,index:t.index,elements:null,recursive:t.recursive,nullables:t.nullables.slice()})},e.create=function(t){return new e(t)},e.prototype.isRest=function(){return this.elements.length>0&&null!==this.elements[this.elements.length-1].rest},e.prototype.toJSON=function(){return{name:this.name,index:this.index,elements:this.elements.map((function(e){return e.toJSON()})),recursive:this.recursive,nullables:this.nullables.slice()}},e}();t.MetadataTupleType=a},9055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9987:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3109:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4075:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8303:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},981:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3183:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},615:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7150:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5905:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4540:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},217:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4517:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8719:function(e,t,a){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),n(a(9055),t),n(a(9987),t),n(a(3109),t),n(a(4075),t),n(a(3183),t),n(a(8303),t),n(a(981),t),n(a(5905),t),n(a(615),t),n(a(7150),t),n(a(4540),t),n(a(1835),t),n(a(217),t),n(a(4517),t)},1261:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Writable=void 0,t.Writable=function(e){return e}},3346:function(e,t){"use strict";var a,i=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r},n=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayUtil=void 0,function(e){e.has=function(e,t){return e.some(t)},e.add=function(e,t,a){return void 0===a&&(a=function(e,t){return e===t}),!e.some((function(e){return a(e,t)}))&&(e.push(t),!0)},e.set=function(e,t,a){e.some((function(e){return a(e)===a(t)}))||e.push(t)},e.take=function(e,t,a){var i=e.findIndex(t);if(-1!==i)return e[i];var n=a();return e.push(n),n},e.repeat=function(e,t){return new Array(e).fill("").map((function(a,i){return t(i,e)}))},e.flat=function(e){var t;return(t=[]).concat.apply(t,n([],i(e),!1))}}(a||(t.ArrayUtil=a={}))},473:function(e,t,a){"use strict";var i=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var i,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.NamingConvention=void 0;var n,s=a(1725);!function(e){e.snake=function(e){for(var t=[],a=0;a<e.length;a++){var i=e.charCodeAt(a);65<=i&&i<=90&&t.push(a)}for(a=t.length-1;a>0;--a){t[a]-t[a-1]==1&&t.splice(a,1)}if(0!==t.length&&0===t[0]&&t.splice(0,1),0===t.length)return e.toLowerCase();var n="";for(a=0;a<t.length;a++){var s=0===a?0:t[a-1],r=t[a];n+=e.substring(s,r).toLowerCase(),n+="_"}return n+=e.substring(t[t.length-1]).toLowerCase()},e.camel=function(e){return 0===(e=t(e)).length?e:e[0]===e[0].toUpperCase()?e[0].toLowerCase()+e.substring(1):"_"===e[0]&&e.length>1&&e[1]===e[1].toLowerCase()?"_"+e[1].toUpperCase()+e.substring(2):e},e.pascal=function(e){return 0===(e=t(e)).length?e:e[0]===e[0].toLowerCase()?e[0].toUpperCase()+e.substring(1):"_"===e[0]&&e.length>1&&e[1]===e[1].toLowerCase()?"_"+e[1].toUpperCase()+e.substring(2):e};var t=function(e){for(var t=[],a=0;a<e.length;a++){if("_"===e[a]){var n=t[t.length-1];void 0===n||n[0]+n[1]!==a?t.push([a,1]):++n[1]}}if(0===t.length)return e;var r="";for(a=0;a<t.length;a++){var o=i(t[a],1)[0];if(0===a)r+=0===o?"_":e.substring(0,o);else{var l=i(t[a-1],2),c=l[0],d=l[1],u=e.substring(c+d,o);u.length&&(r+=s.StringUtil.capitalize(u))}}var h=t[t.length-1],p=e.substring(h[0]+h[1]);return h.length&&(r+=s.StringUtil.capitalize(p)),r}}(n||(t.NamingConvention=n={}))},6036:function(e,t,a){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RandomGenerator=void 0;var n,s=i(a(4419));!function(e){var t="abcdefghijklmnopqrstuvwxyz";e.boolean=function(){return Math.random()<.5},e.integer=function(e,t){return null!=e||(e=0),null!=t||(t=100),Math.floor(Math.random()*(t-e+1))+e},e.bigint=function(t,a){return null!=t||(t=BigInt(0)),null!=a||(a=BigInt(100)),BigInt(e.integer(Number(t),Number(a)))},e.number=function(e,t){return null!=e||(e=0),null!=t||(t=100),Math.random()*(t-e)+e},e.string=function(a){return new Array(null!=a?a:e.integer(5,10)).fill(0).map((function(){return t[e.integer(0,25)]})).join("")},e.array=function(t,a){return new Array(null!=a?a:e.length()).fill(0).map((function(e,a){return t(a)}))},e.pick=function(t){return t[e.integer(0,t.length-1)]},e.length=function(){return e.integer(0,3)},e.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.email=function(){return"".concat(e.string(10),"@").concat(e.string(10),".").concat(e.string(3))},e.url=function(){return"https://".concat(e.string(10),".").concat(e.string(3))},e.ipv4=function(){return e.array((function(){return e.integer(0,255)}),4).join(".")},e.ipv6=function(){return e.array((function(){return e.integer(0,65535).toString(16)}),8).join(":")},e.pattern=function(e){return new s.default(e).gen()},e.date=function(t,a){return null!=t||(t=0),null!=a||(a=2*Date.now()),new Date(e.number(t,a)).toISOString().substring(0,10)},e.datetime=function(t,a){return null!=t||(t=Date.now()-30*r),null!=a||(a=Date.now()+7*r),new Date(e.number(t,a)).toISOString()}}(n||(t.RandomGenerator=n={}));var r=864e5},1725:(e,t)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.StringUtil=void 0,function(e){e.capitalize=function(e){return e.length?e[0].toUpperCase()+e.slice(1):e}}(a||(t.StringUtil=a={}))},8541:(e,t,a)=>{"use strict";a.a(e,(async(e,i)=>{try{a.d(t,{Me:()=>c,OW:()=>l,Tu:()=>o});var n={640:(e,t,a)=>{a.d(t,{AnnotationLayer:()=>AnnotationLayer,FreeTextAnnotationElement:()=>FreeTextAnnotationElement,InkAnnotationElement:()=>InkAnnotationElement,StampAnnotationElement:()=>StampAnnotationElement});var i=a(266),n=a(473),s=a(780);function r(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}function o(e){return Math.max(0,Math.min(255,255*e))}class ColorConverters{static CMYK_G([e,t,a,i]){return["G",1-Math.min(1,.3*e+.59*a+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return[e=o(e),e,e]}static G_HTML([e]){const t=r(e);return`#${t}${t}${t}`}static RGB_G([e,t,a]){return["G",.3*e+.59*t+.11*a]}static RGB_rgb(e){return e.map(o)}static RGB_HTML(e){return`#${e.map(r).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,a,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,a+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,a,i]){return[o(1-Math.min(1,e+i)),o(1-Math.min(1,a+i)),o(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,a]){const i=1-e,n=1-t,s=1-a;return["CMYK",i,n,s,Math.min(i,n,s)]}}var l=a(160);const c=1e3,d=new WeakSet;function u(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class AnnotationElementFactory{static create(e){switch(e.data.annotationType){case i.AnnotationType.LINK:return new LinkAnnotationElement(e);case i.AnnotationType.TEXT:return new TextAnnotationElement(e);case i.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new TextWidgetAnnotationElement(e);case"Btn":return e.data.radioButton?new RadioButtonWidgetAnnotationElement(e):e.data.checkBox?new CheckboxWidgetAnnotationElement(e):new PushButtonWidgetAnnotationElement(e);case"Ch":return new ChoiceWidgetAnnotationElement(e);case"Sig":return new SignatureWidgetAnnotationElement(e)}return new WidgetAnnotationElement(e);case i.AnnotationType.POPUP:return new PopupAnnotationElement(e);case i.AnnotationType.FREETEXT:return new FreeTextAnnotationElement(e);case i.AnnotationType.LINE:return new LineAnnotationElement(e);case i.AnnotationType.SQUARE:return new SquareAnnotationElement(e);case i.AnnotationType.CIRCLE:return new CircleAnnotationElement(e);case i.AnnotationType.POLYLINE:return new PolylineAnnotationElement(e);case i.AnnotationType.CARET:return new CaretAnnotationElement(e);case i.AnnotationType.INK:return new InkAnnotationElement(e);case i.AnnotationType.POLYGON:return new PolygonAnnotationElement(e);case i.AnnotationType.HIGHLIGHT:return new HighlightAnnotationElement(e);case i.AnnotationType.UNDERLINE:return new UnderlineAnnotationElement(e);case i.AnnotationType.SQUIGGLY:return new SquigglyAnnotationElement(e);case i.AnnotationType.STRIKEOUT:return new StrikeOutAnnotationElement(e);case i.AnnotationType.STAMP:return new StampAnnotationElement(e);case i.AnnotationType.FILEATTACHMENT:return new FileAttachmentAnnotationElement(e);default:return new AnnotationElement(e)}}}class AnnotationElement{#e=!1;constructor(e,{isRenderable:t=!1,ignoreBorder:a=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(a)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:a}){return!!(e?.str||t?.str||a?.str)}get hasPopupData(){return AnnotationElement._hasPopupData(this.data)}_createContainer(e){const{data:t,parent:{page:a,viewport:n}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof WidgetAnnotationElement||(s.tabIndex=c),s.style.zIndex=this.parent.zIndex++,this.data.popupRef&&s.setAttribute("aria-haspopup","dialog"),t.noRotate&&s.classList.add("norotate");const{pageWidth:r,pageHeight:o,pageX:l,pageY:d}=n.rawDims;if(!t.rect||this instanceof PopupAnnotationElement){const{rotation:e}=t;return t.hasOwnCanvas||0===e||this.setRotation(e,s),s}const{width:h,height:p}=u(t.rect),m=i.Util.normalizeRect([t.rect[0],a.view[3]-t.rect[1]+a.view[1],t.rect[2],a.view[3]-t.rect[3]+a.view[1]]);if(!e&&t.borderStyle.width>0){s.style.borderWidth=`${t.borderStyle.width}px`;const e=t.borderStyle.horizontalCornerRadius,a=t.borderStyle.verticalCornerRadius;if(e>0||a>0){const t=`calc(${e}px * var(--scale-factor)) / calc(${a}px * var(--scale-factor))`;s.style.borderRadius=t}else if(this instanceof RadioButtonWidgetAnnotationElement){const e=`calc(${h}px * var(--scale-factor)) / calc(${p}px * var(--scale-factor))`;s.style.borderRadius=e}switch(t.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:s.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:s.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:s.style.borderBottomStyle="solid"}const n=t.borderColor||null;n?(this.#e=!0,s.style.borderColor=i.Util.makeHexColor(0|n[0],0|n[1],0|n[2])):s.style.borderWidth=0}s.style.left=100*(m[0]-l)/r+"%",s.style.top=100*(m[1]-d)/o+"%";const{rotation:f}=t;return t.hasOwnCanvas||0===f?(s.style.width=100*h/r+"%",s.style.height=100*p/o+"%"):this.setRotation(f,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:a,pageHeight:i}=this.parent.viewport.rawDims,{width:n,height:s}=u(this.data.rect);let r,o;e%180==0?(r=100*n/a,o=100*s/i):(r=100*s/a,o=100*n/i),t.style.width=`${r}%`,t.style.height=`${o}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(e,t,a)=>{const i=a.detail[e],n=i[0],s=i.slice(1);a.target.style[t]=ColorConverters[`${n}_HTML`](s),this.annotationStorage.setValue(this.data.id,{[t]:ColorConverters[`${n}_rgb`](s)})};return(0,i.shadow)(this,"_commonActions",{display:e=>{const{display:t}=e.detail,a=t%2==1;this.container.style.visibility=a?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:a,noPrint:1===t||2===t})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:t}=e.detail;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{const t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){const a=this._commonActions;for(const i of Object.keys(t.detail)){const n=e[i]||a[i];n?.(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const a=this._commonActions;for(const[i,n]of Object.entries(t)){const s=a[i];if(s){s({detail:{[i]:n},target:e}),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,a,i,n]=this.data.rect;if(1===e.length){const[,{x:s,y:r},{x:o,y:l}]=e[0];if(i===s&&n===r&&t===o&&a===l)return}const{style:s}=this.container;let r;if(this.#e){const{borderColor:e,borderWidth:t}=s;s.borderWidth=0,r=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${e}" stroke-width="${t}">`],this.container.classList.add("hasBorder")}const o=i-t,l=n-a,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const u=c.createElement("defs");d.append(u);const h=c.createElement("clipPath"),p=`clippath_${this.data.id}`;h.setAttribute("id",p),h.setAttribute("clipPathUnits","objectBoundingBox"),u.append(h);for(const[,{x:a,y:i},{x:s,y:d}]of e){const e=c.createElement("rect"),u=(s-t)/o,p=(n-i)/l,m=(a-s)/o,f=(i-d)/l;e.setAttribute("x",u),e.setAttribute("y",p),e.setAttribute("width",m),e.setAttribute("height",f),h.append(e),r?.push(`<rect vector-effect="non-scaling-stroke" x="${u}" y="${p}" width="${m}" height="${f}"/>`)}this.#e&&(r.push("</g></svg>')"),s.backgroundImage=r.join("")),this.container.append(d),this.container.style.clipPath=`url(#${p})`}_createPopup(){const{container:e,data:t}=this;e.setAttribute("aria-haspopup","dialog");const a=new PopupAnnotationElement({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(a.render())}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const a=[];if(this._fieldObjects){const n=this._fieldObjects[e];if(n)for(const{page:e,id:s,exportValues:r}of n){if(-1===e)continue;if(s===t)continue;const n="string"==typeof r?r:null,o=document.querySelector(`[data-element-id="${s}"]`);!o||d.has(o)?a.push({id:s,exportValue:n,domElement:o}):(0,i.warn)(`_getElementsByName - element not allowed: ${s}`)}return a}for(const i of document.getElementsByName(e)){const{exportValue:e}=i,n=i.getAttribute("data-element-id");n!==t&&(d.has(i)&&a.push({id:n,exportValue:e,domElement:i}))}return a}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",(()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})}))}}class LinkAnnotationElement extends AnnotationElement{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,a=document.createElement("a");a.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(a,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(a,e.action),i=!0):e.attachment?(this.#t(a,e.attachment,e.attachmentDest),i=!0):e.setOCGState?(this.#a(a,e.setOCGState),i=!0):e.dest?(this._bindLink(a,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(a,e),i=!0),e.resetForm?(this._bindResetFormAction(a,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(a,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(a),this.container}#i(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&this.#i()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#i()}#t(e,t,a=null){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,a),!1),this.#i()}#a(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#i()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const a=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(t.actions)){const n=a.get(i);n&&(e[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}e.onclick||(e.onclick=()=>!1),this.#i()}_bindResetFormAction(e,t){const a=e.onclick;if(a||(e.href=this.linkService.getAnchorUrl("")),this.#i(),!this._fieldObjects)return(0,i.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(a||(e.onclick=()=>!1));e.onclick=()=>{a?.();const{fields:e,refs:n,include:s}=t,r=[];if(0!==e.length||0!==n.length){const t=new Set(n);for(const a of e){const e=this._fieldObjects[a]||[];for(const{id:a}of e)t.add(a)}for(const e of Object.values(this._fieldObjects))for(const a of e)t.has(a.id)===s&&r.push(a)}else for(const e of Object.values(this._fieldObjects))r.push(...e);const o=this.annotationStorage,l=[];for(const e of r){const{id:t}=e;switch(l.push(t),e.type){case"text":{const a=e.defaultValue||"";o.setValue(t,{value:a});break}case"checkbox":case"radiobutton":{const a=e.defaultValue===e.exportValues;o.setValue(t,{value:a});break}case"combobox":case"listbox":{const a=e.defaultValue||"";o.setValue(t,{value:a});break}default:continue}const a=document.querySelector(`[data-element-id="${t}"]`);a&&(d.has(a)?a.dispatchEvent(new Event("resetform")):(0,i.warn)(`_bindResetFormAction - element not allowed: ${t}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class TextAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class WidgetAnnotationElement extends AnnotationElement{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&("CANVAS"===e.previousSibling?.nodeName&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return i.FeatureTest.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,a,i,n){a.includes("mouse")?e.addEventListener(a,(e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(a,(e=>{if("blur"===a){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if("focus"===a){if(t.focused)return;t.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(e)}})}))}_setEventListeners(e,t,a,i){for(const[n,s]of a)("Action"===s||this.data.actions?.[s])&&("Focus"!==s&&"Blur"!==s||(t||={focused:!1}),this._setEventListener(e,t,n,s,i),"Focus"!==s||this.data.actions?.Blur?"Blur"!==s||this.data.actions?.Focus||this._setEventListener(e,t,"focus","Focus",null):this._setEventListener(e,t,"blur","Blur",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":i.Util.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:a}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||9,s=e.style;let r;const o=e=>Math.round(10*e)/10;if(this.data.multiLine){const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=e/(Math.round(e/(i.LINE_FACTOR*n))||1);r=Math.min(n,o(t/i.LINE_FACTOR))}else{const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);r=Math.min(n,o(e/i.LINE_FACTOR))}s.fontSize=`calc(${r}px * var(--scale-factor))`,s.color=i.Util.makeHexColor(a[0],a[1],a[2]),null!==this.data.textAlignment&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class TextWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,a,i){const n=this.annotationStorage;for(const s of this._getElementsByName(e.name,e.id))s.domElement&&(s.domElement[t]=a),n.setValue(s.id,{[i]:a})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let a=null;if(this.renderForms){const i=e.getValue(t,{value:this.data.fieldValue});let n=i.value||"";const s=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;s&&n.length>s&&(n=n.slice(0,s));let r=i.formattedValue||this.data.textContent?.join("\n")||null;r&&this.data.comb&&(r=r.replaceAll(/\s+/g,""));const o={userValue:n,formattedValue:r,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(a=document.createElement("textarea"),a.textContent=r??n,this.data.doNotScroll&&(a.style.overflowY="hidden")):(a=document.createElement("input"),a.type="text",a.setAttribute("value",r??n),this.data.doNotScroll&&(a.style.overflowX="hidden")),this.data.hasOwnCanvas&&(a.hidden=!0),d.add(a),a.setAttribute("data-element-id",t),a.disabled=this.data.readOnly,a.name=this.data.fieldName,a.tabIndex=c,this._setRequired(a,this.data.required),s&&(a.maxLength=s),a.addEventListener("input",(i=>{e.setValue(t,{value:i.target.value}),this.setPropertyOnSiblings(a,"value",i.target.value,"value"),o.formattedValue=null})),a.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue??"";a.value=o.userValue=t,o.formattedValue=null}));let l=e=>{const{formattedValue:t}=o;null!=t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){a.addEventListener("focus",(e=>{if(o.focused)return;const{target:t}=e;o.userValue&&(t.value=o.userValue),o.lastCommittedValue=t.value,o.commitKey=1,this.data.actions?.Focus||(o.focused=!0)})),a.addEventListener("updatefromsandbox",(a=>{this.showElementAndHideCanvas(a.target);const i={value(a){o.userValue=a.detail.value??"",e.setValue(t,{value:o.userValue.toString()}),a.target.value=o.userValue},formattedValue(a){const{formattedValue:i}=a.detail;o.formattedValue=i,null!=i&&a.target!==document.activeElement&&(a.target.value=i),e.setValue(t,{formattedValue:i})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:a=>{const{charLimit:i}=a.detail,{target:n}=a;if(0===i)return void n.removeAttribute("maxLength");n.setAttribute("maxLength",i);let s=o.userValue;!s||s.length<=i||(s=s.slice(0,i),n.value=o.userValue=s,e.setValue(t,{value:s}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:s,willCommit:!0,commitKey:1,selStart:n.selectionStart,selEnd:n.selectionEnd}}))}};this._dispatchEventFromSandbox(i,a)})),a.addEventListener("keydown",(e=>{o.commitKey=1;let a=-1;if("Escape"===e.key?a=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(o.commitKey=3):a=2,-1===a)return;const{value:i}=e.target;o.lastCommittedValue!==i&&(o.lastCommittedValue=i,o.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:a,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));const i=l;l=null,a.addEventListener("blur",(e=>{if(!o.focused||!e.relatedTarget)return;this.data.actions?.Blur||(o.focused=!1);const{value:a}=e.target;o.userValue=a,o.lastCommittedValue!==a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:a,willCommit:!0,commitKey:o.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),i(e)})),this.data.actions?.Keystroke&&a.addEventListener("beforeinput",(e=>{o.lastCommittedValue=null;const{data:a,target:i}=e,{value:n,selectionStart:s,selectionEnd:r}=i;let l=s,c=r;switch(e.inputType){case"deleteWordBackward":{const e=n.substring(0,s).match(/\w*[^\w]*$/);e&&(l-=e[0].length);break}case"deleteWordForward":{const e=n.substring(s).match(/^[^\w]*\w*/);e&&(c+=e[0].length);break}case"deleteContentBackward":s===r&&(l-=1);break;case"deleteContentForward":s===r&&(c+=1)}e.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:n,change:a||"",willCommit:!1,selStart:l,selEnd:c}})})),this._setEventListeners(a,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(l&&a.addEventListener("blur",l),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/s;a.classList.add("comb"),a.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else a=document.createElement("div"),a.textContent=this.data.fieldValue,a.style.verticalAlign="middle",a.style.display="table-cell",this.data.hasOwnCanvas&&(a.hidden=!0);return this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class SignatureWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class CheckboxWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,a=t.id;let i=e.getValue(a,{value:t.exportValue===t.fieldValue}).value;"string"==typeof i&&(i="Off"!==i,e.setValue(a,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return d.add(n),n.setAttribute("data-element-id",a),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=c,n.addEventListener("change",(i=>{const{name:n,checked:s}=i.target;for(const i of this._getElementsByName(n,a)){const a=s&&i.exportValue===t.exportValue;i.domElement&&(i.domElement.checked=a),e.setValue(i.id,{value:a})}e.setValue(a,{value:s})})),n.addEventListener("resetform",(e=>{const a=t.defaultFieldValue||"Off";e.target.checked=a===t.exportValue})),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",(t=>{const i={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(a,{value:t.target.checked})}};this._dispatchEventFromSandbox(i,t)})),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,a=t.id;let i=e.getValue(a,{value:t.fieldValue===t.buttonValue}).value;if("string"==typeof i&&(i=i!==t.buttonValue,e.setValue(a,{value:i})),i)for(const i of this._getElementsByName(t.fieldName,a))e.setValue(i.id,{value:!1});const n=document.createElement("input");if(d.add(n),n.setAttribute("data-element-id",a),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=c,n.addEventListener("change",(t=>{const{name:i,checked:n}=t.target;for(const t of this._getElementsByName(i,a))e.setValue(t.id,{value:!1});e.setValue(a,{value:n})})),n.addEventListener("resetform",(e=>{const a=t.defaultFieldValue;e.target.checked=null!=a&&a===t.buttonValue})),this.enableScripting&&this.hasJSActions){const i=t.buttonValue;n.addEventListener("updatefromsandbox",(t=>{const n={value:t=>{const n=i===t.detail.value;for(const i of this._getElementsByName(t.target.name)){const t=n&&i.id===a;i.domElement&&(i.domElement.checked=t),e.setValue(i.id,{value:t})}}};this._dispatchEventFromSandbox(n,t)})),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class PushButtonWidgetAnnotationElement extends LinkAnnotationElement{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(e.title=this.data.alternativeText);const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({},e)}))),e}}class ChoiceWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,a=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");d.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=c;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue;for(const e of i.options)e.selected=e.value===t}));for(const e of this.data.options){const t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,a.value.includes(e.exportValue)&&(t.setAttribute("selected",!0),n=!1),i.append(t)}let s=null;if(n){const e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),i.prepend(e),s=()=>{e.remove(),i.removeEventListener("input",s),s=null},i.addEventListener("input",s)}const r=e=>{const t=e?"value":"textContent",{options:a,multiple:n}=i;return n?Array.prototype.filter.call(a,(e=>e.selected)).map((e=>e[t])):-1===a.selectedIndex?null:a[a.selectedIndex][t]};let o=r(!1);const l=e=>{const t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",(a=>{const n={value(a){s?.();const n=a.detail.value,l=new Set(Array.isArray(n)?n:[n]);for(const e of i.options)e.selected=l.has(e.value);e.setValue(t,{value:r(!0)}),o=r(!1)},multipleSelection(e){i.multiple=!0},remove(a){const n=i.options,s=a.detail.remove;if(n[s].selected=!1,i.remove(s),n.length>0){-1===Array.prototype.findIndex.call(n,(e=>e.selected))&&(n[0].selected=!0)}e.setValue(t,{value:r(!0),items:l(a)}),o=r(!1)},clear(a){for(;0!==i.length;)i.remove(0);e.setValue(t,{value:null,items:[]}),o=r(!1)},insert(a){const{index:n,displayValue:s,exportValue:c}=a.detail.insert,d=i.children[n],u=document.createElement("option");u.textContent=s,u.value=c,d?d.before(u):i.append(u),e.setValue(t,{value:r(!0),items:l(a)}),o=r(!1)},items(a){const{items:n}=a.detail;for(;0!==i.length;)i.remove(0);for(const e of n){const{displayValue:t,exportValue:a}=e,n=document.createElement("option");n.textContent=t,n.value=a,i.append(n)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:r(!0),items:l(a)}),o=r(!1)},indices(a){const i=new Set(a.detail.indices);for(const e of a.target.options)e.selected=i.has(e.index);e.setValue(t,{value:r(!0)}),o=r(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(n,a)})),i.addEventListener("input",(a=>{const i=r(!0);e.setValue(t,{value:i}),a.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(e=>e.target.value))):i.addEventListener("input",(function(a){e.setValue(t,{value:r(!0)})})),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class PopupAnnotationElement extends AnnotationElement{constructor(e){const{data:t,elements:a}=e;super(e,{isRenderable:AnnotationElement._hasPopupData(t)}),this.elements=a}render(){this.container.classList.add("popupAnnotation");const e=new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const a of this.elements)a.popup=e,t.push(a.data.id),a.addHighlightArea();return this.container.setAttribute("aria-controls",t.map((e=>`${i.AnnotationPrefix}${e}`)).join(",")),this.container}}class PopupElement{#n=this.#s.bind(this);#r=this.#o.bind(this);#l=this.#c.bind(this);#d=this.#u.bind(this);#h=null;#p=null;#m=null;#f=null;#g=null;#y=null;#v=null;#b=!1;#A=null;#_=null;#x=null;#w=null;#C=!1;constructor({container:e,color:t,elements:a,titleObj:i,modificationDate:s,contentsObj:r,richText:o,parent:l,rect:c,parentRect:d,open:u}){this.#p=e,this.#w=i,this.#m=r,this.#x=o,this.#y=l,this.#h=t,this.#_=c,this.#v=d,this.#g=a,this.#f=n.PDFDateString.toDateObject(s),this.trigger=a.flatMap((e=>e.getElementsToTriggerPopup()));for(const e of this.trigger)e.addEventListener("click",this.#d),e.addEventListener("mouseenter",this.#l),e.addEventListener("mouseleave",this.#r),e.classList.add("popupTriggerArea");for(const e of a)e.container?.addEventListener("keydown",this.#n);this.#p.hidden=!0,u&&this.#u()}render(){if(this.#A)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:a,pageX:n,pageY:s}}}=this.#y,r=this.#A=document.createElement("div");if(r.className="popup",this.#h){const e=r.style.outlineColor=i.Util.makeHexColor(...this.#h);if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))r.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`;else{const e=.7;r.style.backgroundColor=i.Util.makeHexColor(...this.#h.map((t=>Math.floor(e*(255-t)+t))))}}const o=document.createElement("span");o.className="header";const c=document.createElement("h1");if(o.append(c),({dir:c.dir,str:c.textContent}=this.#w),r.append(o),this.#f){const e=document.createElement("span");e.classList.add("popupDate"),e.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),e.setAttribute("data-l10n-args",JSON.stringify({date:this.#f.toLocaleDateString(),time:this.#f.toLocaleTimeString()})),o.append(e)}const d=this.#m,u=this.#x;if(!u?.str||d?.str&&d.str!==u.str){const e=this._formatContents(d);r.append(e)}else l.XfaLayer.render({xfaHtml:u.html,intent:"richText",div:r}),r.lastChild.classList.add("richText","popupContent");let h=!!this.#v,p=h?this.#v:this.#_;for(const e of this.#g)if(!p||null!==i.Util.intersect(e.data.rect,p)){p=e.data.rect,h=!0;break}const m=i.Util.normalizeRect([p[0],e[3]-p[1]+e[1],p[2],e[3]-p[3]+e[1]]),f=h?p[2]-p[0]+5:0,g=m[0]+f,y=m[1],{style:v}=this.#p;v.left=100*(g-n)/t+"%",v.top=100*(y-s)/a+"%",this.#p.append(r)}_formatContents({str:e,dir:t}){const a=document.createElement("p");a.classList.add("popupContent"),a.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let e=0,t=i.length;e<t;++e){const n=i[e];a.append(document.createTextNode(n)),e<t-1&&a.append(document.createElement("br"))}return a}#s(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&this.#b)&&this.#u()}#u(){this.#b=!this.#b,this.#b?(this.#c(),this.#p.addEventListener("click",this.#d),this.#p.addEventListener("keydown",this.#n)):(this.#o(),this.#p.removeEventListener("click",this.#d),this.#p.removeEventListener("keydown",this.#n))}#c(){this.#A||this.render(),this.isVisible?this.#b&&this.#p.classList.add("focused"):(this.#p.hidden=!1,this.#p.style.zIndex=parseInt(this.#p.style.zIndex)+1e3)}#o(){this.#p.classList.remove("focused"),!this.#b&&this.isVisible&&(this.#p.hidden=!0,this.#p.style.zIndex=parseInt(this.#p.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#p.hidden=!0)}maybeShow(){this.#C&&(this.#C=!1,this.#p.hidden=!1)}get isVisible(){return!1===this.#p.hidden}}class FreeTextAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=i.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const a=document.createElement("span");a.textContent=t,e.append(a)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class LineAnnotationElement extends AnnotationElement{#E=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:t,height:a}=u(e.rect),i=this.svgFactory.create(t,a,!0),n=this.#E=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#E}addHighlightArea(){this.container.classList.add("highlightArea")}}class SquareAnnotationElement extends AnnotationElement{#S=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:t,height:a}=u(e.rect),i=this.svgFactory.create(t,a,!0),n=e.borderStyle.width,s=this.#S=this.svgFactory.createElement("svg:rect");return s.setAttribute("x",n/2),s.setAttribute("y",n/2),s.setAttribute("width",t-n),s.setAttribute("height",a-n),s.setAttribute("stroke-width",n||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#S}addHighlightArea(){this.container.classList.add("highlightArea")}}class CircleAnnotationElement extends AnnotationElement{#M=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:t,height:a}=u(e.rect),i=this.svgFactory.create(t,a,!0),n=e.borderStyle.width,s=this.#M=this.svgFactory.createElement("svg:ellipse");return s.setAttribute("cx",t/2),s.setAttribute("cy",a/2),s.setAttribute("rx",t/2-n/2),s.setAttribute("ry",a/2-n/2),s.setAttribute("stroke-width",n||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#M}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolylineAnnotationElement extends AnnotationElement{#T=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:t,height:a}=u(e.rect),i=this.svgFactory.create(t,a,!0);let n=[];for(const t of e.vertices){const a=t.x-e.rect[0],i=e.rect[3]-t.y;n.push(a+","+i)}n=n.join(" ");const s=this.#T=this.svgFactory.createElement(this.svgElementName);return s.setAttribute("points",n),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#T}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolygonAnnotationElement extends PolylineAnnotationElement{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class CaretAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class InkAnnotationElement extends AnnotationElement{#k=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=i.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:t,height:a}=u(e.rect),i=this.svgFactory.create(t,a,!0);for(const t of e.inkLists){let a=[];for(const i of t){const t=i.x-e.rect[0],n=e.rect[3]-i.y;a.push(`${t},${n}`)}a=a.join(" ");const n=this.svgFactory.createElement(this.svgElementName);this.#k.push(n),n.setAttribute("points",a),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),i.append(n)}return this.container.append(i),this.container}getElementsToTriggerPopup(){return this.#k}addHighlightArea(){this.container.classList.add("highlightArea")}}class HighlightAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class UnderlineAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class SquigglyAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class StrikeOutAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class StampAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class FileAttachmentAnnotationElement extends AnnotationElement{#P=null;constructor(e){super(e,{isRenderable:!0});const{filename:t,content:a}=this.data.file;this.filename=(0,n.getFilenameFromUrl)(t,!0),this.content=a,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:t,content:a})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let a;t.hasAppearance||0===t.fillAlpha?a=document.createElement("div"):(a=document.createElement("img"),a.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(a.style=`filter: opacity(${Math.round(100*t.fillAlpha)}%);`)),a.addEventListener("dblclick",this.#D.bind(this)),this.#P=a;const{isMac:n}=i.FeatureTest.platform;return e.addEventListener("keydown",(e=>{"Enter"===e.key&&(n?e.metaKey:e.ctrlKey)&&this.#D()})),!t.popupRef&&this.hasPopupData?this._createPopup():a.classList.add("popupTriggerArea"),e.append(a),e}getElementsToTriggerPopup(){return this.#P}addHighlightArea(){this.container.classList.add("highlightArea")}#D(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class AnnotationLayer{#R=null;#F=null;#I=new Map;constructor({div:e,accessibilityManager:t,annotationCanvasMap:a,page:i,viewport:n}){this.div=e,this.#R=t,this.#F=a,this.page=i,this.viewport=n,this.zIndex=0}#O(e,t){const a=e.firstChild||e;a.id=`${i.AnnotationPrefix}${t}`,this.div.append(e),this.#R?.moveElementInDOM(this.div,e,a,!1)}async render(e){const{annotations:t}=e,a=this.div;(0,n.setLayerDimensions)(a,this.viewport);const r=new Map,o={data:null,layer:a,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new n.DOMSVGFactory,annotationStorage:e.annotationStorage||new s.AnnotationStorage,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const e of t){if(e.noHTML)continue;const t=e.annotationType===i.AnnotationType.POPUP;if(t){const t=r.get(e.id);if(!t)continue;o.elements=t}else{const{width:t,height:a}=u(e.rect);if(t<=0||a<=0)continue}o.data=e;const a=AnnotationElementFactory.create(o);if(!a.isRenderable)continue;if(!t&&e.popupRef){const t=r.get(e.popupRef);t?t.push(a):r.set(e.popupRef,[a])}a.annotationEditorType>0&&this.#I.set(a.data.id,a);const n=a.render();e.hidden&&(n.style.visibility="hidden"),this.#O(n,e.id)}this.#L()}update({viewport:e}){const t=this.div;this.viewport=e,(0,n.setLayerDimensions)(t,{rotation:e.rotation}),this.#L(),t.hidden=!1}#L(){if(!this.#F)return;const e=this.div;for(const[t,a]of this.#F){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;const{firstChild:n}=i;n?"CANVAS"===n.nodeName?n.replaceWith(a):n.before(a):i.append(a)}this.#F.clear()}getEditableAnnotations(){return Array.from(this.#I.values())}getEditableAnnotation(e){return this.#I.get(e)}}},780:(e,t,a)=>{a.d(t,{AnnotationStorage:()=>AnnotationStorage,PrintAnnotationStorage:()=>PrintAnnotationStorage,SerializableEmpty:()=>r});var i=a(266),n=a(796),s=a(825);const r=Object.freeze({map:null,hash:"",transfer:void 0});class AnnotationStorage{#j=!1;#N=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const a=this.#N.get(e);return void 0===a?t:Object.assign(t,a)}getRawValue(e){return this.#N.get(e)}remove(e){if(this.#N.delete(e),0===this.#N.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(const e of this.#N.values())if(e instanceof n.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(e,t){const a=this.#N.get(e);let i=!1;if(void 0!==a)for(const[e,n]of Object.entries(t))a[e]!==n&&(i=!0,a[e]=n);else i=!0,this.#N.set(e,t);i&&this.#B(),t instanceof n.AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#N.has(e)}getAll(){return this.#N.size>0?(0,i.objectFromMap)(this.#N):null}setAll(e){for(const[t,a]of Object.entries(e))this.setValue(t,a)}get size(){return this.#N.size}#B(){this.#j||(this.#j=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#j&&(this.#j=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new PrintAnnotationStorage(this)}get serializable(){if(0===this.#N.size)return r;const e=new Map,t=new s.MurmurHash3_64,a=[],i=Object.create(null);let o=!1;for(const[a,s]of this.#N){const r=s instanceof n.AnnotationEditor?s.serialize(!1,i):s;r&&(e.set(a,r),t.update(`${a}:${JSON.stringify(r)}`),o||=!!r.bitmap)}if(o)for(const t of e.values())t.bitmap&&a.push(t.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:a}:r}}class PrintAnnotationStorage extends AnnotationStorage{#q;constructor(e){super();const{map:t,hash:a,transfer:i}=e.serializable,n=structuredClone(t,i?{transfer:i}:null);this.#q={map:n,hash:a,transfer:i}}get print(){(0,i.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#q}}},406:(e,t,a)=>{a.a(e,(async(e,i)=>{try{a.d(t,{PDFDataRangeTransport:()=>PDFDataRangeTransport,PDFWorker:()=>PDFWorker,build:()=>F,getDocument:()=>M,version:()=>R});var n=a(266),s=a(780),r=a(473),o=a(742),l=a(738),c=a(250),d=a(368),u=a(694),h=a(472),p=a(890),m=a(92),f=a(171),g=a(474),y=a(498),v=a(521),b=e([l,y]);[l,y]=b.then?(await b)():b;const A=65536,_=100,x=5e3,w=n.isNodeJS?l.NodeCanvasFactory:r.DOMCanvasFactory,C=n.isNodeJS?l.NodeCMapReaderFactory:r.DOMCMapReaderFactory,E=n.isNodeJS?l.NodeFilterFactory:r.DOMFilterFactory,S=n.isNodeJS?l.NodeStandardFontDataFactory:r.DOMStandardFontDataFactory;function M(e){if("string"==typeof e||e instanceof URL?e={url:e}:(0,n.isArrayBuffer)(e)&&(e={data:e}),"object"!=typeof e)throw new Error("Invalid parameter in getDocument, need parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const t=new PDFDocumentLoadingTask,{docId:a}=t,i=e.url?k(e.url):null,s=e.data?P(e.data):null,o=e.httpHeaders||null,l=!0===e.withCredentials,c=e.password??null,h=e.range instanceof PDFDataRangeTransport?e.range:null,p=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:A;let v=e.worker instanceof PDFWorker?e.worker:null;const b=e.verbosity,_="string"!=typeof e.docBaseUrl||(0,r.isDataScheme)(e.docBaseUrl)?null:e.docBaseUrl,x="string"==typeof e.cMapUrl?e.cMapUrl:null,M=!1!==e.cMapPacked,D=e.CMapReaderFactory||C,R="string"==typeof e.standardFontDataUrl?e.standardFontDataUrl:null,F=e.StandardFontDataFactory||S,I=!0!==e.stopAtErrors,O=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,L=!1!==e.isEvalSupported,j="boolean"==typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!n.isNodeJS,N=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,B="boolean"==typeof e.disableFontFace?e.disableFontFace:n.isNodeJS,q=!0===e.fontExtraProperties,z=!0===e.enableXfa,U=e.ownerDocument||globalThis.document,H=!0===e.disableRange,W=!0===e.disableStream,$=!0===e.disableAutoFetch,V=!0===e.pdfBug,G=h?h.length:e.length??NaN,X="boolean"==typeof e.useSystemFonts?e.useSystemFonts:!n.isNodeJS&&!B,K="boolean"==typeof e.useWorkerFetch?e.useWorkerFetch:D===r.DOMCMapReaderFactory&&F===r.DOMStandardFontDataFactory&&x&&R&&(0,r.isValidFetchUrl)(x,document.baseURI)&&(0,r.isValidFetchUrl)(R,document.baseURI),Y=e.canvasFactory||new w({ownerDocument:U}),J=e.filterFactory||new E({docId:a,ownerDocument:U});(0,n.setVerbosityLevel)(b);const Q={canvasFactory:Y,filterFactory:J};if(K||(Q.cMapReaderFactory=new D({baseUrl:x,isCompressed:M}),Q.standardFontDataFactory=new F({baseUrl:R})),!v){const e={verbosity:b,port:d.GlobalWorkerOptions.workerPort};v=e.port?PDFWorker.fromPort(e):new PDFWorker(e),t._worker=v}const Z={docId:a,apiVersion:"4.0.269",data:s,password:c,disableAutoFetch:$,rangeChunkSize:p,length:G,docBaseUrl:_,enableXfa:z,evaluatorOptions:{maxImageSize:O,disableFontFace:B,ignoreErrors:I,isEvalSupported:L,isOffscreenCanvasSupported:j,canvasMaxAreaInBytes:N,fontExtraProperties:q,useSystemFonts:X,cMapUrl:K?x:null,standardFontDataUrl:K?R:null}},ee={ignoreErrors:I,isEvalSupported:L,disableFontFace:B,fontExtraProperties:q,enableXfa:z,ownerDocument:U,disableAutoFetch:$,pdfBug:V,styleElement:null};return v.promise.then((function(){if(t.destroyed)throw new Error("Loading aborted");const e=T(v,Z),c=new Promise((function(e){let t;if(h)t=new m.PDFDataTransportStream({length:G,initialData:h.initialData,progressiveDone:h.progressiveDone,contentDispositionFilename:h.contentDispositionFilename,disableRange:H,disableStream:W},h);else if(!s){t=(e=>n.isNodeJS?new y.PDFNodeStream(e):(0,r.isValidFetchUrl)(e.url)?new f.PDFFetchStream(e):new g.PDFNetworkStream(e))({url:i,length:G,httpHeaders:o,withCredentials:l,rangeChunkSize:p,disableRange:H,disableStream:W})}e(t)}));return Promise.all([e,c]).then((function([e,i]){if(t.destroyed)throw new Error("Loading aborted");const n=new u.MessageHandler(a,e,v.port),s=new WorkerTransport(n,t,i,ee,Q);t._transport=s,n.send("Ready",null)}))})).catch(t._capability.reject),t}async function T(e,t){if(e.destroyed)throw new Error("Worker was destroyed");const a=await e.messageHandler.sendWithPromise("GetDocRequest",t,t.data?[t.data.buffer]:null);if(e.destroyed)throw new Error("Worker was destroyed");return a}function k(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch{if(n.isNodeJS&&"string"==typeof e)return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function P(e){if(n.isNodeJS&&"undefined"!=typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"==typeof e)return(0,n.stringToBytes)(e);if("object"==typeof e&&!isNaN(e?.length)||(0,n.isArrayBuffer)(e))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#z=0;constructor(){this._capability=new n.PromiseCapability,this._transport=null,this._worker=null,this.docId="d"+PDFDocumentLoadingTask.#z++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await(this._transport?.destroy())}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class PDFDataRangeTransport{constructor(e,t,a=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=a,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new n.PromiseCapability}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const a of this._rangeListeners)a(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(const a of this._progressListeners)a(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(const t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,n.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,n.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class PDFPageProxy{#U=null;#H=!1;constructor(e,t,a,i=!1){this._pageIndex=e,this._pageInfo=t,this._transport=a,this._stats=i?new r.StatTimer:null,this._pdfBug=i,this.commonObjs=a.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:a=0,offsetY:i=0,dontFlip:n=!1}={}){return new r.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:a,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){const t=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,n.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:a="display",annotationMode:i=n.AnnotationMode.ENABLE,transform:s=null,background:r=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null}){this._stats?.time("Overall");const u=this._transport.getRenderingIntent(a,i,d);this.#H=!1,this.#W(),o||(o=this._transport.getOptionalContentConfig());let h=this._intentStates.get(u.cacheKey);h||(h=Object.create(null),this._intentStates.set(u.cacheKey,h)),h.streamReaderCancelTimeout&&(clearTimeout(h.streamReaderCancelTimeout),h.streamReaderCancelTimeout=null);const p=!!(u.renderingIntent&n.RenderingIntentFlag.PRINT);h.displayReadyCapability||(h.displayReadyCapability=new n.PromiseCapability,h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(u));const m=e=>{h.renderTasks.delete(f),(this._maybeCleanupAfterRender||p)&&(this.#H=!0),this.#$(!p),e?(f.capability.reject(e),this._abortOperatorList({intentState:h,reason:e instanceof Error?e:new Error(e)})):f.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},f=new InternalRenderTask({callback:m,params:{canvasContext:e,viewport:t,transform:s,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:h.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!p,pdfBug:this._pdfBug,pageColors:c});(h.renderTasks||=new Set).add(f);const g=f.task;return Promise.all([h.displayReadyCapability.promise,o]).then((([e,t])=>{this.destroyed?m():(this._stats?.time("Rendering"),f.initializeGraphics({transparency:e,optionalContentConfig:t}),f.operatorListChanged())})).catch(m),g}getOperatorList({intent:e="display",annotationMode:t=n.AnnotationMode.ENABLE,printAnnotationStorage:a=null}={}){const i=this._transport.getRenderingIntent(e,t,a,!0);let s,r=this._intentStates.get(i.cacheKey);return r||(r=Object.create(null),this._intentStates.set(i.cacheKey,r)),r.opListReadCapability||(s=Object.create(null),s.operatorListChanged=function(){r.operatorList.lastChunk&&(r.opListReadCapability.resolve(r.operatorList),r.renderTasks.delete(s))},r.opListReadCapability=new n.PromiseCapability,(r.renderTasks||=new Set).add(s),r.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(i)),r.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then((e=>v.XfaText.textContent(e)));const t=this.streamTextContent(e);return new Promise((function(e,a){const i=t.getReader(),n={items:[],styles:Object.create(null)};!function t(){i.read().then((function({value:a,done:i}){i?e(n):(Object.assign(n.styles,a.styles),n.items.push(...a.items),t())}),a)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const a of t.renderTasks)e.push(a.completed),a.cancel();return this.objs.clear(),this.#H=!1,this.#W(),Promise.all(e)}cleanup(e=!1){this.#H=!0;const t=this.#$(!1);return e&&t&&(this._stats&&=new r.StatTimer),t}#$(e=!1){if(this.#W(),!this.#H||this.destroyed)return!1;if(e)return this.#U=setTimeout((()=>{this.#U=null,this.#$(!1)}),x),!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#H=!1,!0}#W(){this.#U&&(clearTimeout(this.#U),this.#U=null)}_startRenderPage(e,t){const a=this._intentStates.get(t);a&&(this._stats?.timeEnd("Page Request"),a.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let a=0,i=e.length;a<i;a++)t.operatorList.fnArray.push(e.fnArray[a]),t.operatorList.argsArray.push(e.argsArray[a]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const e of t.renderTasks)e.operatorListChanged();e.lastChunk&&this.#$(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:a}){const{map:i,transfer:n}=a,s=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i},n).getReader(),r=this._intentStates.get(t);r.streamReader=s;const o=()=>{s.read().then((({value:e,done:t})=>{t?r.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,r),o())}),(e=>{if(r.streamReader=null,!this._transport.destroyed){if(r.operatorList){r.operatorList.lastChunk=!0;for(const e of r.renderTasks)e.operatorListChanged();this.#$(!0)}if(r.displayReadyCapability)r.displayReadyCapability.reject(e);else{if(!r.opListReadCapability)throw e;r.opListReadCapability.reject(e)}}}))};o()}_abortOperatorList({intentState:e,reason:t,force:a=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!a){if(e.renderTasks.size>0)return;if(t instanceof r.RenderingCancelledException){let a=_;return t.extraDelay>0&&t.extraDelay<1e3&&(a+=t.extraDelay),void(e.streamReaderCancelTimeout=setTimeout((()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})}),a))}}if(e.streamReader.cancel(new n.AbortException(t.message)).catch((()=>{})),e.streamReader=null,!this._transport.destroyed){for(const[t,a]of this._intentStates)if(a===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}class LoopbackPort{#V=new Set;#G=Promise.resolve();postMessage(e,t){const a={data:structuredClone(e,t?{transfer:t}:null)};this.#G.then((()=>{for(const e of this.#V)e.call(this,a)}))}addEventListener(e,t){this.#V.add(t)}removeEventListener(e,t){this.#V.delete(t)}terminate(){this.#V.clear()}}const D={isWorkerDisabled:!1,fakeWorkerId:0};n.isNodeJS&&(D.isWorkerDisabled=!0,d.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),D.isSameOrigin=function(e,t){let a;try{if(a=new URL(e),!a.origin||"null"===a.origin)return!1}catch{return!1}const i=new URL(t,a);return a.origin===i.origin},D.createCDNWrapper=function(e){const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};class PDFWorker{static#X;constructor({name:e=null,port:t=null,verbosity:a=(0,n.getVerbosityLevel)()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=a,this._readyCapability=new n.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,t){if(PDFWorker.#X?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");return(PDFWorker.#X||=new WeakMap).set(t,this),void this._initializeFromPort(t)}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new u.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!D.isWorkerDisabled&&!PDFWorker.#K){let{workerSrc:e}=PDFWorker;try{D.isSameOrigin(window.location.href,e)||(e=D.createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),a=new u.MessageHandler("main","worker",t),i=()=>{t.removeEventListener("error",n),a.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=()=>{this._webWorker||i()};t.addEventListener("error",n),a.on("test",(e=>{t.removeEventListener("error",n),this.destroyed?i():e?(this._messageHandler=a,this._port=t,this._webWorker=t,this._readyCapability.resolve(),a.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),a.destroy(),t.terminate())})),a.on("ready",(e=>{if(t.removeEventListener("error",n),this.destroyed)i();else try{s()}catch{this._setupFakeWorker()}}));const s=()=>{const e=new Uint8Array;a.send("test",e,[e.buffer])};return void s()}catch{(0,n.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){D.isWorkerDisabled||((0,n.warn)("Setting up fake worker."),D.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new LoopbackPort;this._port=t;const a="fake"+D.fakeWorkerId++,i=new u.MessageHandler(a+"_worker",a,t);e.setup(i,t);const n=new u.MessageHandler(a,a+"_worker",t);this._messageHandler=n,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#X?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const t=this.#X?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new PDFWorker(e)}static get workerSrc(){if(d.GlobalWorkerOptions.workerSrc)return d.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#K(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return(0,n.shadow)(this,"_setupFakeWorkerGlobal",(async()=>{if(this.#K)return this.#K;return(await import(this.workerSrc)).WorkerMessageHandler})())}}class WorkerTransport{#Y=new Map;#J=new Map;#Q=new Map;#Z=null;constructor(e,t,a,i,s){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new o.FontLoader({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=a,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new n.PromiseCapability,this.setupMessageHandler()}#ee(e,t=null){const a=this.#Y.get(e);if(a)return a;const i=this.messageHandler.sendWithPromise(e,t);return this.#Y.set(e,i),i}get annotationStorage(){return(0,n.shadow)(this,"annotationStorage",new s.AnnotationStorage)}getRenderingIntent(e,t=n.AnnotationMode.ENABLE,a=null,i=!1){let r=n.RenderingIntentFlag.DISPLAY,o=s.SerializableEmpty;switch(e){case"any":r=n.RenderingIntentFlag.ANY;break;case"display":break;case"print":r=n.RenderingIntentFlag.PRINT;break;default:(0,n.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case n.AnnotationMode.DISABLE:r+=n.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case n.AnnotationMode.ENABLE:break;case n.AnnotationMode.ENABLE_FORMS:r+=n.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case n.AnnotationMode.ENABLE_STORAGE:r+=n.RenderingIntentFlag.ANNOTATIONS_STORAGE;o=(r&n.RenderingIntentFlag.PRINT&&a instanceof s.PrintAnnotationStorage?a:this.annotationStorage).serializable;break;default:(0,n.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return i&&(r+=n.RenderingIntentFlag.OPLIST),{renderingIntent:r,cacheKey:`${r}_${o.hash}`,annotationStorageSerializable:o}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new n.PromiseCapability,this.#Z?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const t of this.#J.values())e.push(t._destroy());this.#J.clear(),this.#Q.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Y.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new n.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,n.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function({value:e,done:a}){a?t.close():((0,n.assert)(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{const a=new n.PromiseCapability,i=this._fullReader;return i.headersReady.then((()=>{i.isStreamingSupported&&i.isRangeSupported||(this._lastProgress&&t.onProgress?.(this._lastProgress),i.onProgress=e=>{t.onProgress?.({loaded:e.loaded,total:e.total})}),a.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})}),a.reject),a.promise})),e.on("GetRangeReader",((e,t)=>{(0,n.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const a=this._networkStream.getRangeReader(e.begin,e.end);a?(t.onPull=()=>{a.read().then((function({value:e,done:a}){a?t.close():((0,n.assert)(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{a.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(e,this))})),e.on("DocException",(function(e){let a;switch(e.name){case"PasswordException":a=new n.PasswordException(e.message,e.code);break;case"InvalidPDFException":a=new n.InvalidPDFException(e.message);break;case"MissingPDFException":a=new n.MissingPDFException(e.message);break;case"UnexpectedResponseException":a=new n.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":a=new n.UnknownErrorException(e.message,e.details);break;default:(0,n.unreachable)("DocException - expected a valid Error.")}t._capability.reject(a)})),e.on("PasswordRequest",(e=>{if(this.#Z=new n.PromiseCapability,t.onPassword){const a=e=>{e instanceof Error?this.#Z.reject(e):this.#Z.resolve({password:e})};try{t.onPassword(a,e.code)}catch(e){this.#Z.reject(e)}}else this.#Z.reject(new n.PasswordException(e.message,e.code));return this.#Z.promise})),e.on("DataLoaded",(e=>{t.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{if(this.destroyed)return;this.#J.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(([t,a,i])=>{if(!this.destroyed&&!this.commonObjs.has(t))switch(a){case"Font":const s=this._params;if("error"in i){const e=i.error;(0,n.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(t,e);break}const r=s.pdfBug&&globalThis.FontInspector?.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,l=new o.FontFaceObject(i,{isEvalSupported:s.isEvalSupported,disableFontFace:s.disableFontFace,ignoreErrors:s.ignoreErrors,inspectFont:r});this.fontLoader.bind(l).catch((a=>e.sendWithPromise("FontFallback",{id:t}))).finally((()=>{!s.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(t,l)}));break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(t,i);break;default:throw new Error(`Got unknown common object type ${a}`)}})),e.on("obj",(([e,t,a,i])=>{if(this.destroyed)return;const s=this.#J.get(t);if(!s.objs.has(e))if(0!==s._intentStates.size)switch(a){case"Image":if(s.objs.resolve(e,i),i){let e;if(i.bitmap){const{width:t,height:a}=i;e=t*a*4}else e=i.data?.length||0;e>n.MAX_IMAGE_SIZE_TO_CACHE&&(s._maybeCleanupAfterRender=!0)}break;case"Pattern":s.objs.resolve(e,i);break;default:throw new Error(`Got unknown object type ${a}`)}else i?.bitmap?.close()})),e.on("DocProgress",(e=>{this.destroyed||t.onProgress?.({loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,n.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally((()=>{this.annotationStorage.resetModified()}))}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,a=this.#Q.get(t);if(a)return a;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");const a=new PDFPageProxy(t,e,this,this._params.pdfBug);return this.#J.set(t,a),a}));return this.#Q.set(t,i),i}getPageIndex(e){return"object"!=typeof e||null===e||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#ee("GetFieldObjects")}hasJSActions(){return this.#ee("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#ee("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new p.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#Y.get(e);if(t)return t;const a=this.messageHandler.sendWithPromise(e,null).then((e=>({info:e[0],metadata:e[1]?new h.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})));return this.#Y.set(e,a),a}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#J.values()){if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`)}this.commonObjs.clear(),e||this.fontLoader.clear(),this.#Y.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:e,enableXfa:t}=this._params;return(0,n.shadow)(this,"loadingParams",{disableAutoFetch:e,enableXfa:t})}}class PDFObjects{#te=Object.create(null);#ae(e){return this.#te[e]||={capability:new n.PromiseCapability,data:null}}get(e,t=null){if(t){const a=this.#ae(e);return a.capability.promise.then((()=>t(a.data))),null}const a=this.#te[e];if(!a?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return a.data}has(e){const t=this.#te[e];return t?.capability.settled||!1}resolve(e,t=null){const a=this.#ae(e);a.data=t,a.capability.resolve()}clear(){for(const e in this.#te){const{data:t}=this.#te[e];t?.bitmap?.close()}this.#te=Object.create(null)}}class RenderTask{#ie=null;constructor(e){this.#ie=e,this.onContinue=null}get promise(){return this.#ie.capability.promise}cancel(e=0){this.#ie.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#ie.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#ie;return e.form||e.canvas&&t?.size>0}}class InternalRenderTask{static#ne=new WeakSet;constructor({callback:e,params:t,objs:a,commonObjs:i,annotationCanvasMap:s,operatorList:r,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:h=null}){this.callback=e,this.params=t,this.objs=a,this.commonObjs=i,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=h,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!=typeof window,this.cancelled=!1,this.capability=new n.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#ne.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#ne.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:a,viewport:i,transform:n,background:s}=this.params;this.gfx=new c.CanvasGraphics(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:i,transparency:e,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#ne.delete(this._canvas),this.callback(e||new r.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#ne.delete(this._canvas),this.callback())))}}const R="4.0.269",F="f4b396f6c";i()}catch(I){i(I)}}))},822:(e,t,a)=>{a.d(t,{BaseCMapReaderFactory:()=>BaseCMapReaderFactory,BaseCanvasFactory:()=>BaseCanvasFactory,BaseFilterFactory:()=>BaseFilterFactory,BaseSVGFactory:()=>BaseSVGFactory,BaseStandardFontDataFactory:()=>BaseStandardFontDataFactory});var i=a(266);class BaseFilterFactory{constructor(){this.constructor===BaseFilterFactory&&(0,i.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addHighlightHCMFilter(e,t,a,i){return"none"}destroy(e=!1){}}class BaseCanvasFactory{constructor(){this.constructor===BaseCanvasFactory&&(0,i.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const a=this._createCanvas(e,t);return{canvas:a,context:a.getContext("2d")}}reset(e,t,a){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||a<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=a}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){(0,i.unreachable)("Abstract method `_createCanvas` called.")}}class BaseCMapReaderFactory{constructor({baseUrl:e=null,isCompressed:t=!0}){this.constructor===BaseCMapReaderFactory&&(0,i.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":""),a=this.isCompressed?i.CMapCompressionType.BINARY:i.CMapCompressionType.NONE;return this._fetchData(t,a).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)}))}_fetchData(e,t){(0,i.unreachable)("Abstract method `_fetchData` called.")}}class BaseStandardFontDataFactory{constructor({baseUrl:e=null}){this.constructor===BaseStandardFontDataFactory&&(0,i.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetchData(t).catch((e=>{throw new Error(`Unable to load font data at: ${t}`)}))}_fetchData(e){(0,i.unreachable)("Abstract method `_fetchData` called.")}}class BaseSVGFactory{constructor(){this.constructor===BaseSVGFactory&&(0,i.unreachable)("Cannot initialize BaseSVGFactory.")}create(e,t,a=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),a||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if("string"!=typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){(0,i.unreachable)("Abstract method `_createSVG` called.")}}},250:(e,t,a)=>{a.d(t,{CanvasGraphics:()=>CanvasGraphics});var i=a(266),n=a(473);const s="Fill",r="Stroke",o="Shading";function l(e,t){if(!t)return;const a=t[2]-t[0],i=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],a,i),e.clip(n)}class BaseShadingPattern{constructor(){this.constructor===BaseShadingPattern&&(0,i.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,i.unreachable)("Abstract method `getPattern` called.")}}class RadialAxialShadingPattern extends BaseShadingPattern{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const e of this._colorStops)t.addColorStop(e[0],e[1]);return t}getPattern(e,t,a,o){let c;if(o===r||o===s){const s=t.current.getClippedPathBoundingBox(o,(0,n.getCurrentTransform)(e))||[0,0,0,0],r=Math.ceil(s[2]-s[0])||1,d=Math.ceil(s[3]-s[1])||1,u=t.cachedCanvases.getCanvas("pattern",r,d,!0),h=u.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-s[0],-s[1]),a=i.Util.transform(a,[1,0,0,1,s[0],s[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),l(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),c=e.createPattern(u.canvas,"no-repeat");const p=new DOMMatrix(a);c.setTransform(p)}else l(e,this._bbox),c=this._createGradient(e);return c}}function c(e,t,a,i,n,s,r,o){const l=t.coords,c=t.colors,d=e.data,u=4*e.width;let h;l[a+1]>l[i+1]&&(h=a,a=i,i=h,h=s,s=r,r=h),l[i+1]>l[n+1]&&(h=i,i=n,n=h,h=r,r=o,o=h),l[a+1]>l[i+1]&&(h=a,a=i,i=h,h=s,s=r,r=h);const p=(l[a]+t.offsetX)*t.scaleX,m=(l[a+1]+t.offsetY)*t.scaleY,f=(l[i]+t.offsetX)*t.scaleX,g=(l[i+1]+t.offsetY)*t.scaleY,y=(l[n]+t.offsetX)*t.scaleX,v=(l[n+1]+t.offsetY)*t.scaleY;if(m>=v)return;const b=c[s],A=c[s+1],_=c[s+2],x=c[r],w=c[r+1],C=c[r+2],E=c[o],S=c[o+1],M=c[o+2],T=Math.round(m),k=Math.round(v);let P,D,R,F,I,O,L,j;for(let e=T;e<=k;e++){if(e<g){const t=e<m?0:(m-e)/(m-g);P=p-(p-f)*t,D=b-(b-x)*t,R=A-(A-w)*t,F=_-(_-C)*t}else{let t;t=e>v?1:g===v?0:(g-e)/(g-v),P=f-(f-y)*t,D=x-(x-E)*t,R=w-(w-S)*t,F=C-(C-M)*t}let t;t=e<m?0:e>v?1:(m-e)/(m-v),I=p-(p-y)*t,O=b-(b-E)*t,L=A-(A-S)*t,j=_-(_-M)*t;const a=Math.round(Math.min(P,I)),i=Math.round(Math.max(P,I));let n=u*e+4*a;for(let e=a;e<=i;e++)t=(P-e)/(P-I),t<0?t=0:t>1&&(t=1),d[n++]=D-(D-O)*t|0,d[n++]=R-(R-L)*t|0,d[n++]=F-(F-j)*t|0,d[n++]=255}}function d(e,t,a){const i=t.coords,n=t.colors;let s,r;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(i.length/o)-1,d=o-1;for(s=0;s<l;s++){let t=s*o;for(let s=0;s<d;s++,t++)c(e,a,i[t],i[t+1],i[t+o],n[t],n[t+1],n[t+o]),c(e,a,i[t+o+1],i[t+1],i[t+o],n[t+o+1],n[t+1],n[t+o])}break;case"triangles":for(s=0,r=i.length;s<r;s+=3)c(e,a,i[s],i[s+1],i[s+2],n[s],n[s+1],n[s+2]);break;default:throw new Error("illegal figure")}}class MeshShadingPattern extends BaseShadingPattern{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,a){const i=Math.floor(this._bounds[0]),n=Math.floor(this._bounds[1]),s=Math.ceil(this._bounds[2])-i,r=Math.ceil(this._bounds[3])-n,o=Math.min(Math.ceil(Math.abs(s*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(r*e[1]*1.1)),3e3),c=s/o,u=r/l,h={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-n,scaleX:1/c,scaleY:1/u},p=o+4,m=l+4,f=a.getCanvas("mesh",p,m,!1),g=f.context,y=g.createImageData(o,l);if(t){const e=y.data;for(let a=0,i=e.length;a<i;a+=4)e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=255}for(const e of this._figures)d(y,e,h);g.putImageData(y,2,2);return{canvas:f.canvas,offsetX:i-2*c,offsetY:n-2*u,scaleX:c,scaleY:u}}getPattern(e,t,a,s){let r;if(l(e,this._bbox),s===o)r=i.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(e));else if(r=i.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){const e=i.Util.singularValueDecompose2dScale(this.matrix);r=[r[0]*e[0],r[1]*e[1]]}const c=this._createMeshCanvas(r,s===o?null:this._background,t.cachedCanvases);return s!==o&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(c.offsetX,c.offsetY),e.scale(c.scaleX,c.scaleY),e.createPattern(c.canvas,"no-repeat")}}class DummyShadingPattern extends BaseShadingPattern{getPattern(){return"hotpink"}}const u=1,h=2;class TilingPattern{static MAX_PATTERN_SIZE=3e3;constructor(e,t,a,i,n){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=a,this.canvasGraphicsFactory=i,this.baseTransform=n}createPatternCanvas(e){const t=this.operatorList,a=this.bbox,s=this.xstep,r=this.ystep,o=this.paintType,l=this.tilingType,c=this.color,d=this.canvasGraphicsFactory;(0,i.info)("TilingType: "+l);const u=a[0],h=a[1],p=a[2],m=a[3],f=i.Util.singularValueDecompose2dScale(this.matrix),g=i.Util.singularValueDecompose2dScale(this.baseTransform),y=[f[0]*g[0],f[1]*g[1]],v=this.getSizeAndScale(s,this.ctx.canvas.width,y[0]),b=this.getSizeAndScale(r,this.ctx.canvas.height,y[1]),A=e.cachedCanvases.getCanvas("pattern",v.size,b.size,!0),_=A.context,x=d.createCanvasGraphics(_);x.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(x,o,c);let w=u,C=h,E=p,S=m;return u<0&&(w=0,E+=Math.abs(u)),h<0&&(C=0,S+=Math.abs(h)),_.translate(-v.scale*w,-b.scale*C),x.transform(v.scale,0,0,b.scale,0,0),_.save(),this.clipBbox(x,w,C,E,S),x.baseTransform=(0,n.getCurrentTransform)(x.ctx),x.executeOperatorList(t),x.endDrawing(),{canvas:A.canvas,scaleX:v.scale,scaleY:b.scale,offsetX:w,offsetY:C}}getSizeAndScale(e,t,a){e=Math.abs(e);const i=Math.max(TilingPattern.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*a);return n>=i?n=i:a=n/e,{scale:a,size:n}}clipBbox(e,t,a,i,s){const r=i-t,o=s-a;e.ctx.rect(t,a,r,o),e.current.updateRectMinMax((0,n.getCurrentTransform)(e.ctx),[t,a,i,s]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,a){const n=e.ctx,s=e.current;switch(t){case u:const e=this.ctx;n.fillStyle=e.fillStyle,n.strokeStyle=e.strokeStyle,s.fillColor=e.fillStyle,s.strokeColor=e.strokeStyle;break;case h:const r=i.Util.makeHexColor(a[0],a[1],a[2]);n.fillStyle=r,n.strokeStyle=r,s.fillColor=r,s.strokeColor=r;break;default:throw new i.FormatError(`Unsupported paint type: ${t}`)}}getPattern(e,t,a,n){let s=a;n!==o&&(s=i.Util.transform(s,t.baseTransform),this.matrix&&(s=i.Util.transform(s,this.matrix)));const r=this.createPatternCanvas(t);let l=new DOMMatrix(s);l=l.translate(r.offsetX,r.offsetY),l=l.scale(1/r.scaleX,1/r.scaleY);const c=e.createPattern(r.canvas,"repeat");return c.setTransform(l),c}}function p({src:e,srcPos:t=0,dest:a,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const l=i.FeatureTest.isLittleEndian?4278190080:255,[c,d]=o?[r,l]:[l,r],u=n>>3,h=7&n,p=e.length;a=new Uint32Array(a.buffer);let m=0;for(let i=0;i<s;i++){for(const i=t+u;t<i;t++){const i=t<p?e[t]:255;a[m++]=128&i?d:c,a[m++]=64&i?d:c,a[m++]=32&i?d:c,a[m++]=16&i?d:c,a[m++]=8&i?d:c,a[m++]=4&i?d:c,a[m++]=2&i?d:c,a[m++]=1&i?d:c}if(0===h)continue;const i=t<p?e[t++]:255;for(let e=0;e<h;e++)a[m++]=i&1<<7-e?d:c}return{srcPos:t,destPos:m}}const m=4096,f=16;class CachedCanvases{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,a){let i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,a)):(i=this.canvasFactory.create(t,a),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function g(e,t,a,i,s,r,o,l,c,d){const[u,h,p,m,f,g]=(0,n.getCurrentTransform)(e);if(0===h&&0===p){const n=o*u+f,y=Math.round(n),v=l*m+g,b=Math.round(v),A=(o+c)*u+f,_=Math.abs(Math.round(A)-y)||1,x=(l+d)*m+g,w=Math.abs(Math.round(x)-b)||1;return e.setTransform(Math.sign(u),0,0,Math.sign(m),y,b),e.drawImage(t,a,i,s,r,0,0,_,w),e.setTransform(u,h,p,m,f,g),[_,w]}if(0===u&&0===m){const n=l*p+f,y=Math.round(n),v=o*h+g,b=Math.round(v),A=(l+d)*p+f,_=Math.abs(Math.round(A)-y)||1,x=(o+c)*h+g,w=Math.abs(Math.round(x)-b)||1;return e.setTransform(0,Math.sign(h),Math.sign(p),0,y,b),e.drawImage(t,a,i,s,r,0,0,w,_),e.setTransform(u,h,p,m,f,g),[w,_]}e.drawImage(t,a,i,s,r,o,l,c,d);return[Math.hypot(u,h)*c,Math.hypot(p,m)*d]}class CanvasExtraState{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=i.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=i.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,a){[t,a]=i.Util.applyTransform([t,a],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,a),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,a)}updateRectMinMax(e,t){const a=i.Util.applyTransform(t,e),n=i.Util.applyTransform(t.slice(2),e),s=i.Util.applyTransform([t[0],t[3]],e),r=i.Util.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,a[0],n[0],s[0],r[0]),this.minY=Math.min(this.minY,a[1],n[1],s[1],r[1]),this.maxX=Math.max(this.maxX,a[0],n[0],s[0],r[0]),this.maxY=Math.max(this.maxY,a[1],n[1],s[1],r[1])}updateScalingPathMinMax(e,t){i.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,a,n,s,r,o,l,c,d){const u=i.Util.bezierBoundingBox(t,a,n,s,r,o,l,c);if(d)return d[0]=Math.min(d[0],u[0],u[2]),d[1]=Math.max(d[1],u[0],u[2]),d[2]=Math.min(d[2],u[1],u[3]),void(d[3]=Math.max(d[3],u[1],u[3]));this.updateRectMinMax(e,u)}getPathBoundingBox(e=s,t=null){const a=[this.minX,this.minY,this.maxX,this.maxY];if(e===r){t||(0,i.unreachable)("Stroke bounding box must include transform.");const e=i.Util.singularValueDecompose2dScale(t),n=e[0]*this.lineWidth/2,s=e[1]*this.lineWidth/2;a[0]-=n,a[1]-=s,a[2]+=n,a[3]+=s}return a}updateClipFromPath(){const e=i.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=s,t=null){return i.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function y(e,t){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const a=t.height,n=t.width,s=a%f,r=(a-s)/f,o=0===s?r:r+1,l=e.createImageData(n,f);let c,d=0;const u=t.data,h=l.data;let p,m,g,y;if(t.kind===i.ImageKind.GRAYSCALE_1BPP){const t=u.byteLength,a=new Uint32Array(h.buffer,0,h.byteLength>>2),y=a.length,v=n+7>>3,b=4294967295,A=i.FeatureTest.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(g=p<r?f:s,c=0,m=0;m<g;m++){const e=t-d;let i=0;const s=e>v?n:8*e-7,r=-8&s;let o=0,l=0;for(;i<r;i+=8)l=u[d++],a[c++]=128&l?b:A,a[c++]=64&l?b:A,a[c++]=32&l?b:A,a[c++]=16&l?b:A,a[c++]=8&l?b:A,a[c++]=4&l?b:A,a[c++]=2&l?b:A,a[c++]=1&l?b:A;for(;i<s;i++)0===o&&(l=u[d++],o=128),a[c++]=l&o?b:A,o>>=1}for(;c<y;)a[c++]=0;e.putImageData(l,0,p*f)}}else if(t.kind===i.ImageKind.RGBA_32BPP){for(m=0,y=n*f*4,p=0;p<r;p++)h.set(u.subarray(d,d+y)),d+=y,e.putImageData(l,0,m),m+=f;p<o&&(y=n*s*4,h.set(u.subarray(d,d+y)),e.putImageData(l,0,m))}else{if(t.kind!==i.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);for(g=f,y=n*g,p=0;p<o;p++){for(p>=r&&(g=s,y=n*g),c=0,m=y;m--;)h[c++]=u[d++],h[c++]=u[d++],h[c++]=u[d++],h[c++]=255;e.putImageData(l,0,p*f)}}}function v(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);const a=t.height,i=t.width,n=a%f,s=(a-n)/f,r=0===n?s:s+1,o=e.createImageData(i,f);let l=0;const c=t.data,d=o.data;for(let t=0;t<r;t++){const a=t<s?f:n;({srcPos:l}=p({src:c,srcPos:l,dest:d,width:i,height:a,nonBlackColor:0})),e.putImageData(o,0,t*f)}}function b(e,t){const a=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of a)void 0!==e[i]&&(t[i]=e[i]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function A(e){if(e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0),!i.isNodeJS){const{filter:t}=e;"none"!==t&&""!==t&&(e.filter="none")}}function _(e,t,a,i){const n=e.length;for(let s=3;s<n;s+=4){const n=e[s];if(0===n)e[s-3]=t,e[s-2]=a,e[s-1]=i;else if(n<255){const r=255-n;e[s-3]=e[s-3]*n+t*r>>8,e[s-2]=e[s-2]*n+a*r>>8,e[s-1]=e[s-1]*n+i*r>>8}}}function x(e,t,a){const i=e.length;for(let n=3;n<i;n+=4){const i=a?a[e[n]]:e[n];t[n]=t[n]*i*.00392156862745098|0}}function w(e,t,a){const i=e.length;for(let n=3;n<i;n+=4){const i=77*e[n-3]+152*e[n-2]+28*e[n-1];t[n]=a?t[n]*a[i>>8]>>8:t[n]*i>>16}}function C(e,t,a,i){const n=i[0],s=i[1],r=i[2]-n,o=i[3]-s;0!==r&&0!==o&&(!function(e,t,a,i,n,s,r,o,l,c,d){const u=!!s,h=u?s[0]:0,p=u?s[1]:0,m=u?s[2]:0,f="Luminosity"===n?w:x,g=Math.min(i,Math.ceil(1048576/a));for(let n=0;n<i;n+=g){const s=Math.min(g,i-n),y=e.getImageData(o-c,n+(l-d),a,s),v=t.getImageData(o,n+l,a,s);u&&_(y.data,h,p,m),f(y.data,v.data,r),t.putImageData(v,o,n+l)}}(t.context,a,r,o,t.subtype,t.backdrop,t.transferMap,n,s,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(a.canvas,0,0),e.restore())}function E(e,t){const a=i.Util.singularValueDecompose2dScale(e);a[0]=Math.fround(a[0]),a[1]=Math.fround(a[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*n.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==t?t:a[0]<=s||a[1]<=s}const S=["butt","round","square"],M=["miter","round","bevel"],T={},k={};class CanvasGraphics{constructor(e,t,a,i,n,{optionalContentConfig:s,markedContentStack:r=null},o,l){this.ctx=e,this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=a,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=r||[],this.optionalContentConfig=s,this.cachedCanvases=new CachedCanvases(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:a=!1,background:i=null}){const s=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,s,r),this.ctx.fillStyle=o,a){const e=this.cachedCanvases.getCanvas("transparent",s,r);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...(0,n.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),A(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=(0,n.getCurrentTransform)(this.ctx)}executeOperatorList(e,t,a,n){const s=e.argsArray,r=e.fnArray;let o=t||0;const l=s.length;if(l===o)return o;const c=l-o>10&&"function"==typeof a,d=c?Date.now()+15:0;let u=0;const h=this.commonObjs,p=this.objs;let m;for(;;){if(void 0!==n&&o===n.nextBreakPoint)return n.breakIt(o,a),o;if(m=r[o],m!==i.OPS.dependency)this[m].apply(this,s[o]);else for(const e of s[o]){const t=e.startsWith("g_")?h:p;if(!t.has(e))return t.get(e,a),o}if(o++,o===l)return o;if(c&&++u>10){if(Date.now()>d)return a(),o;u=0}}}#se(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#se(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#re()}#re(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const a=e.width,i=e.height;let n,s,r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=a,c=i,d="prescale1";for(;r>2&&l>1||o>2&&c>1;){let t=l,a=c;r>2&&l>1&&(t=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),r/=l/t),o>2&&c>1&&(a=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/a),n=this.cachedCanvases.getCanvas(d,t,a),s=n.context,s.clearRect(0,0,t,a),s.drawImage(e,0,0,l,c,0,0,t,a),e=n.canvas,l=t,c=a,d="prescale1"===d?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:a,height:r}=e,o=this.current.fillColor,l=this.current.patternFill,c=(0,n.getCurrentTransform)(t);let d,u,h,p;if((e.bitmap||e.data)&&e.count>1){const t=e.bitmap||e.data.buffer;u=JSON.stringify(l?c:[c.slice(0,4),o]),d=this._cachedBitmapsMap.get(t),d||(d=new Map,this._cachedBitmapsMap.set(t,d));const a=d.get(u);if(a&&!l){return{canvas:a,offsetX:Math.round(Math.min(c[0],c[2])+c[4]),offsetY:Math.round(Math.min(c[1],c[3])+c[5])}}h=a}h||(p=this.cachedCanvases.getCanvas("maskCanvas",a,r),v(p.context,e));let m=i.Util.transform(c,[1/a,0,0,-1/r,0,0]);m=i.Util.transform(m,[1,0,0,1,0,-r]);const[f,y,b,A]=i.Util.getAxialAlignedBoundingBox([0,0,a,r],m),_=Math.round(b-f)||1,x=Math.round(A-y)||1,w=this.cachedCanvases.getCanvas("fillCanvas",_,x),C=w.context,S=f,M=y;C.translate(-S,-M),C.transform(...m),h||(h=this._scaleImage(p.canvas,(0,n.getCurrentTransformInverse)(C)),h=h.img,d&&l&&d.set(u,h)),C.imageSmoothingEnabled=E((0,n.getCurrentTransform)(C),e.interpolate),g(C,h,0,0,h.width,h.height,0,0,a,r),C.globalCompositeOperation="source-in";const T=i.Util.transform((0,n.getCurrentTransformInverse)(C),[1,0,0,1,-S,-M]);return C.fillStyle=l?o.getPattern(t,this,T,s):o,C.fillRect(0,0,a,r),d&&!l&&(this.cachedCanvases.delete("fillCanvas"),d.set(u,w.canvas)),{canvas:w.canvas,offsetX:Math.round(S),offsetY:Math.round(M)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=S[e]}setLineJoin(e){this.ctx.lineJoin=M[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const a=this.ctx;void 0!==a.setLineDash&&(a.setLineDash(e),a.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,a]of e)switch(t){case"LW":this.setLineWidth(a);break;case"LC":this.setLineCap(a);break;case"LJ":this.setLineJoin(a);break;case"ML":this.setMiterLimit(a);break;case"D":this.setDash(a[0],a[1]);break;case"RI":this.setRenderingIntent(a);break;case"FL":this.setFlatness(a);break;case"Font":this.setFont(a[0],a[1]);break;case"CA":this.current.strokeAlpha=a;break;case"ca":this.current.fillAlpha=a,this.ctx.globalAlpha=a;break;case"BM":this.ctx.globalCompositeOperation=a;break;case"SMask":this.current.activeSMask=a?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(a)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,a="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(a,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;const s=this.ctx;s.setTransform(...(0,n.getCurrentTransform)(this.suspendedCtx)),b(this.suspendedCtx,s),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,a){t.translate(e,a),this.__originalTranslate(e,a)},e.scale=function(e,a){t.scale(e,a),this.__originalScale(e,a)},e.transform=function(e,a,i,n,s,r){t.transform(e,a,i,n,s,r),this.__originalTransform(e,a,i,n,s,r)},e.setTransform=function(e,a,i,n,s,r){t.setTransform(e,a,i,n,s,r),this.__originalSetTransform(e,a,i,n,s,r)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,a){t.moveTo(e,a),this.__originalMoveTo(e,a)},e.lineTo=function(e,a){t.lineTo(e,a),this.__originalLineTo(e,a)},e.bezierCurveTo=function(e,a,i,n,s,r){t.bezierCurveTo(e,a,i,n,s,r),this.__originalBezierCurveTo(e,a,i,n,s,r)},e.rect=function(e,a,i,n){t.rect(e,a,i,n),this.__originalRect(e,a,i,n)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(s,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),b(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask;C(this.suspendedCtx,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(b(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),b(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,a,i,n,s){this.ctx.transform(e,t,a,i,n,s),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,a){const s=this.ctx,r=this.current;let o,l,c=r.x,d=r.y;const u=(0,n.getCurrentTransform)(s),h=0===u[0]&&0===u[3]||0===u[1]&&0===u[2],p=h?a.slice(0):null;for(let a=0,n=0,m=e.length;a<m;a++)switch(0|e[a]){case i.OPS.rectangle:c=t[n++],d=t[n++];const e=t[n++],a=t[n++],m=c+e,f=d+a;s.moveTo(c,d),0===e||0===a?s.lineTo(m,f):(s.lineTo(m,d),s.lineTo(m,f),s.lineTo(c,f)),h||r.updateRectMinMax(u,[c,d,m,f]),s.closePath();break;case i.OPS.moveTo:c=t[n++],d=t[n++],s.moveTo(c,d),h||r.updatePathMinMax(u,c,d);break;case i.OPS.lineTo:c=t[n++],d=t[n++],s.lineTo(c,d),h||r.updatePathMinMax(u,c,d);break;case i.OPS.curveTo:o=c,l=d,c=t[n+4],d=t[n+5],s.bezierCurveTo(t[n],t[n+1],t[n+2],t[n+3],c,d),r.updateCurvePathMinMax(u,o,l,t[n],t[n+1],t[n+2],t[n+3],c,d,p),n+=6;break;case i.OPS.curveTo2:o=c,l=d,s.bezierCurveTo(c,d,t[n],t[n+1],t[n+2],t[n+3]),r.updateCurvePathMinMax(u,o,l,c,d,t[n],t[n+1],t[n+2],t[n+3],p),c=t[n+2],d=t[n+3],n+=4;break;case i.OPS.curveTo3:o=c,l=d,c=t[n+2],d=t[n+3],s.bezierCurveTo(t[n],t[n+1],c,d,c,d),r.updateCurvePathMinMax(u,o,l,t[n],t[n+1],c,d,c,d,p),n+=4;break;case i.OPS.closePath:s.closePath()}h&&r.updateScalingPathMinMax(u,p),r.setCurrentPoint(c,d)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,a=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof a&&a?.getPattern?(t.save(),t.strokeStyle=a.getPattern(t,this,(0,n.getCurrentTransformInverse)(t),r),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,a=this.current.fillColor;let i=!1;this.current.patternFill&&(t.save(),t.fillStyle=a.getPattern(t,this,(0,n.getCurrentTransformInverse)(t),s),i=!0);const r=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==r&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=T}eoClip(){this.pendingClip=k}beginText(){this.current.textMatrix=i.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(const a of e)t.setTransform(...a.transform),t.translate(a.x,a.y),a.addToPath(t,a.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const a=this.commonObjs.get(e),n=this.current;if(!a)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=a.fontMatrix||i.FONT_IDENTITY_MATRIX,0!==n.fontMatrix[0]&&0!==n.fontMatrix[3]||(0,i.warn)("Invalid font matrix for font "+e),t<0?(t=-t,n.fontDirection=-1):n.fontDirection=1,this.current.font=a,this.current.fontSize=t,a.isType3Font)return;const s=a.loadedName||"sans-serif",r=a.systemFontInfo?.css||`"${s}", ${a.fallbackName}`;let o="normal";a.black?o="900":a.bold&&(o="bold");const l=a.italic?"italic":"normal";let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${o} ${c}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,a,i,n,s){this.current.textMatrix=[e,t,a,i,n,s],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,a,s){const r=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=c&i.TextRenderingMode.FILL_STROKE_MASK,h=!!(c&i.TextRenderingMode.ADD_TO_PATH_FLAG),p=o.patternFill&&!l.missingFile;let m;if((l.disableFontFace||h||p)&&(m=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p?(r.save(),r.translate(t,a),r.beginPath(),m(r,d),s&&r.setTransform(...s),u!==i.TextRenderingMode.FILL&&u!==i.TextRenderingMode.FILL_STROKE||r.fill(),u!==i.TextRenderingMode.STROKE&&u!==i.TextRenderingMode.FILL_STROKE||r.stroke(),r.restore()):(u!==i.TextRenderingMode.FILL&&u!==i.TextRenderingMode.FILL_STROKE||r.fillText(e,t,a),u!==i.TextRenderingMode.STROKE&&u!==i.TextRenderingMode.FILL_STROKE||r.strokeText(e,t,a)),h){(this.pendingTextPaths||=[]).push({transform:(0,n.getCurrentTransform)(r),x:t,y:a,fontSize:d,addToPath:m})}}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let a=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){a=!0;break}return(0,i.shadow)(this,"isFontSubpixelAAEnabled",a)}showText(e){const t=this.current,a=t.font;if(a.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(0===r)return;const o=this.ctx,l=t.fontSizeScale,c=t.charSpacing,d=t.wordSpacing,u=t.fontDirection,h=t.textHScale*u,p=e.length,m=a.vertical,f=m?1:-1,g=a.defaultVMetrics,y=r*t.fontMatrix[0],v=t.textRenderingMode===i.TextRenderingMode.FILL&&!a.disableFontFace&&!t.patternFill;let b;if(o.save(),o.transform(...t.textMatrix),o.translate(t.x,t.y+t.textRise),u>0?o.scale(h,-1):o.scale(h,1),t.patternFill){o.save();const e=t.fillColor.getPattern(o,this,(0,n.getCurrentTransformInverse)(o),s);b=(0,n.getCurrentTransform)(o),o.restore(),o.fillStyle=e}let A=t.lineWidth;const _=t.textMatrixScale;if(0===_||0===A){const e=t.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;e!==i.TextRenderingMode.STROKE&&e!==i.TextRenderingMode.FILL_STROKE||(A=this.getSinglePixelWidth())}else A/=_;if(1!==l&&(o.scale(l,l),A/=l),o.lineWidth=A,a.isInvalidPDFjsFont){const a=[];let i=0;for(const t of e)a.push(t.unicode),i+=t.width;return o.fillText(a.join(""),0,0),t.x+=i*y*h,o.restore(),void this.compose()}let x,w=0;for(x=0;x<p;++x){const t=e[x];if("number"==typeof t){w+=f*t*r/1e3;continue}let i=!1;const n=(t.isSpace?d:0)+c,s=t.fontChar,h=t.accent;let p,A,_=t.width;if(m){const e=t.vmetric||g,a=-(t.vmetric?e[1]:.5*_)*y,i=e[2]*y;_=e?-e[0]:_,p=a/l,A=(w+i)/l}else p=w/l,A=0;if(a.remeasure&&_>0){const e=1e3*o.measureText(s).width/r*l;if(_<e&&this.isFontSubpixelAAEnabled){const t=_/e;i=!0,o.save(),o.scale(t,1),p/=t}else _!==e&&(p+=(_-e)/2e3*r/l)}if(this.contentVisible&&(t.isInFont||a.missingFile))if(v&&!h)o.fillText(s,p,A);else if(this.paintChar(s,p,A,b),h){const e=p+r*h.offset.x/l,t=A-r*h.offset.y/l;this.paintChar(h.fontChar,e,t,b)}w+=m?_*y-n*u:_*y+n*u,i&&o.restore()}m?t.y-=w:t.x+=w*h,o.restore(),this.compose()}showType3Text(e){const t=this.ctx,a=this.current,n=a.font,s=a.fontSize,r=a.fontDirection,o=n.vertical?1:-1,l=a.charSpacing,c=a.wordSpacing,d=a.textHScale*r,u=a.fontMatrix||i.FONT_IDENTITY_MATRIX,h=e.length;let p,m,f,g;if(!(a.textRenderingMode===i.TextRenderingMode.INVISIBLE)&&0!==s){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...a.textMatrix),t.translate(a.x,a.y),t.scale(d,r),p=0;p<h;++p){if(m=e[p],"number"==typeof m){g=o*m*s/1e3,this.ctx.translate(g,0),a.x+=g*d;continue}const r=(m.isSpace?c:0)+l,h=n.charProcOperatorList[m.operatorListId];if(!h){(0,i.warn)(`Type3 character "${m.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=m,this.save(),t.scale(s,s),t.transform(...u),this.executeOperatorList(h),this.restore());f=i.Util.applyTransform([m.width,0],u)[0]*s+r,t.translate(f,0),a.x+=f*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,a,i,n,s){this.ctx.rect(a,i,n-a,s-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const a=e[1],i=this.baseTransform||(0,n.getCurrentTransform)(this.ctx),s={createCanvasGraphics:e=>new CanvasGraphics(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new TilingPattern(e,a,this.ctx,s,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,a){const n=i.Util.makeHexColor(e,t,a);this.ctx.strokeStyle=n,this.current.strokeColor=n}setFillRGBColor(e,t,a){const n=i.Util.makeHexColor(e,t,a);this.ctx.fillStyle=n,this.current.fillColor=n,this.current.patternFill=!1}_getPattern(e,t=null){let a;return this.cachedPatterns.has(e)?a=this.cachedPatterns.get(e):(a=function(e){switch(e[0]){case"RadialAxial":return new RadialAxialShadingPattern(e);case"Mesh":return new MeshShadingPattern(e);case"Dummy":return new DummyShadingPattern}throw new Error(`Unknown IR type: ${e[0]}`)}(this.getObject(e)),this.cachedPatterns.set(e,a)),t&&(a.matrix=t),a}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const a=this._getPattern(e);t.fillStyle=a.getPattern(t,this,(0,n.getCurrentTransformInverse)(t),o);const s=(0,n.getCurrentTransformInverse)(t);if(s){const{width:e,height:a}=t.canvas,[n,r,o,l]=i.Util.getAxialAlignedBoundingBox([0,0,e,a],s);this.ctx.fillRect(n,r,o-n,l-r)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,i.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,i.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform(...e),this.baseTransform=(0,n.getCurrentTransform)(this.ctx),t)){const e=t[2]-t[0],a=t[3]-t[1];this.ctx.rect(t[0],t[1],e,a),this.current.updateRectMinMax((0,n.getCurrentTransform)(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||(0,i.info)("TODO: Support non-isolated groups."),e.knockout&&(0,i.warn)("Knockout groups not supported.");const a=(0,n.getCurrentTransform)(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=i.Util.getAxialAlignedBoundingBox(e.bbox,(0,n.getCurrentTransform)(t));const r=[0,0,t.canvas.width,t.canvas.height];s=i.Util.intersect(s,r)||[0,0,0,0];const o=Math.floor(s[0]),l=Math.floor(s[1]);let c=Math.max(Math.ceil(s[2])-o,1),d=Math.max(Math.ceil(s[3])-l,1),u=1,h=1;c>m&&(u=c/m,c=m),d>m&&(h=d/m,d=m),this.current.startNewPathAndClipBox([0,0,c,d]);let p="groupAt"+this.groupLevel;e.smask&&(p+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(p,c,d),g=f.context;g.scale(1/u,1/h),g.translate(-o,-l),g.transform(...a),e.smask?this.smaskStack.push({canvas:f.canvas,context:g,offsetX:o,offsetY:l,scaleX:u,scaleY:h,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,l),t.scale(u,h),t.save()),b(t,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,a=this.groupStack.pop();if(this.ctx=a,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const e=(0,n.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...e);const a=i.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(e,t,a,s,r){if(this.#se(),A(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(t)&&4===t.length){const s=t[2]-t[0],o=t[3]-t[1];if(r&&this.annotationCanvasMap){(a=a.slice())[4]-=t[0],a[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=s,t[3]=o;const[r,l]=i.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(this.ctx)),{viewportScale:c}=this,d=Math.ceil(s*this.outputScaleX*c),u=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,u);const{canvas:h,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(r,0,0,-l,0,o*l),A(this.ctx)}else A(this.ctx),this.ctx.rect(t[0],t[1],s,o),this.ctx.clip(),this.endPath()}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...a),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#re(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;(e=this.getObject(e.data,e)).count=t;const a=this.ctx,i=this.processingType3;if(i&&(void 0===i.compiled&&(i.compiled=function(e){const{width:t,height:a}=e;if(t>1e3||a>1e3)return null;const i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=t+1;let s,r,o,l=new Uint8Array(n*(a+1));const c=t+7&-8;let d=new Uint8Array(c*a),u=0;for(const t of e.data){let e=128;for(;e>0;)d[u++]=t&e?0:255,e>>=1}let h=0;for(u=0,0!==d[u]&&(l[0]=1,++h),r=1;r<t;r++)d[u]!==d[u+1]&&(l[r]=d[u]?2:1,++h),u++;for(0!==d[u]&&(l[r]=2,++h),s=1;s<a;s++){u=s*c,o=s*n,d[u-c]!==d[u]&&(l[o]=d[u]?1:8,++h);let e=(d[u]?4:0)+(d[u-c]?8:0);for(r=1;r<t;r++)e=(e>>2)+(d[u+1]?4:0)+(d[u-c+1]?8:0),i[e]&&(l[o+r]=i[e],++h),u++;if(d[u-c]!==d[u]&&(l[o+r]=d[u]?2:4,++h),h>1e3)return null}for(u=c*(a-1),o=s*n,0!==d[u]&&(l[o]=8,++h),r=1;r<t;r++)d[u]!==d[u+1]&&(l[o+r]=d[u]?4:8,++h),u++;if(0!==d[u]&&(l[o+r]=4,++h),h>1e3)return null;const p=new Int32Array([0,n,-1,0,-n,0,0,0,1]),m=new Path2D;for(s=0;h&&s<=a;s++){let e=s*n;const a=e+t;for(;e<a&&!l[e];)e++;if(e===a)continue;m.moveTo(e%n,s);const i=e;let r=l[e];do{const t=p[r];do{e+=t}while(!l[e]);const a=l[e];5!==a&&10!==a?(r=a,l[e]=0):(r=a&51*r>>4,l[e]&=r>>2|r<<2),m.lineTo(e%n,e/n|0),l[e]||--h}while(i!==e);--s}return d=null,l=null,function(e){e.save(),e.scale(1/t,-1/a),e.translate(0,-a),e.fill(m),e.beginPath(),e.restore()}}(e)),i.compiled))return void i.compiled(a);const n=this._createMaskCanvas(e),s=n.canvas;a.save(),a.setTransform(1,0,0,1,0,0),a.drawImage(s,n.offsetX,n.offsetY),a.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,a=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const l=this.ctx;l.save();const c=(0,n.getCurrentTransform)(l);l.transform(t,a,s,r,0,0);const d=this._createMaskCanvas(e);l.setTransform(1,0,0,1,d.offsetX-c[4],d.offsetY-c[5]);for(let e=0,n=o.length;e<n;e+=2){const n=i.Util.transform(c,[t,a,s,r,o[e],o[e+1]]),[u,h]=i.Util.applyTransform([0,0],n);l.drawImage(d.canvas,u,h)}l.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,a=this.current.fillColor,i=this.current.patternFill;for(const r of e){const{data:e,width:o,height:l,transform:c}=r,d=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=d.context;u.save();v(u,this.getObject(e,r)),u.globalCompositeOperation="source-in",u.fillStyle=i?a.getPattern(u,this,(0,n.getCurrentTransformInverse)(t),s):a,u.fillRect(0,0,o,l),u.restore(),t.save(),t.transform(...c),t.scale(1,-1),g(t,d.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,i.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,a,n){if(!this.contentVisible)return;const s=this.getObject(e);if(!s)return void(0,i.warn)("Dependent image isn't ready yet");const r=s.width,o=s.height,l=[];for(let e=0,i=n.length;e<i;e+=2)l.push({transform:[t,0,0,a,n[e],n[e+1]],x:0,y:0,w:r,h:o});this.paintInlineImageXObjectGroup(s,l)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;const{bitmap:t,width:a,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",a,i),s=n.context;return s.filter=this.current.transferMaps,s.drawImage(t,0,0),s.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,a=e.height,s=this.ctx;if(this.save(),!i.isNodeJS){const{filter:e}=s;"none"!==e&&""!==e&&(s.filter="none")}let r;if(s.scale(1/t,-1/a),e.bitmap)r=this.applyTransferMapsToBitmap(e);else if("function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)r=e;else{const i=this.cachedCanvases.getCanvas("inlineImage",t,a).context;y(i,e),r=this.applyTransferMapsToCanvas(i)}const o=this._scaleImage(r,(0,n.getCurrentTransformInverse)(s));s.imageSmoothingEnabled=E((0,n.getCurrentTransform)(s),e.interpolate),g(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-a,t,a),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const a=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const t=e.width,a=e.height,n=this.cachedCanvases.getCanvas("inlineImage",t,a).context;y(n,e),i=this.applyTransferMapsToCanvas(n)}for(const e of t)a.save(),a.transform(...e.transform),a.scale(1,-1),g(a,i,e.x,e.y,e.w,e.h,0,-1,1,1),a.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const a=this.ctx;this.pendingClip&&(t||(this.pendingClip===k?a.clip("evenodd"):a.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),a.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=(0,n.getCurrentTransform)(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),a=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(a,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:e}=this.current,{a:t,b:a,c:i,d:n}=this.ctx.getTransform();let s,r;if(0===a&&0===i){const a=Math.abs(t),i=Math.abs(n);if(a===i)if(0===e)s=r=1/a;else{const t=a*e;s=r=t<1?1/t:1}else if(0===e)s=1/a,r=1/i;else{const t=a*e,n=i*e;s=t<1?1/t:1,r=n<1?1/n:1}}else{const o=Math.abs(t*n-a*i),l=Math.hypot(t,a),c=Math.hypot(i,n);if(0===e)s=c/o,r=l/o;else{const t=e*o;s=c>t?c/t:1,r=l>t?l/t:1}}this._cachedScaleForStroking[0]=s,this._cachedScaleForStroking[1]=r}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:a}=this.current,[i,n]=this.getScaleForStroking();if(t.lineWidth=a||1,1===i&&1===n)return void t.stroke();const s=t.getLineDash();if(e&&t.save(),t.scale(i,n),s.length>0){const e=Math.max(i,n);t.setLineDash(s.map((t=>t/e))),t.lineDashOffset/=e}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const e in i.OPS)void 0!==CanvasGraphics.prototype[e]&&(CanvasGraphics.prototype[i.OPS[e]]=CanvasGraphics.prototype[e])},473:(e,t,a)=>{a.d(t,{DOMCMapReaderFactory:()=>DOMCMapReaderFactory,DOMCanvasFactory:()=>DOMCanvasFactory,DOMFilterFactory:()=>DOMFilterFactory,DOMSVGFactory:()=>DOMSVGFactory,DOMStandardFontDataFactory:()=>DOMStandardFontDataFactory,PDFDateString:()=>PDFDateString,PageViewport:()=>PageViewport,PixelsPerInch:()=>PixelsPerInch,RenderingCancelledException:()=>RenderingCancelledException,StatTimer:()=>StatTimer,fetchData:()=>r,getColorValues:()=>g,getCurrentTransform:()=>y,getCurrentTransformInverse:()=>v,getFilenameFromUrl:()=>c,getPdfFilenameFromUrl:()=>d,getRGB:()=>f,getXfaPageViewport:()=>m,isDataScheme:()=>o,isPdfFile:()=>l,isValidFetchUrl:()=>u,noContextMenu:()=>h,setLayerDimensions:()=>b});var i=a(822),n=a(266);const s="http://www.w3.org/2000/svg";class PixelsPerInch{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class DOMFilterFactory extends i.BaseFilterFactory{#oe;#le;#z;#ce;#de;#ue;#he;#pe;#me;#fe;#ge=0;constructor({docId:e,ownerDocument:t=globalThis.document}={}){super(),this.#z=e,this.#ce=t}get#ye(){return this.#oe||=new Map}get#ve(){if(!this.#le){const e=this.#ce.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const a=this.#ce.createElementNS(s,"svg");a.setAttribute("width",0),a.setAttribute("height",0),this.#le=this.#ce.createElementNS(s,"defs"),e.append(a),a.append(this.#le),this.#ce.body.append(e)}return this.#le}addFilter(e){if(!e)return"none";let t,a,i,n,s=this.#ye.get(e);if(s)return s;if(1===e.length){const s=e[0],r=new Array(256);for(let e=0;e<256;e++)r[e]=s[e]/255;n=t=a=i=r.join(",")}else{const[s,r,o]=e,l=new Array(256),c=new Array(256),d=new Array(256);for(let e=0;e<256;e++)l[e]=s[e]/255,c[e]=r[e]/255,d[e]=o[e]/255;t=l.join(","),a=c.join(","),i=d.join(","),n=`${t}${a}${i}`}if(s=this.#ye.get(n),s)return this.#ye.set(e,s),s;const r=`g_${this.#z}_transfer_map_${this.#ge++}`,o=`url(#${r})`;this.#ye.set(e,o),this.#ye.set(n,o);const l=this.#be(r);return this.#Ae(t,a,i,l),o}addHCMFilter(e,t){const a=`${e}-${t}`;if(this.#ue===a)return this.#he;if(this.#ue=a,this.#he="none",this.#de?.remove(),!e||!t)return this.#he;const i=this.#_e(e);e=n.Util.makeHexColor(...i);const s=this.#_e(t);if(t=n.Util.makeHexColor(...s),this.#ve.style.color="","#000000"===e&&"#ffffff"===t||e===t)return this.#he;const r=new Array(256);for(let e=0;e<=255;e++){const t=e/255;r[e]=t<=.03928?t/12.92:((t+.055)/1.055)**2.4}const o=r.join(","),l=`g_${this.#z}_hcm_filter`,c=this.#pe=this.#be(l);this.#Ae(o,o,o,c),this.#xe(c);const d=(e,t)=>{const a=i[e]/255,n=s[e]/255,r=new Array(t+1);for(let e=0;e<=t;e++)r[e]=a+e/t*(n-a);return r.join(",")};return this.#Ae(d(0,5),d(1,5),d(2,5),c),this.#he=`url(#${l})`,this.#he}addHighlightHCMFilter(e,t,a,i){const n=`${e}-${t}-${a}-${i}`;if(this.#me===n)return this.#fe;if(this.#me=n,this.#fe="none",this.#pe?.remove(),!e||!t)return this.#fe;const[s,r]=[e,t].map(this.#_e.bind(this));let o=Math.round(.2126*s[0]+.7152*s[1]+.0722*s[2]),l=Math.round(.2126*r[0]+.7152*r[1]+.0722*r[2]),[c,d]=[a,i].map(this.#_e.bind(this));l<o&&([o,l,c,d]=[l,o,d,c]),this.#ve.style.color="";const u=(e,t,a)=>{const i=new Array(256),n=(l-o)/a,s=e/255,r=(t-e)/(255*a);let c=0;for(let e=0;e<=a;e++){const t=Math.round(o+e*n),a=s+e*r;for(let e=c;e<=t;e++)i[e]=a;c=t+1}for(let e=c;e<256;e++)i[e]=i[c-1];return i.join(",")},h=`g_${this.#z}_hcm_highlight_filter`,p=this.#pe=this.#be(h);return this.#xe(p),this.#Ae(u(c[0],d[0],5),u(c[1],d[1],5),u(c[2],d[2],5),p),this.#fe=`url(#${h})`,this.#fe}destroy(e=!1){e&&(this.#he||this.#fe)||(this.#le&&(this.#le.parentNode.parentNode.remove(),this.#le=null),this.#oe&&(this.#oe.clear(),this.#oe=null),this.#ge=0)}#xe(e){const t=this.#ce.createElementNS(s,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#be(e){const t=this.#ce.createElementNS(s,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#ve.append(t),t}#we(e,t,a){const i=this.#ce.createElementNS(s,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",a),e.append(i)}#Ae(e,t,a,i){const n=this.#ce.createElementNS(s,"feComponentTransfer");i.append(n),this.#we(n,"feFuncR",e),this.#we(n,"feFuncG",t),this.#we(n,"feFuncB",a)}#_e(e){return this.#ve.style.color=e,f(getComputedStyle(this.#ve).getPropertyValue("color"))}}class DOMCanvasFactory extends i.BaseCanvasFactory{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}_createCanvas(e,t){const a=this._document.createElement("canvas");return a.width=e,a.height=t,a}}async function r(e,t="text"){if(u(e,document.baseURI)){const a=await fetch(e);if(!a.ok)throw new Error(a.statusText);switch(t){case"arraybuffer":return a.arrayBuffer();case"blob":return a.blob();case"json":return a.json()}return a.text()}return new Promise(((a,i)=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType=t,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(200===n.status||0===n.status){let e;switch(t){case"arraybuffer":case"blob":case"json":e=n.response;break;default:e=n.responseText}if(e)return void a(e)}i(new Error(n.statusText))}},n.send(null)}))}class DOMCMapReaderFactory extends i.BaseCMapReaderFactory{_fetchData(e,t){return r(e,this.isCompressed?"arraybuffer":"text").then((e=>({cMapData:e instanceof ArrayBuffer?new Uint8Array(e):(0,n.stringToBytes)(e),compressionType:t})))}}class DOMStandardFontDataFactory extends i.BaseStandardFontDataFactory{_fetchData(e){return r(e,"arraybuffer").then((e=>new Uint8Array(e)))}}class DOMSVGFactory extends i.BaseSVGFactory{_createSVG(e){return document.createElementNS(s,e)}}class PageViewport{constructor({viewBox:e,scale:t,rotation:a,offsetX:i=0,offsetY:n=0,dontFlip:s=!1}){this.viewBox=e,this.scale=t,this.rotation=a,this.offsetX=i,this.offsetY=n;const r=(e[2]+e[0])/2,o=(e[3]+e[1])/2;let l,c,d,u,h,p,m,f;switch((a%=360)<0&&(a+=360),a){case 180:l=-1,c=0,d=0,u=1;break;case 90:l=0,c=1,d=1,u=0;break;case 270:l=0,c=-1,d=-1,u=0;break;case 0:l=1,c=0,d=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}s&&(d=-d,u=-u),0===l?(h=Math.abs(o-e[1])*t+i,p=Math.abs(r-e[0])*t+n,m=(e[3]-e[1])*t,f=(e[2]-e[0])*t):(h=Math.abs(r-e[0])*t+i,p=Math.abs(o-e[1])*t+n,m=(e[2]-e[0])*t,f=(e[3]-e[1])*t),this.transform=[l*t,c*t,d*t,u*t,h-l*t*r-d*t*o,p-c*t*r-u*t*o],this.width=m,this.height=f}get rawDims(){const{viewBox:e}=this;return(0,n.shadow)(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:a=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new PageViewport({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:a,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){return n.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=n.Util.applyTransform([e[0],e[1]],this.transform),a=n.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],a[0],a[1]]}convertToPdfPoint(e,t){return n.Util.applyInverseTransform([e,t],this.transform)}}class RenderingCancelledException extends n.BaseException{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function o(e){const t=e.length;let a=0;for(;a<t&&""===e[a].trim();)a++;return"data:"===e.substring(a,a+5).toLowerCase()}function l(e){return"string"==typeof e&&/\.pdf$/i.test(e)}function c(e,t=!1){return t||([e]=e.split(/[#?]/,1)),e.substring(e.lastIndexOf("/")+1)}function d(e,t="document.pdf"){if("string"!=typeof e)return t;if(o(e))return(0,n.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const a=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e);let s=a.exec(i[1])||a.exec(i[2])||a.exec(i[3]);if(s&&(s=s[0],s.includes("%")))try{s=a.exec(decodeURIComponent(s))[0]}catch{}return s||t}class StatTimer{started=Object.create(null);times=[];time(e){e in this.started&&(0,n.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,n.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:e}of this.times)t=Math.max(e.length,t);for(const{name:a,start:i,end:n}of this.times)e.push(`${a.padEnd(t)} ${n-i}ms\n`);return e.join("")}}function u(e,t){try{const{protocol:a}=t?new URL(e,t):new URL(e);return"http:"===a||"https:"===a}catch{return!1}}function h(e){e.preventDefault()}let p;class PDFDateString{static toDateObject(e){if(!e||"string"!=typeof e)return null;p||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=p.exec(e);if(!t)return null;const a=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let s=parseInt(t[4],10);s=s>=0&&s<=23?s:0;let r=parseInt(t[5],10);r=r>=0&&r<=59?r:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,"-"===l?(s+=c,r+=d):"+"===l&&(s-=c,r-=d),new Date(Date.UTC(a,i,n,s,r,o))}}function m(e,{scale:t=1,rotation:a=0}){const{width:i,height:n}=e.attributes.style,s=[0,0,parseInt(i),parseInt(n)];return new PageViewport({viewBox:s,scale:t,rotation:a})}function f(e){if(e.startsWith("#")){const t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((e=>parseInt(e))):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((e=>parseInt(e))).slice(0,3):((0,n.warn)(`Not a valid color format: "${e}"`),[0,0,0])}function g(e){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const a of e.keys()){t.style.color=a;const i=window.getComputedStyle(t).color;e.set(a,f(i))}t.remove()}function y(e){const{a:t,b:a,c:i,d:n,e:s,f:r}=e.getTransform();return[t,a,i,n,s,r]}function v(e){const{a:t,b:a,c:i,d:n,e:s,f:r}=e.getTransform().invertSelf();return[t,a,i,n,s,r]}function b(e,t,a=!1,i=!0){if(t instanceof PageViewport){const{pageWidth:i,pageHeight:s}=t.rawDims,{style:r}=e,o=n.FeatureTest.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${s}px`,d=o?`round(${l}, 1px)`:`calc(${l})`,u=o?`round(${c}, 1px)`:`calc(${c})`;a&&t.rotation%180!=0?(r.width=u,r.height=d):(r.width=d,r.height=u)}i&&e.setAttribute("data-main-rotation",t.rotation)}},423:(e,t,a)=>{a.d(t,{DrawLayer:()=>DrawLayer});var i=a(473),n=a(266);class DrawLayer{#y=null;#ge=0;#Ce=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(this.#y){if(this.#y!==e){if(this.#Ce.size>0)for(const t of this.#Ce.values())t.remove(),e.append(t);this.#y=e}}else this.#y=e}static get _svgFactory(){return(0,n.shadow)(this,"_svgFactory",new i.DOMSVGFactory)}static#Ee(e,{x:t,y:a,width:i,height:n}){const{style:s}=e;s.top=100*a+"%",s.left=100*t+"%",s.width=100*i+"%",s.height=100*n+"%"}#Se(e){const t=DrawLayer._svgFactory.create(1,1,!0);return this.#y.append(t),DrawLayer.#Ee(t,e),t}highlight({outlines:e,box:t},a,i){const n=this.#ge++,s=this.#Se(t);s.classList.add("highlight");const r=DrawLayer._svgFactory.createElement("defs");s.append(r);const o=DrawLayer._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("d",DrawLayer.#Me(e));const c=DrawLayer._svgFactory.createElement("clipPath");r.append(c);const d=`clip_${l}`;c.setAttribute("id",d),c.setAttribute("clipPathUnits","objectBoundingBox");const u=DrawLayer._svgFactory.createElement("use");c.append(u),u.setAttribute("href",`#${l}`),u.classList.add("clip");const h=DrawLayer._svgFactory.createElement("use");return s.append(h),s.setAttribute("fill",a),s.setAttribute("fill-opacity",i),h.setAttribute("href",`#${l}`),this.#Ce.set(n,s),{id:n,clipPathId:`url(#${d})`}}highlightOutline({outlines:e,box:t}){const a=this.#ge++,i=this.#Se(t);i.classList.add("highlightOutline");const n=DrawLayer._svgFactory.createElement("defs");i.append(n);const s=DrawLayer._svgFactory.createElement("path");n.append(s);const r=`path_p${this.pageIndex}_${a}`;s.setAttribute("id",r),s.setAttribute("d",DrawLayer.#Me(e)),s.setAttribute("vector-effect","non-scaling-stroke");const o=DrawLayer._svgFactory.createElement("use");i.append(o),o.setAttribute("href",`#${r}`);const l=o.cloneNode();return i.append(l),o.classList.add("mainOutline"),l.classList.add("secondaryOutline"),this.#Ce.set(a,i),a}static#Me(e){const t=[];for(const a of e){let[e,i]=a;t.push(`M${e} ${i}`);for(let n=2;n<a.length;n+=2){const s=a[n],r=a[n+1];s===e?(t.push(`V${r}`),i=r):r===i&&(t.push(`H${s}`),e=s)}t.push("Z")}return t.join(" ")}updateBox(e,t){DrawLayer.#Ee(this.#Ce.get(e),t)}rotate(e,t){this.#Ce.get(e).setAttribute("data-main-rotation",t)}changeColor(e,t){this.#Ce.get(e).setAttribute("fill",t)}changeOpacity(e,t){this.#Ce.get(e).setAttribute("fill-opacity",t)}addClass(e,t){this.#Ce.get(e).classList.add(t)}removeClass(e,t){this.#Ce.get(e).classList.remove(t)}remove(e){this.#Ce.get(e).remove(),this.#Ce.delete(e)}destroy(){this.#y=null;for(const e of this.#Ce.values())e.remove();this.#Ce.clear()}}},331:(e,t,a)=>{a.d(t,{AnnotationEditorLayer:()=>AnnotationEditorLayer});var i=a(266),n=a(796),s=a(812),r=a(640);class FreeTextEditor extends n.AnnotationEditor{#Te=this.editorDivBlur.bind(this);#ke=this.editorDivFocus.bind(this);#Pe=this.editorDivInput.bind(this);#De=this.editorDivKeydown.bind(this);#h;#Re="";#Fe=`${this.id}-editor`;#Ie;#Oe=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=FreeTextEditor.prototype,t=e=>e.isEmpty(),a=s.AnnotationEditorUIManager.TRANSLATE_SMALL,n=s.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,i.shadow)(this,"_keyboardManager",new s.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-a,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[a,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-a],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,a],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}]]))}static _type="freetext";static _editorType=i.AnnotationEditorType.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.#h=e.color||FreeTextEditor._defaultColor||n.AnnotationEditor._defaultLineColor,this.#Ie=e.fontSize||FreeTextEditor._defaultFontSize}static initialize(e){n.AnnotationEditor.initialize(e,{strings:["pdfjs-free-text-default-content"]});const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case i.AnnotationEditorParamsType.FREETEXT_SIZE:FreeTextEditor._defaultFontSize=t;break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:FreeTextEditor._defaultColor=t}}updateParams(e,t){switch(e){case i.AnnotationEditorParamsType.FREETEXT_SIZE:this.#Le(t);break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:this.#je(t)}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,FreeTextEditor._defaultFontSize],[i.AnnotationEditorParamsType.FREETEXT_COLOR,FreeTextEditor._defaultColor||n.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,this.#Ie],[i.AnnotationEditorParamsType.FREETEXT_COLOR,this.#h]]}#Le(e){const t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--scale-factor))`,this.translate(0,-(e-this.#Ie)*this.parentScale),this.#Ie=e,this.#Ne()},a=this.#Ie;this.addCommands({cmd:()=>{t(e)},undo:()=>{t(a)},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#je(e){const t=this.#h;this.addCommands({cmd:()=>{this.#h=this.editorDiv.style.color=e},undo:()=>{this.#h=this.editorDiv.style.color=t},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-FreeTextEditor._internalPadding*e,-(FreeTextEditor._internalPadding+this.#Ie)*e]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(i.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#De),this.editorDiv.addEventListener("focus",this.#ke),this.editorDiv.addEventListener("blur",this.#Te),this.editorDiv.addEventListener("input",this.#Pe))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#Fe),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#De),this.editorDiv.removeEventListener("focus",this.#ke),this.editorDiv.removeEventListener("blur",this.#Te),this.editorDiv.removeEventListener("input",this.#Pe),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width?this.#Be():(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#qe(){const e=this.editorDiv.getElementsByTagName("div");if(0===e.length)return this.editorDiv.innerText;const t=[];for(const a of e)t.push(a.innerText.replace(/\r\n?|\n/,""));return t.join("\n")}#Ne(){const[e,t]=this.parentDimensions;let a;if(this.isAttachedToDOM)a=this.div.getBoundingClientRect();else{const{currentLayer:e,div:t}=this,i=t.style.display;t.style.display="hidden",e.div.append(this.div),a=t.getBoundingClientRect(),t.remove(),t.style.display=i}this.rotation%180==this.parentRotation%180?(this.width=a.width/e,this.height=a.height/t):(this.width=a.height/e,this.height=a.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#Re,t=this.#Re=this.#qe().trimEnd();if(e===t)return;const a=e=>{this.#Re=e,e?(this.#ze(),this._uiManager.rebuild(this),this.#Ne()):this.remove()};this.addCommands({cmd:()=>{a(t)},undo:()=>{a(e)},mustExec:!1}),this.#Ne()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){FreeTextEditor._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#Fe),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),n.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then((e=>this.editorDiv?.setAttribute("default-content",e))),this.editorDiv.contentEditable=!0;const{style:a}=this.editorDiv;if(a.fontSize=`calc(${this.#Ie}px * var(--scale-factor))`,a.color=this.#h,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,s.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[a,i]=this.parentDimensions;if(this.annotationElementId){const{position:n}=this.#Oe;let[s,r]=this.getInitialTranslation();[s,r]=this.pageTranslationToScreen(s,r);const[o,l]=this.pageDimensions,[c,d]=this.pageTranslation;let u,h;switch(this.rotation){case 0:u=e+(n[0]-c)/o,h=t+this.height-(n[1]-d)/l;break;case 90:u=e+(n[0]-c)/o,h=t-(n[1]-d)/l,[s,r]=[r,-s];break;case 180:u=e-this.width+(n[0]-c)/o,h=t-(n[1]-d)/l,[s,r]=[-s,-r];break;case 270:u=e+(n[0]-c-this.height*l)/o,h=t+(n[1]-d-this.width*o)/l,[s,r]=[-r,s]}this.setAt(u*a,h*i,s,r)}else this.setAt(e*a,t*i,this.width*a,this.height*i);this.#ze(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#ze(){if(this.editorDiv.replaceChildren(),this.#Re)for(const e of this.#Re.split("\n")){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(e,t,a){let n=null;if(e instanceof r.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:t,fontColor:a},rect:s,rotation:r,id:o},textContent:l,textPosition:c,parent:{page:{pageNumber:d}}}=e;if(!l||0===l.length)return null;n=e={annotationType:i.AnnotationEditorType.FREETEXT,color:Array.from(a),fontSize:t,value:l.join("\n"),position:c,pageIndex:d-1,rect:s,rotation:r,id:o,deleted:!1}}const s=super.deserialize(e,t,a);return s.#Ie=e.fontSize,s.#h=i.Util.makeHexColor(...e.color),s.#Re=e.value,s.annotationElementId=e.id||null,s.#Oe=n,s}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=FreeTextEditor._internalPadding*this.parentScale,a=this.getRect(t,t),s=n.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#h),r={annotationType:i.AnnotationEditorType.FREETEXT,color:s,fontSize:this.#Ie,value:this.#Re,pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?r:this.annotationElementId&&!this.#Ue(r)?null:(r.id=this.annotationElementId,r)}#Ue(e){const{value:t,fontSize:a,color:i,rect:n,pageIndex:s}=this.#Oe;return e.value!==t||e.fontSize!==a||e.rect.some(((e,t)=>Math.abs(e-n[t])>=1))||e.color.some(((e,t)=>e!==i[t]))||e.pageIndex!==s}#Be(e=!1){if(!this.annotationElementId)return;if(this.#Ne(),!e&&(0===this.width||0===this.height))return void setTimeout((()=>this.#Be(!0)),0);const t=FreeTextEditor._internalPadding*this.parentScale;this.#Oe.rect=this.getRect(t,t)}}var o=a(473);class InkEditor extends n.AnnotationEditor{#He=0;#We=0;#$e=this.canvasPointermove.bind(this);#Ve=this.canvasPointerleave.bind(this);#Ge=this.canvasPointerup.bind(this);#Xe=this.canvasPointerdown.bind(this);#Ke=null;#Ye=new Path2D;#Je=!1;#Qe=!1;#Ze=!1;#et=null;#tt=0;#at=0;#it=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=i.AnnotationEditorType.INK;constructor(e){super({...e,name:"inkEditor"}),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(e){n.AnnotationEditor.initialize(e)}static updateDefaultParams(e,t){switch(e){case i.AnnotationEditorParamsType.INK_THICKNESS:InkEditor._defaultThickness=t;break;case i.AnnotationEditorParamsType.INK_COLOR:InkEditor._defaultColor=t;break;case i.AnnotationEditorParamsType.INK_OPACITY:InkEditor._defaultOpacity=t/100}}updateParams(e,t){switch(e){case i.AnnotationEditorParamsType.INK_THICKNESS:this.#nt(t);break;case i.AnnotationEditorParamsType.INK_COLOR:this.#je(t);break;case i.AnnotationEditorParamsType.INK_OPACITY:this.#st(t)}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,InkEditor._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,InkEditor._defaultColor||n.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*InkEditor._defaultOpacity)]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||InkEditor._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,this.color||InkEditor._defaultColor||n.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??InkEditor._defaultOpacity))]]}#nt(e){const t=this.thickness;this.addCommands({cmd:()=>{this.thickness=e,this.#rt()},undo:()=>{this.thickness=t,this.#rt()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#je(e){const t=this.color;this.addCommands({cmd:()=>{this.color=e,this.#ot()},undo:()=>{this.color=t,this.#ot()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#st(e){e/=100;const t=this.opacity;this.addCommands({cmd:()=>{this.opacity=e,this.#ot()},undo:()=>{this.opacity=t,this.#ot()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.canvas||(this.#lt(),this.#ct()),this.isAttachedToDOM||(this.parent.add(this),this.#dt()),this.#rt()))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#Ke&&(clearTimeout(this.#Ke),this.#Ke=null),this.#et.disconnect(),this.#et=null,super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&null===e&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){const[e,t]=this.parentDimensions,a=this.width*e,i=this.height*t;this.setDimensions(a,i)}enableEditMode(){this.#Je||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#Xe))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#Xe))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#ut(){const{parentRotation:e,parentDimensions:[t,a]}=this;switch(e){case 90:return[0,a,a,t];case 180:return[t,a,t,a];case 270:return[t,0,a,t];default:return[0,0,t,a]}}#ht(){const{ctx:e,color:t,opacity:a,thickness:i,parentScale:n,scaleFactor:r}=this;e.lineWidth=i*n/r,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle=`${t}${(0,s.opacityToHex)(a)}`}#pt(e,t){this.canvas.addEventListener("contextmenu",o.noContextMenu),this.canvas.addEventListener("pointerleave",this.#Ve),this.canvas.addEventListener("pointermove",this.#$e),this.canvas.addEventListener("pointerup",this.#Ge),this.canvas.removeEventListener("pointerdown",this.#Xe),this.isEditing=!0,this.#Ze||(this.#Ze=!0,this.#dt(),this.thickness||=InkEditor._defaultThickness,this.color||=InkEditor._defaultColor||n.AnnotationEditor._defaultLineColor,this.opacity??=InkEditor._defaultOpacity),this.currentPath.push([e,t]),this.#Qe=!1,this.#ht(),this.#it=()=>{this.#mt(),this.#it&&window.requestAnimationFrame(this.#it)},window.requestAnimationFrame(this.#it)}#ft(e,t){const[a,i]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===a&&t===i)return;const n=this.currentPath;let s=this.#Ye;if(n.push([e,t]),this.#Qe=!0,n.length<=2)return s.moveTo(...n[0]),void s.lineTo(e,t);3===n.length&&(this.#Ye=s=new Path2D,s.moveTo(...n[0])),this.#gt(s,...n.at(-3),...n.at(-2),e,t)}#yt(){if(0===this.currentPath.length)return;const e=this.currentPath.at(-1);this.#Ye.lineTo(...e)}#vt(e,t){let a;if(this.#it=null,e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height),this.#ft(e,t),this.#yt(),1!==this.currentPath.length)a=this.#bt();else{const i=[e,t];a=[[i,i.slice(),i.slice(),i]]}const i=this.#Ye,n=this.currentPath;this.currentPath=[],this.#Ye=new Path2D;this.addCommands({cmd:()=>{this.allRawPaths.push(n),this.paths.push(a),this.bezierPath2D.push(i),this.rebuild()},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#lt(),this.#ct()),this.#rt())},mustExec:!0})}#mt(){if(!this.#Qe)return;this.#Qe=!1;const e=Math.ceil(this.thickness*this.parentScale),t=this.currentPath.slice(-3),a=t.map((e=>e[0])),i=t.map((e=>e[1])),{ctx:n}=(Math.min(...a),Math.max(...a),Math.min(...i),Math.max(...i),this);n.save(),n.clearRect(0,0,this.canvas.width,this.canvas.height);for(const e of this.bezierPath2D)n.stroke(e);n.stroke(this.#Ye),n.restore()}#gt(e,t,a,i,n,s,r){const o=(t+i)/2,l=(a+n)/2,c=(i+s)/2,d=(n+r)/2;e.bezierCurveTo(o+2*(i-o)/3,l+2*(n-l)/3,c+2*(i-c)/3,d+2*(n-d)/3,c,d)}#bt(){const e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];const t=[];let a,[i,n]=e[0];for(a=1;a<e.length-2;a++){const[s,r]=e[a],[o,l]=e[a+1],c=(s+o)/2,d=(r+l)/2,u=[i+2*(s-i)/3,n+2*(r-n)/3],h=[c+2*(s-c)/3,d+2*(r-d)/3];t.push([[i,n],u,h,[c,d]]),[i,n]=[c,d]}const[s,r]=e[a],[o,l]=e[a+1],c=[i+2*(s-i)/3,n+2*(r-n)/3],d=[o+2*(s-o)/3,l+2*(r-l)/3];return t.push([[i,n],c,d,[o,l]]),t}#ot(){if(this.isEmpty())return void this.#At();this.#ht();const{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),this.#At();for(const e of this.bezierPath2D)t.stroke(e)}commit(){this.#Je||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#Je=!0,this.div.classList.add("disabled"),this.#rt(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),this.enableEditMode())}canvasPointerdown(e){0===e.button&&this.isInEditMode()&&!this.#Je&&(this.setInForeground(),e.preventDefault(),"mouse"===e.pointerType||this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#pt(e.offsetX,e.offsetY))}canvasPointermove(e){e.preventDefault(),this.#ft(e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),this.#_t(e)}canvasPointerleave(e){this.#_t(e)}#_t(e){this.canvas.removeEventListener("pointerleave",this.#Ve),this.canvas.removeEventListener("pointermove",this.#$e),this.canvas.removeEventListener("pointerup",this.#Ge),this.canvas.addEventListener("pointerdown",this.#Xe),this.#Ke&&clearTimeout(this.#Ke),this.#Ke=setTimeout((()=>{this.#Ke=null,this.canvas.removeEventListener("contextmenu",o.noContextMenu)}),10),this.#vt(e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#lt(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#ct(){this.#et=new ResizeObserver((e=>{const t=e[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)})),this.#et.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#Je}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[a,i,n,s]=this.#ut();if(this.setAt(a,i,0,0),this.setDims(n,s),this.#lt(),this.width){const[a,i]=this.parentDimensions;this.setAspectRatio(this.width*a,this.height*i),this.setAt(e*a,t*i,this.width*a,this.height*i),this.#Ze=!0,this.#dt(),this.setDims(this.width*a,this.height*i),this.#ot(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#ct(),this.div}#dt(){if(!this.#Ze)return;const[e,t]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),this.#At()}setDimensions(e,t){const a=Math.round(e),i=Math.round(t);if(this.#tt===a&&this.#at===i)return;this.#tt=a,this.#at=i,this.canvas.style.visibility="hidden";const[n,s]=this.parentDimensions;this.width=e/n,this.height=t/s,this.fixAndSetPosition(),this.#Je&&this.#xt(e,t),this.#dt(),this.#ot(),this.canvas.style.visibility="visible",this.fixDims()}#xt(e,t){const a=this.#wt(),i=(e-a)/this.#We,n=(t-a)/this.#He;this.scaleFactor=Math.min(i,n)}#At(){const e=this.#wt()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)}static#Ct(e){const t=new Path2D;for(let a=0,i=e.length;a<i;a++){const[i,n,s,r]=e[a];0===a&&t.moveTo(...i),t.bezierCurveTo(n[0],n[1],s[0],s[1],r[0],r[1])}return t}static#Et(e,t,a){const[i,n,s,r]=t;switch(a){case 0:for(let t=0,a=e.length;t<a;t+=2)e[t]+=i,e[t+1]=r-e[t+1];break;case 90:for(let t=0,a=e.length;t<a;t+=2){const a=e[t];e[t]=e[t+1]+i,e[t+1]=a+n}break;case 180:for(let t=0,a=e.length;t<a;t+=2)e[t]=s-e[t],e[t+1]+=n;break;case 270:for(let t=0,a=e.length;t<a;t+=2){const a=e[t];e[t]=s-e[t+1],e[t+1]=r-a}break;default:throw new Error("Invalid rotation")}return e}static#St(e,t,a){const[i,n,s,r]=t;switch(a){case 0:for(let t=0,a=e.length;t<a;t+=2)e[t]-=i,e[t+1]=r-e[t+1];break;case 90:for(let t=0,a=e.length;t<a;t+=2){const a=e[t];e[t]=e[t+1]-n,e[t+1]=a-i}break;case 180:for(let t=0,a=e.length;t<a;t+=2)e[t]=s-e[t],e[t+1]-=n;break;case 270:for(let t=0,a=e.length;t<a;t+=2){const a=e[t];e[t]=r-e[t+1],e[t+1]=s-a}break;default:throw new Error("Invalid rotation")}return e}#Mt(e,t,a,i){const n=[],s=this.thickness/2,r=e*t+s,o=e*a+s;for(const t of this.paths){const a=[],s=[];for(let i=0,n=t.length;i<n;i++){const[l,c,d,u]=t[i],h=e*l[0]+r,p=e*l[1]+o,m=e*c[0]+r,f=e*c[1]+o,g=e*d[0]+r,y=e*d[1]+o,v=e*u[0]+r,b=e*u[1]+o;0===i&&(a.push(h,p),s.push(h,p)),a.push(m,f,g,y,v,b),s.push(m,f),i===n-1&&s.push(v,b)}n.push({bezier:InkEditor.#Et(a,i,this.rotation),points:InkEditor.#Et(s,i,this.rotation)})}return n}#Tt(){let e=1/0,t=-1/0,a=1/0,n=-1/0;for(const s of this.paths)for(const[r,o,l,c]of s){const s=i.Util.bezierBoundingBox(...r,...o,...l,...c);e=Math.min(e,s[0]),a=Math.min(a,s[1]),t=Math.max(t,s[2]),n=Math.max(n,s[3])}return[e,a,t,n]}#wt(){return this.#Je?Math.ceil(this.thickness*this.parentScale):0}#rt(e=!1){if(this.isEmpty())return;if(!this.#Je)return void this.#ot();const t=this.#Tt(),a=this.#wt();this.#We=Math.max(n.AnnotationEditor.MIN_SIZE,t[2]-t[0]),this.#He=Math.max(n.AnnotationEditor.MIN_SIZE,t[3]-t[1]);const i=Math.ceil(a+this.#We*this.scaleFactor),s=Math.ceil(a+this.#He*this.scaleFactor),[r,o]=this.parentDimensions;this.width=i/r,this.height=s/o,this.setAspectRatio(i,s);const l=this.translationX,c=this.translationY;this.translationX=-t[0],this.translationY=-t[1],this.#dt(),this.#ot(),this.#tt=i,this.#at=s,this.setDims(i,s);const d=e?a/this.scaleFactor/2:0;this.translate(l-this.translationX-d,c-this.translationY-d)}static deserialize(e,t,a){if(e instanceof r.InkAnnotationElement)return null;const s=super.deserialize(e,t,a);s.thickness=e.thickness,s.color=i.Util.makeHexColor(...e.color),s.opacity=e.opacity;const[o,l]=s.pageDimensions,c=s.width*o,d=s.height*l,u=s.parentScale,h=e.thickness/2;s.#Je=!0,s.#tt=Math.round(c),s.#at=Math.round(d);const{paths:p,rect:m,rotation:f}=e;for(let{bezier:e}of p){e=InkEditor.#St(e,m,f);const t=[];s.paths.push(t);let a=u*(e[0]-h),i=u*(e[1]-h);for(let n=2,s=e.length;n<s;n+=6){const s=u*(e[n]-h),r=u*(e[n+1]-h),o=u*(e[n+2]-h),l=u*(e[n+3]-h),c=u*(e[n+4]-h),d=u*(e[n+5]-h);t.push([[a,i],[s,r],[o,l],[c,d]]),a=c,i=d}const n=this.#Ct(t);s.bezierPath2D.push(n)}const g=s.#Tt();return s.#We=Math.max(n.AnnotationEditor.MIN_SIZE,g[2]-g[0]),s.#He=Math.max(n.AnnotationEditor.MIN_SIZE,g[3]-g[1]),s.#xt(c,d),s}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),t=n.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:i.AnnotationEditorType.INK,color:t,thickness:this.thickness,opacity:this.opacity,paths:this.#Mt(this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class StampEditor extends n.AnnotationEditor{#kt=null;#Pt=null;#Dt=null;#Rt=null;#Ft=null;#It="";#Ot=null;#et=null;#Lt=null;#jt=!1;#Nt=!1;static _type="stamp";static _editorType=i.AnnotationEditorType.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#Rt=e.bitmapUrl,this.#Ft=e.bitmapFile}static initialize(e){n.AnnotationEditor.initialize(e)}static get supportedTypes(){return(0,i.shadow)(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((e=>`image/${e}`)))}static get supportedTypesStr(){return(0,i.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(i.AnnotationEditorType.STAMP,{bitmapFile:e.getAsFile()})}#Bt(e,t=!1){e?(this.#kt=e.bitmap,t||(this.#Pt=e.id,this.#jt=e.isSvg),e.file&&(this.#It=e.file.name),this.#lt()):this.remove()}#qt(){this.#Dt=null,this._uiManager.enableWaiting(!1),this.#Ot&&this.div.focus()}#zt(){if(this.#Pt)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#Pt).then((e=>this.#Bt(e,!0))).finally((()=>this.#qt()));if(this.#Rt){const e=this.#Rt;return this.#Rt=null,this._uiManager.enableWaiting(!0),void(this.#Dt=this._uiManager.imageManager.getFromUrl(e).then((e=>this.#Bt(e))).finally((()=>this.#qt())))}if(this.#Ft){const e=this.#Ft;return this.#Ft=null,this._uiManager.enableWaiting(!0),void(this.#Dt=this._uiManager.imageManager.getFromFile(e).then((e=>this.#Bt(e))).finally((()=>this.#qt())))}const e=document.createElement("input");e.type="file",e.accept=StampEditor.supportedTypesStr,this.#Dt=new Promise((t=>{e.addEventListener("change",(async()=>{if(e.files&&0!==e.files.length){this._uiManager.enableWaiting(!0);const t=await this._uiManager.imageManager.getFromFile(e.files[0]);this.#Bt(t)}else this.remove();t()})),e.addEventListener("cancel",(()=>{this.remove(),t()}))})).finally((()=>this.#qt())),e.click()}remove(){this.#Pt&&(this.#kt=null,this._uiManager.imageManager.deleteId(this.#Pt),this.#Ot?.remove(),this.#Ot=null,this.#et?.disconnect(),this.#et=null,this.#Lt&&(clearTimeout(this.#Lt),this.#Lt=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#Pt&&this.#zt(),this.isAttachedToDOM||this.parent.add(this))):this.#Pt&&this.#zt()}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#Dt||this.#kt||this.#Rt||this.#Ft)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.#kt?this.#lt():this.#zt(),this.width){const[a,i]=this.parentDimensions;this.setAt(e*a,t*i,this.width*a,this.height*i)}return this.div}#lt(){const{div:e}=this;let{width:t,height:a}=this.#kt;const[i,n]=this.pageDimensions,s=.75;if(this.width)t=this.width*i,a=this.height*n;else if(t>s*i||a>s*n){const e=Math.min(s*i/t,s*n/a);t*=e,a*=e}const[r,o]=this.parentDimensions;this.setDims(t*r/i,a*o/n),this._uiManager.enableWaiting(!1);const l=this.#Ot=document.createElement("canvas");e.append(l),e.hidden=!1,this.#Ut(t,a),this.#ct(),this.#Nt||(this.parent.addUndoableEditor(this),this.#Nt=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton(),this.#It&&l.setAttribute("aria-label",this.#It)}#Ht(e,t){const[a,i]=this.parentDimensions;this.width=e/a,this.height=t/i,this.setDims(e,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==this.#Lt&&clearTimeout(this.#Lt);this.#Lt=setTimeout((()=>{this.#Lt=null,this.#Ut(e,t)}),200)}#Wt(e,t){const{width:a,height:i}=this.#kt;let n=a,s=i,r=this.#kt;for(;n>2*e||s>2*t;){const a=n,i=s;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),s>2*t&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2));const o=new OffscreenCanvas(n,s);o.getContext("2d").drawImage(r,0,0,a,i,0,0,n,s),r=o.transferToImageBitmap()}return r}#Ut(e,t){e=Math.ceil(e),t=Math.ceil(t);const a=this.#Ot;if(!a||a.width===e&&a.height===t)return;a.width=e,a.height=t;const i=this.#jt?this.#kt:this.#Wt(e,t),n=a.getContext("2d");n.filter=this._uiManager.hcmFilter,n.drawImage(i,0,0,i.width,i.height,0,0,e,t)}getImageForAltText(){return this.#Ot}#$t(e){if(e){if(this.#jt){const e=this._uiManager.imageManager.getSvgUrl(this.#Pt);if(e)return e}const e=document.createElement("canvas");({width:e.width,height:e.height}=this.#kt);return e.getContext("2d").drawImage(this.#kt,0,0),e.toDataURL()}if(this.#jt){const[e,t]=this.pageDimensions,a=Math.round(this.width*e*o.PixelsPerInch.PDF_TO_CSS_UNITS),i=Math.round(this.height*t*o.PixelsPerInch.PDF_TO_CSS_UNITS),n=new OffscreenCanvas(a,i);return n.getContext("2d").drawImage(this.#kt,0,0,this.#kt.width,this.#kt.height,0,0,a,i),n.transferToImageBitmap()}return structuredClone(this.#kt)}#ct(){this.#et=new ResizeObserver((e=>{const t=e[0].contentRect;t.width&&t.height&&this.#Ht(t.width,t.height)})),this.#et.observe(this.div)}static deserialize(e,t,a){if(e instanceof r.StampAnnotationElement)return null;const i=super.deserialize(e,t,a),{rect:n,bitmapUrl:s,bitmapId:o,isSvg:l,accessibilityData:c}=e;o&&a.imageManager.isValidId(o)?i.#Pt=o:i.#Rt=s,i.#jt=l;const[d,u]=i.pageDimensions;return i.width=(n[2]-n[0])/d,i.height=(n[3]-n[1])/u,c&&(i.altTextData=c),i}serialize(e=!1,t=null){if(this.isEmpty())return null;const a={annotationType:i.AnnotationEditorType.STAMP,bitmapId:this.#Pt,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#jt,structTreeParentId:this._structTreeParentId};if(e)return a.bitmapUrl=this.#$t(!0),a.accessibilityData=this.altTextData,a;const{decorative:n,altText:s}=this.altTextData;if(!n&&s&&(a.accessibilityData={type:"Figure",alt:s}),null===t)return a;t.stamps||=new Map;const r=this.#jt?(a.rect[2]-a.rect[0])*(a.rect[3]-a.rect[1]):null;if(t.stamps.has(this.#Pt)){if(this.#jt){const e=t.stamps.get(this.#Pt);r>e.area&&(e.area=r,e.serialized.bitmap.close(),e.serialized.bitmap=this.#$t(!1))}}else t.stamps.set(this.#Pt,{area:r,serialized:a}),a.bitmap=this.#$t(!1);return a}}class AnnotationEditorLayer{#R;#Vt=!1;#Gt=null;#Xt=this.pointerup.bind(this);#Kt=this.pointerdown.bind(this);#Yt=null;#Jt=new Map;#Qt=!1;#Zt=!1;#ea=!1;#ta;static _initialized=!1;static#aa=new Map([FreeTextEditor,InkEditor,StampEditor].map((e=>[e._editorType,e])));constructor({uiManager:e,pageIndex:t,div:a,accessibilityManager:i,annotationLayer:n,viewport:s,l10n:r}){const o=[...AnnotationEditorLayer.#aa.values()];if(!AnnotationEditorLayer._initialized){AnnotationEditorLayer._initialized=!0;for(const e of o)e.initialize(r)}e.registerEditorTypes(o),this.#ta=e,this.pageIndex=t,this.div=a,this.#R=i,this.#Gt=n,this.viewport=s,this.#ta.addLayer(this)}get isEmpty(){return 0===this.#Jt.size}updateToolbar(e){this.#ta.updateToolbar(e)}updateMode(e=this.#ta.getMode()){if(this.#ia(),e===i.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),e!==i.AnnotationEditorType.NONE){const{classList:t}=this.div;for(const a of AnnotationEditorLayer.#aa.values())t.toggle(`${a._type}Editing`,e===a._editorType);this.div.hidden=!1}}addInkEditorIfNeeded(e){if(!e&&this.#ta.getMode()!==i.AnnotationEditorType.INK)return;if(!e)for(const e of this.#Jt.values())if(e.isEmpty())return void e.setInBackground();this.#na({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(e){this.#ta.setEditingState(e)}addCommands(e){this.#ta.addCommands(e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}enable(){this.togglePointerEvents(!0);const e=new Set;for(const t of this.#Jt.values())t.enableEditing(),t.annotationElementId&&e.add(t.annotationElementId);if(!this.#Gt)return;const t=this.#Gt.getEditableAnnotations();for(const a of t){if(a.hide(),this.#ta.isDeletedAnnotationElement(a.data.id))continue;if(e.has(a.data.id))continue;const t=this.deserialize(a);t&&(this.addOrRebuild(t),t.enableEditing())}}disable(){this.#ea=!0,this.togglePointerEvents(!1);const e=new Set;for(const t of this.#Jt.values())t.disableEditing(),t.annotationElementId&&null===t.serialize()?(this.getEditableAnnotation(t.annotationElementId)?.show(),t.remove()):e.add(t.annotationElementId);if(this.#Gt){const t=this.#Gt.getEditableAnnotations();for(const a of t){const{id:t}=a.data;e.has(t)||this.#ta.isDeletedAnnotationElement(t)||a.show()}}this.#ia(),this.isEmpty&&(this.div.hidden=!0);const{classList:t}=this.div;for(const e of AnnotationEditorLayer.#aa.values())t.remove(`${e._type}Editing`);this.#ea=!1}getEditableAnnotation(e){return this.#Gt?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#ta.getActive()!==e&&this.#ta.setActiveEditor(e)}enableClick(){this.div.addEventListener("pointerdown",this.#Kt),this.div.addEventListener("pointerup",this.#Xt)}disableClick(){this.div.removeEventListener("pointerdown",this.#Kt),this.div.removeEventListener("pointerup",this.#Xt)}attach(e){this.#Jt.set(e.id,e);const{annotationElementId:t}=e;t&&this.#ta.isDeletedAnnotationElement(t)&&this.#ta.removeDeletedAnnotationElement(e)}detach(e){this.#Jt.delete(e.id),this.#R?.removePointerInTextLayer(e.contentDiv),!this.#ea&&e.annotationElementId&&this.#ta.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#ta.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,this.#Zt||this.addInkEditorIfNeeded(!1)}changeParent(e){e.parent!==this&&(e.annotationElementId&&(this.#ta.addDeletedAnnotationElement(e.annotationElementId),n.AnnotationEditor.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(this.changeParent(e),this.#ta.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),this.#ta.addToAnnotationStorage(e)}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#Yt&&(e._focusEventsAllowed=!1,this.#Yt=setTimeout((()=>{this.#Yt=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",(()=>{e._focusEventsAllowed=!0}),{once:!0}),t.focus())}),0)),e._structTreeParentId=this.#R?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getNextId(){return this.#ta.getId()}#sa(e){const t=AnnotationEditorLayer.#aa.get(this.#ta.getMode());return t?new t.prototype.constructor(e):null}pasteEditor(e,t){this.#ta.updateToolbar(e),this.#ta.updateMode(e);const{offsetX:a,offsetY:i}=this.#ra(),n=this.getNextId(),s=this.#sa({parent:this,id:n,x:a,y:i,uiManager:this.#ta,isCentered:!0,...t});s&&this.add(s)}deserialize(e){return AnnotationEditorLayer.#aa.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#ta)||null}#na(e,t){const a=this.getNextId(),i=this.#sa({parent:this,id:a,x:e.offsetX,y:e.offsetY,uiManager:this.#ta,isCentered:t});return i&&this.add(i),i}#ra(){const{x:e,y:t,width:a,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,e),s=Math.max(0,t),r=(n+Math.min(window.innerWidth,e+a))/2-e,o=(s+Math.min(window.innerHeight,t+i))/2-t,[l,c]=this.viewport.rotation%180==0?[r,o]:[o,r];return{offsetX:l,offsetY:c}}addNewEditor(){this.#na(this.#ra(),!0)}setSelected(e){this.#ta.setSelected(e)}toggleSelected(e){this.#ta.toggleSelected(e)}isSelected(e){return this.#ta.isSelected(e)}unselect(e){this.#ta.unselect(e)}pointerup(e){const{isMac:t}=i.FeatureTest.platform;0!==e.button||e.ctrlKey&&t||e.target===this.div&&this.#Qt&&(this.#Qt=!1,this.#Vt?this.#ta.getMode()!==i.AnnotationEditorType.STAMP?this.#na(e,!1):this.#ta.unselectAll():this.#Vt=!0)}pointerdown(e){if(this.#Qt)return void(this.#Qt=!1);const{isMac:t}=i.FeatureTest.platform;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;this.#Qt=!0;const a=this.#ta.getActive();this.#Vt=!a||a.isEmpty()}findNewParent(e,t,a){const i=this.#ta.findParent(t,a);return null!==i&&i!==this&&(i.changeParent(e),!0)}destroy(){this.#ta.getActive()?.parent===this&&(this.#ta.commitOrRemove(),this.#ta.setActiveEditor(null)),this.#Yt&&(clearTimeout(this.#Yt),this.#Yt=null);for(const e of this.#Jt.values())this.#R?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#Jt.clear(),this.#ta.removeLayer(this)}#ia(){this.#Zt=!0;for(const e of this.#Jt.values())e.isEmpty()&&e.remove();this.#Zt=!1}render({viewport:e}){this.viewport=e,(0,o.setLayerDimensions)(this.div,e);for(const e of this.#ta.getEditors(this.pageIndex))this.add(e);this.updateMode()}update({viewport:e}){this.#ta.commitOrRemove(),this.viewport=e,(0,o.setLayerDimensions)(this.div,{rotation:e.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}}},796:(e,t,a)=>{a.d(t,{AnnotationEditor:()=>AnnotationEditor});var i=a(812),n=a(266),s=a(473);class EditorToolbar{#oa=null;#la;#ca=null;constructor(e){this.#la=e}render(){const e=this.#oa=document.createElement("div");e.className="editToolbar",e.addEventListener("contextmenu",s.noContextMenu),e.addEventListener("pointerdown",EditorToolbar.#da);const t=this.#ca=document.createElement("div");return t.className="buttons",e.append(t),this.#ua(),e}static#da(e){e.stopPropagation()}#ha(e){this.#la._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()}#pa(e){this.#la._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()}#ma(e){e.addEventListener("focusin",this.#ha.bind(this),{capture:!0}),e.addEventListener("focusout",this.#pa.bind(this),{capture:!0}),e.addEventListener("contextmenu",s.noContextMenu)}hide(){this.#oa.classList.add("hidden")}show(){this.#oa.classList.remove("hidden")}#ua(){const e=document.createElement("button");e.className="delete",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-editor-remove-button"),this.#ma(e),e.addEventListener("click",(e=>{this.#la._uiManager.delete()})),this.#ca.append(e)}remove(){this.#oa.remove()}}class AnnotationEditor{#fa=null;#ga="";#ya=!1;#va=null;#ba=null;#Aa=null;#_a=!1;#xa=!1;#wa=null;#Ca=null;#Ea=this.focusin.bind(this);#Sa=this.focusout.bind(this);#Ma=null;#Ta="";#ka=!1;#Pa=!1;#Da=!1;#Ra=!1;#Fa=null;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#Ia=!1;#Oa=AnnotationEditor._zIndex++;static _borderLineWidth=-1;static _colorManager=new i.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;static get _resizerKeyboardManager(){const e=AnnotationEditor.prototype._resizeWithKeyboard,t=i.AnnotationEditorUIManager.TRANSLATE_SMALL,a=i.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,n.shadow)(this,"_resizerKeyboardManager",new i.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-a,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[a,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-a]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,a]}],[["Escape","mac+Escape"],AnnotationEditor.prototype._stopResizingWithKeyboard]]))}constructor(e){this.constructor===AnnotationEditor&&(0,n.unreachable)("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:a,pageHeight:i,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[a,i],this.pageTranslation=[s,r];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,n.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new FakeEditor({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t=null){if(AnnotationEditor._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map((t=>[t,e.get(t.replaceAll(/([A-Z])/g,(e=>`-${e.toLowerCase()}`)))]))),t?.strings)for(const a of t.strings)AnnotationEditor._l10nPromise.set(a,e.get(a));if(-1!==AnnotationEditor._borderLineWidth)return;const a=getComputedStyle(document.documentElement);AnnotationEditor._borderLineWidth=parseFloat(a.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){(0,n.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#Ia}set _isDraggable(e){this.#Ia=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(2*e),this.y+=this.width*e/(2*t);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(2*e),this.y-=this.width*e/(2*t);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#Oa}setParent(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#La(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#ka?this.#ka=!1:this.parent.setSelected(this))}focusout(e){if(!this._focusEventsAllowed)return;if(!this.isAttachedToDOM)return;const t=e.relatedTarget;t?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,a,i){const[n,s]=this.parentDimensions;[a,i]=this.screenToPageTranslation(a,i),this.x=(e+a)/n,this.y=(t+i)/s,this.fixAndSetPosition()}#ja([e,t],a,i){[a,i]=this.screenToPageTranslation(a,i),this.x+=a/e,this.y+=i/t,this.fixAndSetPosition()}translate(e,t){this.#ja(this.parentDimensions,e,t)}translateInPage(e,t){this.#ja(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){const[a,i]=this.parentDimensions;if(this.x+=e/a,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:e,y:t}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,t)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:n,y:s}=this;const[r,o]=this.#Na();n+=r,s+=o,this.div.style.left=`${(100*n).toFixed(2)}%`,this.div.style.top=`${(100*s).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#Na(){const[e,t]=this.parentDimensions,{_borderLineWidth:a}=AnnotationEditor,i=a/e,n=a/t;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}fixAndSetPosition(){const[e,t]=this.pageDimensions;let{x:a,y:i,width:n,height:s}=this;switch(n*=e,s*=t,a*=e,i*=t,this.rotation){case 0:a=Math.max(0,Math.min(e-n,a)),i=Math.max(0,Math.min(t-s,i));break;case 90:a=Math.max(0,Math.min(e-s,a)),i=Math.min(t,Math.max(n,i));break;case 180:a=Math.min(e,Math.max(n,a)),i=Math.min(t,Math.max(s,i));break;case 270:a=Math.min(e,Math.max(s,a)),i=Math.max(0,Math.min(t-n,i))}this.x=a/=e,this.y=i/=t;const[r,o]=this.#Na();a+=r,i+=o;const{style:l}=this.div;l.left=`${(100*a).toFixed(2)}%`,l.top=`${(100*i).toFixed(2)}%`,this.moveInDOM()}static#Ba(e,t,a){switch(a){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return AnnotationEditor.#Ba(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return AnnotationEditor.#Ba(e,t,360-this.parentRotation)}#qa(e){switch(e){case 90:{const[e,t]=this.pageDimensions;return[0,-e/t,t/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,t]=this.pageDimensions;return[0,e/t,-t/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,a]}=this,i=t*e,s=a*e;return n.FeatureTest.isCSSRoundSupported?[Math.round(i),Math.round(s)]:[i,s]}setDims(e,t){const[a,i]=this.parentDimensions;this.div.style.width=`${(100*e/a).toFixed(2)}%`,this.#xa||(this.div.style.height=`${(100*t/i).toFixed(2)}%`),this.#va?.classList.toggle("small",e<AnnotationEditor.SMALL_EDITOR_SIZE||t<AnnotationEditor.SMALL_EDITOR_SIZE)}fixDims(){const{style:e}=this.div,{height:t,width:a}=e,i=a.endsWith("%"),n=!this.#xa&&t.endsWith("%");if(i&&n)return;const[s,r]=this.parentDimensions;i||(e.width=`${(100*parseFloat(a)/s).toFixed(2)}%`),this.#xa||n||(e.height=`${(100*parseFloat(t)/r).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#za(){if(this.#wa)return;this.#wa=document.createElement("div"),this.#wa.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const t of e){const e=document.createElement("div");this.#wa.append(e),e.classList.add("resizer",t),e.setAttribute("data-resizer-name",t),e.addEventListener("pointerdown",this.#Ua.bind(this,t)),e.addEventListener("contextmenu",s.noContextMenu),e.tabIndex=-1}this.div.prepend(this.#wa)}#Ua(e,t){t.preventDefault();const{isMac:a}=n.FeatureTest.platform;if(0!==t.button||t.ctrlKey&&a)return;this.#Ha(!1);const i=this.#Wa.bind(this,e),s=this._isDraggable;this._isDraggable=!1;const r={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",i,r);const o=this.x,l=this.y,c=this.width,d=this.height,u=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const p=()=>{this.parent.togglePointerEvents(!0),this.#Ha(!0),this._isDraggable=s,window.removeEventListener("pointerup",p),window.removeEventListener("blur",p),window.removeEventListener("pointermove",i,r),this.parent.div.style.cursor=u,this.div.style.cursor=h,this.#$a(o,l,c,d)};window.addEventListener("pointerup",p),window.addEventListener("blur",p)}#$a(e,t,a,i){const n=this.x,s=this.y,r=this.width,o=this.height;n===e&&s===t&&r===a&&o===i||this.addCommands({cmd:()=>{this.width=r,this.height=o,this.x=n,this.y=s;const[e,t]=this.parentDimensions;this.setDims(e*r,t*o),this.fixAndSetPosition()},undo:()=>{this.width=a,this.height=i,this.x=e,this.y=t;const[n,s]=this.parentDimensions;this.setDims(n*a,s*i),this.fixAndSetPosition()},mustExec:!0})}#Wa(e,t){const[a,i]=this.parentDimensions,n=this.x,s=this.y,r=this.width,o=this.height,l=AnnotationEditor.MIN_SIZE/a,c=AnnotationEditor.MIN_SIZE/i,d=e=>Math.round(1e4*e)/1e4,u=this.#qa(this.rotation),h=(e,t)=>[u[0]*e+u[2]*t,u[1]*e+u[3]*t],p=this.#qa(360-this.rotation);let m,f,g=!1,y=!1;switch(e){case"topLeft":g=!0,m=(e,t)=>[0,0],f=(e,t)=>[e,t];break;case"topMiddle":m=(e,t)=>[e/2,0],f=(e,t)=>[e/2,t];break;case"topRight":g=!0,m=(e,t)=>[e,0],f=(e,t)=>[0,t];break;case"middleRight":y=!0,m=(e,t)=>[e,t/2],f=(e,t)=>[0,t/2];break;case"bottomRight":g=!0,m=(e,t)=>[e,t],f=(e,t)=>[0,0];break;case"bottomMiddle":m=(e,t)=>[e/2,t],f=(e,t)=>[e/2,0];break;case"bottomLeft":g=!0,m=(e,t)=>[0,t],f=(e,t)=>[e,0];break;case"middleLeft":y=!0,m=(e,t)=>[0,t/2],f=(e,t)=>[e,t/2]}const v=m(r,o),b=f(r,o);let A=h(...b);const _=d(n+A[0]),x=d(s+A[1]);let w=1,C=1,[E,S]=this.screenToPageTranslation(t.movementX,t.movementY);var M,T;if([E,S]=(M=E/a,T=S/i,[p[0]*M+p[2]*T,p[1]*M+p[3]*T]),g){const e=Math.hypot(r,o);w=C=Math.max(Math.min(Math.hypot(b[0]-v[0]-E,b[1]-v[1]-S)/e,1/r,1/o),l/r,c/o)}else y?w=Math.max(l,Math.min(1,Math.abs(b[0]-v[0]-E)))/r:C=Math.max(c,Math.min(1,Math.abs(b[1]-v[1]-S)))/o;const k=d(r*w),P=d(o*C);A=h(...f(k,P));const D=_-A[0],R=x-A[1];this.width=k,this.height=P,this.x=D,this.y=R,this.setDims(a*k,i*P),this.fixAndSetPosition()}async addAltTextButton(){if(this.#va)return;const e=this.#va=document.createElement("button");e.className="altText";const t=await AnnotationEditor._l10nPromise.get("pdfjs-editor-alt-text-button-label");e.textContent=t,e.setAttribute("aria-label",t),e.tabIndex="0",e.addEventListener("contextmenu",s.noContextMenu),e.addEventListener("pointerdown",(e=>e.stopPropagation()));const a=e=>{this.#va.hidden=!0,e.preventDefault(),this._uiManager.editAltText(this)};if(e.addEventListener("click",a,{capture:!0}),e.addEventListener("keydown",(t=>{t.target===e&&"Enter"===t.key&&(this.#_a=!0,a(t))})),this.#Va(),this.div.append(e),!AnnotationEditor.SMALL_EDITOR_SIZE){const t=40;AnnotationEditor.SMALL_EDITOR_SIZE=Math.min(128,Math.round(e.getBoundingClientRect().width*(1+t/100)))}}async#Va(){const e=this.#va;if(!e)return;if(!this.#ga&&!this.#ya)return e.classList.remove("done"),void this.#ba?.remove();e.classList.add("done"),AnnotationEditor._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then((t=>{e.setAttribute("aria-label",t)}));let t=this.#ba;if(!t){this.#ba=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const a=t.id=`alt-text-tooltip-${this.id}`;e.setAttribute("aria-describedby",a);const i=100;e.addEventListener("mouseenter",(()=>{this.#Aa=setTimeout((()=>{this.#Aa=null,this.#ba.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})}),i)})),e.addEventListener("mouseleave",(()=>{this.#Aa&&(clearTimeout(this.#Aa),this.#Aa=null),this.#ba?.classList.remove("show")}))}t.innerText=this.#ya?await AnnotationEditor._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#ga,t.parentNode||e.append(t);const a=this.getImageForAltText();a?.setAttribute("aria-describedby",t.id)}#Ha(e=!1){this.#va&&(!e&&this.#Aa&&(clearTimeout(this.#Aa),this.#Aa=null),this.#va.disabled=!e)}altTextFinish(){this.#va&&(this.#va.hidden=!1,this.#va.focus({focusVisible:this.#_a}),this.#_a=!1)}addEditToolbar(){this.#Ma||this.#Da||(this.#Ma=new EditorToolbar(this),this.div.append(this.#Ma.render()))}removeEditToolbar(){this.#Ma&&(this.#Ma.remove(),this.#Ma=null)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#ga,decorative:this.#ya}}set altTextData({altText:e,decorative:t}){this.#ga===e&&this.#ya===t||(this.#ga=e,this.#ya=t,this.#Va())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#Ea),this.div.addEventListener("focusout",this.#Sa);const[e,t]=this.parentDimensions;this.parentRotation%180!=0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[a,n]=this.getInitialTranslation();return this.translate(a,n),(0,i.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(e){const{isMac:t}=n.FeatureTest.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(this.#ka=!0,this.#Ga(e))}#Ga(e){if(!this._isDraggable)return;const t=this._uiManager.isSelected(this);let a,i;this._uiManager.setUpDragSession(),t&&(a={passive:!0,capture:!0},i=e=>{const[t,a]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(t,a)},window.addEventListener("pointermove",i,a));const s=()=>{if(window.removeEventListener("pointerup",s),window.removeEventListener("blur",s),t&&window.removeEventListener("pointermove",i,a),this.#ka=!1,!this._uiManager.endDragSession()){const{isMac:t}=n.FeatureTest.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",s),window.addEventListener("blur",s)}moveInDOM(){this.#Fa&&clearTimeout(this.#Fa),this.#Fa=setTimeout((()=>{this.#Fa=null,this.parent?.moveEditorInDOM(this)}),0)}_setParentAndPosition(e,t,a){e.changeParent(this),this.x=t,this.y=a,this.fixAndSetPosition()}getRect(e,t){const a=this.parentScale,[i,n]=this.pageDimensions,[s,r]=this.pageTranslation,o=e/a,l=t/a,c=this.x*i,d=this.y*n,u=this.width*i,h=this.height*n;switch(this.rotation){case 0:return[c+o+s,n-d-l-h+r,c+o+u+s,n-d-l+r];case 90:return[c+l+s,n-d+o+r,c+l+h+s,n-d+o+u+r];case 180:return[c-o-u+s,n-d+l+r,c-o+s,n-d+l+h+r];case 270:return[c-l-h+s,n-d-o-u+r,c-l+s,n-d-o+r];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[a,i,n,s]=e,r=n-a,o=s-i;switch(this.rotation){case 0:return[a,t-s,r,o];case 90:return[a,t-i,o,r];case 180:return[n,t-i,r,o];case 270:return[n,t-s,o,r];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#Da=!0}disableEditMode(){this.#Da=!1}isInEditMode(){return this.#Da}shouldGetKeyboardEvents(){return this.#Ra}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#Ea),this.div?.addEventListener("focusout",this.#Sa)}serialize(e=!1,t=null){(0,n.unreachable)("An editor must be serializable")}static deserialize(e,t,a){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:a});i.rotation=e.rotation;const[n,s]=i.pageDimensions,[r,o,l,c]=i.getRectInCurrentCoords(e.rect,s);return i.x=r/n,i.y=o/s,i.width=l/n,i.height=c/s,i}remove(){this.div.removeEventListener("focusin",this.#Ea),this.div.removeEventListener("focusout",this.#Sa),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#va?.remove(),this.#va=null,this.#ba=null,this.#Fa&&(clearTimeout(this.#Fa),this.#Fa=null),this.#La(),this.removeEditToolbar()}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#za(),this.#wa.classList.remove("hidden"),(0,i.bindEvents)(this,this.div,["keydown"]))}keydown(e){if(!this.isResizable||e.target!==this.div||"Enter"!==e.key)return;this._uiManager.setSelected(this),this.#Ca={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#wa.children;if(!this.#fa){this.#fa=Array.from(t);const e=this.#Xa.bind(this),a=this.#Ka.bind(this);for(const t of this.#fa){const i=t.getAttribute("data-resizer-name");t.setAttribute("role","spinbutton"),t.addEventListener("keydown",e),t.addEventListener("blur",a),t.addEventListener("focus",this.#Ya.bind(this,i)),AnnotationEditor._l10nPromise.get(`pdfjs-editor-resizer-label-${i}`).then((e=>t.setAttribute("aria-label",e)))}}const a=this.#fa[0];let i=0;for(const e of t){if(e===a)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#fa.length/4);if(n!==i){if(n<i)for(let e=0;e<i-n;e++)this.#wa.append(this.#wa.firstChild);else if(n>i)for(let e=0;e<n-i;e++)this.#wa.firstChild.before(this.#wa.lastChild);let e=0;for(const a of t){const t=this.#fa[e++].getAttribute("data-resizer-name");AnnotationEditor._l10nPromise.get(`pdfjs-editor-resizer-label-${t}`).then((e=>a.setAttribute("aria-label",e)))}}this.#Ja(0),this.#Ra=!0,this.#wa.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#Xa(e){AnnotationEditor._resizerKeyboardManager.exec(this,e)}#Ka(e){this.#Ra&&e.relatedTarget?.parentNode!==this.#wa&&this.#La()}#Ya(e){this.#Ta=this.#Ra?e:""}#Ja(e){if(this.#fa)for(const t of this.#fa)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#Ra&&this.#Wa(this.#Ta,{movementX:e,movementY:t})}#La(){if(this.#Ra=!1,this.#Ja(-1),this.#Ca){const{savedX:e,savedY:t,savedWidth:a,savedHeight:i}=this.#Ca;this.#$a(e,t,a,i),this.#Ca=null}}_stopResizingWithKeyboard(){this.#La(),this.div.focus()}select(){this.makeResizable(),this.div?.classList.add("selectedEditor"),this.addEditToolbar(),this.#Ma?.show()}unselect(){this.#wa?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus(),this.#Ma?.hide()}updateParams(e,t){}disableEditing(){this.#va&&(this.#va.hidden=!0)}enableEditing(){this.#va&&(this.#va.hidden=!1)}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#Pa}set isEditing(e){this.#Pa=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#xa=!0;const a=e/t,{style:i}=this.div;i.aspectRatio=a,i.height="auto"}static get MIN_SIZE(){return 16}}class FakeEditor extends AnnotationEditor{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},405:(e,t,a)=>{a.d(t,{Outliner:()=>Outliner});class Outliner{#Qa;#Za=[];#ei=[];constructor(e,t=0,a=0,i=!0){let n=1/0,s=-1/0,r=1/0,o=-1/0;const l=1e-4;for(const{x:a,y:i,width:c,height:d}of e){const e=Math.floor((a-t)/l)*l,u=Math.ceil((a+c+t)/l)*l,h=Math.floor((i-t)/l)*l,p=Math.ceil((i+d+t)/l)*l,m=[e,h,p,!0],f=[u,h,p,!1];this.#Za.push(m,f),n=Math.min(n,e),s=Math.max(s,u),r=Math.min(r,h),o=Math.max(o,p)}const c=s-n+2*a,d=o-r+2*a,u=n-a,h=r-a,p=this.#Za.at(i?-1:-2),m=[p[0],p[2]];for(const e of this.#Za){const[t,a,i]=e;e[0]=(t-u)/c,e[1]=(a-h)/d,e[2]=(i-h)/d}this.#Qa={x:u,y:h,width:c,height:d,lastPoint:m}}getOutlines(){this.#Za.sort(((e,t)=>e[0]-t[0]||e[1]-t[1]||e[2]-t[2]));const e=[];for(const t of this.#Za)t[3]?(e.push(...this.#ti(t)),this.#ai(t)):(this.#ii(t),e.push(...this.#ti(t)));return this.#ni(e)}#ni(e){const t=[],a=new Set;for(const a of e){const[e,i,n]=a;t.push([e,i,a],[e,n,a])}t.sort(((e,t)=>e[1]-t[1]||e[0]-t[0]));for(let e=0,i=t.length;e<i;e+=2){const i=t[e][2],n=t[e+1][2];i.push(n),n.push(i),a.add(i),a.add(n)}const i=[];let n;for(;a.size>0;){const e=a.values().next().value;let[t,s,r,o,l]=e;a.delete(e);let c=t,d=s;for(n=[t,r],i.push(n);;){let e;if(a.has(o))e=o;else{if(!a.has(l))break;e=l}a.delete(e),[t,s,r,o,l]=e,c!==t&&(n.push(c,d,t,d===s?s:r),c=t),d=d===s?r:s}n.push(c,d)}return{outlines:i,box:this.#Qa}}#si(e){const t=this.#ei;let a=0,i=t.length-1;for(;a<=i;){const n=a+i>>1,s=t[n][0];if(s===e)return n;s<e?a=n+1:i=n-1}return i+1}#ai([,e,t]){const a=this.#si(e);this.#ei.splice(a,0,[e,t])}#ii([,e,t]){const a=this.#si(e);for(let i=a;i<this.#ei.length;i++){const[a,n]=this.#ei[i];if(a!==e)break;if(a===e&&n===t)return void this.#ei.splice(i,1)}for(let i=a-1;i>=0;i--){const[a,n]=this.#ei[i];if(a!==e)break;if(a===e&&n===t)return void this.#ei.splice(i,1)}}#ti(e){const[t,a,i]=e,n=[[t,a,i]],s=this.#si(i);for(let e=0;e<s;e++){const[a,i]=this.#ei[e];for(let e=0,s=n.length;e<s;e++){const[,r,o]=n[e];if(!(i<=r||o<=a))if(r>=a)if(o>i)n[e][1]=i;else{if(1===s)return[];n.splice(e,1),e--,s--}else n[e][2]=a,o>i&&n.push([t,i,o])}}return n}}},812:(e,t,a)=>{a.d(t,{AnnotationEditorUIManager:()=>AnnotationEditorUIManager,ColorManager:()=>ColorManager,KeyboardManager:()=>KeyboardManager,bindEvents:()=>s,opacityToHex:()=>r});var i=a(266),n=a(473);function s(e,t,a){for(const i of a)t.addEventListener(i,e[i].bind(e))}function r(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")}class IdManager{#ge=0;getId(){return`${i.AnnotationEditorPrefix}${this.#ge++}`}}class ImageManager{#ri=(0,i.getUuid)();#ge=0;#ye=null;static get _isSVGFittingCanvas(){const e=new OffscreenCanvas(1,3).getContext("2d"),t=new Image;t.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';const a=t.decode().then((()=>(e.drawImage(t,0,0,1,1,0,0,1,3),0===new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0])));return(0,i.shadow)(this,"_isSVGFittingCanvas",a)}async#oi(e,t){this.#ye||=new Map;let a=this.#ye.get(e);if(null===a)return null;if(a?.bitmap)return a.refCounter+=1,a;try{let e;if(a||={bitmap:null,id:`image_${this.#ri}_${this.#ge++}`,refCounter:0,isSvg:!1},"string"==typeof t?(a.url=t,e=await(0,n.fetchData)(t,"blob")):e=a.file=t,"image/svg+xml"===e.type){const t=ImageManager._isSVGFittingCanvas,i=new FileReader,n=new Image,s=new Promise(((e,s)=>{n.onload=()=>{a.bitmap=n,a.isSvg=!0,e()},i.onload=async()=>{const e=a.svgUrl=i.result;n.src=await t?`${e}#svgView(preserveAspectRatio(none))`:e},n.onerror=i.onerror=s}));i.readAsDataURL(e),await s}else a.bitmap=await createImageBitmap(e);a.refCounter=1}catch(e){console.error(e),a=null}return this.#ye.set(e,a),a&&this.#ye.set(a.id,a),a}async getFromFile(e){const{lastModified:t,name:a,size:i,type:n}=e;return this.#oi(`${t}_${a}_${i}_${n}`,e)}async getFromUrl(e){return this.#oi(e,e)}async getFromId(e){this.#ye||=new Map;const t=this.#ye.get(e);return t?t.bitmap?(t.refCounter+=1,t):t.file?this.getFromFile(t.file):this.getFromUrl(t.url):null}getSvgUrl(e){const t=this.#ye.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#ye||=new Map;const t=this.#ye.get(e);t&&(t.refCounter-=1,0===t.refCounter&&(t.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#ri}_`)}}class CommandManager{#li=[];#ci=!1;#di;#ui=-1;constructor(e=128){this.#di=e}add({cmd:e,undo:t,mustExec:a,type:i=NaN,overwriteIfSameType:n=!1,keepUndo:s=!1}){if(a&&e(),this.#ci)return;const r={cmd:e,undo:t,type:i};if(-1===this.#ui)return this.#li.length>0&&(this.#li.length=0),this.#ui=0,void this.#li.push(r);if(n&&this.#li[this.#ui].type===i)return s&&(r.undo=this.#li[this.#ui].undo),void(this.#li[this.#ui]=r);const o=this.#ui+1;o===this.#di?this.#li.splice(0,1):(this.#ui=o,o<this.#li.length&&this.#li.splice(o)),this.#li.push(r)}undo(){-1!==this.#ui&&(this.#ci=!0,this.#li[this.#ui].undo(),this.#ci=!1,this.#ui-=1)}redo(){this.#ui<this.#li.length-1&&(this.#ui+=1,this.#ci=!0,this.#li[this.#ui].cmd(),this.#ci=!1)}hasSomethingToUndo(){return-1!==this.#ui}hasSomethingToRedo(){return this.#ui<this.#li.length-1}destroy(){this.#li=null}}class KeyboardManager{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=i.FeatureTest.platform;for(const[a,i,n={}]of e)for(const e of a){const a=e.startsWith("mac+");t&&a?(this.callbacks.set(e.slice(4),{callback:i,options:n}),this.allKeys.add(e.split("+").at(-1))):t||a||(this.callbacks.set(e,{callback:i,options:n}),this.allKeys.add(e.split("+").at(-1)))}}#hi(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const a=this.callbacks.get(this.#hi(t));if(!a)return;const{callback:i,options:{bubbles:n=!1,args:s=[],checker:r=null}}=a;r&&!r(e,t)||(i.bind(e,...s)(),n||(t.stopPropagation(),t.preventDefault()))}}class ColorManager{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,n.getColorValues)(e),(0,i.shadow)(this,"_colors",e)}convert(e){const t=(0,n.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[e,a]of this._colors)if(a.every(((e,a)=>e===t[a])))return ColorManager._colorsMapping.get(e);return t}getHexCode(e){const t=this._colors.get(e);return t?i.Util.makeHexColor(...t):e}}class AnnotationEditorUIManager{#pi=null;#mi=new Map;#fi=new Map;#gi=null;#yi=null;#vi=new CommandManager;#bi=0;#Ai=new Set;#_i=null;#aa=null;#xi=new Set;#wi=null;#Ci=null;#Ei=new IdManager;#Si=!1;#Mi=!1;#Ti=null;#ki=i.AnnotationEditorType.NONE;#Pi=new Set;#Di=null;#Ri=this.blur.bind(this);#Fi=this.focus.bind(this);#Ii=this.copy.bind(this);#Oi=this.cut.bind(this);#Li=this.paste.bind(this);#ji=this.keydown.bind(this);#Ni=this.onEditingAction.bind(this);#Bi=this.onPageChanging.bind(this);#qi=this.onScaleChanging.bind(this);#zi=this.onRotationChanging.bind(this);#Ui={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#Hi=[0,0];#Wi=null;#p=null;#$i=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=AnnotationEditorUIManager.prototype,t=e=>e.#p.contains(document.activeElement)&&e.hasSomethingToControl(),a=(e,{target:t})=>{if(t instanceof HTMLInputElement){const{type:e}=t;return"text"!==e&&"number"!==e}return!0},n=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return(0,i.shadow)(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:a}],[["ctrl+z","mac+meta+z"],e.undo,{checker:a}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:a}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:a}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(e,{target:t})=>!(t instanceof HTMLButtonElement)&&e.#p.contains(t)&&!e.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:e=>e.#p.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}constructor(e,t,a,i,s,r){this.#p=e,this.#$i=t,this.#gi=a,this._eventBus=i,this._eventBus._on("editingaction",this.#Ni),this._eventBus._on("pagechanging",this.#Bi),this._eventBus._on("scalechanging",this.#qi),this._eventBus._on("rotationchanging",this.#zi),this.#yi=s.annotationStorage,this.#wi=s.filterFactory,this.#Di=r,this.viewParameters={realScale:n.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#Vi(),this.#Gi(),this._eventBus._off("editingaction",this.#Ni),this._eventBus._off("pagechanging",this.#Bi),this._eventBus._off("scalechanging",this.#qi),this._eventBus._off("rotationchanging",this.#zi);for(const e of this.#fi.values())e.destroy();this.#fi.clear(),this.#mi.clear(),this.#xi.clear(),this.#pi=null,this.#Pi.clear(),this.#vi.destroy(),this.#gi.destroy(),this.#Ci&&(clearTimeout(this.#Ci),this.#Ci=null),this.#Wi&&(clearTimeout(this.#Wi),this.#Wi=null)}get hcmFilter(){return(0,i.shadow)(this,"hcmFilter",this.#Di?this.#wi.addHCMFilter(this.#Di.foreground,this.#Di.background):"none")}get direction(){return(0,i.shadow)(this,"direction",getComputedStyle(this.#p).direction)}editAltText(e){this.#gi?.editAltText(this,e)}onPageChanging({pageNumber:e}){this.#bi=e-1}focusMainContainer(){this.#p.focus()}findParent(e,t){for(const a of this.#fi.values()){const{x:i,y:n,width:s,height:r}=a.div.getBoundingClientRect();if(e>=i&&e<=i+s&&t>=n&&t<=n+r)return a}return null}disableUserSelect(e=!1){this.#$i.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#xi.add(e)}removeShouldRescale(e){this.#xi.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*n.PixelsPerInch.PDF_TO_CSS_UNITS;for(const e of this.#xi)e.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){e.isEmpty()||!this.#yi||this.#yi.has(e.id)||this.#yi.setValue(e.id,e)}#Xi(){window.addEventListener("focus",this.#Fi),window.addEventListener("blur",this.#Ri)}#Gi(){window.removeEventListener("focus",this.#Fi),window.removeEventListener("blur",this.#Ri)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#Pi)if(t.div.contains(e)){this.#Ti=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#Ti)return;const[e,t]=this.#Ti;this.#Ti=null,t.addEventListener("focusin",(()=>{e._focusEventsAllowed=!0}),{once:!0}),t.focus()}#Ki(){window.addEventListener("keydown",this.#ji)}#Vi(){window.removeEventListener("keydown",this.#ji)}#Yi(){document.addEventListener("copy",this.#Ii),document.addEventListener("cut",this.#Oi),document.addEventListener("paste",this.#Li)}#Ji(){document.removeEventListener("copy",this.#Ii),document.removeEventListener("cut",this.#Oi),document.removeEventListener("paste",this.#Li)}addEditListeners(){this.#Ki(),this.#Yi()}removeEditListeners(){this.#Vi(),this.#Ji()}copy(e){if(e.preventDefault(),this.#pi?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const e of this.#Pi){const a=e.serialize(!0);a&&t.push(a)}0!==t.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:t}=e;for(const e of t.items)for(const t of this.#aa)if(t.isHandlingMimeForPasting(e.type))return void t.paste(e,this.currentLayer);let a=t.getData("application/pdfjs");if(!a)return;try{a=JSON.parse(a)}catch(e){return void(0,i.warn)(`paste: "${e.message}".`)}if(!Array.isArray(a))return;this.unselectAll();const n=this.currentLayer;try{const e=[];for(const t of a){const a=n.deserialize(t);if(!a)return;e.push(a)}const t=()=>{for(const t of e)this.#Qi(t);this.#Zi(e)},i=()=>{for(const t of e)t.remove()};this.addCommands({cmd:t,undo:i,mustExec:!0})}catch(e){(0,i.warn)(`paste: "${e.message}".`)}}keydown(e){this.isEditorHandlingKeyboard||AnnotationEditorUIManager._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}#en(e){Object.entries(e).some((([e,t])=>this.#Ui[e]!==t))&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Ui,e)})}#tn(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#Xi(),this.#Ki(),this.#Yi(),this.#en({isEditing:this.#ki!==i.AnnotationEditorType.NONE,isEmpty:this.#an(),hasSomethingToUndo:this.#vi.hasSomethingToUndo(),hasSomethingToRedo:this.#vi.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Gi(),this.#Vi(),this.#Ji(),this.#en({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#aa){this.#aa=e;for(const e of this.#aa)this.#tn(e.defaultPropertiesToUpdate)}}getId(){return this.#Ei.getId()}get currentLayer(){return this.#fi.get(this.#bi)}getLayer(e){return this.#fi.get(e)}get currentPageIndex(){return this.#bi}addLayer(e){this.#fi.set(e.pageIndex,e),this.#Si?e.enable():e.disable()}removeLayer(e){this.#fi.delete(e.pageIndex)}updateMode(e,t=null,a=!1){if(this.#ki!==e){if(this.#ki=e,e===i.AnnotationEditorType.NONE)return this.setEditingState(!1),void this.#in();this.setEditingState(!0),this.#nn(),this.unselectAll();for(const t of this.#fi.values())t.updateMode(e);if(t||!a){if(t)for(const e of this.#mi.values())if(e.annotationElementId===t){this.setSelected(e),e.enterInEditMode();break}}else this.addNewEditorFromKeyboard()}}addNewEditorFromKeyboard(){this.currentLayer.addNewEditor()}updateToolbar(e){e!==this.#ki&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(this.#aa)if(e!==i.AnnotationEditorParamsType.CREATE){for(const a of this.#Pi)a.updateParams(e,t);for(const a of this.#aa)a.updateDefaultParams(e,t)}else this.currentLayer.addNewEditor()}enableWaiting(e=!1){if(this.#Mi!==e){this.#Mi=e;for(const t of this.#fi.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}#nn(){if(!this.#Si){this.#Si=!0;for(const e of this.#fi.values())e.enable()}}#in(){if(this.unselectAll(),this.#Si){this.#Si=!1;for(const e of this.#fi.values())e.disable()}}getEditors(e){const t=[];for(const a of this.#mi.values())a.pageIndex===e&&t.push(a);return t}getEditor(e){return this.#mi.get(e)}addEditor(e){this.#mi.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#Ci&&clearTimeout(this.#Ci),this.#Ci=setTimeout((()=>{this.focusMainContainer(),this.#Ci=null}),0)),this.#mi.delete(e.id),this.unselect(e),e.annotationElementId&&this.#Ai.has(e.annotationElementId)||this.#yi?.remove(e.id)}addDeletedAnnotationElement(e){this.#Ai.add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return this.#Ai.has(e)}removeDeletedAnnotationElement(e){this.#Ai.delete(e.annotationElementId),e.deleted=!1}#Qi(e){const t=this.#fi.get(e.pageIndex);t?t.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#pi!==e&&(this.#pi=e,e&&this.#tn(e.propertiesToUpdate))}toggleSelected(e){if(this.#Pi.has(e))return this.#Pi.delete(e),e.unselect(),void this.#en({hasSelectedEditor:this.hasSelection});this.#Pi.add(e),e.select(),this.#tn(e.propertiesToUpdate),this.#en({hasSelectedEditor:!0})}setSelected(e){for(const t of this.#Pi)t!==e&&t.unselect();this.#Pi.clear(),this.#Pi.add(e),e.select(),this.#tn(e.propertiesToUpdate),this.#en({hasSelectedEditor:!0})}isSelected(e){return this.#Pi.has(e)}get firstSelectedEditor(){return this.#Pi.values().next().value}unselect(e){e.unselect(),this.#Pi.delete(e),this.#en({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#Pi.size}get isEnterHandled(){return 1===this.#Pi.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#vi.undo(),this.#en({hasSomethingToUndo:this.#vi.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#an()})}redo(){this.#vi.redo(),this.#en({hasSomethingToUndo:!0,hasSomethingToRedo:this.#vi.hasSomethingToRedo(),isEmpty:this.#an()})}addCommands(e){this.#vi.add(e),this.#en({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#an()})}#an(){if(0===this.#mi.size)return!0;if(1===this.#mi.size)for(const e of this.#mi.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#Pi];this.addCommands({cmd:()=>{for(const t of e)t.remove()},undo:()=>{for(const t of e)this.#Qi(t)},mustExec:!0})}commitOrRemove(){this.#pi?.commitOrRemove()}hasSomethingToControl(){return this.#pi||this.hasSelection}#Zi(e){this.#Pi.clear();for(const t of e)t.isEmpty()||(this.#Pi.add(t),t.select());this.#en({hasSelectedEditor:!0})}selectAll(){for(const e of this.#Pi)e.commit();this.#Zi(this.#mi.values())}unselectAll(){if(this.#pi)this.#pi.commitOrRemove();else if(this.hasSelection){for(const e of this.#Pi)e.unselect();this.#Pi.clear(),this.#en({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,a=!1){if(a||this.commitOrRemove(),!this.hasSelection)return;this.#Hi[0]+=e,this.#Hi[1]+=t;const[i,n]=this.#Hi,s=[...this.#Pi];this.#Wi&&clearTimeout(this.#Wi),this.#Wi=setTimeout((()=>{this.#Wi=null,this.#Hi[0]=this.#Hi[1]=0,this.addCommands({cmd:()=>{for(const e of s)this.#mi.has(e.id)&&e.translateInPage(i,n)},undo:()=>{for(const e of s)this.#mi.has(e.id)&&e.translateInPage(-i,-n)},mustExec:!1})}),1e3);for(const a of s)a.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#_i=new Map;for(const e of this.#Pi)this.#_i.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#_i)return!1;this.disableUserSelect(!1);const e=this.#_i;this.#_i=null;let t=!1;for(const[{x:a,y:i,pageIndex:n},s]of e)s.newX=a,s.newY=i,s.newPageIndex=n,t||=a!==s.savedX||i!==s.savedY||n!==s.savedPageIndex;if(!t)return!1;const a=(e,t,a,i)=>{if(this.#mi.has(e.id)){const n=this.#fi.get(i);n?e._setParentAndPosition(n,t,a):(e.pageIndex=i,e.x=t,e.y=a)}};return this.addCommands({cmd:()=>{for(const[t,{newX:i,newY:n,newPageIndex:s}]of e)a(t,i,n,s)},undo:()=>{for(const[t,{savedX:i,savedY:n,savedPageIndex:s}]of e)a(t,i,n,s)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#_i)for(const a of this.#_i.keys())a.drag(e,t)}rebuild(e){if(null===e.parent){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#Pi.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#pi===e}getActive(){return this.#pi}getMode(){return this.#ki}get imageManager(){return(0,i.shadow)(this,"imageManager",new ImageManager)}}},171:(e,t,a)=>{a.d(t,{PDFFetchStream:()=>PDFFetchStream});var i=a(266),n=a(253);function s(e,t,a){return{method:"GET",headers:e,signal:a.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function r(e){const t=new Headers;for(const a in e){const i=e[a];void 0!==i&&t.append(a,i)}return t}function o(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:((0,i.warn)(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}class PDFFetchStream{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new PDFFetchStreamReader(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const a=new PDFFetchStreamRangeReader(this,e,t);return this._rangeRequestReaders.push(a),a}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class PDFFetchStreamReader{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=new i.PromiseCapability,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=r(this._stream.httpHeaders);const a=t.url;fetch(a,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,n.validateResponseStatus)(e.status))throw(0,n.createResponseStatusError)(e.status,a);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:s,suggestedLength:r}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=r||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new i.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:o(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class PDFFetchStreamRangeReader{constructor(e,t,a){this._stream=e,this._reader=null,this._loaded=0;const o=e.source;this._withCredentials=o.withCredentials||!1,this._readCapability=new i.PromiseCapability,this._isStreamingSupported=!o.disableStream,this._abortController=new AbortController,this._headers=r(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${a-1}`);const l=o.url;fetch(l,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,n.validateResponseStatus)(e.status))throw(0,n.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:o(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}},742:(e,t,a)=>{a.d(t,{FontFaceObject:()=>FontFaceObject,FontLoader:()=>FontLoader});var i=a(266);class FontLoader{#sn=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#sn.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(e&&!this.#sn.has(e.loadedName))if((0,i.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:a,src:n,style:s}=e,r=new FontFace(a,n,s);this.addNativeFontFace(r);try{await r.load(),this.#sn.add(a),t?.(e)}catch{(0,i.warn)(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}}else(0,i.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void await this.loadSystemFont(e);if(this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(a){throw(0,i.warn)(`Failed to load font '${t.family}': '${a}'.`),e.disableFontFace=!0,a}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise((t=>{const a=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,a)}))}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return(0,i.shadow)(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(i.isNodeJS||"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),(0,i.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const{loadingRequests:t}=this,a={done:!1,complete:function(){for((0,i.assert)(!a.done,"completeRequest() cannot be called twice."),a.done=!0;t.length>0&&t[0].done;){const e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(a),a}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,i.shadow)(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function a(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function n(e,t,a,i){return e.substring(0,t)+i+e.substring(t+a)}let s,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let c=0;const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=n(u,976,d.length,d);const h=1482184792;let p=a(u,16);for(s=0,r=d.length-3;s<r;s+=4)p=p-h+a(d,s)|0;s<d.length&&(p=p-h+a(d+"XXX",s)|0),u=n(u,16,4,(0,i.string32)(p));const m=`@font-face {font-family:"${d}";src:${`url(data:font/opentype;base64,${btoa(u)});`}}`;this.insertRule(m);const f=this._document.createElement("div");f.style.visibility="hidden",f.style.width=f.style.height="10px",f.style.position="absolute",f.style.top=f.style.left="0px";for(const t of[e.loadedName,d]){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=t,f.append(e)}this._document.body.append(f),function e(t,a){if(++c>30)return(0,i.warn)("Load test font never loaded."),void a();l.font="30px "+t,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?a():setTimeout(e.bind(null,t,a))}(d,(()=>{f.remove(),t.complete()}))}}class FontFaceObject{constructor(e,{isEvalSupported:t=!0,disableFontFace:a=!1,ignoreErrors:i=!1,inspectFont:n=null}){this.compiledGlyphs=Object.create(null);for(const t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===a,this.ignoreErrors=!0===i,this._inspectFont=n}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(this.cssFontInfo){const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}else e=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=(0,i.bytesToString)(this.data),t=`url(data:${this.mimetype};base64,${btoa(e)});`;let a;if(this.cssFontInfo){let e=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),a=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${t}}`}else a=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this._inspectFont?.(this,t),a}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let a;try{a=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return(0,i.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&i.FeatureTest.isEvalSupported){const e=[];for(const t of a){const a=void 0!==t.args?t.args.join(","):"";e.push("c.",t.cmd,"(",a,");\n")}return this.compiledGlyphs[t]=new Function("c","size",e.join(""))}return this.compiledGlyphs[t]=function(e,t){for(const i of a)"scale"===i.cmd&&(i.args=[t,-t]),e[i.cmd].apply(e,i.args)}}}},472:(e,t,a)=>{a.d(t,{Metadata:()=>Metadata});var i=a(266);class Metadata{#rn;#on;constructor({parsedData:e,rawData:t}){this.#rn=e,this.#on=t}getRaw(){return this.#on}get(e){return this.#rn.get(e)??null}getAll(){return(0,i.objectFromMap)(this.#rn)}has(e){return this.#rn.has(e)}}},474:(e,t,a)=>{a.d(t,{PDFNetworkStream:()=>PDFNetworkStream});var i=a(266),n=a(253);class NetworkManager{constructor(e,t={}){this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,a){const i={begin:e,end:t};for(const e in a)i[e]=a[e];return this.request(i)}requestFull(e){return this.request(e)}request(e){const t=new XMLHttpRequest,a=this.currXhrId++,i=this.pendingRequests[a]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const e in this.httpHeaders){const a=this.httpHeaders[e];void 0!==a&&t.setRequestHeader(e,a)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=206):i.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(a){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,a),t.onprogress=this.onProgress.bind(this,a),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),a}onProgress(e,t){const a=this.pendingRequests[e];a&&a.onProgress?.(t)}onStateChange(e,t){const a=this.pendingRequests[e];if(!a)return;const n=a.xhr;if(n.readyState>=2&&a.onHeadersReceived&&(a.onHeadersReceived(),delete a.onHeadersReceived),4!==n.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===n.status&&this.isHttp)return void a.onError?.(n.status);const s=n.status||200;if(!(200===s&&206===a.expectedStatus)&&s!==a.expectedStatus)return void a.onError?.(n.status);const r=function(e){const t=e.response;return"string"!=typeof t?t:(0,i.stringToBytes)(t).buffer}(n);if(206===s){const e=n.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);a.onDone({begin:parseInt(t[1],10),chunk:r})}else r?a.onDone({begin:0,chunk:r}):a.onError?.(n.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class PDFNetworkStream{constructor(e){this._source=e,this._manager=new NetworkManager(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const a=new PDFNetworkStreamRangeRequestReader(this._manager,e,t);return a.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(a),a}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class PDFNetworkStreamFullRequestReader{constructor(e,t){this._manager=e;const a={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(a),this._headersReceivedCapability=new i.PromiseCapability,this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),a=e=>t.getResponseHeader(e),{allowRangeRequests:i,suggestedLength:s}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:a,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(a),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e)if(this._requests.length>0){this._requests.shift().resolve({value:e.chunk,done:!1})}else this._cachedChunks.push(e.chunk);if(this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=(0,n.createResponseStatusError)(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0){return{value:this._cachedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=new i.PromiseCapability;return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class PDFNetworkStreamRangeRequestReader{constructor(e,t,a){this._manager=e;const i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,a,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;if(this._requests.length>0){this._requests.shift().resolve({value:t,done:!1})}else this._queuedChunk=t;this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=(0,n.createResponseStatusError)(e,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=new i.PromiseCapability;return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},253:(e,t,a)=>{a.d(t,{createResponseStatusError:()=>o,extractFilenameFromHeader:()=>r,validateRangeRequestCapabilities:()=>s,validateResponseStatus:()=>l});var i=a(266);var n=a(473);function s({getResponseHeader:e,isHttp:t,rangeChunkSize:a,disableRange:i}){const n={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(e("Content-Length"),10);if(!Number.isInteger(s))return n;if(n.suggestedLength=s,s<=2*a)return n;if(i||!t)return n;if("bytes"!==e("Accept-Ranges"))return n;return"identity"!==(e("Content-Encoding")||"identity")||(n.allowRangeRequests=!0),n}function r(e){const t=e("Content-Disposition");if(t){let e=function(e){let t=!0,a=n("filename\\*","i").exec(e);if(a){a=a[1];let e=o(a);return e=unescape(e),e=l(e),e=c(e),r(e)}if(a=function(e){const t=[];let a;const i=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(a=i.exec(e));){let[,e,i,n]=a;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[i,n]}const s=[];for(let e=0;e<t.length&&e in t;++e){let[a,i]=t[e];i=o(i),a&&(i=unescape(i),0===e&&(i=l(i))),s.push(i)}return s.join("")}(e),a)return r(c(a));if(a=n("filename","i").exec(e),a){a=a[1];let e=o(a);return e=c(e),r(e)}function n(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function s(e,a){if(e){if(!/^[\x00-\xFF]+$/.test(a))return a;try{const n=new TextDecoder(e,{fatal:!0}),s=(0,i.stringToBytes)(a);a=n.decode(s),t=!1}catch{}}return a}function r(e){return t&&/[\x80-\xff]/.test(e)&&(e=s("utf-8",e),t&&(e=s("iso-8859-1",e))),e}function o(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const a=t[e].indexOf('"');-1!==a&&(t[e]=t[e].slice(0,a),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function l(e){const t=e.indexOf("'");return-1===t?e:s(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function c(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,a,i){if("q"===a||"Q"===a)return s(t,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{i=atob(i)}catch{}return s(t,i)}))}return""}(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if((0,n.isPdfFile)(e))return e}return null}function o(e,t){return 404===e||0===e&&t.startsWith("file:")?new i.MissingPDFException('Missing PDF "'+t+'".'):new i.UnexpectedResponseException(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e)}function l(e){return 200===e||206===e}},498:(e,t,a)=>{a.a(e,(async(e,i)=>{try{a.d(t,{PDFNodeStream:()=>PDFNodeStream});var n=a(266),s=a(253);let r,o,l,c;n.isNodeJS&&(r=await import("fs"),o=await import("http"),l=await import("https"),c=await import("url"));const d=/^file:\/\/\/[a-zA-Z]:\//;function u(e){const t=c.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?c.parse(`file:///${e}`):(t.host||(t.protocol="file:"),t)}class PDFNodeStream{constructor(e){this.source=e,this.url=u(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new PDFNodeStreamFsFullReader(this):new PDFNodeStreamFullReader(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const a=this.isFsUrl?new PDFNodeStreamFsRangeReader(this,e,t):new PDFNodeStreamRangeReader(this,e,t);return this._rangeRequestReaders.push(a),a}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class BaseFullReader{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=new n.PromiseCapability,this.read();this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:new Uint8Array(e).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class BaseRangeReader{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=new n.PromiseCapability,this.read();this._loaded+=e.length,this.onProgress?.({loaded:this._loaded});return{value:new Uint8Array(e).buffer,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function h(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class PDFNodeStreamFullReader extends BaseFullReader{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new n.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const a=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:i,suggestedLength:r}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=r||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(a)};this._request=null,"http:"===this._url.protocol?this._request=o.request(h(this._url,e.httpHeaders),t):this._request=l.request(h(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class PDFNodeStreamRangeReader extends BaseRangeReader{constructor(e,t,a){super(e),this._httpHeaders={};for(const t in e.httpHeaders){const a=e.httpHeaders[t];void 0!==a&&(this._httpHeaders[t]=a)}this._httpHeaders.Range=`bytes=${t}-${a-1}`;const i=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=o.request(h(this._url,this._httpHeaders),i):this._request=l.request(h(this._url,this._httpHeaders),i),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class PDFNodeStreamFsFullReader extends BaseFullReader{constructor(e){super(e);let t=decodeURIComponent(this._url.path);d.test(this._url.href)&&(t=t.replace(/^\//,"")),r.lstat(t,((e,a)=>{if(e)return"ENOENT"===e.code&&(e=new n.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=a.size,this._setReadableStream(r.createReadStream(t)),this._headersCapability.resolve()}))}}class PDFNodeStreamFsRangeReader extends BaseRangeReader{constructor(e,t,a){super(e);let i=decodeURIComponent(this._url.path);d.test(this._url.href)&&(i=i.replace(/^\//,"")),this._setReadableStream(r.createReadStream(i,{start:t,end:a-1}))}}i()}catch(p){i(p)}}),1)},738:(e,t,a)=>{a.a(e,(async(e,i)=>{try{a.d(t,{NodeCMapReaderFactory:()=>NodeCMapReaderFactory,NodeCanvasFactory:()=>NodeCanvasFactory,NodeFilterFactory:()=>NodeFilterFactory,NodeStandardFontDataFactory:()=>NodeStandardFontDataFactory});var n=a(822);let e,s,r;if(a(266).isNodeJS){e=await import("fs");try{s=await import("canvas")}catch{}try{r=await import("path2d-polyfill")}catch{}}const o=function(t){return new Promise(((a,i)=>{e.readFile(t,((e,t)=>{!e&&t?a(new Uint8Array(t)):i(new Error(e))}))}))};class NodeFilterFactory extends n.BaseFilterFactory{}class NodeCanvasFactory extends n.BaseCanvasFactory{_createCanvas(e,t){return s.createCanvas(e,t)}}class NodeCMapReaderFactory extends n.BaseCMapReaderFactory{_fetchData(e,t){return o(e).then((e=>({cMapData:e,compressionType:t})))}}class NodeStandardFontDataFactory extends n.BaseStandardFontDataFactory{_fetchData(e){return o(e)}}i()}catch(e){i(e)}}),1)},890:(e,t,a)=>{a.d(t,{OptionalContentConfig:()=>OptionalContentConfig});var i=a(266),n=a(825);const s=Symbol("INTERNAL");class OptionalContentGroup{#ln=!0;constructor(e,t){this.name=e,this.intent=t}get visible(){return this.#ln}_setVisible(e,t){e!==s&&(0,i.unreachable)("Internal method `_setVisible` called."),this.#ln=t}}class OptionalContentConfig{#cn=null;#dn=new Map;#un=null;#hn=null;constructor(e){if(this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,this.#hn=e.order;for(const t of e.groups)this.#dn.set(t.id,new OptionalContentGroup(t.name,t.intent));if("OFF"===e.baseState)for(const e of this.#dn.values())e._setVisible(s,!1);for(const t of e.on)this.#dn.get(t)._setVisible(s,!0);for(const t of e.off)this.#dn.get(t)._setVisible(s,!1);this.#un=this.getHash()}}#pn(e){const t=e.length;if(t<2)return!0;const a=e[0];for(let n=1;n<t;n++){const t=e[n];let s;if(Array.isArray(t))s=this.#pn(t);else{if(!this.#dn.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;s=this.#dn.get(t).visible}switch(a){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===a}isVisible(e){if(0===this.#dn.size)return!0;if(!e)return(0,i.warn)("Optional content group not defined."),!0;if("OCG"===e.type)return this.#dn.has(e.id)?this.#dn.get(e.id).visible:((0,i.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this.#pn(e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this.#dn.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(this.#dn.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this.#dn.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(!this.#dn.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this.#dn.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(!this.#dn.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this.#dn.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(this.#dn.get(t).visible)return!1}return!0}return(0,i.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,i.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){this.#dn.has(e)?(this.#dn.get(e)._setVisible(s,!!t),this.#cn=null):(0,i.warn)(`Optional content group not found: ${e}`)}get hasInitialVisibility(){return null===this.#un||this.getHash()===this.#un}getOrder(){return this.#dn.size?this.#hn?this.#hn.slice():[...this.#dn.keys()]:null}getGroups(){return this.#dn.size>0?(0,i.objectFromMap)(this.#dn):null}getGroup(e){return this.#dn.get(e)||null}getHash(){if(null!==this.#cn)return this.#cn;const e=new n.MurmurHash3_64;for(const[t,a]of this.#dn)e.update(`${t}:${a.visible}`);return this.#cn=e.hexdigest()}}},739:(e,t,a)=>{a.d(t,{renderTextLayer:()=>u,updateTextLayer:()=>h});var i=a(266),n=a(473);const s=30,r=.8,o=new Map;function l(e,t){let a;if(t&&i.FeatureTest.isOffscreenCanvasSupported)a=new OffscreenCanvas(e,e).getContext("2d",{alpha:!1});else{const t=document.createElement("canvas");t.width=t.height=e,a=t.getContext("2d",{alpha:!1})}return a}function c(e,t,a){const n=document.createElement("span"),c={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};e._textDivs.push(n);const d=i.Util.transform(e._transform,t.transform);let u=Math.atan2(d[1],d[0]);const h=a[t.fontName];h.vertical&&(u+=Math.PI/2);const p=e._fontInspectorEnabled&&h.fontSubstitution||h.fontFamily,m=Math.hypot(d[2],d[3]),f=m*function(e,t){const a=o.get(e);if(a)return a;const i=l(s,t);i.font=`${s}px ${e}`;const n=i.measureText("");let c=n.fontBoundingBoxAscent,d=Math.abs(n.fontBoundingBoxDescent);if(c){const t=c/(c+d);return o.set(e,t),i.canvas.width=i.canvas.height=0,t}i.strokeStyle="red",i.clearRect(0,0,s,s),i.strokeText("g",0,0);let u=i.getImageData(0,0,s,s).data;d=0;for(let e=u.length-1-3;e>=0;e-=4)if(u[e]>0){d=Math.ceil(e/4/s);break}i.clearRect(0,0,s,s),i.strokeText("A",0,s),u=i.getImageData(0,0,s,s).data,c=0;for(let e=0,t=u.length;e<t;e+=4)if(u[e]>0){c=s-Math.floor(e/4/s);break}if(i.canvas.width=i.canvas.height=0,c){const t=c/(c+d);return o.set(e,t),t}return o.set(e,r),r}(p,e._isOffscreenCanvasSupported);let g,y;0===u?(g=d[4],y=d[5]-f):(g=d[4]+f*Math.sin(u),y=d[5]-f*Math.cos(u));const v="calc(var(--scale-factor)*",b=n.style;e._container===e._rootContainer?(b.left=`${(100*g/e._pageWidth).toFixed(2)}%`,b.top=`${(100*y/e._pageHeight).toFixed(2)}%`):(b.left=`${v}${g.toFixed(2)}px)`,b.top=`${v}${y.toFixed(2)}px)`),b.fontSize=`${v}${m.toFixed(2)}px)`,b.fontFamily=p,c.fontSize=m,n.setAttribute("role","presentation"),n.textContent=t.str,n.dir=t.dir,e._fontInspectorEnabled&&(n.dataset.fontName=h.fontSubstitutionLoadedName||t.fontName),0!==u&&(c.angle=u*(180/Math.PI));let A=!1;if(t.str.length>1)A=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),a=Math.abs(t.transform[3]);e!==a&&Math.max(e,a)/Math.min(e,a)>1.5&&(A=!0)}A&&(c.canvasWidth=h.vertical?t.height:t.width),e._textDivProperties.set(n,c),e._isReadableStream&&e._layoutText(n)}function d(e){const{div:t,scale:a,properties:i,ctx:n,prevFontSize:s,prevFontFamily:r}=e,{style:o}=t;let l="";if(0!==i.canvasWidth&&i.hasText){const{fontFamily:c}=o,{canvasWidth:d,fontSize:u}=i;s===u&&r===c||(n.font=`${u*a}px ${c}`,e.prevFontSize=u,e.prevFontFamily=c);const{width:h}=n.measureText(t.textContent);h>0&&(l=`scaleX(${d*a/h})`)}0!==i.angle&&(l=`rotate(${i.angle}deg) ${l}`),l.length>0&&(o.transform=l)}class TextLayerRenderTask{constructor({textContentSource:e,container:t,viewport:a,textDivs:s,textDivProperties:r,textContentItemsStr:o,isOffscreenCanvasSupported:c}){this._textContentSource=e,this._isReadableStream=e instanceof ReadableStream,this._container=this._rootContainer=t,this._textDivs=s||[],this._textContentItemsStr=o||[],this._isOffscreenCanvasSupported=c,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=r||new WeakMap,this._canceled=!1,this._capability=new i.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:a.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:l(0,c)};const{pageWidth:d,pageHeight:u,pageX:h,pageY:p}=a.rawDims;this._transform=[1,0,0,-1,-h,p+u],this._pageWidth=d,this._pageHeight=u,(0,n.setLayerDimensions)(t,a),this._capability.promise.finally((()=>{this._layoutTextParams=null})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new i.AbortException("TextLayer task cancelled.")).catch((()=>{})),this._reader=null),this._capability.reject(new i.AbortException("TextLayer task cancelled."))}_processItems(e,t){for(const a of e)if(void 0!==a.str)this._textContentItemsStr.push(a.str),c(this,a,t);else if("beginMarkedContentProps"===a.type||"beginMarkedContent"===a.type){const e=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==a.id&&this._container.setAttribute("id",`${a.id}`),e.append(this._container)}else"endMarkedContent"===a.type&&(this._container=this._container.parentNode)}_layoutText(e){const t=this._layoutTextParams.properties=this._textDivProperties.get(e);if(this._layoutTextParams.div=e,d(this._layoutTextParams),t.hasText&&this._container.append(e),t.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),this._container.append(e)}}_render(){const e=new i.PromiseCapability;let t=Object.create(null);if(this._isReadableStream){const a=()=>{this._reader.read().then((({value:i,done:n})=>{n?e.resolve():(Object.assign(t,i.styles),this._processItems(i.items,t),a())}),e.reject)};this._reader=this._textContentSource.getReader(),a()}else{if(!this._textContentSource)throw new Error('No "textContentSource" parameter specified.');{const{items:t,styles:a}=this._textContentSource;this._processItems(t,a),e.resolve()}}e.promise.then((()=>{t=null,function(e){if(e._canceled)return;const t=e._textDivs,a=e._capability;if(t.length>1e5)a.resolve();else{if(!e._isReadableStream)for(const a of t)e._layoutText(a);a.resolve()}}(this)}),this._capability.reject)}}function u(e){const t=new TextLayerRenderTask(e);return t._render(),t}function h({container:e,viewport:t,textDivs:a,textDivProperties:i,isOffscreenCanvasSupported:s,mustRotate:r=!0,mustRescale:o=!0}){if(r&&(0,n.setLayerDimensions)(e,{rotation:t.rotation}),o){const e=l(0,s),n={prevFontSize:null,prevFontFamily:null,div:null,scale:t.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:e};for(const e of a)n.properties=i.get(e),n.div=e,d(n)}}},92:(e,t,a)=>{a.d(t,{PDFDataTransportStream:()=>PDFDataTransportStream});var i=a(266),n=a(473);class PDFDataTransportStream{constructor({length:e,initialData:t,progressiveDone:a=!1,contentDispositionFilename:n=null,disableRange:s=!1,disableStream:r=!1},o){if((0,i.assert)(o,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=n,t?.length>0){const e=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=o,this._isStreamingSupported=!r,this._isRangeSupported=!s,this._contentLength=e,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:e,chunk:t}){const a=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(void 0===e)this._fullRequestReader?this._fullRequestReader._enqueue(a):this._queuedChunks.push(a);else{const t=this._rangeReaders.some((function(t){return t._begin===e&&(t._enqueue(a),!0)}));(0,i.assert)(t,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){void 0===e.total?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,i.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new PDFDataTransportStreamReader(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const a=new PDFDataTransportStreamRangeReader(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(a),a}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class PDFDataTransportStreamReader{constructor(e,t,a=!1,i=null){this._stream=e,this._done=a||!1,this._filename=(0,n.isPdfFile)(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length>0){this._requests.shift().resolve({value:e,done:!1})}else this._queuedChunks.push(e);this._loaded+=e.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){return{value:this._queuedChunks.shift(),done:!1}}if(this._done)return{value:void 0,done:!0};const e=new i.PromiseCapability;return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class PDFDataTransportStreamRangeReader{constructor(e,t,a){this._stream=e,this._begin=t,this._end=a,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=new i.PromiseCapability;return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},368:(e,t,a)=>{a.d(t,{GlobalWorkerOptions:()=>i});const i=Object.create(null);i.workerPort=null,i.workerSrc=""},160:(e,t,a)=>{a.d(t,{XfaLayer:()=>XfaLayer});var i=a(521);class XfaLayer{static setupStorage(e,t,a,i,n){const s=i.getValue(t,{value:null});switch(a.name){case"textarea":if(null!==s.value&&(e.textContent=s.value),"print"===n)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===a.attributes.type||"checkbox"===a.attributes.type){if(s.value===a.attributes.xfaOn?e.setAttribute("checked",!0):s.value===a.attributes.xfaOff&&e.removeAttribute("checked"),"print"===n)break;e.addEventListener("change",(e=>{i.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==s.value&&e.setAttribute("value",s.value),"print"===n)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==s.value){e.setAttribute("value",s.value);for(const e of a.children)e.attributes.value===s.value?e.attributes.selected=!0:e.attributes.hasOwnProperty("selected")&&delete e.attributes.selected}e.addEventListener("input",(e=>{const a=e.target.options,n=-1===a.selectedIndex?"":a[a.selectedIndex].value;i.setValue(t,{value:n})}))}}static setAttributes({html:e,element:t,storage:a=null,intent:i,linkService:n}){const{attributes:s}=t,r=e instanceof HTMLAnchorElement;"radio"===s.type&&(s.name=`${s.name}-${i}`);for(const[t,a]of Object.entries(s))if(null!=a)switch(t){case"class":a.length&&e.setAttribute(t,a.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",a);break;case"style":Object.assign(e.style,a);break;case"textContent":e.textContent=a;break;default:(!r||"href"!==t&&"newWindow"!==t)&&e.setAttribute(t,a)}r&&n.addLinkAttributes(e,s.href,s.newWindow),a&&s.dataId&&this.setupStorage(e,s.dataId,t,a)}static render(e){const t=e.annotationStorage,a=e.linkService,n=e.xfaHtml,s=e.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:s,linkService:a});const o="richText"!==s,l=e.div;if(l.append(r),e.viewport){const t=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=t}o&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(0===n.children.length){if(n.value){const e=document.createTextNode(n.value);r.append(e),o&&i.XfaText.shouldBuildText(n.name)&&c.push(e)}return{textDivs:c}}const d=[[n,-1,r]];for(;d.length>0;){const[e,n,r]=d.at(-1);if(n+1===e.children.length){d.pop();continue}const l=e.children[++d.at(-1)[1]];if(null===l)continue;const{name:u}=l;if("#text"===u){const e=document.createTextNode(l.value);c.push(e),r.append(e);continue}const h=l?.attributes?.xmlns?document.createElementNS(l.attributes.xmlns,u):document.createElement(u);if(r.append(h),l.attributes&&this.setAttributes({html:h,element:l,storage:t,intent:s,linkService:a}),l.children?.length>0)d.push([l,-1,h]);else if(l.value){const e=document.createTextNode(l.value);o&&i.XfaText.shouldBuildText(u)&&c.push(e),h.append(e)}}for(const e of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}},521:(e,t,a)=>{a.d(t,{XfaText:()=>XfaText});class XfaText{static textContent(e){const t=[],a={items:t,styles:Object.create(null)};return function e(a){if(!a)return;let i=null;const n=a.name;if("#text"===n)i=a.value;else{if(!XfaText.shouldBuildText(n))return;a?.attributes?.textContent?i=a.attributes.textContent:a.value&&(i=a.value)}if(null!==i&&t.push({str:i}),a.children)for(const t of a.children)e(t)}(e),a}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}},907:(e,t,a)=>{a.a(e,(async(e,i)=>{try{a.d(t,{AbortException:()=>n.AbortException,AnnotationEditorLayer:()=>l.AnnotationEditorLayer,AnnotationEditorParamsType:()=>n.AnnotationEditorParamsType,AnnotationEditorType:()=>n.AnnotationEditorType,AnnotationEditorUIManager:()=>c.AnnotationEditorUIManager,AnnotationLayer:()=>d.AnnotationLayer,AnnotationMode:()=>n.AnnotationMode,CMapCompressionType:()=>n.CMapCompressionType,DOMSVGFactory:()=>r.DOMSVGFactory,DrawLayer:()=>u.DrawLayer,FeatureTest:()=>n.FeatureTest,GlobalWorkerOptions:()=>h.GlobalWorkerOptions,ImageKind:()=>n.ImageKind,InvalidPDFException:()=>n.InvalidPDFException,MissingPDFException:()=>n.MissingPDFException,OPS:()=>n.OPS,Outliner:()=>p.Outliner,PDFDataRangeTransport:()=>s.PDFDataRangeTransport,PDFDateString:()=>r.PDFDateString,PDFWorker:()=>s.PDFWorker,PasswordResponses:()=>n.PasswordResponses,PermissionFlag:()=>n.PermissionFlag,PixelsPerInch:()=>r.PixelsPerInch,PromiseCapability:()=>n.PromiseCapability,RenderingCancelledException:()=>r.RenderingCancelledException,UnexpectedResponseException:()=>n.UnexpectedResponseException,Util:()=>n.Util,VerbosityLevel:()=>n.VerbosityLevel,XfaLayer:()=>m.XfaLayer,build:()=>s.build,createValidAbsoluteUrl:()=>n.createValidAbsoluteUrl,fetchData:()=>r.fetchData,getDocument:()=>s.getDocument,getFilenameFromUrl:()=>r.getFilenameFromUrl,getPdfFilenameFromUrl:()=>r.getPdfFilenameFromUrl,getXfaPageViewport:()=>r.getXfaPageViewport,isDataScheme:()=>r.isDataScheme,isPdfFile:()=>r.isPdfFile,noContextMenu:()=>r.noContextMenu,normalizeUnicode:()=>n.normalizeUnicode,renderTextLayer:()=>o.renderTextLayer,setLayerDimensions:()=>r.setLayerDimensions,shadow:()=>n.shadow,updateTextLayer:()=>o.updateTextLayer,version:()=>s.version});var n=a(266),s=a(406),r=a(473),o=a(739),l=a(331),c=a(812),d=a(640),u=a(423),h=a(368),p=a(405),m=a(160),f=e([s]);s=(f.then?(await f)():f)[0];i()}catch(e){i(e)}}))},694:(e,t,a)=>{a.d(t,{MessageHandler:()=>MessageHandler});var i=a(266);const n=1,s=2,r=1,o=2,l=3,c=4,d=5,u=6,h=7,p=8;function m(e){switch(e instanceof Error||"object"==typeof e&&null!==e||(0,i.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new i.AbortException(e.message);case"MissingPDFException":return new i.MissingPDFException(e.message);case"PasswordException":return new i.PasswordException(e.message,e.code);case"UnexpectedResponseException":return new i.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new i.UnknownErrorException(e.message,e.details);default:return new i.UnknownErrorException(e.message,e.toString())}}class MessageHandler{constructor(e,t,a){this.sourceName=e,this.targetName=t,this.comObj=a,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this.#mn(t);if(t.callback){const e=t.callbackId,a=this.callbackCapabilities[e];if(!a)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],t.callback===n)a.resolve(t.data);else{if(t.callback!==s)throw new Error("Unexpected callback case");a.reject(m(t.reason))}return}const i=this.actionHandler[t.action];if(!i)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,r=t.sourceName;new Promise((function(e){e(i(t.data))})).then((function(i){a.postMessage({sourceName:e,targetName:r,callback:n,callbackId:t.callbackId,data:i})}),(function(i){a.postMessage({sourceName:e,targetName:r,callback:s,callbackId:t.callbackId,reason:m(i)})}))}else t.streamId?this.#fn(t):i(t.data)},a.addEventListener("message",this._onComObjOnMessage)}on(e,t){const a=this.actionHandler;if(a[e])throw new Error(`There is already an actionName called "${e}"`);a[e]=t}send(e,t,a){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},a)}sendWithPromise(e,t,a){const n=this.callbackId++,s=new i.PromiseCapability;this.callbackCapabilities[n]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:n,data:t},a)}catch(e){s.reject(e)}return s.promise}sendWithStream(e,t,a,n){const s=this.streamId++,o=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:a=>{const r=new i.PromiseCapability;return this.streamControllers[s]={controller:a,startCall:r,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:l,action:e,streamId:s,data:t,desiredSize:a.desiredSize},n),r.promise},pull:e=>{const t=new i.PromiseCapability;return this.streamControllers[s].pullCall=t,c.postMessage({sourceName:o,targetName:l,stream:u,streamId:s,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,i.assert)(e instanceof Error,"cancel must have a valid reason");const t=new i.PromiseCapability;return this.streamControllers[s].cancelCall=t,this.streamControllers[s].isClosed=!0,c.postMessage({sourceName:o,targetName:l,stream:r,streamId:s,reason:m(e)}),t.promise}},a)}#fn(e){const t=e.streamId,a=this.sourceName,n=e.sourceName,s=this.comObj,r=this,o=this.actionHandler[e.action],u={enqueue(e,r=1,o){if(this.isCancelled)return;const l=this.desiredSize;this.desiredSize-=r,l>0&&this.desiredSize<=0&&(this.sinkCapability=new i.PromiseCapability,this.ready=this.sinkCapability.promise),s.postMessage({sourceName:a,targetName:n,stream:c,streamId:t,chunk:e},o)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:a,targetName:n,stream:l,streamId:t}),delete r.streamSinks[t])},error(e){(0,i.assert)(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:a,targetName:n,stream:d,streamId:t,reason:m(e)}))},sinkCapability:new i.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};u.sinkCapability.resolve(),u.ready=u.sinkCapability.promise,this.streamSinks[t]=u,new Promise((function(t){t(o(e.data,u))})).then((function(){s.postMessage({sourceName:a,targetName:n,stream:p,streamId:t,success:!0})}),(function(e){s.postMessage({sourceName:a,targetName:n,stream:p,streamId:t,reason:m(e)})}))}#mn(e){const t=e.streamId,a=this.sourceName,n=e.sourceName,s=this.comObj,f=this.streamControllers[t],g=this.streamSinks[t];switch(e.stream){case p:e.success?f.startCall.resolve():f.startCall.reject(m(e.reason));break;case h:e.success?f.pullCall.resolve():f.pullCall.reject(m(e.reason));break;case u:if(!g){s.postMessage({sourceName:a,targetName:n,stream:h,streamId:t,success:!0});break}g.desiredSize<=0&&e.desiredSize>0&&g.sinkCapability.resolve(),g.desiredSize=e.desiredSize,new Promise((function(e){e(g.onPull?.())})).then((function(){s.postMessage({sourceName:a,targetName:n,stream:h,streamId:t,success:!0})}),(function(e){s.postMessage({sourceName:a,targetName:n,stream:h,streamId:t,reason:m(e)})}));break;case c:if((0,i.assert)(f,"enqueue should have stream controller"),f.isClosed)break;f.controller.enqueue(e.chunk);break;case l:if((0,i.assert)(f,"close should have stream controller"),f.isClosed)break;f.isClosed=!0,f.controller.close(),this.#gn(f,t);break;case d:(0,i.assert)(f,"error should have stream controller"),f.controller.error(m(e.reason)),this.#gn(f,t);break;case o:e.success?f.cancelCall.resolve():f.cancelCall.reject(m(e.reason)),this.#gn(f,t);break;case r:if(!g)break;new Promise((function(t){t(g.onCancel?.(m(e.reason)))})).then((function(){s.postMessage({sourceName:a,targetName:n,stream:o,streamId:t,success:!0})}),(function(e){s.postMessage({sourceName:a,targetName:n,stream:o,streamId:t,reason:m(e)})})),g.sinkCapability.reject(m(e.reason)),g.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#gn(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},825:(e,t,a)=>{a.d(t,{MurmurHash3_64:()=>MurmurHash3_64});var i=a(266);const n=3285377520,s=4294901760,r=65535;class MurmurHash3_64{constructor(e){this.h1=e?4294967295&e:n,this.h2=e?4294967295&e:n}update(e){let t,a;if("string"==typeof e){t=new Uint8Array(2*e.length),a=0;for(let i=0,n=e.length;i<n;i++){const n=e.charCodeAt(i);n<=255?t[a++]=n:(t[a++]=n>>>8,t[a++]=255&n)}}else{if(!(0,i.isArrayBuffer)(e))throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");t=e.slice(),a=t.byteLength}const n=a>>2,o=a-4*n,l=new Uint32Array(t.buffer,0,n);let c=0,d=0,u=this.h1,h=this.h2;const p=3432918353,m=461845907,f=11601,g=13715;for(let e=0;e<n;e++)1&e?(c=l[e],c=c*p&s|c*f&r,c=c<<15|c>>>17,c=c*m&s|c*g&r,u^=c,u=u<<13|u>>>19,u=5*u+3864292196):(d=l[e],d=d*p&s|d*f&r,d=d<<15|d>>>17,d=d*m&s|d*g&r,h^=d,h=h<<13|h>>>19,h=5*h+3864292196);switch(c=0,o){case 3:c^=t[4*n+2]<<16;case 2:c^=t[4*n+1]<<8;case 1:c^=t[4*n],c=c*p&s|c*f&r,c=c<<15|c>>>17,c=c*m&s|c*g&r,1&n?u^=c:h^=c}this.h1=u,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&s|36045*e&r,t=4283543511*t&s|(2950163797*(t<<16|e>>>16)&s)>>>16,e^=t>>>1,e=444984403*e&s|60499*e&r,t=3301882366*t&s|(3120437893*(t<<16|e>>>16)&s)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}},266:(e,t,a)=>{a.d(t,{AbortException:()=>AbortException,AnnotationBorderStyleType:()=>y,AnnotationEditorParamsType:()=>h,AnnotationEditorPrefix:()=>d,AnnotationEditorType:()=>u,AnnotationMode:()=>c,AnnotationPrefix:()=>U,AnnotationType:()=>g,BaseException:()=>D,CMapCompressionType:()=>b,FONT_IDENTITY_MATRIX:()=>s,FeatureTest:()=>FeatureTest,FormatError:()=>FormatError,IDENTITY_MATRIX:()=>n,ImageKind:()=>f,InvalidPDFException:()=>InvalidPDFException,LINE_FACTOR:()=>o,MAX_IMAGE_SIZE_TO_CACHE:()=>r,MissingPDFException:()=>MissingPDFException,OPS:()=>A,PasswordException:()=>PasswordException,PasswordResponses:()=>_,PermissionFlag:()=>p,PromiseCapability:()=>PromiseCapability,RenderingIntentFlag:()=>l,TextRenderingMode:()=>m,UnexpectedResponseException:()=>UnexpectedResponseException,UnknownErrorException:()=>UnknownErrorException,Util:()=>Util,VerbosityLevel:()=>v,assert:()=>T,bytesToString:()=>R,createValidAbsoluteUrl:()=>k,getUuid:()=>z,getVerbosityLevel:()=>C,info:()=>E,isArrayBuffer:()=>j,isNodeJS:()=>i,normalizeUnicode:()=>q,objectFromMap:()=>O,setVerbosityLevel:()=>w,shadow:()=>P,string32:()=>I,stringToBytes:()=>F,unreachable:()=>M,warn:()=>S});const i=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),n=[1,0,0,1,0,0],s=[.001,0,0,.001,0,0],r=1e7,o=1.35,l={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},c={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},d="pdfjs_internal_editor_",u={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},h={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23},p={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},m={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},f={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},g={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},y={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},v={ERRORS:0,WARNINGS:1,INFOS:5},b={NONE:0,BINARY:1},A={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},_={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let x=v.WARNINGS;function w(e){Number.isInteger(e)&&(x=e)}function C(){return x}function E(e){x>=v.INFOS&&console.log(`Info: ${e}`)}function S(e){x>=v.WARNINGS&&console.log(`Warning: ${e}`)}function M(e){throw new Error(e)}function T(e,t){e||M(t)}function k(e,t=null,a=null){if(!e)return null;try{if(a&&"string"==typeof e){if(a.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);t?.length>=2&&(e=`http://${e}`)}if(a.tryConvertEncoding)try{e=decodeURIComponent(escape(e))}catch{}}const i=t?new URL(e,t):new URL(e);if(function(e){switch(e?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i))return i}catch{}return null}function P(e,t,a,i=!1){return Object.defineProperty(e,t,{value:a,enumerable:!i,configurable:!0,writable:!1}),a}const D=function(){function e(t,a){this.constructor===e&&M("Cannot initialize BaseException."),this.message=t,this.name=a}return e.prototype=new Error,e.constructor=e,e}();class PasswordException extends D{constructor(e,t){super(e,"PasswordException"),this.code=t}}class UnknownErrorException extends D{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class InvalidPDFException extends D{constructor(e){super(e,"InvalidPDFException")}}class MissingPDFException extends D{constructor(e){super(e,"MissingPDFException")}}class UnexpectedResponseException extends D{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class FormatError extends D{constructor(e){super(e,"FormatError")}}class AbortException extends D{constructor(e){super(e,"AbortException")}}function R(e){"object"==typeof e&&void 0!==e?.length||M("Invalid argument for bytesToString");const t=e.length,a=8192;if(t<a)return String.fromCharCode.apply(null,e);const i=[];for(let n=0;n<t;n+=a){const s=Math.min(n+a,t),r=e.subarray(n,s);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function F(e){"string"!=typeof e&&M("Invalid argument for stringToBytes");const t=e.length,a=new Uint8Array(t);for(let i=0;i<t;++i)a[i]=255&e.charCodeAt(i);return a}function I(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function O(e){const t=Object.create(null);for(const[a,i]of e)t[a]=i;return t}class FeatureTest{static get isLittleEndian(){return P(this,"isLittleEndian",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return P(this,"isEvalSupported",function(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return P(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?P(this,"platform",{isMac:navigator.platform.includes("Mac")}):P(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return P(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const L=[...Array(256).keys()].map((e=>e.toString(16).padStart(2,"0")));class Util{static makeHexColor(e,t,a){return`#${L[e]}${L[t]}${L[a]}`}static scaleMinMax(e,t){let a;e[0]?(e[0]<0&&(a=t[0],t[0]=t[1],t[1]=a),t[0]*=e[0],t[1]*=e[0],e[3]<0&&(a=t[2],t[2]=t[3],t[3]=a),t[2]*=e[3],t[3]*=e[3]):(a=t[0],t[0]=t[2],t[2]=a,a=t[1],t[1]=t[3],t[3]=a,e[1]<0&&(a=t[2],t[2]=t[3],t[3]=a),t[2]*=e[1],t[3]*=e[1],e[2]<0&&(a=t[0],t[0]=t[1],t[1]=a),t[0]*=e[2],t[1]*=e[2]),t[0]+=e[4],t[1]+=e[4],t[2]+=e[5],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const a=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/a,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/a]}static getAxialAlignedBoundingBox(e,t){const a=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),s=this.applyTransform([e[2],e[1]],t);return[Math.min(a[0],i[0],n[0],s[0]),Math.min(a[1],i[1],n[1],s[1]),Math.max(a[0],i[0],n[0],s[0]),Math.max(a[1],i[1],n[1],s[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],a=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],s=e[2]*t[1]+e[3]*t[3],r=(a+s)/2,o=Math.sqrt((a+s)**2-4*(a*s-n*i))/2,l=r+o||1,c=r-o||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const a=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(a>i)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),s=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>s?null:[a,n,i,s]}static bezierBoundingBox(e,t,a,i,n,s,r,o){const l=[],c=[[],[]];let d,u,h,p,m,f,g,y;for(let c=0;c<2;++c)if(0===c?(u=6*e-12*a+6*n,d=-3*e+9*a-9*n+3*r,h=3*a-3*e):(u=6*t-12*i+6*s,d=-3*t+9*i-9*s+3*o,h=3*i-3*t),Math.abs(d)<1e-12){if(Math.abs(u)<1e-12)continue;p=-h/u,0<p&&p<1&&l.push(p)}else g=u*u-4*h*d,y=Math.sqrt(g),g<0||(m=(-u+y)/(2*d),0<m&&m<1&&l.push(m),f=(-u-y)/(2*d),0<f&&f<1&&l.push(f));let v,b=l.length;const A=b;for(;b--;)p=l[b],v=1-p,c[0][b]=v*v*v*e+3*v*v*p*a+3*v*p*p*n+p*p*p*r,c[1][b]=v*v*v*t+3*v*v*p*i+3*v*p*p*s+p*p*p*o;return c[0][A]=e,c[1][A]=t,c[0][A+1]=r,c[1][A+1]=o,c[0].length=c[1].length=A+2,[Math.min(...c[0]),Math.min(...c[1]),Math.max(...c[0]),Math.max(...c[1])]}}function j(e){return"object"==typeof e&&void 0!==e?.byteLength}class PromiseCapability{#yn=!1;constructor(){this.promise=new Promise(((e,t)=>{this.resolve=t=>{this.#yn=!0,e(t)},this.reject=e=>{this.#yn=!0,t(e)}}))}get settled(){return this.#yn}}let N=null,B=null;function q(e){return N||(N=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,B=new Map([["ï¬…","Å¿t"]])),e.replaceAll(N,((e,t,a)=>t?t.normalize("NFKC"):B.get(a)))}function z(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();const e=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(e);else for(let t=0;t<32;t++)e[t]=Math.floor(255*Math.random());return R(e)}const U="pdfjs_internal_id_"}},s={};function m(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return n[e](a,a.exports,m),a.exports}d="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",u="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",h="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",p=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},m.a=(e,t,a)=>{var i;a&&((i=[]).d=-1);var n,s,r,o=new Set,l=e.exports,c=new Promise(((e,t)=>{r=t,s=e}));c[u]=l,c[d]=e=>(i&&e(i),o.forEach(e),c.catch((e=>{}))),e.exports=c,t((e=>{var t;n=(e=>e.map((e=>{if(null!==e&&"object"==typeof e){if(e[d])return e;if(e.then){var t=[];t.d=0,e.then((e=>{a[u]=e,p(t)}),(e=>{a[h]=e,p(t)}));var a={};return a[d]=e=>e(t),a}}var i={};return i[d]=e=>{},i[u]=e,i})))(e);var a=()=>n.map((e=>{if(e[h])throw e[h];return e[u]})),s=new Promise((e=>{(t=()=>e(a)).r=0;var s=e=>e!==i&&!o.has(e)&&(o.add(e),e&&!e.d&&(t.r++,e.push(t)));n.map((e=>e[d](s)))}));return t.r?s:a()}),(e=>(e?r(c[h]=e):s(l),p(i)))),i&&i.d<0&&(i.d=0)},m.d=(e,t)=>{for(var a in t)m.o(t,a)&&!m.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=m(907),o=((r=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=r)).AbortException,r.AnnotationEditorLayer,r.AnnotationEditorParamsType,r.AnnotationEditorType,r.AnnotationEditorUIManager,r.AnnotationLayer,r.AnnotationMode,r.CMapCompressionType,r.DOMSVGFactory,r.DrawLayer,r.FeatureTest,r.GlobalWorkerOptions),l=(r.ImageKind,r.InvalidPDFException,r.MissingPDFException,r.OPS),c=(r.Outliner,r.PDFDataRangeTransport,r.PDFDateString,r.PDFWorker,r.PasswordResponses,r.PermissionFlag,r.PixelsPerInch,r.PromiseCapability,r.RenderingCancelledException,r.UnexpectedResponseException,r.Util,r.VerbosityLevel,r.XfaLayer,r.build,r.createValidAbsoluteUrl,r.fetchData,r.getDocument);r.getFilenameFromUrl,r.getPdfFilenameFromUrl,r.getXfaPageViewport,r.isDataScheme,r.isPdfFile,r.noContextMenu,r.normalizeUnicode,r.renderTextLayer,r.setLayerDimensions,r.shadow,r.updateTextLayer,r.version;i()}catch(f){i(f)}var d,u,h,p}),1)}},s={};function r(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return n[e].call(a.exports,a,a.exports,r),a.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",a="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},r.a=(n,s,r)=>{var o;r&&((o=[]).d=-1);var l,c,d,u=new Set,h=n.exports,p=new Promise(((e,t)=>{d=t,c=e}));p[t]=h,p[e]=e=>(o&&e(o),u.forEach(e),p.catch((e=>{}))),n.exports=p,s((n=>{var s;l=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var s=[];s.d=0,n.then((e=>{r[t]=e,i(s)}),(e=>{r[a]=e,i(s)}));var r={};return r[e]=e=>e(s),r}}var o={};return o[e]=e=>{},o[t]=n,o})))(n);var r=()=>l.map((e=>{if(e[a])throw e[a];return e[t]})),c=new Promise((t=>{(s=()=>t(r)).r=0;var a=e=>e!==o&&!u.has(e)&&(u.add(e),e&&!e.d&&(s.r++,e.push(s)));l.map((t=>t[e](a)))}));return s.r?c:r()}),(e=>(e?d(p[a]=e):c(h),i(o)))),o&&o.d<0&&(o.d=0)},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);r(8519)})();